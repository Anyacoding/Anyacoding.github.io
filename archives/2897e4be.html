<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>MySQL应知应会（二） | Anya の Blog</title><meta name="keywords" content="MySQL"><meta name="author" content="Anya"><meta name="copyright" content="Anya"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="使用子查询SQL 允许创建子查询，即嵌套在其他查询中的查询。我们在什么情况需要子查询呢？考虑下面这个列子。 使用子查询进行过滤有两个表，customer 表存储了客户的 ID 和客户的名字、邮箱等信息；payment 表存储了 payment_id 和对应的客户的 ID。现在，假如要列出 payment_id 为 1001 的所有客户的名字和邮箱，我们该如何检索？  检索所有 payment_id">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL应知应会（二）">
<meta property="og:url" content="https://anya.cool/archives/2897e4be.html">
<meta property="og:site_name" content="Anya の Blog">
<meta property="og:description" content="使用子查询SQL 允许创建子查询，即嵌套在其他查询中的查询。我们在什么情况需要子查询呢？考虑下面这个列子。 使用子查询进行过滤有两个表，customer 表存储了客户的 ID 和客户的名字、邮箱等信息；payment 表存储了 payment_id 和对应的客户的 ID。现在，假如要列出 payment_id 为 1001 的所有客户的名字和邮箱，我们该如何检索？  检索所有 payment_id">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/104493943_p0_master1200.jpg">
<meta property="article:published_time" content="2023-01-21T08:51:46.165Z">
<meta property="article:modified_time" content="2023-01-31T03:37:25.304Z">
<meta property="article:author" content="Anya">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/104493943_p0_master1200.jpg"><link rel="shortcut icon" href="/./img/maomao.jpeg"><link rel="canonical" href="https://anya.cool/archives/2897e4be"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="code-kmx2JXFUqP"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":1000},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Anya","link":"链接: ","source":"来源: Anya の Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MySQL应知应会（二）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-01-31 11:37:25'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/style.css"><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.1.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/maomao.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">25</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">18</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Anya の Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">MySQL应知应会（二）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-01-21T08:51:46.165Z" title="发表于 2023-01-21 16:51:46">2023-01-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-01-31T03:37:25.304Z" title="更新于 2023-01-31 11:37:25">2023-01-31</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/MySQL/">MySQL</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">9.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>35分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="MySQL应知应会（二）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div><article class="post-content" id="article-container"><h1 id="使用子查询"><a href="#使用子查询" class="headerlink" title="使用子查询"></a>使用子查询</h1><p><strong><em>SQL</em></strong> 允许创建子查询，即嵌套在其他查询中的查询。我们在什么情况需要子查询呢？考虑下面这个列子。</p>
<h2 id="使用子查询进行过滤"><a href="#使用子查询进行过滤" class="headerlink" title="使用子查询进行过滤"></a>使用子查询进行过滤</h2><p>有两个表，<strong><em>customer</em></strong> 表存储了客户的 <strong><em>ID</em></strong> 和客户的名字、邮箱等信息；<strong><em>payment</em></strong> 表存储了 <strong><em>payment_id</em></strong> 和对应的客户的 <strong><em>ID</em></strong>。现在，假如要列出 <strong><em>payment_id</em></strong> 为 <strong><em>1001</em></strong> 的所有客户的名字和邮箱，我们该如何检索？</p>
<ol>
<li>检索所有 <strong><em>payment_id</em></strong> 为 <strong><em>1001</em></strong> 的客户编号</li>
<li>返回前一步检索出来的所有客户 <strong><em>ID</em></strong> 的客户信息</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> first_name, email</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> customer</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> customer_id <span class="keyword">IN</span>(<span class="keyword">SELECT</span> customer_id</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>                      <span class="keyword">FROM</span> payment</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>                      <span class="keyword">WHERE</span> payment_id <span class="operator">=</span> <span class="number">1001</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">------------+-----------------------------------+</span></span><br><span class="line"><span class="operator">|</span> first_name <span class="operator">|</span> email                             <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-----------------------------------+</span></span><br><span class="line"><span class="operator">|</span> KATHLEEN   <span class="operator">|</span> KATHLEEN.ADAMS<span class="variable">@sakilacustomer</span>.org <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-----------------------------------+</span></span><br></pre></td></tr></table></figure>
<p>在 <strong><em>SELECT</em></strong> 语句中，子查询总是 <strong><em>从内向外</em></strong> 处理的。在处理上面的 <strong><em>SELECT</em></strong> 语句是，<strong><em>MySQL</em></strong> 实际上执行了两个操作。</p>
<p>首先，他执行查询下面的查询：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> customer_id</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> payment</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> payment_id <span class="operator">=</span> <span class="number">1001</span>;</span><br></pre></td></tr></table></figure><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="operator">|</span> customer_id <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="operator">|</span>          <span class="number">36</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br></pre></td></tr></table></figure><br>此查询返回一个客户 <strong><em>ID</em></strong>：<strong><em>36</em></strong>，然后，外部查询变成：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> first_name, email</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> customer</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> customer_id <span class="keyword">IN</span>(<span class="number">36</span>);</span><br></pre></td></tr></table></figure><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">------------+-----------------------------------+</span></span><br><span class="line"><span class="operator">|</span> first_name <span class="operator">|</span> email                             <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-----------------------------------+</span></span><br><span class="line"><span class="operator">|</span> KATHLEEN   <span class="operator">|</span> KATHLEEN.ADAMS<span class="variable">@sakilacustomer</span>.org <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-----------------------------------+</span></span><br></pre></td></tr></table></figure><br>可以看到，输出与前面硬编码 <strong><em>WHERE</em></strong> 子句返回的值相同。</p>
<h2 id="作为计算字段使用子查询"><a href="#作为计算字段使用子查询" class="headerlink" title="作为计算字段使用子查询"></a>作为计算字段使用子查询</h2><p>使用子查询的另一方法是创建计算字段。假如我们需要显示 <strong><em>customer</em></strong> 表中每个客户的订单总数。订单与相应的客户 <strong><em>ID</em></strong> 存储字 <strong><em>payment</em></strong> 表中。我们需要执行以下两个步骤：</p>
<ol>
<li>从 <strong><em>customer</em></strong> 表中检索除客户列表</li>
<li>对于检索出的每个客户，统计其在 <strong><em>payment</em></strong> 表中的订单数目</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> first_name, </span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>              email,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>              (<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>)</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>               <span class="keyword">FROM</span> payment</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>               <span class="keyword">WHERE</span> customer.customer_id <span class="operator">=</span> payment.customer_id) <span class="keyword">AS</span> payments</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> customer;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">-------------+------------------------------------------+----------+</span></span><br><span class="line"><span class="operator">|</span> first_name  <span class="operator">|</span> email                                    <span class="operator">|</span> payments <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+------------------------------------------+----------+</span></span><br><span class="line"><span class="operator">|</span> MARY        <span class="operator">|</span> MARY.SMITH<span class="variable">@sakilacustomer</span>.org            <span class="operator">|</span>       <span class="number">32</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> PATRICIA    <span class="operator">|</span> PATRICIA.JOHNSON<span class="variable">@sakilacustomer</span>.org      <span class="operator">|</span>       <span class="number">27</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> LINDA       <span class="operator">|</span> LINDA.WILLIAMS<span class="variable">@sakilacustomer</span>.org        <span class="operator">|</span>       <span class="number">26</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> BARBARA     <span class="operator">|</span> BARBARA.JONES<span class="variable">@sakilacustomer</span>.org         <span class="operator">|</span>       <span class="number">22</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> ELIZABETH   <span class="operator">|</span> ELIZABETH.BROWN<span class="variable">@sakilacustomer</span>.org       <span class="operator">|</span>       <span class="number">38</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> JENNIFER    <span class="operator">|</span> JENNIFER.DAVIS<span class="variable">@sakilacustomer</span>.org        <span class="operator">|</span>       <span class="number">28</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARIA       <span class="operator">|</span> MARIA.MILLER<span class="variable">@sakilacustomer</span>.org          <span class="operator">|</span>       <span class="number">33</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> SUSAN       <span class="operator">|</span> SUSAN.WILSON<span class="variable">@sakilacustomer</span>.org          <span class="operator">|</span>       <span class="number">24</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARGARET    <span class="operator">|</span> MARGARET.MOORE<span class="variable">@sakilacustomer</span>.org        <span class="operator">|</span>       <span class="number">23</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> DOROTHY     <span class="operator">|</span> DOROTHY.TAYLOR<span class="variable">@sakilacustomer</span>.org        <span class="operator">|</span>       <span class="number">25</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+------------------------------------------+----------+</span></span><br></pre></td></tr></table></figure>
<p>子查询中的 <strong><em>WHERE</em></strong> 子句与前面使用的 <strong><em>WHERE</em></strong> 子句稍有不同，因为它使用了完全限定列名。这种类型的子查询称为相关子查询。</p>
<div class="note success flat"><p><strong><em>相关子查询</em></strong><br>涉及外部查询的子查询。</p>
</div> 
<h1 id="联结表"><a href="#联结表" class="headerlink" title="联结表"></a>联结表</h1><p><strong><em>SQL</em></strong> 最强大的功能之一，就是能在数据检索查询的执行中联结表。</p>
<div class="note warning flat"><p><strong><em>维护引用完整性</em></strong><br>重要的是，要理解联结不是物理实体。换句话说，他在实际的数据库表中不存在。联结由 <strong><em>MySQL</em></strong> 根据需要建立，它存在与查询的执行当中。</p>
<p>在使用关系表时，仅在关系列中插入合法的数据非常重要。假设在一个 <strong><em>products</em></strong> 表中插入拥有非法供应商 <strong><em>ID</em></strong> （即没有在 <strong><em>vendors</em></strong> 表中出现）的供应商生产的产品，则这些产品是不可访问的，因为它们没有关联到某个供应商。</p>
<p>为了防止这种情况发生，可指示 <strong><em>MySQL</em></strong> 只允许在 <strong><em>products</em></strong> 表的供应商 <strong><em>ID</em></strong> 出现合法值，这就是维护引用完整性。它是通过在表的定义中指定主键和外键来实现的。</p>
</div> 
<div class="note success flat"><p><strong><em>主键</em></strong><br>一列（或一组列），其值能够唯一区分表中每个行。</p>
</div> 
<div class="note success flat"><p><strong><em>外键</em></strong><br>外键为某个表中的一列，它包含另一个表的主键值，定义了两个表之间的关系。</p>
</div> 
<h2 id="创建联结"><a href="#创建联结" class="headerlink" title="创建联结"></a>创建联结</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> first_name, amount</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> customer, payment</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> customer.customer_id <span class="operator">=</span> payment.customer_id;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">------------+--------+</span></span><br><span class="line"><span class="operator">|</span> first_name <span class="operator">|</span> amount <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+--------+</span></span><br><span class="line"><span class="operator">|</span> MARY       <span class="operator">|</span>   <span class="number">2.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY       <span class="operator">|</span>   <span class="number">0.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY       <span class="operator">|</span>   <span class="number">5.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY       <span class="operator">|</span>   <span class="number">0.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY       <span class="operator">|</span>   <span class="number">9.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY       <span class="operator">|</span>   <span class="number">4.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY       <span class="operator">|</span>   <span class="number">4.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY       <span class="operator">|</span>   <span class="number">0.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY       <span class="operator">|</span>   <span class="number">3.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY       <span class="operator">|</span>   <span class="number">5.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+--------+</span></span><br></pre></td></tr></table></figure>
<p>现在来看 <strong><em>FROM</em></strong> 子句，与以前的 <strong><em>SELECT</em></strong> 语句不一样，这条语句的 <strong><em>FROM</em></strong> 子句列出了两个表，分别是 <strong><em>customer</em></strong> 和 <strong><em>payment</em></strong> 。他们就是这条 <strong><em>SELECT</em></strong> 语句联结的两个表的名字。这两个表用 <strong><em>WHERE</em></strong> 子句正确联结，它指示了 <strong><em>MySQL</em></strong> 匹配 <strong><em>customer</em></strong> 中的 <strong><em>customer_id</em></strong> 和 <strong><em>payment</em></strong> 中的 <strong><em>customer_id</em></strong>。</p>
<div class="note warning flat"><p><strong><em>不要忘了WHERE子句</em></strong><br>应该保证所有联结都有 <strong><em>WHERE</em></strong> 子句，否则 <strong><em>MySQL</em></strong> 将返回比想要的数据多得多的数据。同理，应该保持 <strong><em>WHERE</em></strong> 子句的正确性，不正确的 <strong><em>WHERE</em></strong> 子句将导致返回不正确的数据。</p>
</div> 
<h2 id="内部联结"><a href="#内部联结" class="headerlink" title="内部联结"></a>内部联结</h2><p>目前所用的联结称为等值联结，它基于两个表之间的相等测试。这种联结也称为内部联结。对于这种联结，可以使用稍微不同的语法来明确联结类型：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> first_name, amount</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> customer <span class="keyword">INNER</span> <span class="keyword">JOIN</span> payment</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">ON</span> customer.customer_id <span class="operator">=</span> payment.customer_id;</span><br></pre></td></tr></table></figure><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">------------+--------+</span></span><br><span class="line"><span class="operator">|</span> first_name <span class="operator">|</span> amount <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+--------+</span></span><br><span class="line"><span class="operator">|</span> MARY       <span class="operator">|</span>   <span class="number">2.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY       <span class="operator">|</span>   <span class="number">0.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY       <span class="operator">|</span>   <span class="number">5.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY       <span class="operator">|</span>   <span class="number">0.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY       <span class="operator">|</span>   <span class="number">9.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY       <span class="operator">|</span>   <span class="number">4.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY       <span class="operator">|</span>   <span class="number">4.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY       <span class="operator">|</span>   <span class="number">0.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY       <span class="operator">|</span>   <span class="number">3.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY       <span class="operator">|</span>   <span class="number">5.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+--------+</span></span><br></pre></td></tr></table></figure><br>可以看到两种语法返回的结果相同。</p>
<div class="note success flat"><p><strong><em>使用哪种语法</em></strong><br><strong><em>ANSI SQL</em></strong> 首选 <strong><em>INNER JOIN</em></strong> 语法。此外，尽管使用 <strong><em>WHERE</em></strong> 子句定义联结确实比较简单，但使用明确的联结语法能够保证不会忘记联结条件。</p>
</div> 
<h2 id="联结多个表"><a href="#联结多个表" class="headerlink" title="联结多个表"></a>联结多个表</h2><p><strong><em>SQL</em></strong> 对一条 <strong><em>SELECT</em></strong> 语句中可以联结的表的数目没有限制。创建联结的基本规则也相同。</p>
<p>考虑前面提到的子查询的例子，我们可以使用联结达到同样的效果：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> first_name, email</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> customer, payment</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> customer.customer_id <span class="operator">=</span> payment.customer_id <span class="keyword">AND</span> payment_id <span class="operator">=</span> <span class="number">1001</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">------------+-----------------------------------+</span></span><br><span class="line"><span class="operator">|</span> first_name <span class="operator">|</span> email                             <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-----------------------------------+</span></span><br><span class="line"><span class="operator">|</span> KATHLEEN   <span class="operator">|</span> KATHLEEN.ADAMS<span class="variable">@sakilacustomer</span>.org <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-----------------------------------+</span></span><br></pre></td></tr></table></figure>
<div class="note warning flat"><p><strong><em>多做实验</em></strong><br>正如所见，为执行任一给定的 <strong><em>SQL</em></strong> 操作，一般存在不止一种方法。很少有绝对正确或绝对错误的方法。因此有必要对不同的机制进行实验，以找出最合适的方法。</p>
</div> 
<h1 id="创建高级联结"><a href="#创建高级联结" class="headerlink" title="创建高级联结"></a>创建高级联结</h1><h2 id="使用表别名"><a href="#使用表别名" class="headerlink" title="使用表别名"></a>使用表别名</h2><p>使用表别名的理有</p>
<ul>
<li>缩短 <strong><em>SQL</em></strong> 语句</li>
<li>允许在单条 <strong><em>SELECT</em></strong> 语句中多次使用相同的表</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> first_name, amount</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> customer <span class="keyword">AS</span> c, payment <span class="keyword">AS</span> p</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> c.customer_id <span class="operator">=</span> p.customer_id;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">------------+--------+</span></span><br><span class="line"><span class="operator">|</span> first_name <span class="operator">|</span> amount <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+--------+</span></span><br><span class="line"><span class="operator">|</span> MARY       <span class="operator">|</span>   <span class="number">2.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY       <span class="operator">|</span>   <span class="number">0.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY       <span class="operator">|</span>   <span class="number">5.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY       <span class="operator">|</span>   <span class="number">0.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY       <span class="operator">|</span>   <span class="number">9.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY       <span class="operator">|</span>   <span class="number">4.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY       <span class="operator">|</span>   <span class="number">4.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY       <span class="operator">|</span>   <span class="number">0.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY       <span class="operator">|</span>   <span class="number">3.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY       <span class="operator">|</span>   <span class="number">5.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+--------+</span></span><br></pre></td></tr></table></figure>
<p>需要注意的是，表别名只在查询执行中使用。与列别名不一样，表别名不返回到客户机。</p>
<h2 id="自联结"><a href="#自联结" class="headerlink" title="自联结"></a>自联结</h2><p>使用表别名的主要原因之一是能在单条 <strong><em>SELECT</em></strong> 语句中不止一次引用相同的表，看下面的例子：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> first_name, email</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> customer <span class="keyword">AS</span> c1, customer <span class="keyword">AS</span> c2</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> c1.customer_id <span class="operator">=</span> c2.customer_id</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>       <span class="keyword">AND</span> c2.store_id <span class="operator">=</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">------------+------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> first_name <span class="operator">|</span> email                                    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> BARBARA    <span class="operator">|</span> BARBARA.JONES<span class="variable">@sakilacustomer</span>.org         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> JENNIFER   <span class="operator">|</span> JENNIFER.DAVIS<span class="variable">@sakilacustomer</span>.org        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> SUSAN      <span class="operator">|</span> SUSAN.WILSON<span class="variable">@sakilacustomer</span>.org          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARGARET   <span class="operator">|</span> MARGARET.MOORE<span class="variable">@sakilacustomer</span>.org        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> LISA       <span class="operator">|</span> LISA.ANDERSON<span class="variable">@sakilacustomer</span>.org         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> KAREN      <span class="operator">|</span> KAREN.JACKSON<span class="variable">@sakilacustomer</span>.org         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> BETTY      <span class="operator">|</span> BETTY.WHITE<span class="variable">@sakilacustomer</span>.org           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> SANDRA     <span class="operator">|</span> SANDRA.MARTIN<span class="variable">@sakilacustomer</span>.org         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> CAROL      <span class="operator">|</span> CAROL.GARCIA<span class="variable">@sakilacustomer</span>.org          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> SHARON     <span class="operator">|</span> SHARON.ROBINSON<span class="variable">@sakilacustomer</span>.org       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> SARAH      <span class="operator">|</span> SARAH.LEWIS<span class="variable">@sakilacustomer</span>.org           <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+------------------------------------------+</span></span><br></pre></td></tr></table></figure></p>
<p>此查询中需要的两个表实际上是相同的表，因此 <strong><em>customer</em></strong> 表在 <strong><em>FROM</em></strong> 子句中出现了两次。虽然这完全合法，但对 <strong><em>customer</em></strong> 表的引用具有二义性，因为 <strong><em>MySQL</em></strong> 不知道你引用的是 <strong><em>customer</em></strong> 表的哪个实例。</p>
<p>为解决此问题，才使用了表别名。<br><div class="note warning flat"><p><strong><em>用自联结而不是子查询</em></strong><br>虽然最终的结果是相同的，但有时候处理联结远比处理子查询快得多。应该试一下两种方法，以确定哪一种性能更好。</p>
</div> </p>
<h2 id="自然联结"><a href="#自然联结" class="headerlink" title="自然联结"></a>自然联结</h2><p>自然联结排除多次出现，使每个列只返回一次。系统不完成这项工作，需要有我们自己完成它。这一般是通过对表使用通配符，对所有其他表的列使用明确的子集来完成：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> p.<span class="operator">*</span>, c.first_name</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> customer <span class="keyword">AS</span> c, payment <span class="keyword">AS</span> p</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> c.customer_id <span class="operator">=</span> p.customer_id;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">------------+-------------+----------+-----------+--------+---------------------+---------------------+-------------+</span></span><br><span class="line"><span class="operator">|</span> payment_id <span class="operator">|</span> customer_id <span class="operator">|</span> staff_id <span class="operator">|</span> rental_id <span class="operator">|</span> amount <span class="operator">|</span> payment_date        <span class="operator">|</span> last_update         <span class="operator">|</span> first_name  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-------------+----------+-----------+--------+---------------------+---------------------+-------------+</span></span><br><span class="line"><span class="operator">|</span>          <span class="number">1</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span>        <span class="number">1</span> <span class="operator">|</span>        <span class="number">76</span> <span class="operator">|</span>   <span class="number">2.99</span> <span class="operator">|</span> <span class="number">2005</span><span class="number">-05</span><span class="number">-25</span> <span class="number">11</span>:<span class="number">30</span>:<span class="number">37</span> <span class="operator">|</span> <span class="number">2006</span><span class="number">-02</span><span class="number">-15</span> <span class="number">22</span>:<span class="number">12</span>:<span class="number">30</span> <span class="operator">|</span> MARY        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>          <span class="number">2</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span>        <span class="number">1</span> <span class="operator">|</span>       <span class="number">573</span> <span class="operator">|</span>   <span class="number">0.99</span> <span class="operator">|</span> <span class="number">2005</span><span class="number">-05</span><span class="number">-28</span> <span class="number">10</span>:<span class="number">35</span>:<span class="number">23</span> <span class="operator">|</span> <span class="number">2006</span><span class="number">-02</span><span class="number">-15</span> <span class="number">22</span>:<span class="number">12</span>:<span class="number">30</span> <span class="operator">|</span> MARY        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>          <span class="number">3</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span>        <span class="number">1</span> <span class="operator">|</span>      <span class="number">1185</span> <span class="operator">|</span>   <span class="number">5.99</span> <span class="operator">|</span> <span class="number">2005</span><span class="number">-06</span><span class="number">-15</span> <span class="number">00</span>:<span class="number">54</span>:<span class="number">12</span> <span class="operator">|</span> <span class="number">2006</span><span class="number">-02</span><span class="number">-15</span> <span class="number">22</span>:<span class="number">12</span>:<span class="number">30</span> <span class="operator">|</span> MARY        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>          <span class="number">4</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span>        <span class="number">2</span> <span class="operator">|</span>      <span class="number">1422</span> <span class="operator">|</span>   <span class="number">0.99</span> <span class="operator">|</span> <span class="number">2005</span><span class="number">-06</span><span class="number">-15</span> <span class="number">18</span>:<span class="number">02</span>:<span class="number">53</span> <span class="operator">|</span> <span class="number">2006</span><span class="number">-02</span><span class="number">-15</span> <span class="number">22</span>:<span class="number">12</span>:<span class="number">30</span> <span class="operator">|</span> MARY        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>          <span class="number">5</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span>        <span class="number">2</span> <span class="operator">|</span>      <span class="number">1476</span> <span class="operator">|</span>   <span class="number">9.99</span> <span class="operator">|</span> <span class="number">2005</span><span class="number">-06</span><span class="number">-15</span> <span class="number">21</span>:<span class="number">08</span>:<span class="number">46</span> <span class="operator">|</span> <span class="number">2006</span><span class="number">-02</span><span class="number">-15</span> <span class="number">22</span>:<span class="number">12</span>:<span class="number">30</span> <span class="operator">|</span> MARY        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>          <span class="number">6</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span>        <span class="number">1</span> <span class="operator">|</span>      <span class="number">1725</span> <span class="operator">|</span>   <span class="number">4.99</span> <span class="operator">|</span> <span class="number">2005</span><span class="number">-06</span><span class="number">-16</span> <span class="number">15</span>:<span class="number">18</span>:<span class="number">57</span> <span class="operator">|</span> <span class="number">2006</span><span class="number">-02</span><span class="number">-15</span> <span class="number">22</span>:<span class="number">12</span>:<span class="number">30</span> <span class="operator">|</span> MARY        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>          <span class="number">7</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span>        <span class="number">1</span> <span class="operator">|</span>      <span class="number">2308</span> <span class="operator">|</span>   <span class="number">4.99</span> <span class="operator">|</span> <span class="number">2005</span><span class="number">-06</span><span class="number">-18</span> <span class="number">08</span>:<span class="number">41</span>:<span class="number">48</span> <span class="operator">|</span> <span class="number">2006</span><span class="number">-02</span><span class="number">-15</span> <span class="number">22</span>:<span class="number">12</span>:<span class="number">30</span> <span class="operator">|</span> MARY        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>          <span class="number">8</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span>        <span class="number">2</span> <span class="operator">|</span>      <span class="number">2363</span> <span class="operator">|</span>   <span class="number">0.99</span> <span class="operator">|</span> <span class="number">2005</span><span class="number">-06</span><span class="number">-18</span> <span class="number">13</span>:<span class="number">33</span>:<span class="number">59</span> <span class="operator">|</span> <span class="number">2006</span><span class="number">-02</span><span class="number">-15</span> <span class="number">22</span>:<span class="number">12</span>:<span class="number">30</span> <span class="operator">|</span> MARY        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>          <span class="number">9</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span>        <span class="number">1</span> <span class="operator">|</span>      <span class="number">3284</span> <span class="operator">|</span>   <span class="number">3.99</span> <span class="operator">|</span> <span class="number">2005</span><span class="number">-06</span><span class="number">-21</span> <span class="number">06</span>:<span class="number">24</span>:<span class="number">45</span> <span class="operator">|</span> <span class="number">2006</span><span class="number">-02</span><span class="number">-15</span> <span class="number">22</span>:<span class="number">12</span>:<span class="number">30</span> <span class="operator">|</span> MARY        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>         <span class="number">10</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span>        <span class="number">2</span> <span class="operator">|</span>      <span class="number">4526</span> <span class="operator">|</span>   <span class="number">5.99</span> <span class="operator">|</span> <span class="number">2005</span><span class="number">-07</span><span class="number">-08</span> <span class="number">03</span>:<span class="number">17</span>:<span class="number">05</span> <span class="operator">|</span> <span class="number">2006</span><span class="number">-02</span><span class="number">-15</span> <span class="number">22</span>:<span class="number">12</span>:<span class="number">30</span> <span class="operator">|</span> MARY        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>         <span class="number">11</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span>        <span class="number">1</span> <span class="operator">|</span>      <span class="number">4611</span> <span class="operator">|</span>   <span class="number">5.99</span> <span class="operator">|</span> <span class="number">2005</span><span class="number">-07</span><span class="number">-08</span> <span class="number">07</span>:<span class="number">33</span>:<span class="number">56</span> <span class="operator">|</span> <span class="number">2006</span><span class="number">-02</span><span class="number">-15</span> <span class="number">22</span>:<span class="number">12</span>:<span class="number">30</span> <span class="operator">|</span> MARY        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>         <span class="number">12</span> <span class="operator">|</span>           <span class="number">1</span> <span class="operator">|</span>        <span class="number">1</span> <span class="operator">|</span>      <span class="number">5244</span> <span class="operator">|</span>   <span class="number">4.99</span> <span class="operator">|</span> <span class="number">2005</span><span class="number">-07</span><span class="number">-09</span> <span class="number">13</span>:<span class="number">24</span>:<span class="number">07</span> <span class="operator">|</span> <span class="number">2006</span><span class="number">-02</span><span class="number">-15</span> <span class="number">22</span>:<span class="number">12</span>:<span class="number">30</span> <span class="operator">|</span> MARY        <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-------------+----------+-----------+--------+---------------------+---------------------+-------------+</span></span><br></pre></td></tr></table></figure>
<p>可以看到，没有重复的列被检索出来。</p>
<h2 id="外部联结"><a href="#外部联结" class="headerlink" title="外部联结"></a>外部联结</h2><p>许多联结将一个表中的行于另一个表的行相关联，但有时候会需要包含没有关联行的那些行。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> first_name, amount</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> customer <span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> payment</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">ON</span> customer.customer_id <span class="operator">=</span> payment.customer_id;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">-------------+--------+</span></span><br><span class="line"><span class="operator">|</span> first_name  <span class="operator">|</span> amount <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+--------+</span></span><br><span class="line"><span class="operator">|</span> MARY        <span class="operator">|</span>   <span class="number">2.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY        <span class="operator">|</span>   <span class="number">0.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY        <span class="operator">|</span>   <span class="number">5.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY        <span class="operator">|</span>   <span class="number">0.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY        <span class="operator">|</span>   <span class="number">9.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY        <span class="operator">|</span>   <span class="number">4.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY        <span class="operator">|</span>   <span class="number">4.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY        <span class="operator">|</span>   <span class="number">0.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY        <span class="operator">|</span>   <span class="number">3.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY        <span class="operator">|</span>   <span class="number">5.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY        <span class="operator">|</span>   <span class="number">5.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARY        <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+--------+</span></span><br></pre></td></tr></table></figure>
<p>与内部联结关联两个表的行不同的是，外部联结还包括没有关联行的行。在使用 <strong><em>OUTER JOIN</em></strong> 语法时，必须使用 <strong><em>RIGHT</em></strong> 或 <strong><em>LEFT</em></strong> 关键字指定包含其所有行的表（<strong><em>RIGHT</em></strong> 指出的是 <strong><em>OUTER JOIN</em></strong> 右边的表，<strong><em>LEFT</em></strong> 同理）。</p>
<div class="note warning flat"><p><strong><em>外部联结的类型</em></strong><br>存在两种基本的外部联结形式：左外部联结和右外部联结。它们之间可以通过颠倒 <strong><em>FROM</em></strong> 子句的顺序互相转换。而究竟使用哪一种纯粹是根据方便而定。</p>
</div> 
<h2 id="使用带聚集函数的联结"><a href="#使用带聚集函数的联结" class="headerlink" title="使用带聚集函数的联结"></a>使用带聚集函数的联结</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> customer.first_name, </span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>        customer.email,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>        (<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(payment_id)) <span class="keyword">AS</span> payments</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> customer, payment           </span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> customer.customer_id <span class="operator">=</span> payment.customer_id</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> customer.email;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">-------------+------------------------------------------+----------+</span></span><br><span class="line"><span class="operator">|</span> first_name  <span class="operator">|</span> email                                    <span class="operator">|</span> payments <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+------------------------------------------+----------+</span></span><br><span class="line"><span class="operator">|</span> MARY        <span class="operator">|</span> MARY.SMITH<span class="variable">@sakilacustomer</span>.org            <span class="operator">|</span>       <span class="number">32</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> PATRICIA    <span class="operator">|</span> PATRICIA.JOHNSON<span class="variable">@sakilacustomer</span>.org      <span class="operator">|</span>       <span class="number">27</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> LINDA       <span class="operator">|</span> LINDA.WILLIAMS<span class="variable">@sakilacustomer</span>.org        <span class="operator">|</span>       <span class="number">26</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> BARBARA     <span class="operator">|</span> BARBARA.JONES<span class="variable">@sakilacustomer</span>.org         <span class="operator">|</span>       <span class="number">22</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> ELIZABETH   <span class="operator">|</span> ELIZABETH.BROWN<span class="variable">@sakilacustomer</span>.org       <span class="operator">|</span>       <span class="number">38</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> JENNIFER    <span class="operator">|</span> JENNIFER.DAVIS<span class="variable">@sakilacustomer</span>.org        <span class="operator">|</span>       <span class="number">28</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARIA       <span class="operator">|</span> MARIA.MILLER<span class="variable">@sakilacustomer</span>.org          <span class="operator">|</span>       <span class="number">33</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> SUSAN       <span class="operator">|</span> SUSAN.WILSON<span class="variable">@sakilacustomer</span>.org          <span class="operator">|</span>       <span class="number">24</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARGARET    <span class="operator">|</span> MARGARET.MOORE<span class="variable">@sakilacustomer</span>.org        <span class="operator">|</span>       <span class="number">23</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> DOROTHY     <span class="operator">|</span> DOROTHY.TAYLOR<span class="variable">@sakilacustomer</span>.org        <span class="operator">|</span>       <span class="number">25</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+------------------------------------------+----------+</span></span><br></pre></td></tr></table></figure>
<h2 id="使用联结和连接条件"><a href="#使用联结和连接条件" class="headerlink" title="使用联结和连接条件"></a>使用联结和连接条件</h2><ul>
<li>注意所使用的联结类型。一般我们使用内部联结，但使用外部联结也是有效的。</li>
<li>保证使用正确的联结条件，否则将返回不正确的数据。</li>
<li>应该总是提供联结条件，否则会得出笛卡儿积。</li>
<li>在一个联结中可以包含多个表，甚至对于每个联结可以采用不同的联结类型。虽然这样做一般也很有用，但应该在一起测试它们之前，分别测试每个联结，这将有利于排除 <strong><em>bug</em></strong>。</li>
</ul>
<h1 id="组合查询"><a href="#组合查询" class="headerlink" title="组合查询"></a>组合查询</h1><p>有两种基本情况，需要使用组合查询：</p>
<ul>
<li>在单个查询中从不同的表返回类似结构的数据</li>
<li>对单个表执行多个查询，按单个表查询返回数据</li>
</ul>
<h2 id="使用UNION"><a href="#使用UNION" class="headerlink" title="使用UNION"></a>使用UNION</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> payment_id, customer_id, amount</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> payment</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> amount <span class="operator">&gt;=</span> <span class="number">10</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">UNION</span> </span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">SELECT</span> payment_id, customer_id, amount</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> payment</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> payment_id <span class="keyword">IN</span>(<span class="number">1000</span>, <span class="number">1001</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">------------+-------------+--------+</span></span><br><span class="line"><span class="operator">|</span> payment_id <span class="operator">|</span> customer_id <span class="operator">|</span> amount <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-------------+--------+</span></span><br><span class="line"><span class="operator">|</span>         <span class="number">44</span> <span class="operator">|</span>           <span class="number">2</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>         <span class="number">69</span> <span class="operator">|</span>           <span class="number">3</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">324</span> <span class="operator">|</span>          <span class="number">12</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">342</span> <span class="operator">|</span>          <span class="number">13</span> <span class="operator">|</span>  <span class="number">11.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">551</span> <span class="operator">|</span>          <span class="number">21</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">793</span> <span class="operator">|</span>          <span class="number">29</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">908</span> <span class="operator">|</span>          <span class="number">33</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">1254</span> <span class="operator">|</span>          <span class="number">45</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">1347</span> <span class="operator">|</span>          <span class="number">49</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>      <span class="number">15850</span> <span class="operator">|</span>         <span class="number">592</span> <span class="operator">|</span>  <span class="number">11.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>      <span class="number">15947</span> <span class="operator">|</span>         <span class="number">595</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">1000</span> <span class="operator">|</span>          <span class="number">36</span> <span class="operator">|</span>   <span class="number">2.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">1001</span> <span class="operator">|</span>          <span class="number">36</span> <span class="operator">|</span>   <span class="number">2.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-------------+--------+</span></span><br></pre></td></tr></table></figure>
<p><strong><em>UNION</em></strong> 指示 <strong><em>MySQL</em></strong> 执行两条 <strong><em>SELECT</em></strong> 语句，并把输出组合成单个查询结果集。</p>
<p>这里同时给出等价的使用 <strong><em>WHERE</em></strong> 子句的写法：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> payment_id, customer_id, amount</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> payment</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> amount <span class="operator">&gt;=</span> <span class="number">10</span> <span class="keyword">OR</span> payment_id <span class="keyword">IN</span>(<span class="number">1000</span>, <span class="number">1001</span>);</span><br></pre></td></tr></table></figure><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">------------+-------------+--------+</span></span><br><span class="line"><span class="operator">|</span> payment_id <span class="operator">|</span> customer_id <span class="operator">|</span> amount <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-------------+--------+</span></span><br><span class="line"><span class="operator">|</span>         <span class="number">44</span> <span class="operator">|</span>           <span class="number">2</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>         <span class="number">69</span> <span class="operator">|</span>           <span class="number">3</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">324</span> <span class="operator">|</span>          <span class="number">12</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">342</span> <span class="operator">|</span>          <span class="number">13</span> <span class="operator">|</span>  <span class="number">11.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">551</span> <span class="operator">|</span>          <span class="number">21</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">793</span> <span class="operator">|</span>          <span class="number">29</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">908</span> <span class="operator">|</span>          <span class="number">33</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">1254</span> <span class="operator">|</span>          <span class="number">45</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">1347</span> <span class="operator">|</span>          <span class="number">49</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>      <span class="number">15850</span> <span class="operator">|</span>         <span class="number">592</span> <span class="operator">|</span>  <span class="number">11.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>      <span class="number">15947</span> <span class="operator">|</span>         <span class="number">595</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">1000</span> <span class="operator">|</span>          <span class="number">36</span> <span class="operator">|</span>   <span class="number">2.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">1001</span> <span class="operator">|</span>          <span class="number">36</span> <span class="operator">|</span>   <span class="number">2.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-------------+--------+</span></span><br></pre></td></tr></table></figure><br>在这个例子中，使用 <strong><em>UNION</em></strong> 可能看起来更复杂，但对于更复杂的过滤条件，使用 <strong><em>UNION</em></strong> 可能会使处理更简单。</p>
<h2 id="UNION规则"><a href="#UNION规则" class="headerlink" title="UNION规则"></a>UNION规则</h2><p>有几条规则需要注意：</p>
<ul>
<li><strong><em>UNION</em></strong> 必须由两条或两条以上的 <strong><em>SELECT</em></strong> 语句，语句之间用关键字 <strong><em>UNION</em></strong> 分割（如果有四条 <strong><em>SELECT</em></strong> 语句，将使用三个 <strong><em>UNION</em></strong>）</li>
<li><strong><em>UNION</em></strong> 中的每个查询必须包含相同的列，表达式或聚集函数</li>
<li>列数据类型必须兼容：类型不必完全相同，但必须是 <strong><em>DBMS</em></strong> 可以隐含地转换的类型</li>
</ul>
<h2 id="包含或取消重复的行"><a href="#包含或取消重复的行" class="headerlink" title="包含或取消重复的行"></a>包含或取消重复的行</h2><p><strong><em>UNION</em></strong> 的默认行为会自动去除重复的行（换句话说，它的行为与单条 <strong><em>SELECT</em></strong> 语句中使用多个 <strong><em>WHERE</em></strong> 子句条件一样）。</p>
<p>如果你需要返回重复行，可以使用 <strong><em>UNION ALL</em></strong>:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> payment_id, customer_id, amount</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> payment</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> amount <span class="operator">&gt;=</span> <span class="number">10</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">SELECT</span> payment_id, customer_id, amount</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> payment</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> payment_id <span class="keyword">IN</span>(<span class="number">1000</span>, <span class="number">1001</span>);</span><br></pre></td></tr></table></figure><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">------------+-------------+--------+</span></span><br><span class="line"><span class="operator">|</span> payment_id <span class="operator">|</span> customer_id <span class="operator">|</span> amount <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-------------+--------+</span></span><br><span class="line"><span class="operator">|</span>         <span class="number">44</span> <span class="operator">|</span>           <span class="number">2</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>         <span class="number">69</span> <span class="operator">|</span>           <span class="number">3</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">324</span> <span class="operator">|</span>          <span class="number">12</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">342</span> <span class="operator">|</span>          <span class="number">13</span> <span class="operator">|</span>  <span class="number">11.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">551</span> <span class="operator">|</span>          <span class="number">21</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">793</span> <span class="operator">|</span>          <span class="number">29</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">908</span> <span class="operator">|</span>          <span class="number">33</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">1254</span> <span class="operator">|</span>          <span class="number">45</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">1347</span> <span class="operator">|</span>          <span class="number">49</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>      <span class="number">15850</span> <span class="operator">|</span>         <span class="number">592</span> <span class="operator">|</span>  <span class="number">11.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>      <span class="number">15947</span> <span class="operator">|</span>         <span class="number">595</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">1000</span> <span class="operator">|</span>          <span class="number">36</span> <span class="operator">|</span>   <span class="number">2.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">1001</span> <span class="operator">|</span>          <span class="number">36</span> <span class="operator">|</span>   <span class="number">2.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-------------+--------+</span></span><br></pre></td></tr></table></figure><br><div class="note warning flat"><p><strong><em>UNION和WHERE</em></strong><br><strong><em>UNION ALL</em></strong> 作为 <strong><em>UNION</em></strong> 的一种形式，它完成了 <strong><em>WHERE</em></strong> 子句完成不了的工作，如果确实需要重复行也出现，则必须使用 <strong><em>UNION ALL</em></strong>。</p>
</div> </p>
<h2 id="对组合查询结果排序"><a href="#对组合查询结果排序" class="headerlink" title="对组合查询结果排序"></a>对组合查询结果排序</h2><p>在用 <strong><em>UNION</em></strong> 组合查询时，只能使用一条 <strong><em>ORDER BY</em></strong> 子句，且必须出现在最后一条 <strong><em>SELECT</em></strong> 语句之后：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> payment_id, customer_id, amount</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> payment</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> amount <span class="operator">&gt;=</span> <span class="number">10</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">UNION</span> </span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">SELECT</span> payment_id, customer_id, amount</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> payment</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> payment_id <span class="keyword">IN</span>(<span class="number">1000</span>, <span class="number">1001</span>)</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> payment_id;</span><br></pre></td></tr></table></figure><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">------------+-------------+--------+</span></span><br><span class="line"><span class="operator">|</span> payment_id <span class="operator">|</span> customer_id <span class="operator">|</span> amount <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-------------+--------+</span></span><br><span class="line"><span class="operator">|</span>         <span class="number">44</span> <span class="operator">|</span>           <span class="number">2</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>         <span class="number">69</span> <span class="operator">|</span>           <span class="number">3</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">324</span> <span class="operator">|</span>          <span class="number">12</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">342</span> <span class="operator">|</span>          <span class="number">13</span> <span class="operator">|</span>  <span class="number">11.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">551</span> <span class="operator">|</span>          <span class="number">21</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">793</span> <span class="operator">|</span>          <span class="number">29</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">908</span> <span class="operator">|</span>          <span class="number">33</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">1000</span> <span class="operator">|</span>          <span class="number">36</span> <span class="operator">|</span>   <span class="number">2.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">1001</span> <span class="operator">|</span>          <span class="number">36</span> <span class="operator">|</span>   <span class="number">2.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">1254</span> <span class="operator">|</span>          <span class="number">45</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">1347</span> <span class="operator">|</span>          <span class="number">49</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">1379</span> <span class="operator">|</span>          <span class="number">50</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">1511</span> <span class="operator">|</span>          <span class="number">54</span> <span class="operator">|</span>  <span class="number">10.99</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+-------------+--------+</span></span><br></pre></td></tr></table></figure><br>虽然 <strong><em>ORDER BY</em></strong> 子句似乎只是最后一条 <strong><em>SELECT</em></strong> 语句的组成成分，但实际上 <strong><em>MySQL</em></strong> 将用它来排序所有 <strong><em>SELECT</em></strong> 语句返回的结果。</p>
<h1 id="全文本搜索"><a href="#全文本搜索" class="headerlink" title="全文本搜索"></a>全文本搜索</h1><div class="note warning flat"><p><strong><em>并非所有引擎都支持全文本搜索</em></strong><br>两个最常用的引擎为 <strong><em>MyISAM</em></strong> 和 <strong><em>InnoDB</em></strong>，前者支持全文本搜索，而后者不支持。如果你的应用中需要全文本搜索功能，请记住这一点。</p>
</div> 
<h2 id="启用全文本搜索支持"><a href="#启用全文本搜索支持" class="headerlink" title="启用全文本搜索支持"></a>启用全文本搜索支持</h2><p>一般在创建表时启用全文本搜索。<strong><em>CREATE TABLE</em></strong> 语句接受 <strong><em>FULLTEXT</em></strong> 子句，它给出被索引列的一个逗号分割的列表：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> productnotes (</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   note_id      <span class="type">int</span>         <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,     </span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   prod_id      <span class="type">char</span>(<span class="number">10</span>)    <span class="keyword">NOT</span> <span class="keyword">NULL</span>,   </span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   note_date    datatime    <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   note_text    text        <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   <span class="keyword">PRIMARY</span> KEY(note_id),</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   FULLTEXT(note_text)</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> ) ENGINE<span class="operator">=</span>MyISAM;</span><br></pre></td></tr></table></figure></p>
<p>在定义之后，<strong><em>MySQL</em></strong> 自动维护该索引。在增加、更新或删除行时，索引随之自动更新。</p>
<p>可以在创建表时指定 <strong><em>FULLTEXT</em></strong>，或者在稍后指定（在这种情况下所有已有数据必须立即索引）</p>
<h2 id="进行全文本搜索"><a href="#进行全文本搜索" class="headerlink" title="进行全文本搜索"></a>进行全文本搜索</h2><p><strong><em>Match()</em></strong> 指定被搜索的列，<strong><em>Against()</em></strong> 指定要被使用的搜索表达式：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> note_text</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> productnotes</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> <span class="keyword">Match</span>(note_text) Against(<span class="string">&#x27;rabbit&#x27;</span>);</span><br></pre></td></tr></table></figure><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">----------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> note_text                                                                                                            <span class="operator">|</span>                                </span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Customer complaint: rabbit has been able <span class="keyword">to</span> detect trap, food apparently less effective now.                         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Quantity varies, sold <span class="keyword">by</span> the sack load.                                                                              <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">All</span> guaranteed <span class="keyword">to</span> be bright <span class="keyword">and</span> orange, <span class="keyword">and</span> suitable <span class="keyword">for</span> use <span class="keyword">as</span> rabbit bait.                                         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------------------------------------------------------------------------------------------------+</span></span><br></pre></td></tr></table></figure><br>由于有两行包含词 <strong><em>rabbit</em></strong>，这两个行被返回。</p>
<div class="note warning flat"><p><strong><em>使用完整的Match()说明</em></strong><br>传递给 <strong><em>Match()</em></strong> 的值必须与 <strong><em>FULLTEXT</em></strong> 定义中的相同。如果指定多个列，则必须列出它们，而且要求次序正确。</p>
</div>
<p>使用全文本搜索会返回以文本匹配的良好程度排序的数据。为了演示排序如何工作，请看以下的例子：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> note_text</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>        <span class="keyword">Match</span>(note_text) Against(<span class="string">&#x27;rabbit&#x27;</span>) <span class="keyword">AS</span> ranks</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> productnotes;</span><br></pre></td></tr></table></figure><br><strong><em>Match()</em></strong> 和 <strong><em>Against()</em></strong> 用来计算一个列，此列包含全文本搜索计算出的等机值。确实包含 <strong><em>rabbit</em></strong> 的两个行都有一个等级值。这个例子有助于说明全文本搜索如何排除行（排除等级为 <strong><em>0</em></strong> 的行），以及如何排序。</p>
<h2 id="使用查询扩展"><a href="#使用查询扩展" class="headerlink" title="使用查询扩展"></a>使用查询扩展</h2><p>在使用查询扩展时，<strong><em>MySQL</em></strong> 对数据和索引进行两遍扫描来完成搜索：</p>
<ul>
<li>首先，进行一个基本的全文本搜索，找出与搜索条件匹配的所有行</li>
<li>其次，<strong><em>MySQL</em></strong> 检查这些匹配行并选择所有有用的词</li>
<li>再然后，<strong><em>MySQL</em></strong> 再次进行全文本搜索，这次不仅使用原来的条件，而且还使用所有有用的词</li>
</ul>
<p>利用查询扩展，能找出可能相关的结果，即使它们并不精确包含所查找的词。</p>
<p>下面举一个例子，首先进行一个简单的全本搜索，没有查询扩展：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> note_text</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> productnotes</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> <span class="keyword">Match</span>(note_text) Against(<span class="string">&#x27;anvils&#x27;</span>);</span><br></pre></td></tr></table></figure><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">----------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> note_text                                                                                                                                                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Multiple customer <span class="keyword">returns</span>, anvils failing <span class="keyword">to</span> <span class="keyword">drop</span> fast enough <span class="keyword">or</span> falling backwards <span class="keyword">on</span> purchaser. Recommend that customer considers <span class="keyword">using</span> heavier anvils. <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br></pre></td></tr></table></figure></p>
<p>这次使用查询扩展：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> note_text</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> productnotes</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> <span class="keyword">Match</span>(note_text) Against(<span class="string">&#x27;anvils&#x27;</span> <span class="keyword">WITH</span> QUERY EXPANSION);</span><br></pre></td></tr></table></figure><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">----------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> note_text                                                                                                                                                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Multiple customer <span class="keyword">returns</span>, anvils failing <span class="keyword">to</span> <span class="keyword">drop</span> fast enough <span class="keyword">or</span> falling backwards <span class="keyword">on</span> purchaser. Recommend that customer considers <span class="keyword">using</span> heavier anvils. <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Customer complaint: Sticks <span class="keyword">not</span> individually wrapped, too easy <span class="keyword">to</span> mistakenly detonate <span class="keyword">all</span> <span class="keyword">at</span> once. Recommend individual wrapping.                         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Customer complaint: <span class="keyword">Not</span> heavy enough <span class="keyword">to</span> generate flying stars around head <span class="keyword">of</span> victim. If being purchased <span class="keyword">for</span> dropping, recommend ANV02 <span class="keyword">or</span> ANV03 instead.  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Please note that <span class="keyword">no</span> <span class="keyword">returns</span> will be accepted if safe opened <span class="keyword">using</span> explosives.                                                                            <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Customer complaint: rabbit has been able <span class="keyword">to</span> detect trap, food apparently less effective now.                                                             <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Customer complaint: Circular hole <span class="keyword">in</span> safe floor can apparently be easily cut <span class="keyword">with</span> handsaw.                                                               <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Matches</span> <span class="keyword">not</span> included, recommend purchase <span class="keyword">of</span> <span class="keyword">matches</span> <span class="keyword">or</span> detonator (item DTNTR).                                                                           <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br></pre></td></tr></table></figure><br>这次返回了七行，第一行包含所找词，所以等级最高。第二行与 <strong><em>anvils</em></strong> 无关，但因为它包含第一行中的两个词，所以也被检索出来。</p>
<p>正如所见，查询扩展极大地增加了返回的行数，但这样也实际增加了你不不想要的行。</p>
<h2 id="布尔文本搜索"><a href="#布尔文本搜索" class="headerlink" title="布尔文本搜索"></a>布尔文本搜索</h2><p>以布尔方式，可提供关于如下内容的细节：</p>
<ul>
<li>要匹配的词</li>
<li>要排斥的词（如果某行包含这个词，则不返回该行，即使它包含其他指定的词也是如此）</li>
<li>排列提示（指定某些词比其他词更重要，更重要的词等级更高）</li>
<li>表达式分组</li>
<li>另外一些内容</li>
</ul>
<div class="note success flat"><p><strong><em>即使没有FULLTEXT索引也可以使用</em></strong><br>即使没有定义 <strong><em>FULLTEXT</em></strong> 索引，也可以使用布尔文本搜索，但这是非常缓慢的一种操作。</p>
</div> 
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> note_text</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> productnotes</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> <span class="keyword">Match</span>(note_text) Against(<span class="string">&#x27;heavy -rope*&#x27;</span> <span class="keyword">IN</span> <span class="type">BOOLEAN</span> MODE);</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">---------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> note_text                                                                                                                                               <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> Customer complaint: <span class="keyword">Not</span> heavy enough <span class="keyword">to</span> generate flying stars around head <span class="keyword">of</span> victim. If being purchased <span class="keyword">for</span> dropping, recommend ANV02 <span class="keyword">or</span> ANV03 instead. <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br></pre></td></tr></table></figure>
<p>这一次匹配词 <code>heavy</code>，但 <code>-rope*</code> 明确地指示 <strong><em>MySQL</em></strong> 排除包含 <code>-rope*</code> 的行。</p>
<p>下列表列出支持的所有布尔操作符：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>布尔操作符</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>+</code></td>
<td><code>包含，词必须存在</code></td>
</tr>
<tr>
<td><code>-</code></td>
<td><code>排除，词必须不出现</code></td>
</tr>
<tr>
<td><code>&gt;</code></td>
<td><code>包含，而且增加等级值</code></td>
</tr>
<tr>
<td><code>&lt;</code></td>
<td><code>包含，而且减少等级值</code></td>
</tr>
<tr>
<td><code>()</code></td>
<td><code>把词组成子表达式（允许这些子表达式作为一个组被包含、排除、排列等）</code></td>
</tr>
<tr>
<td><code>~</code></td>
<td><code>取消一个词的排序值</code></td>
</tr>
<tr>
<td><code>*</code></td>
<td><code>词尾的通配符</code></td>
</tr>
<tr>
<td><code>“”</code></td>
<td><code>定义一个词语（与单个词的列表不一样，它匹配整个短语以便包含或排除这个短语）</code></td>
</tr>
</tbody>
</table>
</div>
<h2 id="全文本搜索的使用说明"><a href="#全文本搜索的使用说明" class="headerlink" title="全文本搜索的使用说明"></a>全文本搜索的使用说明</h2><ul>
<li>在索引全文本数据时，短词被忽略且从索引中排除。短语定义为那些具有 <strong><em>3</em></strong> 个或 <strong><em>3</em></strong> 个以下字符的词（如果需要，这个数目可以更改）</li>
<li><strong><em>MySQL</em></strong> 带有一个内建的非用词列表，这些词在索引全文本数据时总是被忽略。如果需要，可以覆盖这个列表</li>
<li>许多次出现频率很高，搜索它们没有用处。因此，<strong><em>MySQL</em></strong> 规定了一条 <strong><em>50%</em></strong> 规则，如果一个词出现在 <strong><em>50%</em></strong> 以上的行中，则将它作为一个非用词忽略</li>
<li>如果表中的行数少于 <strong><em>3</em></strong> 行，则全文本搜索不返回结果</li>
<li>忽略词中的单引号，例如 <code>don&#39;t</code> 索引为 <code>dont</code></li>
<li>不具有词分隔符（包括日语和汉语）的语言不能恰当地返回全文本搜索结果</li>
<li>如前所述，仅在 <strong><em>MyISAM</em></strong> 数据库引擎中支持全文本搜索</li>
</ul>
<h1 id="数据插入"><a href="#数据插入" class="headerlink" title="数据插入"></a>数据插入</h1><p>插入可以用几种方式使用：</p>
<ul>
<li>插入完整的行</li>
<li>插入行的一部分</li>
<li>插入多行</li>
<li>插入某些查询的结果</li>
</ul>
<h2 id="插入完整的行"><a href="#插入完整的行" class="headerlink" title="插入完整的行"></a>插入完整的行</h2><p>我们先来看最简单的 <strong><em>INSERT</em></strong> 语法，它仅要求指定表名和被插入到新行中的值：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">INSERT</span> <span class="keyword">INTO</span> customers</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">VALUES</span>(</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="string">&#x27;Pep E. LaPew&#x27;</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="string">&#x27;100 Main Street&#x27;</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="string">&#x27;Los Angeles&#x27;</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="string">&#x27;CA&#x27;</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="string">&#x27;90046&#x27;</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="string">&#x27;USA&#x27;</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="keyword">NULL</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> );</span><br></pre></td></tr></table></figure>
<p>虽然这种语法很简单，但并不安全，应该避免使用。上面的 <strong><em>SQL</em></strong> 语句高度依赖于表中列的定义次序。</p>
<p>下面是更安全的 <strong><em>INSERT</em></strong> 语句：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">INSERT</span> <span class="keyword">INTO</span> customers(</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     cust_name,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     cust_address,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     cust_city,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     cust_state,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     cust_zip,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     cust_country,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     cust_contact,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     cust_email</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> )</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">VALUES</span>(</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="string">&#x27;Pep E. LaPew&#x27;</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="string">&#x27;100 Main Street&#x27;</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="string">&#x27;Los Angeles&#x27;</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="string">&#x27;CA&#x27;</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="string">&#x27;90046&#x27;</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="string">&#x27;USA&#x27;</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="keyword">NULL</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> );</span><br></pre></td></tr></table></figure><br>此例子完成与前一个 <strong><em>INSERT</em></strong> 语句完全相同的工作，但在表名后的括号里明确给出了列名。</p>
<p>因为提供了列名，<strong><em>VALUES</em></strong> 必须以其指定的次序匹配指定的列名，不一定按各个列出现在实际表中的次序。即使表的结构改变，此语句也能正常工作。</p>
<p>你会发现 <strong><em>cust_id</em></strong> 的 <strong><em>NULL</em></strong> 值是不必要的，因为这是一个自动增量，可由 <strong><em>MySQL</em></strong> 来维护，所以我们可以省略这一列。</p>
<div class="note success flat"><p><strong><em>省略列</em></strong><br>如果表的定义允许，则可以在 <strong><em>INSERT</em></strong> 语句中省略某些列，这些列需要满足以下要求：</p>
<ul>
<li>该列定义为允许 <strong><em>NULL</em></strong> 值</li>
<li>在表定义中给出默认值。这表示如果不给出默认值，将使用默认值。</li>
</ul>
<p>如果省略不满足条件的列，将产生一条错误信息。</p>
</div> 
<h2 id="插入多个行"><a href="#插入多个行" class="headerlink" title="插入多个行"></a>插入多个行</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">INSERT</span> <span class="keyword">INTO</span> customers(</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     cust_name,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     cust_address,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     cust_city,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     cust_state,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     cust_zip,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     cust_country</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> )</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">VALUES</span>(</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="string">&#x27;Pep E. LaPew&#x27;</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="string">&#x27;100 Main Street&#x27;</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="string">&#x27;Los Angeles&#x27;</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="string">&#x27;CA&#x27;</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="string">&#x27;90046&#x27;</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="string">&#x27;USA&#x27;</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> ),</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> (</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="string">&#x27;M. Martian&#x27;</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="string">&#x27;42 Galaxy Way&#x27;</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="string">&#x27;New York&#x27;</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="string">&#x27;Ny&#x27;</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="string">&#x27;11213&#x27;</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     <span class="string">&#x27;USA&#x27;</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> );</span><br></pre></td></tr></table></figure>
<p>其中单条 <strong><em>INSERT</em></strong> 语句有多组值，每组值用一对圆括号括起来，用逗号分割。</p>
<h2 id="插入检索出的数据"><a href="#插入检索出的数据" class="headerlink" title="插入检索出的数据"></a>插入检索出的数据</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">INSERT</span> <span class="keyword">INTO</span> customers(</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     cust_name,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     cust_address,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     cust_city,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     cust_state,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     cust_zip,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     cust_country,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     cust_contact,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     cust_email</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> )</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">SELECT</span> cust_name,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>        cust_address,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>        cust_city,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>        cust_state,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>        cust_zip,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>        cust_country,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>        cust_contact,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>        cust_email</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> custnew;</span><br></pre></td></tr></table></figure>
<p>为简单起见，这个例子在 <strong><em>INSERT</em></strong> 语句和 <strong><em>SELECT</em></strong> 语句中使用了相同的列名。但是不一定要求列名匹配，<strong><em>MySQL</em></strong> 不关心 <strong><em>SELECT</em></strong> 返回的列名。它只是按顺序填充列，这对于从使用不同列名的表中导入数据是非常有用的。</p>
<p><strong><em>SELECT</em></strong> 语句中可包含 <strong><em>WHERE</em></strong> 子句以过滤插入的数据。</p>
<h1 id="更新和删除数据"><a href="#更新和删除数据" class="headerlink" title="更新和删除数据"></a>更新和删除数据</h1><h2 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h2><p>可采用两种方式使用 <strong><em>UPDATE</em></strong>:</p>
<ul>
<li>更新表中特定行；</li>
<li>更新表中所有行。</li>
</ul>
<p>基本的 <strong><em>UPDATE</em></strong> 语句由三部分组成：</p>
<ul>
<li>要更新的表；</li>
<li>列名和它们的新值；</li>
<li>确定要更新行的过滤条件。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">UPDATE</span> customers</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">SET</span> cust_name <span class="operator">=</span> <span class="string">&#x27;The Shy&#x27;</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     cust_email <span class="operator">=</span> <span class="string">&#x27;xxx@qq.com&#x27;</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> cust_id <span class="operator">=</span> <span class="number">1005</span>;</span><br></pre></td></tr></table></figure>
<div class="note warning flat"><p><strong><em>IGNORE关键字</em></strong><br>如果用 <strong><em>UPDATE</em></strong> 语句更新多行，并且在更新这些行中的一行或多行时出现一个错误，则整个 <strong><em>UPDATE</em></strong> 操作被取消（错误发生前更新的所有值被恢复到它们原来的值）。为即使是发生错误，也继续更新，可使用 <strong><em>IGNORE</em></strong> 关键字：<code>UPDATE IGNORE customers</code>。</p>
</div>
<p>为删除某一行某个列的值，可设置它为 <strong><em>NULL</em></strong>:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">UPDATE</span> customers</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">SET</span> cust_email <span class="operator">=</span> <span class="keyword">NULL</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> cust_id <span class="operator">=</span> <span class="number">1005</span>;</span><br></pre></td></tr></table></figure></p>
<h2 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h2><p>可以用两种方式使用 <strong><em>DELETE</em></strong>:</p>
<ul>
<li>从表中删除特定的行；</li>
<li>从表中删除所有行。</li>
</ul>
<p>下面的语句从 <strong><em>customers</em></strong> 中删除一行：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">DELETE</span> customers</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> cust_id <span class="operator">=</span> <span class="number">1005</span>;</span><br></pre></td></tr></table></figure></p>
<div class="note warning flat"><p><strong><em>更快的删除</em></strong><br>如果想从表中删除所有行，可以使用 <strong><em>TRUNCATE TABLE</em></strong> 语句，它完成相同的工作但速度更快（<strong><em>TRUNCATE</em></strong> 实际是删除原来的表并重新创建一个表，而不是逐行删除表中的数据）。</p>
</div>
<h2 id="更新和删除的指导原则"><a href="#更新和删除的指导原则" class="headerlink" title="更新和删除的指导原则"></a>更新和删除的指导原则</h2><p>无论是 <strong><em>UPDATE</em></strong> 还是 <strong><em>DELETE</em></strong>，使用起来都十分简单，正因为如此，它们也十分危险。如果不带 <strong><em>WHERE</em></strong> 子句，它们将影响整个表。</p>
<p>下面是许多 <strong><em>SQL</em></strong> 程序员在使用它们时所遵守的习惯：</p>
<ul>
<li>除非确实打算更新或删除每一行，否则绝对不要不使用 <strong><em>WHERE</em></strong> 子句。</li>
<li>保证每个表都有主键，尽可能像 <strong><em>WHERE</em></strong> 子句那样使用它。</li>
<li>在对 <strong><em>UPDATE</em></strong> 或 <strong><em>DELETE</em></strong> 语句使用 <strong><em>WHERE</em></strong> 子句前，应该先用 <strong><em>SELECT</em></strong> 进行测试，保证他过滤的是正确的记录，以防编写的 <strong><em>WHERE</em></strong> 子句不正确。</li>
<li>使用强势实施引用完整性的数据库，这样 <strong><em>MySQL</em></strong> 将不允许删除具有与其他表相关联的数据的行。</li>
</ul>
<div class="note danger flat"><p><strong><em>小心使用</em></strong><br><strong><em>MySQL</em></strong> 没有撤销按钮，数据删除或更新之后则无法恢复。</p>
</div>
<h1 id="创建和操作表"><a href="#创建和操作表" class="headerlink" title="创建和操作表"></a>创建和操作表</h1><h2 id="表创建基础"><a href="#表创建基础" class="headerlink" title="表创建基础"></a>表创建基础</h2><p>为利用 <strong><em>CREATE TABLE</em></strong> 创建表，必须给出下列信息：</p>
<ul>
<li>新表的名字，在关键字 <strong><em>CREATE TABLE</em></strong> 之后给出；</li>
<li>表列的名字和定义，用逗号分割</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> productnotes (</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   note_id      <span class="type">int</span>         <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,     </span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   prod_id      <span class="type">char</span>(<span class="number">10</span>)    <span class="keyword">NOT</span> <span class="keyword">NULL</span>,   </span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   note_date    datatime    <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   note_text    text        <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   <span class="keyword">PRIMARY</span> KEY(note_id),</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   FULLTEXT(note_text)</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> ) ENGINE<span class="operator">=</span>MyISAM;</span><br></pre></td></tr></table></figure>
<p>每列的定义以列名开始，后跟数据类型。表的主键可以在创建表时用 <strong><em>PRIMARY KEY</em></strong> 关键字指定。</p>
<div class="note danger flat"><p><strong><em>处理现有的表</em></strong><br>在创建新表时，指定的表名必须不存在，否则将出错。如果你的确想覆盖一个表，<strong><em>SQL</em></strong> 要求首先手工删除该表，然后再重建它，而不是简单地用创建表语句覆盖它。</p>
<p>如果你仅想在一个表不存在时创建它，应该在表名后给出 <strong><em>IF NOT EXISTS</em></strong>。这样做不检查已有表的模式是否匹配，仅查看表名是否存在，并且仅在表名不存在时创建它。</p>
</div>
<h2 id="使用NULL值"><a href="#使用NULL值" class="headerlink" title="使用NULL值"></a>使用NULL值</h2><p>允许 <strong><em>NULL</em></strong> 值的列允许在插入行时不给出该列的值。不允许 <strong><em>NULL</em></strong> 值的列在插入行时，该列必须有值。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> orders (</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   order_num      <span class="type">int</span>         <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,     </span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   order_date     datatime    <span class="keyword">NOT</span> <span class="keyword">NULL</span>,   </span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   cust_id        <span class="type">int</span>         <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   <span class="keyword">PRIMARY</span> KEY (order_num)</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> ) ENGINE<span class="operator">=</span>InnoDB;</span><br></pre></td></tr></table></figure>
<p><strong><em>NULL</em></strong> 为默认设置，如果不指定 <strong><em>NOT NULL</em></strong>，则认为指定的是 <strong><em>NULL</em></strong>。</p>
<h2 id="主键再介绍"><a href="#主键再介绍" class="headerlink" title="主键再介绍"></a>主键再介绍</h2><p>主键值必须唯一。如果主键使用单个列，则它的值必须唯一。如果使用多个列，则这些列的组合值必须唯一。</p>
<p>前面我们已经看过如何以单个列为主键了，这里演示创建由多个列组成的主键：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> orderitems (</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   order_num      <span class="type">int</span>           <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,     </span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   order_item     <span class="type">int</span>           <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   prod_id        <span class="type">char</span>(<span class="number">10</span>)      <span class="keyword">NOT</span> <span class="keyword">NULL</span>,  </span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   quantity       <span class="type">int</span>           <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   item_price     <span class="type">decimal</span>(<span class="number">8</span>, <span class="number">2</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   <span class="keyword">PRIMARY</span> KEY (order_num, order_item)</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> ) ENGINE<span class="operator">=</span>InnoDB;</span><br></pre></td></tr></table></figure></p>
<div class="note warning flat"><p><strong><em>主键和NULL值</em></strong><br>主键只能使用不允许 <strong><em>NULL</em></strong> 值的列。</p>
</div>
<h2 id="使用AUTO-INCREMENT"><a href="#使用AUTO-INCREMENT" class="headerlink" title="使用AUTO_INCREMENT"></a>使用AUTO_INCREMENT</h2><p>每个表只允许一个 <strong><em>AUTO_INCREMENT</em></strong> 列，而且它必须被索引（如：通过使它成为主键）。</p>
<div class="note success flat"><p><strong><em>确定AUTO_INCREMENT值</em></strong><br>让 <strong><em>MySQL</em></strong> 生成自动增量的主键的一个缺点是，你不知道这些值是什么。</p>
<p>为了获取这个值，可使用 <strong><em>last_insert_id()</em></strong> 函数获得这个值：<code>SELECT last_insert_id()</code></p>
<p>此语句返回最后一个 <strong><em>AUTO_INCREMENT</em></strong> 值，然后可以用于后续的 <strong><em>MySQL</em></strong> 语句。</p>
</div> 
<h2 id="使用默认值"><a href="#使用默认值" class="headerlink" title="使用默认值"></a>使用默认值</h2><p>默认值用 <strong><em>CREATE TABLE</em></strong> 语句的列定义中的 <strong><em>DEFAULT</em></strong> 关键字指定：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> orderitems (</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   order_num      <span class="type">int</span>           <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,     </span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   order_item     <span class="type">int</span>           <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   prod_id        <span class="type">char</span>(<span class="number">10</span>)      <span class="keyword">NOT</span> <span class="keyword">NULL</span>,  </span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   quantity       <span class="type">int</span>           <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   item_price     <span class="type">decimal</span>(<span class="number">8</span>, <span class="number">2</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   <span class="keyword">PRIMARY</span> KEY (order_num, order_item)</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> ) ENGINE<span class="operator">=</span>InnoDB;</span><br></pre></td></tr></table></figure></p>
<div class="note warning flat"><p><strong><em>不允许函数</em></strong><br>与大多数 <strong><em>DBMS</em></strong> 不同，<strong><em>MySQL</em></strong> 不允许使用函数作为默认值，它只支持常量。</p>
</div>
<h2 id="引擎类型"><a href="#引擎类型" class="headerlink" title="引擎类型"></a>引擎类型</h2><p>如果省略 <strong><em>ENGINE</em></strong> 语句，则使用默认引擎，但默认引擎是什么其实不是很明确。因此，<strong><em>ENGINE</em></strong> 语句还是很重要的。</p>
<p>以下是几个需要知道的引擎：</p>
<ul>
<li><strong><em>InnoDB</em></strong> 是一个可靠的事务处理引擎，它不支持全文本搜索；</li>
<li><strong><em>MEMORY</em></strong> 功能上等同于 <strong><em>MyISAM</em></strong>，但由于数据存储在内存而不是磁盘，因此速度很快，适用于创建临时表；</li>
<li><strong><em>MyISAM</em></strong> 是一个性能极高的引擎，它支持全文本搜索，但不支持事务处理。</li>
</ul>
<div class="note warning flat"><p><strong><em>外键不能跨引擎</em></strong><br>混用引擎类型有一个很大的缺陷。外键不能跨引擎，即一个表不能引用使用不同引擎的表的外键。</p>
</div>
<h2 id="更新表"><a href="#更新表" class="headerlink" title="更新表"></a>更新表</h2><p>为更新表定义，可以使用 <strong><em>ALTER TABLE</em></strong> 语句。为使用 <strong><em>ALTER TABLE</em></strong> 改变表结构，必须给出以下信息：</p>
<ul>
<li>在 <strong><em>ALTER TABLE</em></strong> 之后给出要更改的表名（表名必须存在，否则会报错）；</li>
<li>所做更改的列表。</li>
</ul>
<p>给表添加一个列：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">ALTER</span> <span class="keyword">TABLE</span> vendors</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">ADD</span> vend_phone <span class="type">char</span>(<span class="number">20</span>);</span><br></pre></td></tr></table></figure></p>
<p>删除刚刚添加的列：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">ALTER</span> <span class="keyword">TABLE</span> vendors</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">DROP</span> <span class="keyword">COLUMN</span> vend_phone;</span><br></pre></td></tr></table></figure></p>
<p><strong><em>ALTER TABLE</em></strong> 的另一种常见用途是定义外键：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">ALTER</span> <span class="keyword">TABLE</span> products</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> fk_products_vendors</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FOREIGN</span> KEY (vend_id) <span class="keyword">REFERENCES</span> vendors (vend_id)</span><br></pre></td></tr></table></figure></p>
<div class="note danger flat"><p><strong><em>小心使用ALTER TABLE</em></strong><br><strong><em>MySQL</em></strong> 没有撤销功能，如果增加了不需要的列，可能不能删除它们。如果删除了不应该删除的列，可能会丢失该列中所有数据。</p>
</div>
<h2 id="删除表"><a href="#删除表" class="headerlink" title="删除表"></a>删除表</h2><p>删除整个表，该操作没有确认选项，一经删除无法撤回：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">DROP</span> <span class="keyword">TABLE</span> customer2;</span><br></pre></td></tr></table></figure></p>
<h2 id="重命名表"><a href="#重命名表" class="headerlink" title="重命名表"></a>重命名表</h2><p>你可以一次重命名多个表：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> RENAME <span class="keyword">TABLE</span> customer2 <span class="keyword">TO</span> customers</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>              vendor2   <span class="keyword">TO</span> vendors;</span><br></pre></td></tr></table></figure></p>
<h1 id="使用视图"><a href="#使用视图" class="headerlink" title="使用视图"></a>使用视图</h1><p>视图是虚拟的表。与包含数据的表不一样，视图只包含使用时动态检索数据的查询，也就是说，它包含一个 <strong><em>SQL</em></strong> 查询。</p>
<h2 id="为什么使用视图"><a href="#为什么使用视图" class="headerlink" title="为什么使用视图"></a>为什么使用视图</h2><p>下面是视图的一些常见应用：</p>
<ul>
<li>重用 <strong><em>SQL</em></strong> 语句；</li>
<li>简化复杂的 <strong><em>SQL</em></strong> 操作。在编写查询后，可以方便地重用而不必知道它的基本查询细节；</li>
<li>使用表的组成部分而不是整个表；</li>
<li>保护数据。可以授予用户表的特定部分的访问权限，而不是整个表的访问权限；</li>
<li>更改数据格式和表示。视图可返回与底层表的表示和格式不同的数据。</li>
</ul>
<div class="note warning flat"><p><strong><em>性能问题</em></strong><br>因为视图不包含数据，所以每次使用视图时，都必须处理查询执行时所需的每一个检索。如果使用了很多的视图，可能会发现性能下降的很厉害。</p>
</div>
<h2 id="视图的规则和限制"><a href="#视图的规则和限制" class="headerlink" title="视图的规则和限制"></a>视图的规则和限制</h2><ul>
<li>与表一样，视图必须唯一命名；</li>
<li>对于可创建的视图数目没有限制；</li>
<li>为了创建视图，必须有足够的访问权限；</li>
<li>视图可以嵌套，即可以利用从其他视图中检索数据的查询来构建一个视图；</li>
<li><strong><em>ORDER BY</em></strong> 可以用在视图中；</li>
<li>视图不能索引，也不能有关联的触发器或默认值；</li>
<li>视图可以和表一起使用。例如编写一条联结表和视图的 <strong><em>SELECT</em></strong> 语句。</li>
</ul>
<h2 id="使用视图-1"><a href="#使用视图-1" class="headerlink" title="使用视图"></a>使用视图</h2><p>我们来看一下视图创建的基本操作：</p>
<ul>
<li>视图用 <code>CREATE VIEW</code> 语句来创建；</li>
<li>使用 <code>SHOW CREATE VIEW viewname</code> 来查看所创建视图包含的查询语句；</li>
<li>用 <strong><em>DROP</em></strong> 删除视图，语法为 <code>DROP VIEW viewname</code>；</li>
<li>更新视图时，可以先 <strong><em>DROP</em></strong> 再 <strong><em>CREATE</em></strong>，也可以使用 <strong><em>CREATE OR REPLACE VIEW</em></strong>。</li>
</ul>
<h2 id="利用视图简化复杂的联结"><a href="#利用视图简化复杂的联结" class="headerlink" title="利用视图简化复杂的联结"></a>利用视图简化复杂的联结</h2><p>创建联结表视图：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CREATE</span> <span class="keyword">VIEW</span> productcustomers <span class="keyword">AS</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">SELECT</span> cust_name, cust_contact, prod_id</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> customers, orders, orderitems</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> customers.cust_id <span class="operator">=</span> orders.cust_id</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>   <span class="keyword">AND</span> orderitems.order_num <span class="operator">=</span> orders.order_num;</span><br></pre></td></tr></table></figure><br>使用视图：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> cust_name, cust_contact</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> productcustomers</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> prod_id <span class="operator">=</span> <span class="string">&#x27;TNT2&#x27;</span>;</span><br></pre></td></tr></table></figure><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">----------------+--------------+</span></span><br><span class="line"><span class="operator">|</span> cust_name      <span class="operator">|</span> cust_contact <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+--------------+</span></span><br><span class="line"><span class="operator">|</span> Coyote Inc.    <span class="operator">|</span> Y Lee        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Yosemite Place <span class="operator">|</span> Y Sam        <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+--------------+</span></span><br></pre></td></tr></table></figure></p>
<h2 id="用视图重新格式化检索出的数据"><a href="#用视图重新格式化检索出的数据" class="headerlink" title="用视图重新格式化检索出的数据"></a>用视图重新格式化检索出的数据</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CREATE</span> <span class="keyword">VIEW</span> vendorlocations <span class="keyword">AS</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">SELECT</span> Concat(RTrim(vend_name), <span class="string">&#x27;(&#x27;</span>, RTrim(vend_country), <span class="string">&#x27;)&#x27;</span>)</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>        <span class="keyword">AS</span> vend_title</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> vendors</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> vend_name;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> vendorlocations;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">------------------------+</span></span><br><span class="line"><span class="operator">|</span> vend_title             <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------------+</span></span><br><span class="line"><span class="operator">|</span> ACME(USA)              <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Anvils R Us(USA)       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Furball Inc.(USA)      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Jet <span class="keyword">Set</span>(England)       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Jouets Et Ours(France) <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> LT Supplies(USA)       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------------+</span></span><br></pre></td></tr></table></figure>
<h2 id="用视图过滤不想要的数据"><a href="#用视图过滤不想要的数据" class="headerlink" title="用视图过滤不想要的数据"></a>用视图过滤不想要的数据</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CREATE</span> <span class="keyword">VIEW</span> customeremaillist <span class="keyword">AS</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">SELECT</span> cust_id, cust_name, cust_email</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> customers</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> cust_email <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">FROM</span> customeremaillist;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">---------+----------------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> cust_id <span class="operator">|</span> cust_name      <span class="operator">|</span> cust_email          <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+----------------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">10001</span> <span class="operator">|</span> Coyote Inc.    <span class="operator">|</span> ylee<span class="variable">@coyote</span>.com     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">10003</span> <span class="operator">|</span> Wascals        <span class="operator">|</span> rabbit<span class="variable">@wascally</span>.com <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">10004</span> <span class="operator">|</span> Yosemite Place <span class="operator">|</span> sam<span class="variable">@yosemite</span>.com    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+----------------+---------------------+</span></span><br></pre></td></tr></table></figure>
<h2 id="更新视图"><a href="#更新视图" class="headerlink" title="更新视图"></a>更新视图</h2><p>通常，视图是可更新的（即可以对它们使用 <strong><em>INSERT</em></strong>、<strong><em>UPDATE</em></strong> 和 <strong><em>DELETE</em></strong>）。如果你对视图增加或删除行，实际上是对基表增加或删除行。</p>
<p>但是，如果 <strong><em>MySQL</em></strong> 不能正确地确定被更新的基数据，则不允许更新。如果有以下操作，则不能进行视图的更新：</p>
<ul>
<li>分组（使用 <strong><em>GROUP BY</em></strong> 和 <strong><em>HAVING</em></strong>）</li>
<li>联结</li>
<li>子查询</li>
<li>并</li>
<li>聚集函数</li>
<li><strong><em>DISTINCT</em></strong></li>
<li>导出列（别名）</li>
</ul>
<div class="note warning flat"><p><strong><em>可能的变动</em></strong><br>上面的限制针对 <strong><em>MySQL5</em></strong> 及以下有效，高版本的 <strong><em>MySQL</em></strong> 可能会放开限制。</p>
</div>
<h1 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h1><p>存储过程简单来说，就是为以后的使用而保存的一条或多条 <strong><em>MySQL</em></strong> 语句的集合。可将其视为批文件，虽然它们的作用不仅限于批处理。</p>
<h2 id="创建存储过程"><a href="#创建存储过程" class="headerlink" title="创建存储过程"></a>创建存储过程</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> productpricing()</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>    <span class="keyword">SELECT</span> <span class="built_in">Avg</span>(prod_price) <span class="keyword">AS</span> priceaverage</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>    <span class="keyword">FROM</span> products;</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<p>如果存储过程接受参数，它们将在（）中列举出来。此存储过程没有参数，但后跟的（）仍然需要。<strong><em>BEGIN</em></strong> 和 <strong><em>END</em></strong> 语句用来限定存储过程体。</p>
<div class="note warning flat"><p><strong><em>mysql命令行客户机的分隔符</em></strong><br>如果你使用的是 <strong><em>mysql</em></strong> 命令行，你还需要做额外的事。</p>
<p>默认的 <strong><em>MySQL</em></strong> 语句分隔符为 <strong><em>；</em></strong>。而 <strong><em>mysql</em></strong> 命令行也使用 <strong><em>；</em></strong> 作为语句分隔符。如果命令行要解释存储过程自身内的 <strong><em>；</em></strong> 字符，则它们最终不会成为存储过程的成分，这会导致出现语法错误。</p>
<p>解决办法是临时更改语句分隔符：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> productpricing()</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>    <span class="keyword">SELECT</span> <span class="built_in">Avg</span>(prod_price) <span class="keyword">AS</span> priceaverage</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>    <span class="keyword">FROM</span> products;</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> DELIMITER ;</span><br></pre></td></tr></table></figure><br>其中 <strong><em>DELIMITER //</em></strong> 告诉命令行程序使用 <strong><em>//</em></strong> 作为新的分隔符，再在最后恢复为原来的分隔符即可。</p>
</div>
<h2 id="使用存储过程"><a href="#使用存储过程" class="headerlink" title="使用存储过程"></a>使用存储过程</h2><p>那么如何使用上面创建的存储过程呢：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CALL</span> productpricing();</span><br></pre></td></tr></table></figure><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">--------------+</span></span><br><span class="line"><span class="operator">|</span> priceaverage <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">16.133571</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+</span></span><br></pre></td></tr></table></figure></p>
<h2 id="删除存储过程"><a href="#删除存储过程" class="headerlink" title="删除存储过程"></a>删除存储过程</h2><p>为删除存储过程，可使用以下语句：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> productpricing;</span><br></pre></td></tr></table></figure></p>
<p>删除过程不需要给出存储名后的（），因为我们并不需要调用存储过程。</p>
<h2 id="使用参数"><a href="#使用参数" class="headerlink" title="使用参数"></a>使用参数</h2><p>以下是 productpricing 的修改版本：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> productpricing(</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>    <span class="keyword">OUT</span> pl <span class="type">DECIMAL</span>(<span class="number">8</span>, <span class="number">2</span>),</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>    <span class="keyword">OUT</span> ph <span class="type">DECIMAL</span>(<span class="number">8</span>, <span class="number">2</span>),</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>    <span class="keyword">OUT</span> pa <span class="type">DECIMAL</span>(<span class="number">8</span>, <span class="number">2</span>)   </span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> )</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>    <span class="keyword">SELECT</span> <span class="built_in">Min</span>(prod_price) <span class="keyword">INTO</span> pl</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>    <span class="keyword">FROM</span> products;</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>    <span class="keyword">SELECT</span> <span class="built_in">Max</span>(prod_price) <span class="keyword">INTO</span> ph</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>    <span class="keyword">FROM</span> products;</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>    <span class="keyword">SELECT</span> <span class="built_in">Avg</span>(prod_price) <span class="keyword">INTO</span> pa</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>    <span class="keyword">FROM</span> products;</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">END</span>;</span><br></pre></td></tr></table></figure><br>关键字 <strong><em>OUT</em></strong> 指出相应的参数用来从存储过程传出一个值返回给调用者。<strong><em>MySQL</em></strong> 支持 <strong><em>IN</em></strong> （传递给存储过程）、<strong><em>OUT</em></strong>（从存储过程传出）、<strong><em>INOUT</em></strong> （对存储过程传入和传出）类型的参数。</p>
<p>为调用此存储过程，必须指定三个变量名：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CALL</span> productpricing(<span class="variable">@pricelow</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>                     <span class="variable">@pricehigh</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>                     <span class="variable">@priceaverage</span>);</span><br></pre></td></tr></table></figure><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">--------------+</span></span><br><span class="line"><span class="operator">|</span> priceaverage <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">16.133571</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+</span></span><br></pre></td></tr></table></figure></p>
<div class="note success flat"><p><strong><em>变量名</em></strong><br>所有 <strong><em>MySQL</em></strong> 变量都以 <strong><em>@</em></strong> 开始。</p>
</div>
<p>为获得 <strong><em>3</em></strong> 个值，可以使用以下语句：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="variable">@pricelow</span>, <span class="variable">@pricehigh</span>, <span class="variable">@priceaverage</span>;</span><br></pre></td></tr></table></figure><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">-----------+------------+---------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="variable">@pricelow</span> <span class="operator">|</span> <span class="variable">@pricehigh</span> <span class="operator">|</span> <span class="variable">@priceaverage</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+------------+---------------+</span></span><br><span class="line"><span class="operator">|</span>      <span class="number">2.50</span> <span class="operator">|</span>      <span class="number">55.00</span> <span class="operator">|</span>         <span class="number">16.13</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+------------+---------------+</span></span><br></pre></td></tr></table></figure></p>
<h2 id="建立智能存储过程"><a href="#建立智能存储过程" class="headerlink" title="建立智能存储过程"></a>建立智能存储过程</h2><p>目前所写的所有存储过程基本都没有什么优势，除了让你写的代码变得更多了之外。当你的存储过程中包含业务规则和智能处理时，它们的威力才真正显示出来。</p>
<p>假设你需要获得与以前一样的订单合计，但需要对合计增加营业税，不过只针对某些顾客：</p>
<ul>
<li>获得合计</li>
<li>把营业税有条件地添加到合计中</li>
<li>返回合计（带税或不带税）</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="comment">-- Name: ordertotal</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="comment">-- Parameters: onumber = order number</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="comment">--             taxable = 0 if not taxable, 1 if taxable</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="comment">--             ototal  = order total variable</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> ordertotal(</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>    <span class="keyword">IN</span> onumber <span class="type">INT</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>    <span class="keyword">IN</span> taxable <span class="type">BOOLEAN</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>    <span class="keyword">OUT</span> ototal <span class="type">DECIMAL</span>(<span class="number">8</span>, <span class="number">2</span>)   </span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> ) COMMENT <span class="string">&#x27;Obtain order total, optionally adding tax&#x27;</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">BEGIN</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>    <span class="comment">-- Declare variable for total</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>    <span class="keyword">DECLARE</span> total <span class="type">DECIMAL</span>(<span class="number">8</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>    <span class="comment">-- Declare tax percentage</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>    <span class="keyword">DECLARE</span> taxrate <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">6</span>;</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>    <span class="comment">-- Get the order total</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>    <span class="keyword">SELECT</span> <span class="built_in">Sum</span>(item_price <span class="operator">*</span> quantity) </span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>    <span class="keyword">FROM</span> orderitems</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>    <span class="keyword">WHERE</span> order_num <span class="operator">=</span> onumber</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>    <span class="keyword">INTO</span> total;</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>    <span class="comment">-- Is this taxable</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>    IF taxable <span class="keyword">THEN</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>       <span class="keyword">SELECT</span> total<span class="operator">+</span>(total<span class="operator">/</span><span class="number">100</span><span class="operator">*</span>taxable) <span class="keyword">INTO</span> total;</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>    <span class="keyword">END</span> IF;</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>    <span class="comment">-- And finally，save to out variable</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>    <span class="keyword">SELECT</span> total <span class="keyword">INTO</span> ototal;</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<p>这个存储过程有了很大的改变，首先它使用了注释 <code>--</code>，当代码变大时，这非常中药。其次，在存储体过程中用 <strong><em>DECLARE</em></strong> 语句定义了两个局部变量。<strong><em>DECLARE</em></strong> 要求指定变量名和数据类型，它也支持可选的默认值。</p>
<div class="note warning flat"><p><strong><em>COMMENT关键字</em></strong><br>它不是必须的，但如果给出，将在 <code>SHOW PROCEDURE STATUS</code> 的结果中显示。</p>
</div>
<p>这显然是一个功能更强大的存储过程，现在让我们来使用一下它：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CALL</span> ordertotal(<span class="number">20005</span>, <span class="number">0</span>, <span class="variable">@total</span>);</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="variable">@total</span>;</span><br></pre></td></tr></table></figure><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">--------+</span></span><br><span class="line"><span class="operator">|</span> <span class="variable">@total</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">149.87</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+</span></span><br></pre></td></tr></table></figure><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CALL</span> ordertotal(<span class="number">20005</span>, <span class="number">1</span>, <span class="variable">@total</span>);</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="variable">@total</span>;</span><br></pre></td></tr></table></figure><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">--------+</span></span><br><span class="line"><span class="operator">|</span> <span class="variable">@total</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">151.37</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+</span></span><br></pre></td></tr></table></figure></p>
<div class="note warning flat"><p><strong><em>IF语句</em></strong><br><strong><em>IF</em></strong> 语句还支持 <strong><em>ELSEIF</em></strong> 和 <strong><em>ELSE</em></strong> 子句（前者还使用 <strong><em>THEN</em></strong> 子句，后者不需要使用）。</p>
</div>
<h2 id="检查存储过程"><a href="#检查存储过程" class="headerlink" title="检查存储过程"></a>检查存储过程</h2><p>为显示一个创建一个存储过程的具体 <strong><em>SQL</em></strong> 语句，可以使用 <strong><em>SHOW CREATE PROCEDURE</em></strong> 语句：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> ordertotal;</span><br></pre></td></tr></table></figure></p>
<p>为了获得包括何时、由谁创建等详细信息，可以使用 <strong><em>SHOW PROCEDURE STATUS</em></strong>:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> <span class="keyword">PROCEDURE</span> STATUS;</span><br></pre></td></tr></table></figure><br>为限制输出，可使用 <strong><em>LIKE</em></strong> 指定一个过滤模式：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> <span class="keyword">PROCEDURE</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;ordertotal&#x27;</span>;</span><br></pre></td></tr></table></figure></p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul>
<li><strong><em>《MySQL必知必会》</em></strong></li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined" rel="external nofollow noreferrer">Anya</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://anya.cool/archives/2897e4be.html">https://anya.cool/archives/2897e4be.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://anya.cool" target="_blank">Anya の Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a></div><div class="post_share"><div class="social-share" data-image="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/104493943_p0_master1200.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/archives/559fab34.html"><img class="prev-cover" src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/104835903_p0_master1200.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">MySQL应知应会（三）</div></div></a></div><div class="next-post pull-right"><a href="/archives/92cd9797.html"><img class="next-cover" src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/98176280_p0_master1200.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">MySQL应知应会（一）</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/archives/92cd9797.html" title="MySQL应知应会（一）"><img class="cover" src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/98176280_p0_master1200.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-16</div><div class="title">MySQL应知应会（一）</div></div></a></div><div><a href="/archives/559fab34.html" title="MySQL应知应会（三）"><img class="cover" src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/104835903_p0_master1200.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-30</div><div class="title">MySQL应知应会（三）</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC81NTc0MC8zMjIwNg=="></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/maomao.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Anya</div><div class="author-info__description">这个人很摸鱼，他不想描述自己捏</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">25</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">18</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/Anyacoding"><i class="fab fa-github"></i><span>关注我</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Anyacoding" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:1710273192@qq.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到Anya的博客！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.</span> <span class="toc-text">使用子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%AD%90%E6%9F%A5%E8%AF%A2%E8%BF%9B%E8%A1%8C%E8%BF%87%E6%BB%A4"><span class="toc-number">1.1.</span> <span class="toc-text">使用子查询进行过滤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E4%B8%BA%E8%AE%A1%E7%AE%97%E5%AD%97%E6%AE%B5%E4%BD%BF%E7%94%A8%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.</span> <span class="toc-text">作为计算字段使用子查询</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%81%94%E7%BB%93%E8%A1%A8"><span class="toc-number">2.</span> <span class="toc-text">联结表</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%81%94%E7%BB%93"><span class="toc-number">2.1.</span> <span class="toc-text">创建联结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E9%83%A8%E8%81%94%E7%BB%93"><span class="toc-number">2.2.</span> <span class="toc-text">内部联结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%81%94%E7%BB%93%E5%A4%9A%E4%B8%AA%E8%A1%A8"><span class="toc-number">2.3.</span> <span class="toc-text">联结多个表</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%AB%98%E7%BA%A7%E8%81%94%E7%BB%93"><span class="toc-number">3.</span> <span class="toc-text">创建高级联结</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%A1%A8%E5%88%AB%E5%90%8D"><span class="toc-number">3.1.</span> <span class="toc-text">使用表别名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E8%81%94%E7%BB%93"><span class="toc-number">3.2.</span> <span class="toc-text">自联结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E7%84%B6%E8%81%94%E7%BB%93"><span class="toc-number">3.3.</span> <span class="toc-text">自然联结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%96%E9%83%A8%E8%81%94%E7%BB%93"><span class="toc-number">3.4.</span> <span class="toc-text">外部联结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%B8%A6%E8%81%9A%E9%9B%86%E5%87%BD%E6%95%B0%E7%9A%84%E8%81%94%E7%BB%93"><span class="toc-number">3.5.</span> <span class="toc-text">使用带聚集函数的联结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%81%94%E7%BB%93%E5%92%8C%E8%BF%9E%E6%8E%A5%E6%9D%A1%E4%BB%B6"><span class="toc-number">3.6.</span> <span class="toc-text">使用联结和连接条件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.</span> <span class="toc-text">组合查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8UNION"><span class="toc-number">4.1.</span> <span class="toc-text">使用UNION</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UNION%E8%A7%84%E5%88%99"><span class="toc-number">4.2.</span> <span class="toc-text">UNION规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8C%85%E5%90%AB%E6%88%96%E5%8F%96%E6%B6%88%E9%87%8D%E5%A4%8D%E7%9A%84%E8%A1%8C"><span class="toc-number">4.3.</span> <span class="toc-text">包含或取消重复的行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E7%BB%84%E5%90%88%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%E6%8E%92%E5%BA%8F"><span class="toc-number">4.4.</span> <span class="toc-text">对组合查询结果排序</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%A8%E6%96%87%E6%9C%AC%E6%90%9C%E7%B4%A2"><span class="toc-number">5.</span> <span class="toc-text">全文本搜索</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%AF%E7%94%A8%E5%85%A8%E6%96%87%E6%9C%AC%E6%90%9C%E7%B4%A2%E6%94%AF%E6%8C%81"><span class="toc-number">5.1.</span> <span class="toc-text">启用全文本搜索支持</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E8%A1%8C%E5%85%A8%E6%96%87%E6%9C%AC%E6%90%9C%E7%B4%A2"><span class="toc-number">5.2.</span> <span class="toc-text">进行全文本搜索</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%9F%A5%E8%AF%A2%E6%89%A9%E5%B1%95"><span class="toc-number">5.3.</span> <span class="toc-text">使用查询扩展</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E6%96%87%E6%9C%AC%E6%90%9C%E7%B4%A2"><span class="toc-number">5.4.</span> <span class="toc-text">布尔文本搜索</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E6%96%87%E6%9C%AC%E6%90%9C%E7%B4%A2%E7%9A%84%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E"><span class="toc-number">5.5.</span> <span class="toc-text">全文本搜索的使用说明</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%8F%92%E5%85%A5"><span class="toc-number">6.</span> <span class="toc-text">数据插入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E5%AE%8C%E6%95%B4%E7%9A%84%E8%A1%8C"><span class="toc-number">6.1.</span> <span class="toc-text">插入完整的行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E5%A4%9A%E4%B8%AA%E8%A1%8C"><span class="toc-number">6.2.</span> <span class="toc-text">插入多个行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E6%A3%80%E7%B4%A2%E5%87%BA%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-number">6.3.</span> <span class="toc-text">插入检索出的数据</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%92%8C%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="toc-number">7.</span> <span class="toc-text">更新和删除数据</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE"><span class="toc-number">7.1.</span> <span class="toc-text">更新数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="toc-number">7.2.</span> <span class="toc-text">删除数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E5%92%8C%E5%88%A0%E9%99%A4%E7%9A%84%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%99"><span class="toc-number">7.3.</span> <span class="toc-text">更新和删除的指导原则</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%92%8C%E6%93%8D%E4%BD%9C%E8%A1%A8"><span class="toc-number">8.</span> <span class="toc-text">创建和操作表</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A8%E5%88%9B%E5%BB%BA%E5%9F%BA%E7%A1%80"><span class="toc-number">8.1.</span> <span class="toc-text">表创建基础</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8NULL%E5%80%BC"><span class="toc-number">8.2.</span> <span class="toc-text">使用NULL值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE%E5%86%8D%E4%BB%8B%E7%BB%8D"><span class="toc-number">8.3.</span> <span class="toc-text">主键再介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8AUTO-INCREMENT"><span class="toc-number">8.4.</span> <span class="toc-text">使用AUTO_INCREMENT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="toc-number">8.5.</span> <span class="toc-text">使用默认值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E6%93%8E%E7%B1%BB%E5%9E%8B"><span class="toc-number">8.6.</span> <span class="toc-text">引擎类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E8%A1%A8"><span class="toc-number">8.7.</span> <span class="toc-text">更新表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A1%A8"><span class="toc-number">8.8.</span> <span class="toc-text">删除表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E5%91%BD%E5%90%8D%E8%A1%A8"><span class="toc-number">8.9.</span> <span class="toc-text">重命名表</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%A7%86%E5%9B%BE"><span class="toc-number">9.</span> <span class="toc-text">使用视图</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8%E8%A7%86%E5%9B%BE"><span class="toc-number">9.1.</span> <span class="toc-text">为什么使用视图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E7%9A%84%E8%A7%84%E5%88%99%E5%92%8C%E9%99%90%E5%88%B6"><span class="toc-number">9.2.</span> <span class="toc-text">视图的规则和限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%A7%86%E5%9B%BE-1"><span class="toc-number">9.3.</span> <span class="toc-text">使用视图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E8%A7%86%E5%9B%BE%E7%AE%80%E5%8C%96%E5%A4%8D%E6%9D%82%E7%9A%84%E8%81%94%E7%BB%93"><span class="toc-number">9.4.</span> <span class="toc-text">利用视图简化复杂的联结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E8%A7%86%E5%9B%BE%E9%87%8D%E6%96%B0%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%A3%80%E7%B4%A2%E5%87%BA%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-number">9.5.</span> <span class="toc-text">用视图重新格式化检索出的数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E8%A7%86%E5%9B%BE%E8%BF%87%E6%BB%A4%E4%B8%8D%E6%83%B3%E8%A6%81%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-number">9.6.</span> <span class="toc-text">用视图过滤不想要的数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E8%A7%86%E5%9B%BE"><span class="toc-number">9.7.</span> <span class="toc-text">更新视图</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">10.</span> <span class="toc-text">存储过程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">10.1.</span> <span class="toc-text">创建存储过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">10.2.</span> <span class="toc-text">使用存储过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">10.3.</span> <span class="toc-text">删除存储过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%82%E6%95%B0"><span class="toc-number">10.4.</span> <span class="toc-text">使用参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E6%99%BA%E8%83%BD%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">10.5.</span> <span class="toc-text">建立智能存储过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">10.6.</span> <span class="toc-text">检查存储过程</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reference"><span class="toc-number">11.</span> <span class="toc-text">Reference</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/archives/f1606157.html" title="实现一个简单优雅的C++泛型单例"><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/108381724_p0_master1200.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="实现一个简单优雅的C++泛型单例"/></a><div class="content"><a class="title" href="/archives/f1606157.html" title="实现一个简单优雅的C++泛型单例">实现一个简单优雅的C++泛型单例</a><time datetime="2023-06-02T13:56:46.363Z" title="发表于 2023-06-02 21:56:46">2023-06-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/3a8a56f0.html" title="PlayerPrefs在Windows下的数据存储位置"><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/107951444.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="PlayerPrefs在Windows下的数据存储位置"/></a><div class="content"><a class="title" href="/archives/3a8a56f0.html" title="PlayerPrefs在Windows下的数据存储位置">PlayerPrefs在Windows下的数据存储位置</a><time datetime="2023-05-13T16:07:32.823Z" title="发表于 2023-05-14 00:07:32">2023-05-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/23709f5e.html" title="NavMeshAgent.velocity设置速度不生效问题"><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/107588544_p0_master1200.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="NavMeshAgent.velocity设置速度不生效问题"/></a><div class="content"><a class="title" href="/archives/23709f5e.html" title="NavMeshAgent.velocity设置速度不生效问题">NavMeshAgent.velocity设置速度不生效问题</a><time datetime="2023-04-30T01:37:11.057Z" title="发表于 2023-04-30 09:37:11">2023-04-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/559fab34.html" title="MySQL应知应会（三）"><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/104835903_p0_master1200.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL应知应会（三）"/></a><div class="content"><a class="title" href="/archives/559fab34.html" title="MySQL应知应会（三）">MySQL应知应会（三）</a><time datetime="2023-01-30T02:23:16.821Z" title="发表于 2023-01-30 10:23:16">2023-01-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/2897e4be.html" title="MySQL应知应会（二）"><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/104493943_p0_master1200.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL应知应会（二）"/></a><div class="content"><a class="title" href="/archives/2897e4be.html" title="MySQL应知应会（二）">MySQL应知应会（二）</a><time datetime="2023-01-21T08:51:46.165Z" title="发表于 2023-01-21 16:51:46">2023-01-21</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Anya</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://beian.miit.gov.cn/"><span>桂 ICP 备 2022001111 号 -1</span></a> <br> 生命都是一样的轻，我的也一样</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Livere' === 'Livere' || !false) {
  if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script></div><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>