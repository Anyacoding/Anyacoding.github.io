<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>è®¡ç®—æœºå›¾å½¢å­¦ä¸€ï¼šçŸ©é˜µå˜æ¢</title>
      <link href="/archives/20c47d09.html"/>
      <url>/archives/20c47d09.html</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç³»åˆ—æ–‡ç« æ˜¯æŒ‰ç…§ <a href="https://www.bilibili.com/video/BV1X7411F744/?spm_id_from=333.337.search-card.all.click&amp;vd_source=2652d832108fec04c7b16fcf850e5ca7"><strong><em>games101</em></strong></a> ä¸Šè¯¾è®²æˆçš„å†…å®¹ç¼–å†™çš„ï¼Œç›¸å½“äºè¯¾åç¬”è®°ï¼Œæ–¹ä¾¿æŸ¥æ¼è¡¥ç¼ºï¼Œ<del>ä¹Ÿæ–¹ä¾¿å®ç°ä»£ç æ—¶å¥½æŠ„å…¬å¼</del> ã€‚</p><p>ä»¥ä¸‹æ˜¯ <strong><em>games101</em></strong> çš„æŒ‡è·¯é“¾æ¥ï¼Œä¹Ÿå¸Œæœ›å¤§å®¶å¤šå¤šæ”¯æŒè¿™éš¾å¾—çš„ä¸­æ–‡å¥½è¯¾ï¼š<br><a href="https://sites.cs.ucsb.edu/~lingqi/teaching/games101.html"><strong><em>games101è¯¾ç¨‹ä¸»é¡µ</em></strong></a>    ğŸ‘ˆ<br><a href="https://www.bilibili.com/video/BV1X7411F744/?spm_id_from=333.337.search-card.all.click&amp;vd_source=2652d832108fec04c7b16fcf850e5ca7"><strong><em>games101è¯¾ç¨‹è§‚çœ‹åœ°å€</em></strong></a>    ğŸ‘ˆ<br><a href="https://games-cn.org/forums/topic/allhw/"><strong><em>games101è¯¾ç¨‹ä½œä¸šæ±‡æ€»</em></strong></a>    ğŸ‘ˆ</p><hr><h2 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h2><p>åœ¨å›¾å½¢å­¦ä¸­ï¼Œçº¿æ€§ä»£æ•°çš„é‡è¦æ€§å®åœ¨æ˜¯å¤ªé‡è¦äº†ã€‚çº¿æ€§ä»£æ•°ä¸ºå›¾å½¢å­¦æä¾›äº†ä¸€ç§ååˆ†ä¼˜é›…ä¸”ä¾¿æ·çš„æ•°å­¦å·¥å…·â€”â€”å˜æ¢çŸ©é˜µï¼ˆ<strong><em>Transformation Marices</em></strong>ï¼‰ï¼Œæ¥æè¿°ç©ºé—´ä¸­ç‰©ä½“çš„æ—‹è½¬ï¼Œç¼©æ”¾å’Œå¹³ç§»ï¼Œå¹¶ä¸”åœ¨å„ç§æŠ•å½±å˜æ¢ä¸‹ä¹Ÿæœ‰è®¸å¤šåº”ç”¨ã€‚è¦ç†è§£å›¾å½¢å­¦ï¼Œä»å‡ ä½•çš„è§’åº¦æ¥ç†è§£çº¿æ€§ä»£æ•°æ˜¯ååˆ†å¿…è¦çš„ã€‚</p><h2 id="2Dçº¿æ€§å˜æ¢"><a href="#2Dçº¿æ€§å˜æ¢" class="headerlink" title="2Dçº¿æ€§å˜æ¢"></a>2Dçº¿æ€§å˜æ¢</h2><p>æˆ‘ä»¬å¯ä»¥å°†ç®€å•çš„çŸ©é˜µä¹˜æ³•å®šä¹‰ä¸ºå¯¹åˆ—å‘é‡ $(x,y)^T$ çš„çº¿æ€§å˜æ¢ï¼š</p><script type="math/tex; mode=display">\begin{bmatrix}{a_{11}}&{a_{12}}\\{a_{21}}&{a_{22}}\\\end{bmatrix} \begin{bmatrix}x\\y\\\end{bmatrix} =\begin{bmatrix}{a_{11}}x + {a_{12}}y\\{a_{21}}x + {a_{22}}y\\\end{bmatrix}</script><h3 id="ç¼©æ”¾"><a href="#ç¼©æ”¾" class="headerlink" title="ç¼©æ”¾"></a>ç¼©æ”¾</h3><p>ç¼©æ”¾å˜æ¢æ˜¯ä¸€ç§æ²¿ç€åæ ‡è½´ä½œç”¨çš„å˜æ¢ï¼Œå½¢å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">M_{scale}(s_x, s_y)=\begin{bmatrix}s_x & 0\\0 & s_y\\\end{bmatrix}</script><p>ä¸ºä»€ä¹ˆè¯´è¿™ä¸ªçŸ©é˜µèƒ½èµ·åˆ°ç¼©æ”¾çš„ä½œç”¨å‘¢ï¼Ÿè¿™é‡Œæä¾›ä¸€ä¸ªæ€è·¯ã€‚</p><p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒäºŒç»´å¹³é¢ä¸Šçš„ä»»æ„ä¸€ç‚¹éƒ½èƒ½ä¸åŸç‚¹ç›¸è¿å½¢æˆä¸€ä¸ªå‘é‡ $(x,y)^T$ ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜èƒ½ç”¨å¦å¤–ä¸€ç§å½¢å¼æ¥è¡¨ç¤ºè¿™ä¸ªå‘é‡ $x\hat i + y\hat j$ ï¼Œå…¶ä¸­ $\hat i$ å’Œ $\hat j$ åˆ†åˆ«ä»£è¡¨äº† $x$ è½´å’Œ $y$ çš„å•ä½æ­£å‘é‡ï¼Œå³ <strong><em>äºŒç»´å¹³é¢ä¸Šçš„ä»»æ„ä¸€ä¸ªå‘é‡éƒ½èƒ½ç”±ä¸¤ä¸ªå•ä½åŸºå‘é‡çš„çº¿æ€§ç»„åˆæ¥è¡¨ç¤º</em></strong>ã€‚</p><p>é‚£ä¹ˆå½“å‘é‡ $(x,y)^T$ å·¦ä¹˜ä¸Šè¿™ä¸ªç¼©æ”¾çŸ©é˜µæ—¶ä¼šå¾—åˆ°ä¸‹é¢çš„å½¢å¼ï¼š</p><script type="math/tex; mode=display">\begin{bmatrix}s_x & 0\\0 & s_y\\\end{bmatrix} \begin{bmatrix}x\\y\\\end{bmatrix} =x\begin{bmatrix}s_x\\0\\\end{bmatrix} +y\begin{bmatrix}0\\s_y\\\end{bmatrix} =\begin{bmatrix}s_x x\\s_y y\\\end{bmatrix}</script><p>ç›¸å½“äºæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ª <script type="math/tex">x\begin{bmatrix}s_x\\ 0\\ \end{bmatrix}+ y\begin{bmatrix}0\\ s_y\\ \end{bmatrix}</script> çš„å‘é‡ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¯¥è¿‡ç¨‹ç†è§£ä¸ºç”¨ä¸€ç»„æ–°çš„åŸºå‘é‡æ¥è§£é‡Šå‘é‡ $(x,y)^T$ã€‚<script type="math/tex">\begin{bmatrix}s_x\\ 0\\ \end{bmatrix}</script> æ˜¯ $\hat i$ çš„ $s_x$ å€ï¼Œ<script type="math/tex">\begin{bmatrix}0\\ s_y\\ \end{bmatrix}</script> æ˜¯ $\hat j$ çš„ $s_y$ å€ï¼Œé‚£ä¹ˆåœ¨æ ‡å‡†åæ ‡ç³»ä¸‹å‘é‡ $(x,y)^T$ è¢«é‡æ–°è§£é‡Šä¸º $(s_x x,s_y y)^T$ï¼Œæ¨ªçºµåæ ‡åˆ†åˆ«è¢«æ”¾ç¼©ä¸ºåŸæ¥çš„ $s_x$ å€ å’Œ $s_y$ å€ã€‚</p><p>æœ€åå†ç”¨ä¸¤ä¸ªç®€å•çš„å®é™…ä¾‹å­æ¥å±•ç¤ºä¸€ä¸‹ç¼©æ”¾çŸ©é˜µçš„ä½œç”¨ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/v2-ae48c1455b68fc5593b8788287235309_720w.webp" alt=""><br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/v2-b1a9d665cece63d7e984936641b7ebab_720w.webp" alt=""></p><h3 id="å‰ªåˆ‡"><a href="#å‰ªåˆ‡" class="headerlink" title="å‰ªåˆ‡"></a>å‰ªåˆ‡</h3><p>å‰ªåˆ‡å…¶å®è·Ÿç¼©æ”¾å¾ˆåƒï¼Œåªä¸è¿‡å‰ªåˆ‡æ˜¯æŠŠä¸€è¾¹å›ºå®šï¼Œç„¶åæ‹‰å‘å¦ä¸€ä¸ªæ–¹å‘ï¼Œå½¢å¼å¦‚ä¸‹ï¼š</p><script type="math/tex; mode=display">M_{shear-X}(s)=\begin{bmatrix}1 & s\\0 & 1\\\end{bmatrix},\quadM_{shear-Y}(s)=\begin{bmatrix}1 & 0\\s & 1\\\end{bmatrix}</script><p>æˆ‘ä»¬è¿˜æ˜¯æ²¿ç”¨ä¸Šé¢çš„æ€è·¯ï¼Œä»¥å›ºå®š $x$ è½´ä¸ºä¾‹å­ï¼Œå½“å‘é‡ $(x,y)^T$ å·¦ä¹˜ä¸Šè¿™ä¸ªçŸ©é˜µæ—¶ä¼šå¾—åˆ°ï¼š</p><script type="math/tex; mode=display">\begin{bmatrix}1 & s\\0 & 1\\\end{bmatrix}\begin{bmatrix}x\\y\\\end{bmatrix} =x\begin{bmatrix}1\\0\\\end{bmatrix} +y\begin{bmatrix}s\\1\\\end{bmatrix} =\begin{bmatrix}x + sy\\y\\\end{bmatrix}</script><p>æ–°çš„ $x$ è½´çš„åŸºå‘é‡ä»ç„¶æ˜¯ $\hat i$ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è¯´è¿™æ˜¯ä¸€ä¸ªå›ºå®š $x$ è½´çš„å˜æ¢ï¼›æ–°çš„ $y$ è½´çš„åŸºå‘é‡ä¸º <script type="math/tex">\begin{bmatrix}s\\ 1\\ \end{bmatrix}</script>ï¼Œç›¸å½“äº $\hat j$ ä¿æŒé«˜åº¦ä¸å˜ï¼Œç„¶åå‘åŸæ¥çš„ $x$ è½´æ­£æ–¹å‘æ‹‰ä¼¸äº† $s$ ä¸ªå•ä½è·ç¦»ã€‚</p><p>ä»å‡ ä½•ä¸Šæ¥ç›´è§‚è§‚å¯Ÿå°±æ˜¯ç‰©ä½“å‘æŸä¸ªæ–¹å‘å€¾å€’äº†ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/v2-f4aa66cbabade26576291e780feca4f9_720w.webp" alt=""><br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/v2-aa233efa70a9bae5152b33da75934f3c_720w.webp" alt=""></p><h3 id="æ—‹è½¬"><a href="#æ—‹è½¬" class="headerlink" title="æ—‹è½¬"></a>æ—‹è½¬</h3><p>æ—‹è½¬åœ¨å›¾å½¢å­¦ä¸­å¯è°“æ˜¯éå¸¸é‡è¦çš„ä¸€ç§å˜æ¢çŸ©é˜µäº†ï¼Œå¦‚ä¸‹æˆ‘ä»¬è€ƒè™‘å¦‚ä½•ç”¨ä¸€ä¸ªå˜æ¢çŸ©é˜µå°†å‘é‡ $a$ æ—‹è½¬åˆ° $b$ çš„ä½ç½®ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/v2-2fa721a848bea3d598ccf5c228228adb_720w.webp" alt="æˆ‘ä»¬é»˜è®¤ä»¥åŸç‚¹ä¸ºæ—‹è½¬ä¸­å¿ƒï¼Œå¹¶é€†æ—¶é’ˆæ—‹è½¬"><br>è¿™é‡Œæˆ‘ä»¬å…ˆç»™å‡ºç­”æ¡ˆï¼š</p><script type="math/tex; mode=display">M_{rotate}(\phi)=\begin{bmatrix}cos\phi & -sin\phi\\sin\phi & cos\phi\\\end{bmatrix}</script><p>æˆ‘ä»¬ç»§ç»­æ²¿ç”¨ä¸Šé¢çš„æ€è·¯æ¥è¯æ˜è¿™ä¸ªçŸ©é˜µçš„æœ‰æ•ˆæ€§ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦å¾—åˆ°å‘é‡ $a$ï¼Œå‡è®¾å‘é‡ $a$ çš„é•¿åº¦ä¸º $r$ï¼Œæœ‰ä¸€åˆå§‹å‘é‡ä¸º $(r, 0)^T$ ã€‚</p><p>å…¶å®æ ¹æ®å‰é¢ä¸¤ä¸ªå˜æ¢æˆ‘ä»¬å·²ç»å¯ä»¥å¾—å‡ºè¿™æ ·ä¸€ä¸ªè§’åº¦ï¼Œä¸€ä¸ªå˜æ¢çŸ©é˜µå…¶å®æè¿°äº†å˜æ¢åï¼Œæ–°çš„åŸºå‘é‡çš„å…·ä½“å½¢å¼ã€‚æˆ‘ä»¬å¯ä»¥æƒ³è±¡æŠŠæ•´ä¸ªåæ ‡è½´é€†æ—¶é’ˆæ—‹è½¬ $\alpha$ï¼Œè¿™æ ·æ–°çš„åæ ‡è½´å°±å’Œå‘é‡ $a$ é‡åˆäº†ï¼Œé‚£ä¹ˆ $(r, 0)^T$ å°±å¯ä»¥è¢«è§£é‡Šä¸ºå‘é‡ $a$ äº†ï¼Œå…¶ä¸­æ–°çš„ $x$ è½´åŸºå‘é‡ä¸º <script type="math/tex">\begin{bmatrix}cos\alpha\\ sin\alpha\\ \end{bmatrix}</script>ï¼Œæ–°çš„ $y$ è½´åŸºå‘é‡ä¸º <script type="math/tex">\begin{bmatrix}-sin\alpha\\ cos\alpha\\ \end{bmatrix}</script>ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°å¾—åˆ°è¿™æ ·ä¸€ä¸ªå˜æ¢ï¼š</p><script type="math/tex; mode=display">\begin{bmatrix}cos\alpha & -sin\alpha\\sin\alpha & cos\alpha\\\end{bmatrix} \begin{bmatrix}r\\0\\\end{bmatrix} = r\begin{bmatrix}cos\alpha\\ sin\alpha\\ \end{bmatrix}+0\begin{bmatrix}-sin\alpha\\ cos\alpha\\ \end{bmatrix}=\begin{bmatrix}rcos\alpha\\rsin\alpha\\\end{bmatrix}</script><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ç¡®å®å°±æ˜¯å‘é‡ $a$ çš„åæ ‡ã€‚é‚£ä¹ˆå¾—åˆ°å‘é‡ $b$ æˆ‘ä»¬ä¹Ÿå¦‚æ³•ç‚®åˆ¶ï¼Œåœ¨å‘é‡ $a$ çš„åŸºç¡€ä¸Šå†æ—‹è½¬ $\phi$ï¼š</p><script type="math/tex; mode=display">\begin{bmatrix}cos\phi & -sin\phi\\sin\phi & cos\phi\\\end{bmatrix} \begin{bmatrix}rcos\alpha\\rsin\alpha\\\end{bmatrix} = rcos\alpha\\begin{bmatrix}cos\phi\\ sin\phi\\ \end{bmatrix}+rsin\alpha\\begin{bmatrix}-sin\phi\\ cos\phi\\ \end{bmatrix}=\begin{bmatrix}r(cos\alpha cos\phi - sin\alpha sin\phi)\\r(cos\alpha sin\phi + sin\alpha cos\phi)\\\end{bmatrix}</script><script type="math/tex; mode=display">\Downarrow</script><script type="math/tex; mode=display">\begin{bmatrix}rcos(\alpha + \phi)\\rsin(\alpha + \phi)\\\end{bmatrix}</script><p>æˆ‘ä»¬æ­£ç¡®åœ°å¾—åˆ°äº†å‘é‡ $b$ çš„åæ ‡ï¼Œåˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬è¯æ˜äº†æ—‹è½¬çŸ©é˜µçš„æ­£ç¡®æ€§ã€‚</p><p>ä¸‹é¢ä¸¾ä¸€ä¸ªé€†æ—¶é’ˆæ—‹è½¬ $45^ã€‚$ çš„ä¾‹å­ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/v2-a46dafc052b4e363775e98dadf53a049_720w.webp" alt=""></p><h2 id="3Dçº¿æ€§å˜æ¢"><a href="#3Dçº¿æ€§å˜æ¢" class="headerlink" title="3Dçº¿æ€§å˜æ¢"></a>3Dçº¿æ€§å˜æ¢</h2><p>å‰é¢æˆ‘ä»¬å·²ç»ä»‹ç»äº†äºŒç»´çš„çº¿æ€§å˜æ¢ï¼Œé‚£ä¹ˆæ‹“å±•åˆ°ä¸‰ç»´å…¶å®ç›¸å¯¹ç®€å•çš„ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸€ä¸‹ã€‚</p><h3 id="ç¼©æ”¾-1"><a href="#ç¼©æ”¾-1" class="headerlink" title="ç¼©æ”¾"></a>ç¼©æ”¾</h3><p>æˆ‘ä»¬åªéœ€è¦æŠŠ $z$ è½´ä¹Ÿè€ƒè™‘è¿›æ¥å°±å¥½ï¼š</p><script type="math/tex; mode=display">M_{scale}(s_x, s_y, s_z)=\begin{bmatrix}s_x & 0 & 0\\0 & s_y & 0\\0 & 0 & s_z\\\end{bmatrix}</script><h3 id="å‰ªåˆ‡-1"><a href="#å‰ªåˆ‡-1" class="headerlink" title="å‰ªåˆ‡"></a>å‰ªåˆ‡</h3><p>å‰ªåˆ‡ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬ä»ç„¶ä¸¾å›ºå®š $x$ è½´çš„ä¾‹å­ï¼š</p><script type="math/tex; mode=display">M_{shear-X}(s_y, s_z)=\begin{bmatrix}1 & s_y & s_z\\0 & 1 & 0\\0 & 0 & 1\\\end{bmatrix}</script><h3 id="æ—‹è½¬-1"><a href="#æ—‹è½¬-1" class="headerlink" title="æ—‹è½¬"></a>æ—‹è½¬</h3><p>åœ¨æ—‹è½¬çš„æ—¶å€™ä¸‰ç»´å’ŒäºŒç»´å°±æœ‰äº›ä¸åŒäº†ï¼Œåœ¨ä¸‰ç»´ä¸­æˆ‘ä»¬å¯ä»¥ç»• $x$ è½´ï¼Œ$y$ è½´ï¼Œ$z$ è½´æ—‹è½¬ï¼Œå› æ­¤ä¸€èˆ¬æ¥è¯´æœ‰ä¸‰ç±»æ—‹è½¬çŸ©é˜µã€‚åœ¨è®¨è®ºåŸºç¡€æ—‹è½¬æ—¶æˆ‘ä»¬ä»ç„¶æ˜¯ä»¥é€†æ—¶é’ˆæ—‹è½¬ï¼Œå¹¶ä¸”ä»¥åæ ‡è½´ä¸ºæ—‹è½¬è½´ã€‚</p><p>æ­¤å¤„æˆ‘ä»¬é‡‡ç”¨çš„åæ ‡ç³»æ˜¯å³æ‰‹åæ ‡ç³»ï¼Œä»¥å±å¹•å»ºç«‹è¯¥åæ ‡ç³»ï¼Œå³æ‰‹ä¸º $x$ è½´æ­£æ–¹å‘ï¼Œå‘ä¸Šä¸º $y$ è½´æ­£æ–¹å‘ï¼Œå±å¹•ä»é‡Œæœå¤–ä¸º $z$ è½´æ­£æ–¹å‘ï¼Œåæ ‡åŸç‚¹ä¸ºå±å¹•æ­£ä¸­å¿ƒã€‚</p><h4 id="ç»•zè½´æ—‹è½¬"><a href="#ç»•zè½´æ—‹è½¬" class="headerlink" title="ç»•zè½´æ—‹è½¬"></a>ç»•zè½´æ—‹è½¬</h4><p>è®©æˆ‘ä»¬å›æƒ³ä¸€ä¸‹åœ¨äºŒç»´åæ ‡ä¸‹çš„æ—‹è½¬ï¼Œæˆ‘ä»¬æ˜¯ä»¥ $x$ è½´è½¬å‘ $y$ è½´çš„ï¼ˆé€†æ—¶é’ˆï¼‰ï¼Œæ ¹æ®å³æ‰‹èºæ—‹å®šåˆ™ï¼Œ$x\rightarrow y$ æ­£å¥½æ˜¯ $z$ è½´æ­£æ–¹å‘ï¼Œ$z$ è½´åæ ‡ä¸å˜ï¼Œå› æ­¤ç»• $z$ è½´æ—‹è½¬å¾ˆå®¹æ˜“å†™å‡ºæ¥ï¼š</p><script type="math/tex; mode=display">M_{rotate-Z}(\phi)=\begin{bmatrix}cos\phi & -sin\phi & 0\\sin\phi & cos\phi & 0\\0 & 0 & 1\\\end{bmatrix}</script><p>å¯ä»¥çœ‹åˆ°è¿™è·ŸäºŒç»´çš„å½¢å¼éå¸¸åƒï¼Œååˆ†å¥½è®°ã€‚</p><h4 id="ç»•xè½´æ—‹è½¬"><a href="#ç»•xè½´æ—‹è½¬" class="headerlink" title="ç»•xè½´æ—‹è½¬"></a>ç»•xè½´æ—‹è½¬</h4><p>æˆ‘ä»¬ä»¥ $y$ è½´è½¬å‘ $z$ è½´çš„ï¼ˆé€†æ—¶é’ˆï¼‰ï¼Œæ ¹æ®å³æ‰‹èºæ—‹å®šåˆ™ï¼Œ$y\rightarrow z$ æ­£å¥½æ˜¯ $x$ è½´æ­£æ–¹å‘ï¼Œ$x$ è½´åæ ‡ä¸å˜ï¼š</p><script type="math/tex; mode=display">M_{rotate-X}(\phi)=\begin{bmatrix}1 & 0 & 0\\0 &cos\phi & -sin\phi\\0 & sin\phi & cos\phi\\\end{bmatrix}</script><h4 id="ç»•yè½´æ—‹è½¬"><a href="#ç»•yè½´æ—‹è½¬" class="headerlink" title="ç»•yè½´æ—‹è½¬"></a>ç»•yè½´æ—‹è½¬</h4><p>æˆ‘ä»¬ä»¥ $z$ è½´è½¬å‘ $x$ è½´çš„ï¼ˆé€†æ—¶é’ˆï¼‰ï¼Œæ ¹æ®å³æ‰‹èºæ—‹å®šåˆ™ï¼Œ$z\rightarrow x$ æ­£å¥½æ˜¯ $y$ è½´æ­£æ–¹å‘ï¼Œ$y$ è½´åæ ‡ä¸å˜ï¼š</p><script type="math/tex; mode=display">M_{rotate-X}(\phi)=\begin{bmatrix}cos\phi & 0 & sin\phi\\0 &1 & 0\\-sin\phi & 0 & cos\phi\\\end{bmatrix}</script><p>æ³¨æ„ï¼Œæˆ‘ä»¬ç»• $y$ è½´æ—‹è½¬çš„æ—¶å€™å³ä¸Šè§’å’Œå·¦ä¸‹è§’çš„ç¬¦å·è°ƒæ¢äº†ï¼Œä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿè¿™è·Ÿé¡ºé€†æ—¶é’ˆæ²¡å…³ç³»ï¼Œä¸»è¦æ˜¯å› ä¸ºæˆ‘ä»¬æè¿°åæ ‡æ—¶æ˜¯ä»¥ $(x,y,z)$ çš„é¡ºåºæ¥æè¿°çš„ï¼Œæˆ‘ä»¬çš„çŸ©é˜µçš„åˆ—å‘é‡ä¹Ÿæ˜¯ä»¥è¿™ä¸ªé¡ºåºã€‚æ­¤æ—¶ $z$ è½´ç›¸å½“äºæ¨ªåæ ‡ï¼Œ$x$ è½´ç›¸å½“äºçºµåæ ‡ï¼Œç±»æ¯”äºŒç»´æ—‹è½¬æˆ‘ä»¬å°±å¯ä»¥çŸ¥é“äº†ï¼Œä¸ºçºµåæ ‡çš„é‚£ä¸€ä¸ªè½´ç¬¬äºŒé¡¹ä¸ºè´Ÿæ•°ï¼Œå› æ­¤æˆ‘ä»¬å¾—åˆ°äº†è¿™ä¸€ä¸ªçœ‹èµ·æ¥ä¸å¤ªä¸€æ ·çš„å½¢å¼ã€‚</p><h4 id="æ­£äº¤"><a href="#æ­£äº¤" class="headerlink" title="æ­£äº¤"></a>æ­£äº¤</h4><p>æˆ‘ä»¬è¿˜éœ€è¦æ³¨æ„åˆ°ä¸€ä¸ªäº‹å®ï¼Œå³æ‰€æœ‰çš„æ—‹è½¬çŸ©é˜µå…¨éƒ½æ˜¯æ­£äº¤çŸ©é˜µï¼Œé‚£ä¹ˆæ—‹è½¬çŸ©é˜µçš„é€†å°±æ˜¯å®ƒçš„è½¬ç½®ï¼Œæ ¹æ®è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå¾ˆå®¹æ˜“åœ°å®ç°é€†æ—¶é’ˆæ—‹è½¬å’Œé¡ºæ—¶é’ˆæ—‹è½¬ã€‚</p><h2 id="ä»¿å°„å˜æ¢"><a href="#ä»¿å°„å˜æ¢" class="headerlink" title="ä»¿å°„å˜æ¢"></a>ä»¿å°„å˜æ¢</h2><p>ä¸¥æ ¼æ¥è¯´ï¼Œå¹³ç§»å¹¶éæ˜¯çº¿æ€§å˜æ¢ï¼Œä½†ä»–åˆç¡®å®æ˜¯å›¾å½¢å­¦ä¸­ä¸€ç§ååˆ†å¸¸ç”¨çš„å˜æ¢ã€‚å¦‚æœæˆ‘ä»¬ä»ç„¶ä½¿ç”¨å½“å‰ä½“ç³»ä¸‹çš„è¡¨ç¤ºå½¢å¼ï¼Œæ˜¯ä¸èƒ½ç”¨ä¸€ä¸ªçŸ©é˜µåŒæ—¶è¡¨ç¤ºå¹³ç§»å’Œçº¿æ€§å˜æ¢çš„ï¼Œè¿™å®åœ¨å¤ªä¸æ–¹ä¾¿äº†ã€‚ä¸ºæ­¤æˆ‘ä»¬å°†å¼•å…¥é½æ¬¡åæ ‡çš„æ¦‚å¿µï¼ŒæŠŠçº¿æ€§å˜æ¢å’Œå¹³ç§»ç»Ÿä¸€èµ·æ¥ï¼Œç»Ÿç§°ä¸ºä»¿å°„å˜æ¢ã€‚</p><h3 id="å¹³ç§»"><a href="#å¹³ç§»" class="headerlink" title="å¹³ç§»"></a>å¹³ç§»</h3><p>è¦è¡¨ç¤ºå¹³ç§»å…¶å®éå¸¸ç®€å•ï¼š</p><script type="math/tex; mode=display">\begin{bmatrix}x_{shift}\\y_{shift}\\\end{bmatrix} =\begin{bmatrix}x\\y\\\end{bmatrix} +\begin{bmatrix}x_t\\y_t\\\end{bmatrix} =\begin{bmatrix}x+x_t\\y+y_t\\\end{bmatrix}</script><p>å¯ä»¥çœ‹åˆ°ï¼Œä½†æ˜¯ä»å½¢å¼ä¸Šæ¥è¯´å°±è·ŸåŸæ¥çš„ä½“ç³»ä¸å…¼å®¹äº†ï¼Œæƒ³è¦è¡¨ç¤ºä¸€ä¸ªç‰©ä½“å…ˆç¼©æ”¾åå¹³ç§»æˆ–è®¸å¾—è¿™ä¹ˆè¡¨ç¤ºï¼š</p><script type="math/tex; mode=display">M_{scale}\begin{bmatrix}x\\y\\\end{bmatrix} +\begin{bmatrix}x_t\\y_t\\\end{bmatrix}</script><p>é¢â€¦â€¦.æœ‰ç‚¹å°ä¸‘.</p><h3 id="é½æ¬¡åæ ‡ç³»"><a href="#é½æ¬¡åæ ‡ç³»" class="headerlink" title="é½æ¬¡åæ ‡ç³»"></a>é½æ¬¡åæ ‡ç³»</h3><p>æˆ‘ä»¬å¼•å…¥ä¸€ç»´æ–°çš„åæ ‡ï¼Œç§°ä¹‹ä¸ºé½æ¬¡åæ ‡ï¼Œ$(x, y)^T \rightarrow    (x, y, 1)^T$ã€‚ç°åœ¨æˆ‘ä»¬å†çœ‹æˆ‘ä»¬å¦‚ä½•æ¥è¡¨ç¤ºä¸€ä¸ªç‰©ä½“å…ˆç¼©æ”¾åå¹³ç§»ï¼š</p><script type="math/tex; mode=display">M_{scale \rightarrow shift}\begin{bmatrix}x\\y\\1\\\end{bmatrix} =\begin{bmatrix}s_x & 0 & x_t\\0 & s_y & y_t\\0 & 0 & 1\\\end{bmatrix} \begin{bmatrix}x\\y\\1\\\end{bmatrix} =\begin{bmatrix}s_x x + x_t\\s_y y + y_t\\1\\\end{bmatrix}</script><p>å¤ªä¼˜é›…äº†ï¼Œä¸æ˜¯å—ï¼Ÿæˆ‘ä»¬ä»¥å¤šå¼•å…¥ä¸€ç»´çš„ä»£ä»·å¾—åˆ°äº†ä¸€ä¸ªç»Ÿä¸€çš„å½¢å¼æ¥æè¿°å˜æ¢çŸ©é˜µï¼ŒçœŸæ˜¯å¯å–œå¯è´ºã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè®©æˆ‘ä»¬ç”¨é½æ¬¡åæ ‡ç³»æ¥è¡¨ç¤ºç‰©ä½“çš„å˜æ¢æ—¶ï¼Œæ˜¯å…ˆè¿›è¡Œçº¿æ€§å˜æ¢ï¼Œå†è¿›è¡Œå¹³ç§»å˜æ¢çš„ï¼Œä»ä¸Šé¢çš„ç»“æœæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡ºè¿™ä¸€ç‚¹ã€‚</p><p>è¿˜æœ‰ä¸€ç‚¹ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç”¨ $(x, y, w)^T$ è¿™æ ·çš„å½¢å¼æ¥è¡¨ç¤ºé½æ¬¡åæ ‡ï¼Œå…¶ä¸­ $w$ ä¸º <strong><em>0</em></strong> æ—¶ï¼Œä»£è¡¨è¿™æ˜¯ä¸€ä¸ªå‘é‡ï¼Œå½“ $w$ é <strong><em>0</em></strong> æ—¶ï¼Œä»£è¡¨è¿™æ˜¯ä¸€ä¸ªç‚¹ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè§„å®šå‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼Œå‘é‡å…·æœ‰å¹³ç§»ä¸å˜æ€§ï¼Œä¸€ä¸ªå‘é‡è¢«å¹³ç§»è¿‡åè¿˜æ˜¯åŸæ¥çš„å‘é‡ï¼Œå¦‚æœ $w$ ä¸º0ï¼Œå°±å¯ä»¥ä¿è¯è¿™ä¸€ç‚¹ï¼š</p><script type="math/tex; mode=display">\begin{bmatrix}1 & 0 & x_t\\0 & 1 & y_t\\0 & 0 & 1\\\end{bmatrix} \begin{bmatrix}x\\y\\0\\\end{bmatrix} =\begin{bmatrix}x\\y\\0\\\end{bmatrix}</script><h2 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h2><ul><li>ä¸å®¹é”™è¿‡çš„ç¥è¯¾ï¼š<a href="https://www.bilibili.com/video/BV1ys411472E/?spm_id_from=333.999.0.0"><strong><em>3Blue1Brown çº¿æ€§ä»£æ•°çš„æœ¬è´¨</em></strong></a> </li></ul>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºå›¾å½¢å­¦ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> games101 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¿«é€Ÿå¹‚</title>
      <link href="/archives/1599bffe.html"/>
      <url>/archives/1599bffe.html</url>
      
        <content type="html"><![CDATA[<h2 id="ç®—æ³•ä»‹ç»"><a href="#ç®—æ³•ä»‹ç»" class="headerlink" title="ç®—æ³•ä»‹ç»"></a>ç®—æ³•ä»‹ç»</h2><p>å¿«é€Ÿå¹‚ï¼Œä¹Ÿæˆä¸ºäºŒè¿›åˆ¶å–å¹‚ï¼ˆ<strong><em>Binary Exponentiation</em></strong>ï¼‰ï¼Œæ˜¯ä¸€ä¸ªåœ¨  $\omicron(\log n)$ çš„æ—¶é—´å†…è®¡ç®— $a^n$ çš„å° <strong><em>trick</em></strong>ï¼Œè€Œæš´åŠ›çš„æ–¹æ³•éœ€è¦ $\omicron(n)$ çš„æ—¶é—´ã€‚</p><h2 id="åŸºæœ¬æ€æƒ³"><a href="#åŸºæœ¬æ€æƒ³" class="headerlink" title="åŸºæœ¬æ€æƒ³"></a>åŸºæœ¬æ€æƒ³</h2><p>è®¡ç®— $a$ çš„ $n$ æ¬¡æ–¹è¡¨ç¤ºå°† $n$ ä¸ª $a$ ä¹˜åœ¨ä¸€èµ·ï¼š$a^n=\underbrace{a \times a \cdots \times a}_n$ ï¼Œç„¶è€Œå½“ $n$ å¾ˆå¤§æ—¶ï¼Œè¿™ç§æ–¹æ³•å°±æ¯”è¾ƒæ…¢äº†ã€‚ä¸è¿‡æˆ‘ä»¬çŸ¥é“ï¼Œæ ¹æ®å¹‚çš„æ€§è´¨ï¼Œ$a^{b+c}=a^b \times a^c$ ï¼Œ$a^{2b}=a^b \times a^b=(a^b)^2$ ã€‚å¿«é€Ÿå¹‚çš„æƒ³æ³•å°±æ˜¯ï¼Œæˆ‘ä»¬å°†å–å¹‚çš„ä»»åŠ¡æŒ‰ç…§æŒ‡æ•°çš„ <strong><em>äºŒè¿›åˆ¶è¡¨ç¤º</em></strong> ï¼Œä»¥æ­¤æ¥åˆ†å‰²æˆæ›´å°çš„ä»»åŠ¡ã€‚</p><h2 id="æ±‚è§£è¿‡ç¨‹"><a href="#æ±‚è§£è¿‡ç¨‹" class="headerlink" title="æ±‚è§£è¿‡ç¨‹"></a>æ±‚è§£è¿‡ç¨‹</h2><p>æˆ‘ä»¬é¦–å…ˆä¸¾ä¸€ä¸ª $a^n$ çš„å…·ä½“çš„ä¾‹å­ï¼Œå¹¶å°† $n$ è¡¨ç¤ºä¸ºäºŒè¿›åˆ¶ï¼š</p><script type="math/tex; mode=display">7^{12}=7^{(1100)_2}=7^8 \times 7^4</script><p>å› ä¸º $n$ å¯ä»¥ç”± $\lfloor log_2 n \rfloor + 1$ ä¸ªäºŒè¿›åˆ¶ä½æ¥è¡¨ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿä¸Šé¢çš„ä¾‹å­ï¼Œè¿™ $\lfloor log_2 n \rfloor + 1$ ä¸ªäºŒè¿›åˆ¶ä½ä¸­æœ‰çš„ä½æ˜¯ <strong><em>1</em></strong> ï¼Œæœ‰çš„ä½æ˜¯ <strong><em>0</em></strong>ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠå¯¹åº”äºŒè¿›åˆ¶ä½ä¸º <strong><em>1</em></strong> çš„æ•´ç³»æ•°å¹‚ä¹˜èµ·æ¥å°±è¡Œäº†ã€‚æˆ‘ä»¬ç°åœ¨å‡è®¾ç¬¬ $i$ ä½ä¸Šçš„æ•°ä¸º <strong><em>1</em></strong>ï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“å°±å¯ä»¥å¾—å‡ºä¸€èˆ¬åŒ–çš„å½¢å¼ï¼š</p><script type="math/tex; mode=display">a^n=\prod_{i=0}^{\lfloor log_2 n \rfloor}a^{2^i}</script><p>éœ€è¦æ³¨æ„æˆ‘ä»¬æ˜¯ä» <strong><em>0</em></strong> å¼€å§‹è®¡ç®—ä½æ•°çš„ï¼Œè¿™æ ·å¹‚çš„æ€§è´¨å’ŒäºŒè¿›åˆ¶çš„è¡¨ç¤ºèƒ½å®Œç¾åœ°é…åˆèµ·æ¥ã€‚å› ä¸ºè‡³å¤šéœ€è¦æŠŠ $\lfloor log_2 n \rfloor + 1$ ä¸ªæ•´ç³»æ•°å¹‚ä¹˜èµ·æ¥ï¼Œå› æ­¤è¿™ä¸ªç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯ $\omicron(\log n)$ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªå°¾å·´éœ€è¦è§£å†³ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨æ¯ä¸€æ­¥ä¸­è®¡ç®—å‡º $a^{2^i}$ï¼Œè¿™ä¸ªå…¶å®éå¸¸å®¹æ˜“è§£å†³ã€‚åœ¨æˆ‘ä»¬è¿­ä»£çš„è¿‡ç¨‹ä¸­å¯ä»¥åŠ¨æ€ç»´æŠ¤ $a^{2^i}$ è¿™ä¸ªå˜é‡ï¼Œå¹¶åœ¨å¸¸æ•°æ—¶é—´å†…ä» $a^{2^i}$ æ¨å‡º $a^{2^{i+1}}$:</p><script type="math/tex; mode=display">a^{2^i} \times a^{2^i} = a^{2^{i+1}}</script><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><p>è¿™é‡Œæˆ‘ä»¬ç»™å‡ºéé€’å½’çš„å½¢å¼ï¼Œæ ¹æ®ä¸Šè¿°æ¨å¯¼å¾—å‡ºçš„å…¬å¼è¿™å¹¶ä¸éš¾å®Œæˆï¼š<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">long</span> <span class="type">long</span> <span class="title">quickPow</span><span class="params">(<span class="type">long</span> <span class="type">long</span> a, <span class="type">long</span> <span class="type">long</span> n)</span> </span>&#123;</span><br><span class="line">  <span class="type">long</span> <span class="type">long</span> ans = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (n &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (n &amp; <span class="number">1</span>) ans *= a;</span><br><span class="line">    a *= a;</span><br><span class="line">    n &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="å®æˆ˜æŒ‡è·¯"><a href="#å®æˆ˜æŒ‡è·¯" class="headerlink" title="å®æˆ˜æŒ‡è·¯"></a>å®æˆ˜æŒ‡è·¯</h2><p><a href="https://leetcode-cn.com/problems/sort-list/"><strong><em>Leetcode 50. Pow(x, n) (Medium)</em></strong></a></p><p>â€œ<strong><em>Talk is cheap, show me the code!</em></strong>â€œ<br>â€”â€”<strong><em>Linus Benedict Torvalds</em></strong></p><p>è¿™é‡Œç»™å‡ºæˆ‘çš„å®ç°ä»£ç :</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">myPow</span><span class="params">(<span class="type">double</span> x, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="type">double</span> res = <span class="number">1.0</span>;</span><br><span class="line">        <span class="type">bool</span> negative = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (n &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            negative = <span class="literal">true</span>;</span><br><span class="line">            n = <span class="built_in">abs</span>(n);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (n &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (n &amp; <span class="number">1</span>) res *= x;</span><br><span class="line">            x *= x;</span><br><span class="line">            n &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> negative ? <span class="number">1</span> / res : res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¿«é€Ÿå¹‚ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SocketLab3ï¼šSMTP</title>
      <link href="/archives/4f4fa075.html"/>
      <url>/archives/4f4fa075.html</url>
      
        <content type="html"><![CDATA[<p><em><strong>å®˜æ–¹è‹±æ–‡èµ„æºç½‘ç«™</strong></em> ï¼š<a href="https://media.pearsoncmg.com/ph/esm/ecs_kurose_compnetwork_8/cw/"><em><strong>Pearson Computer Networking: a Top-Down Approach, 8th Edition</strong></em></a></p><p><em><strong>ç›´æ¥ä¸‹è½½</strong></em>ï¼š<a href="https://media.pearsoncmg.com/ph/esm/ecs_kurose_compnetwork_8/cw/content/python-socket-programming-assignments.zip"><em><strong>Python 3 Socket Programming Assignments</strong></em></a></p><p><em><strong>ä»¥ä¸‹å†…å®¹ä¸ºç¬”è€…ç¿»è¯‘</strong></em> ï¼š</p><hr><p>é€šè¿‡å®Œæˆæœ¬å®éªŒï¼Œä½ å°†æ›´åŠ ç†è§£ <em><strong>STMP</strong></em> åè®®ã€‚ä¸æ­¤åŒæ—¶ï¼Œä½ å°†ä¼šå¾—åˆ°ä½¿ç”¨ <em><strong>Python</strong></em> å®ç°ä¸€ä¸ªæ ‡å‡†åè®®çš„ç»éªŒã€‚</p><p>ä½ çš„ä»»åŠ¡æ˜¯å¼€å‘ä¸€ä¸ªç®€å•çš„é‚®ä»¶å®¢æˆ·ç«¯æ¥å‘é€é‚®ä»¶ç»™ä»»æ„æ”¶ä»¶äººã€‚ä½ çš„å®¢æˆ·ç«¯éœ€è¦è¿æ¥åˆ°ä¸€ä¸ªé‚®ä»¶æœåŠ¡å™¨ï¼Œä½¿ç”¨ <em><strong>STMP</strong></em> åè®®ä¸é‚®ä»¶æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œå¹¶å‘é€ä¸€å°ç”µå­é‚®ä»¶åˆ°é‚®ä»¶æœåŠ¡å™¨ã€‚<em><strong>Python</strong></em> æä¾›äº†ä¸€ä¸ªå«åš <code>smtplib</code> çš„æ¨¡å—ï¼Œè¯¥æ¨¡å—å†…ç½®äº†ä½¿ç”¨ <em><strong>STMP</strong></em> åè®®æ¥å‘é€é‚®ä»¶çš„æ–¹æ³•ã€‚ç„¶è€Œï¼Œåœ¨æœ¬å®éªŒä¸­æˆ‘ä»¬ä¸ä¼šä½¿ç”¨è¿™ä¸ªæ¨¡å—ï¼Œå› ä¸ºå®ƒæŠŠ <em><strong>STMP</strong></em> åè®®å’Œå¥—æ¥å­—ç¼–ç¨‹çš„ç»†èŠ‚éšè—èµ·æ¥äº†ã€‚</p><p>ä¸ºäº†æ‹¦æˆªåƒåœ¾é‚®ä»¶ï¼Œä¸€äº›é‚®ä»¶æœåŠ¡å™¨ä¸æ¥å—æ¥è‡ªä»»æ„æœªçŸ¥æºçš„ <em><strong>TCP</strong></em> è¿æ¥ã€‚å¯¹äºä¸‹é¢æ‰€æè¿°çš„å®éªŒï¼Œä½ å¯èƒ½æƒ³è¦å°è¯•è¿æ¥ä½ æœ¬æ ¡çš„é‚®ä»¶æœåŠ¡å™¨å’Œä¸€ä¸ªæµè¡Œçš„ç½‘é¡µé‚®ä»¶æœåŠ¡å™¨ï¼Œä¾‹å¦‚ä¸€ä¸ª <em><strong>AOL</strong></em> é‚®ä»¶æœåŠ¡å™¨ã€‚ä½ ä¹Ÿå¯ä»¥å°è¯•ä»ä½ å®¶åˆ°ä½ æœ¬æ ¡æ ¡å›­è¿›è¡Œè¿æ¥ã€‚</p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p>ä¸‹é¢ä½ ä¼šæ‰¾åˆ°å®¢æˆ·ç«¯çš„æ¡†æ¶ä»£ç ã€‚ä½ çš„ä»»åŠ¡æ˜¯å®Œæˆè¿™ä¸ªæ¡†æ¶ä»£ç ã€‚ä½ éœ€è¦å¡«å†™ä»£ç çš„åœ°æ–¹å·²ç»è¢« <code>#Fill in start</code> å’Œ <code>#Fill in end</code> æ ‡è®°å‡ºæ¥äº†ã€‚æ¯ä¸ªåœ°æ–¹å¯èƒ½éœ€è¦ä¸€è‡³å¤šè¡Œä»£ç ã€‚</p><h2 id="é¢å¤–æç¤º"><a href="#é¢å¤–æç¤º" class="headerlink" title="é¢å¤–æç¤º"></a>é¢å¤–æç¤º</h2><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ¥æ”¶é‚®ä»¶æœåŠ¡å™¨å¯èƒ½ä¼šå°†ä½ çš„é‚®ä»¶è§†ä¸ºåƒåœ¾ã€‚å½“ä½ éœ€è¦æŸ¥æ‰¾ä»å®¢æˆ·ç«¯å‘é€çš„é‚®ä»¶æ—¶ï¼Œç¡®ä¿ä½ æ£€æŸ¥äº†åƒåœ¾é‚®ä»¶æ–‡ä»¶å¤¹ã€‚</p><h2 id="è¦ä¸Šäº¤çš„å†…å®¹"><a href="#è¦ä¸Šäº¤çš„å†…å®¹" class="headerlink" title="è¦ä¸Šäº¤çš„å†…å®¹"></a>è¦ä¸Šäº¤çš„å†…å®¹</h2><p>åœ¨ä½ çš„æäº¤ä¸­ï¼Œä½ éœ€è¦æä¾›å®Œæ•´çš„ <em><strong>STMP</strong></em> é‚®ä»¶å®¢æˆ·ç«¯ä»£ç ï¼Œå¹¶ä¸”é™„å¸¦æˆªå›¾å±•ç¤ºä½ ç¡®å®æ”¶åˆ°äº†ç”µå­é‚®ä»¶ã€‚</p><h2 id="é‚®ä»¶å®¢æˆ·ç«¯çš„Pythonä»£ç æ¡†æ¶"><a href="#é‚®ä»¶å®¢æˆ·ç«¯çš„Pythonä»£ç æ¡†æ¶" class="headerlink" title="é‚®ä»¶å®¢æˆ·ç«¯çš„Pythonä»£ç æ¡†æ¶"></a>é‚®ä»¶å®¢æˆ·ç«¯çš„Pythonä»£ç æ¡†æ¶</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line">msg = <span class="string">&quot;\r\n I love computer networks!&quot;</span></span><br><span class="line">endmsg = <span class="string">&quot;\r\n.\r\n&quot;</span></span><br><span class="line"><span class="comment"># Choose a mail server (e.g. Google mail server) and call it mailserver </span></span><br><span class="line">mailserver = <span class="comment">#Fill in start   #Fill in end</span></span><br><span class="line"><span class="comment"># Create socket called clientSocket and establish a TCP connection with mailserver</span></span><br><span class="line"><span class="comment">#Fill in start</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Fill in end</span></span><br><span class="line">recv = clientSocket.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="built_in">print</span> recv</span><br><span class="line"><span class="keyword">if</span> recv[:<span class="number">3</span>] != <span class="string">&#x27;220&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;220 reply not received from server.&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Send HELO command and print server response.</span></span><br><span class="line">heloCommand = <span class="string">&#x27;HELO Alice\r\n&#x27;</span></span><br><span class="line">clientSocket.send(heloCommand)</span><br><span class="line">recv1 = clientSocket.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="built_in">print</span> recv1</span><br><span class="line"><span class="keyword">if</span> recv1[:<span class="number">3</span>] != <span class="string">&#x27;250&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;250 reply not received from server.&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Send MAIL FROM command and print server response.</span></span><br><span class="line"><span class="comment"># Fill in start</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Fill in end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Send RCPT TO command and print server response.</span></span><br><span class="line"><span class="comment"># Fill in start</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Fill in end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Send DATA command and print server response.</span></span><br><span class="line"><span class="comment"># Fill in start</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Fill in end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Send message data.</span></span><br><span class="line"><span class="comment"># Fill in start</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Fill in end </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Message ends with a single period.</span></span><br><span class="line"><span class="comment"># Fill in start</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Fill in end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Send QUIT command and get server response.</span></span><br><span class="line"><span class="comment"># Fill in start</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Fill in end</span></span><br></pre></td></tr></table></figure><h2 id="å¯é€‰ç»ƒä¹ "><a href="#å¯é€‰ç»ƒä¹ " class="headerlink" title="å¯é€‰ç»ƒä¹ "></a>å¯é€‰ç»ƒä¹ </h2><ol><li><p>é‚®ä»¶æœåŠ¡å™¨ï¼Œä¾‹å¦‚è°·æ­Œé‚®ä»¶ï¼ˆ<em><strong>address: smtp.gmail.com</strong></em>ï¼Œ<em><strong>port: 587</strong></em>ï¼‰å‡ºäºèº«ä»½é‰´å®šå’Œå®‰å…¨çš„åŸå› ï¼Œéœ€è¦ä½ çš„å®¢æˆ·ç«¯åœ¨å‘é€ <code>MAIL FROM</code> å‘½ä»¤ä¹‹å‰ï¼Œæ·»åŠ ä¸€ä¸ªä¼ è¾“å±‚å®‰å…¨åè®®ï¼ˆ<em><strong>TLS</strong></em>ï¼‰æˆ–è€…ä¸€ä¸ªå®‰å…¨å¥—æ¥å­—å±‚ï¼ˆ<em><strong>SSL</strong></em>ï¼‰ã€‚æ·»åŠ  <em><strong>TLS&#x2F;SSL</strong></em> åˆ°ä½ ç°æœ‰çš„ä»£ç ä¸­ï¼Œå¹¶ä½¿ç”¨ä¸Šè¿°çš„åœ°å€å’Œç«¯å£ä¸ºè°·æ­Œé‚®ä»¶æœåŠ¡å™¨å®ç°ä¸€ä¸ªå®¢æˆ·ç«¯ã€‚</p></li><li><p>ç›®å‰ä½ çš„ <em><strong>STMP</strong></em> é‚®ä»¶å®¢æˆ·ç«¯åªèƒ½åœ¨ç”µå­é‚®ä»¶æ­£æ–‡ä¸­å‘é€æ–‡æœ¬ä¿¡æ¯ã€‚ä¿®æ”¹ä½ çš„å®¢æˆ·ç«¯ä½¿å…¶æ—¢èƒ½å‘é€æ–‡æœ¬ä¿¡æ¯åˆèƒ½å‘é€å›¾ç‰‡ã€‚</p></li></ol><h2 id="å¿…åšé¢˜"><a href="#å¿…åšé¢˜" class="headerlink" title="å¿…åšé¢˜"></a>å¿…åšé¢˜</h2><p>ç”±äº <em><strong>AT</strong></em> ç«‹åœºçš„å­˜åœ¨ï¼Œæœ¬æ–‡é‡‡ç”¨çš„é‚®ä»¶æœåŠ¡å™¨å‡ä¸º <em><strong>QQ</strong></em> é‚®ç®±æ¥å®Œæˆã€‚é€šè¿‡å®ç°ä¸€ä¸ª <em><strong>SMTP</strong></em> å®¢æˆ·ç«¯ï¼Œä½¿ç”¨ <em><strong>QQ</strong></em> é‚®ç®±ä½œä¸ºå‘ä»¶äººï¼Œå‘æŒ‡å®šçš„å¦ä¸€ä¸ª <em><strong>QQ</strong></em> é‚®ç®±ç”¨æˆ·å‘é€ä¸€å°é‚®ä»¶ã€‚</p><h3 id="åŸºæœ¬æµç¨‹"><a href="#åŸºæœ¬æµç¨‹" class="headerlink" title="åŸºæœ¬æµç¨‹"></a>åŸºæœ¬æµç¨‹</h3><p><em><strong>SMTP</strong></em> å®¢æˆ·ç«¯ç¨‹åºå‘é€é‚®ä»¶çš„åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>ä¸ <em><strong>QQ</strong></em> é‚®ä»¶æœåŠ¡å™¨å»ºç«‹èµ· <em><strong>TCP</strong></em> è¿æ¥ï¼ŒåŸŸåä¸º <code>smtp.qq.com</code> , <em><strong>QQ</strong></em> é‚®ç®±å®˜æ–¹æä¾›çš„ <em><strong>SMTP</strong></em> é»˜è®¤ç«¯å£å·ä¸º <code>587</code> ã€‚æˆåŠŸå»ºç«‹èµ·è¿æ¥åæœåŠ¡å™¨è¿”å›çŠ¶æ€ç  <code>220</code>ï¼Œä»£è¡¨æœåŠ¡å™¨å·²ç»å°±ç»ªã€‚</li><li>å‘é€ <code>HELO</code> å‘½ä»¤ï¼Œå®¢æˆ·ç«¯å¼€å§‹ä¸æœåŠ¡å™¨è¿›è¡Œäº¤äº’ï¼ŒæœåŠ¡å™¨è¿”å›çŠ¶æ€ç  <code>250</code> ï¼ˆä»£è¡¨è¯·æ±‚åŠ¨ä½œæ­£ç¡®å®Œæˆï¼‰ã€‚</li><li>å‘é€ <code>AUTH LOGIN</code> å‘½ä»¤ï¼Œå¼€å§‹éªŒè¯èº«ä»½ï¼ŒæœåŠ¡å™¨è¿”å›çŠ¶æ€ç  <code>334</code> ï¼ˆæœåŠ¡å™¨ç­‰å¾…ç”¨æˆ·è¾“å…¥éªŒè¯ä¿¡æ¯ï¼‰ã€‚</li><li>å‘é€ç»è¿‡ <em><strong>base64</strong></em> ç¼–ç çš„ç”¨æˆ·åï¼Œå³ä½ çš„é‚®ç®±è´¦å·ï¼ŒæœåŠ¡å™¨è¿”å›çŠ¶æ€ç  <code>334</code> ï¼ˆæœåŠ¡å™¨ç­‰å¾…ç”¨æˆ·è¾“å…¥éªŒè¯ä¿¡æ¯ï¼‰ã€‚</li><li>å‘é€ç»è¿‡ <em><strong>base64</strong></em> ç¼–ç çš„å¯†ç ï¼Œï¼ˆè¿™é‡Œè¯·æ³¨æ„è¯¥å¯†ç ä¸æ˜¯æˆ‘ä»¬å¹³å¸¸æ‰€ç”¨çš„å¯†ç ï¼Œè€Œæ˜¯ç‰¹æ®Šçš„æˆæƒç ï¼Œå…·ä½“æˆ‘ä¼šåœ¨åé¢è¯´æ˜ï¼‰ï¼ŒæœåŠ¡å™¨è¿”å›çŠ¶æ€ç  <code>235</code> ï¼ˆç”¨æˆ·éªŒè¯æˆåŠŸï¼‰ã€‚</li><li>å‘é€ <code>MAIL FROM</code> å‘½ä»¤ï¼Œå¹¶åŒ…å«å‘ä»¶äººçš„é‚®ç®±åœ°å€ï¼ŒæœåŠ¡å™¨å°†è¿”å›çŠ¶æ€ç  <code>250</code> ï¼ˆè¯·æ±‚åŠ¨ä½œæ­£ç¡®å®Œæˆï¼‰ã€‚</li><li>å‘é€ <code>RCPT TO</code> å‘½ä»¤ï¼Œå¹¶åŒ…å«æ”¶ä»¶äººçš„é‚®ç®±åœ°å€ï¼ŒæœåŠ¡å™¨å°†è¿”å›çŠ¶æ€ç  <code>250</code> ï¼ˆè¯·æ±‚åŠ¨ä½œæ­£ç¡®å®Œæˆï¼‰ã€‚</li><li>å‘é€ <code>DATA</code> å‘½ä»¤ï¼Œè¡¨ç¤ºå³å°†å‘é€é‚®ä»¶çš„å†…å®¹ï¼ŒæœåŠ¡å™¨å°†è¿”å›çŠ¶æ€ç  <code>354</code>ã€‚</li><li>å‘é€é‚®ä»¶å†…å®¹ï¼Œä»¥ <code>&lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;</code> ç»“æŸï¼ŒæœåŠ¡å™¨è¿”å›çŠ¶æ€ç  <code>250</code> ï¼ˆä»£è¡¨è¯·æ±‚åŠ¨ä½œæ­£ç¡®å®Œæˆï¼‰ã€‚</li><li>å‘é€ <code>QUIT</code> å‘½ä»¤ï¼Œæ–­å¼€ä¸ <em><strong>QQ</strong></em> é‚®ä»¶æœåŠ¡å™¨çš„è¿æ¥ã€‚</li></ol><h3 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h3><ul><li>ç›®å‰å¤§å¤šæ•°é‚®ç®±éƒ½é»˜è®¤å…³é—­äº† <em><strong>SMTP</strong></em> æœåŠ¡ï¼Œä¾‹å¦‚ <em><strong>QQ</strong></em> é‚®ç®±ã€‚æˆ‘ä»¬éœ€è¦è¿›å…¥ <em><strong>QQ</strong></em> é‚®ç®±åœ¨è®¾ç½®ä¸­æ‰‹åŠ¨æ‰“å¼€ <em><strong>SMTP</strong></em> æœåŠ¡ã€‚åœ¨æ‰“å¼€çš„åŒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”³è¯·åˆ°ä¸€ä¸ªæˆæƒç ï¼Œåœ¨ç¨‹åºä¸­æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªæˆæƒç ä½œä¸ºå¯†ç ç™»å½•ï¼Œè€Œéå¹³å¸¸çš„å¯†ç ã€‚</li><li>ä¸Šæ–‡ä¸­çš„ç¬¬ <em><strong>3ã€4ã€5</strong></em> æ­¥åœ¨è¯¾æœ¬ä¸­å¹¶æœªæåŠï¼Œè¿™ä¹Ÿæ˜¯å› ä¸º <em><strong>SMTP</strong></em> æœåŠ¡è¢«é»˜è®¤å…³é—­äº†çš„åŸå› ï¼Œå› æ­¤éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨éªŒè¯ã€‚</li><li><em><strong>SMTP</strong></em> æœåŠ¡çš„é»˜è®¤ç«¯å£å·å¯ä»¥åœ¨å®˜æ–¹æŸ¥è¯¢å¾—åˆ°ã€‚<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221121234812.png"></li></ul><h3 id="å®ç°ä»£ç "><a href="#å®ç°ä»£ç " class="headerlink" title="å®ç°ä»£ç "></a>å®ç°ä»£ç </h3><p><em><strong>SMTPClient.pyï¼š</strong></em></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">msg = <span class="string">&quot;\r\n I love computer networks!&quot;</span></span><br><span class="line">endmsg = <span class="string">&quot;\r\n.\r\n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Choose a mail server (e.g. Google mail server) and call it mailserver </span></span><br><span class="line">mailServer = <span class="string">&quot;smtp.qq.com&quot;</span></span><br><span class="line">mailPort = <span class="number">587</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Sender and reciever</span></span><br><span class="line">fromAddres = <span class="string">&quot;senderName@qq.com&quot;</span></span><br><span class="line">toAddres = <span class="string">&quot;recvName@qq.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create socket called clientSocket and establish a TCP connection with mailserver</span></span><br><span class="line"><span class="comment">#Fill in start</span></span><br><span class="line">clientSocket = socket(AF_INET, SOCK_STREAM) </span><br><span class="line">clientSocket.connect((mailServer, mailPort))</span><br><span class="line"><span class="comment">#Fill in end</span></span><br><span class="line">recv = clientSocket.recv(<span class="number">1024</span>).decode()</span><br><span class="line"><span class="built_in">print</span>(recv, end = <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> recv[:<span class="number">3</span>] != <span class="string">&#x27;220&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;220 reply not received from server.&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Send HELO command and print server response.</span></span><br><span class="line">heloCommand = <span class="string">&#x27;HELO Alice\r\n&#x27;</span>.encode()</span><br><span class="line">clientSocket.send(heloCommand)</span><br><span class="line">recv1 = clientSocket.recv(<span class="number">1024</span>).decode()</span><br><span class="line"><span class="built_in">print</span>(recv1, end = <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> recv1[:<span class="number">3</span>] != <span class="string">&#x27;250&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;250 reply not received from server.&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Auth information (Encode with base64)</span></span><br><span class="line">userName = base64.b64encode(fromAddres.encode()).decode()</span><br><span class="line">password = base64.b64encode(<span class="string">&quot;magicNumber&quot;</span>.encode()).decode()</span><br><span class="line"></span><br><span class="line">clientSocket.sendall(<span class="string">&#x27;AUTH LOGIN\r\n&#x27;</span>.encode())</span><br><span class="line">recv = clientSocket.recv(<span class="number">1024</span>).decode()</span><br><span class="line"><span class="built_in">print</span>(recv, end = <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> (recv[:<span class="number">3</span>] != <span class="string">&#x27;334&#x27;</span>):</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;334 reply not received from server&#x27;</span>)</span><br><span class="line"></span><br><span class="line">clientSocket.sendall((userName + <span class="string">&#x27;\r\n&#x27;</span>).encode())</span><br><span class="line">recv = clientSocket.recv(<span class="number">1024</span>).decode()</span><br><span class="line"><span class="built_in">print</span>(recv, end = <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> (recv[:<span class="number">3</span>] != <span class="string">&#x27;334&#x27;</span>):</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;334 reply not received from server&#x27;</span>)</span><br><span class="line"></span><br><span class="line">clientSocket.sendall((password + <span class="string">&#x27;\r\n&#x27;</span>).encode())</span><br><span class="line">recv = clientSocket.recv(<span class="number">1024</span>).decode()</span><br><span class="line"><span class="built_in">print</span>(recv, end = <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> (recv[:<span class="number">3</span>] != <span class="string">&#x27;235&#x27;</span>):</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;235 reply not received from server&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Send MAIL FROM command and print server response.</span></span><br><span class="line"><span class="comment"># Fill in start</span></span><br><span class="line">clientSocket.sendall((<span class="string">&quot;MAIL FROM: &lt;&quot;</span> + fromAddres + <span class="string">&quot;&gt;&quot;</span> + <span class="string">&#x27;\r\n&#x27;</span>).encode())</span><br><span class="line">recv = clientSocket.recv(<span class="number">1024</span>).decode()</span><br><span class="line"><span class="built_in">print</span>(recv, end = <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> (recv[:<span class="number">3</span>] != <span class="string">&#x27;250&#x27;</span>):</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;250 reply not received from server&#x27;</span>)</span><br><span class="line"><span class="comment"># Fill in end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Send RCPT TO command and print server response.</span></span><br><span class="line"><span class="comment"># Fill in start</span></span><br><span class="line">clientSocket.sendall((<span class="string">&quot;RCPT TO: &lt;&quot;</span> + toAddres + <span class="string">&quot;&gt;&quot;</span> + <span class="string">&#x27;\r\n&#x27;</span>).encode())</span><br><span class="line">recv = clientSocket.recv(<span class="number">1024</span>).decode()</span><br><span class="line"><span class="built_in">print</span>(recv, end = <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> (recv[:<span class="number">3</span>] != <span class="string">&#x27;250&#x27;</span>):</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;250 reply not received from server&#x27;</span>)</span><br><span class="line"><span class="comment"># Fill in end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Send DATA command and print server response.</span></span><br><span class="line"><span class="comment"># Fill in start</span></span><br><span class="line">clientSocket.sendall(<span class="string">&quot;DATA\r\n&quot;</span>.encode())</span><br><span class="line">recv = clientSocket.recv(<span class="number">1024</span>).decode()</span><br><span class="line"><span class="built_in">print</span>(recv, end = <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> (recv[:<span class="number">3</span>] != <span class="string">&#x27;354&#x27;</span>):</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;354 reply not received from server&#x27;</span>)</span><br><span class="line"><span class="comment"># Fill in end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Send message data.</span></span><br><span class="line"><span class="comment"># Fill in start</span></span><br><span class="line">clientSocket.sendall((msg).encode())</span><br><span class="line"><span class="comment"># Fill in end </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Message ends with a single period.</span></span><br><span class="line"><span class="comment"># Fill in start</span></span><br><span class="line">clientSocket.sendall(endmsg.encode())</span><br><span class="line">recv = clientSocket.recv(<span class="number">1024</span>).decode()</span><br><span class="line"><span class="built_in">print</span>(recv, end = <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> (recv[:<span class="number">3</span>] != <span class="string">&#x27;250&#x27;</span>):</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;250 reply not received from server&#x27;</span>)</span><br><span class="line"><span class="comment"># Fill in end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Send QUIT command and get server response.</span></span><br><span class="line"><span class="comment"># Fill in start</span></span><br><span class="line">clientSocket.sendall(<span class="string">&quot;QUIT\r\n&quot;</span>.encode())</span><br><span class="line">recv = clientSocket.recv(<span class="number">1024</span>).decode()</span><br><span class="line"><span class="built_in">print</span>(recv, end = <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> (recv[:<span class="number">3</span>] != <span class="string">&#x27;221&#x27;</span>):</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;221 reply not received from server&#x27;</span>)</span><br><span class="line"><span class="comment"># Fill in end</span></span><br><span class="line"></span><br><span class="line">clientSocket.close()</span><br></pre></td></tr></table></figure><h3 id="è¿è¡Œç»“æœ"><a href="#è¿è¡Œç»“æœ" class="headerlink" title="è¿è¡Œç»“æœ"></a>è¿è¡Œç»“æœ</h3><p>è¿è¡Œæ­£å¸¸çš„è¯ï¼Œä½ å°†ä¼šæ­£ç¡®æ”¶åˆ°æœåŠ¡å™¨è¿”å›çš„æ¯æ¡ä¿¡æ¯ï¼ŒæœŸä¸­åŒ…å«äº†çŠ¶æ€ç ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221122002248.png"></p><p><em><strong>å‘é€ç«¯é‚®ç®±ï¼š</strong></em><br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221122002521.png"></p><p><em><strong>æ¥æ”¶ç«¯é‚®ç®±ï¼š</strong></em><br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221122002739.png"></p>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œè‡ªé¡¶å‘ä¸‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SocketPA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Wireshark-DNS</title>
      <link href="/archives/a94cdcd7.html"/>
      <url>/archives/a94cdcd7.html</url>
      
        <content type="html"><![CDATA[<p><em><strong>å®˜æ–¹è‹±æ–‡èµ„æºç½‘ç«™</strong></em> ï¼š<a href="https://media.pearsoncmg.com/ph/esm/ecs_kurose_compnetwork_8/cw/"><em><strong>Pearson Computer Networking: a Top-Down Approach, 8th Edition</strong></em></a></p><p><em><strong>ç›´æ¥ä¸‹è½½</strong></em>ï¼š<a href="https://www-net.cs.umass.edu/wireshark-labs/"><em><strong>Wireshark Labs</strong></em></a></p><p>ç”±äºè‹±æ–‡åŸç‰ˆçš„ <em><strong>PDF</strong></em> çš„ç¿»è¯‘ä»»åŠ¡æœ‰ç‚¹å¤§ï¼Œæ‰€ä»¥è¿™é‡Œåªå±•ç¤ºéœ€è¦æäº¤çš„å†…å®¹ï¼Œè‡³äºç¿»è¯‘å…ˆæ”¾è¿› <em><strong>TODO</strong></em> é‡Œå§å‘œå‘œ</p><hr><h2 id="Wireshark-å®éªŒ-DNS-v7-0"><a href="#Wireshark-å®éªŒ-DNS-v7-0" class="headerlink" title="Wireshark å®éªŒ:  DNS v7.0"></a>Wireshark å®éªŒ:  DNS v7.0</h2><p><strong>ã€Šè®¡ç®—æœºç½‘ç»œï¼šè‡ªé¡¶å‘ä¸‹æ–¹æ³•ï¼ˆç¬¬7ç‰ˆï¼‰ã€‹è¡¥å……ææ–™ï¼ŒJ.F. Kurose and K.W. Ross</strong><br>â€œä¸é—»ä¸è‹¥é—»ä¹‹ï¼Œé—»ä¹‹ä¸è‹¥è§ä¹‹ï¼Œè§ä¹‹ä¸è‹¥çŸ¥ä¹‹ï¼ŒçŸ¥ä¹‹ä¸è‹¥è¡Œä¹‹ã€‚â€ â€”â€”ä¸­å›½è°šè¯­ </p><p>Â© 2005-2012, J.F Kurose and K.W. Ross, All Rights Reserved</p><h2 id="nslookup"><a href="#nslookup" class="headerlink" title="nslookup"></a>nslookup</h2><p><em><strong>Q1</strong></em> : è¿è¡Œ <em><strong>nslookup</strong></em> ä»¥è·å–ä¸€ä¸ªäºšæ´²çš„ <em><strong>Web</strong></em> æœåŠ¡å™¨çš„ <em><strong>IP</strong></em> åœ°å€ã€‚è¯¥æœåŠ¡å™¨çš„ <em><strong>IP</strong></em> åœ°å€æ˜¯ä»€ä¹ˆï¼Ÿ<br><em><strong>A</strong></em> : è¿™é‡Œæˆ‘æŸ¥è¯¢çš„æ˜¯å¦é—¨å¤§å­¦ï¼ˆ<code>www.xmu.edu.cn</code>ï¼‰ çš„ <em><strong>IP</strong></em> åœ°å€ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221111170006.png"><br>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºæˆ‘è¿™é‡Œç”¨çš„æœ¬åœ°çš„ <em><strong>DNS</strong></em> æ¥è·å–å¦é—¨å¤§å­¦çš„ <em><strong>IP</strong></em> åœ°å€ã€‚å¦é—¨å¤§å­¦åˆ†åˆ«æœ‰ <em><strong>IPV4</strong></em> åœ°å€ï¼ˆ<code>219.229.81.200</code>ï¼‰å’Œ <em><strong>IPV6</strong></em> åœ°å€ï¼ˆ<code>2001:da8:e800:251c::200</code>)ï¼Œä»¥åŠä¸‹é¢æ˜¯ä»–çš„åˆ«åï¼Œå› ä¸ºåˆ«åå¾€å¾€æ›´å¥½è®°ä½ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬éƒ½ä½¿ç”¨çš„æ˜¯ä»–çš„åˆ«åã€‚</p><p>è‡³äºä¸ºä»€ä¹ˆå«éæƒå¨åº”ç­”ï¼šå› ä¸ºæˆ‘ä½¿ç”¨çš„æœ¬åœ° <em><strong>DNS</strong></em> åœ¨æ²¡æœ‰ç¼“å­˜çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªèƒ½é€’å½’æˆ–è€…è¿­ä»£åœ°å‘ <em><strong>DNS</strong></em> æ ¹æœåŠ¡å™¨ã€<em><strong>TLD DNS</strong></em> æœåŠ¡å™¨ å’Œæƒå¨ <em><strong>DNS</strong></em> æœåŠ¡å™¨æŸ¥è¯¢å¹¶ä¸”è¿”å›ã€‚</p><p>ç”±äºæˆ‘ä»¬ä¸æ˜¯ç›´æ¥å‘æƒå¨ <em><strong>DNS</strong></em> æœåŠ¡å™¨æŸ¥è¯¢çš„ï¼Œä¸­é—´çš„æŸ¥è¯¢è·¯å¾„å¯èƒ½ä¼šæœ‰ç¼“å­˜ï¼Œå› æ­¤å«åšéæƒå¨åº”ç­”ã€‚</p><hr><p><em><strong>Q2</strong></em> : è¿è¡Œ <em><strong>nslookup</strong></em> æ¥ç¡®å®šä¸€ä¸ªæ¬§æ´²çš„å¤§å­¦çš„æƒå¨ <em><strong>DNS</strong></em> æœåŠ¡å™¨ã€‚<br><em><strong>A</strong></em> : é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ä½¿ç”¨ <code>-type=NS</code> é€‰é¡¹å…¶å®å°±æ˜¯åœ¨è¯´ â€œè¯·ç»™æˆ‘å‘é€ xxx çš„æƒå¨ <em><strong>DNS</strong></em> çš„ä¸»æœºåâ€ ï¼Œç†è§£è¿™ç‚¹å°±å¥½åŠäº†ã€‚æˆ‘è¿™é‡Œè¯·æ±‚æŸ¥è¯¢äº†ç‰›æ´¥å¤§å­¦çš„æƒå¨ <em><strong>DNS</strong></em> æœåŠ¡å™¨ï¼Œè¿”å›çš„ç»“æœå¦‚ä¸‹ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221111174111.png"></p><p>æ‰€æœ‰è¿™äº›éƒ½æ˜¯ç‰›æ´¥å¤§å­¦çš„æƒå¨ <em><strong>DNS</strong></em> æœåŠ¡å™¨ã€‚</p><hr><p><em><strong>Q3</strong></em> : è¿è¡Œ <em><strong>nslookup</strong></em>ï¼Œä½¿ç”¨é—®é¢˜2ä¸­ä¸€ä¸ªå·²è·å¾—çš„ <em><strong>DNS</strong></em> æœåŠ¡å™¨ï¼Œæ¥æŸ¥è¯¢ <em><strong>Yahoo!</strong></em> é‚®ç®±çš„é‚®ä»¶æœåŠ¡å™¨ã€‚å®ƒçš„ <em><strong>IP</strong></em> åœ°å€æ˜¯ä»€ä¹ˆï¼Ÿ<br><em><strong>A</strong></em> : ä½¿ç”¨ç‰›æ´¥å¤§å­¦çš„æƒå¨ <em><strong>DNS</strong></em> æœåŠ¡å™¨æ˜¯æŸ¥ä¸åˆ°çš„ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221111174611.png" alt="åŸå› æ˜¯è¯¥æƒå¨æœåŠ¡å™¨å¹¶æ²¡æœ‰ mail.yahoo.com åˆ° IP çš„æ˜ å°„"></p><p>ä½†æˆ‘ä»¬å¯ä»¥ç”¨é»˜è®¤çš„æœ¬åœ° <em><strong>DNS</strong></em> æœåŠ¡å™¨æŸ¥æ‰¾åˆ° <code>mail.yahoo.com</code> çš„ <em><strong>IP</strong></em> åœ°å€ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221111174917.png"></p><h2 id="ipconfig"><a href="#ipconfig" class="headerlink" title="ipconfig"></a>ipconfig</h2><p><em><strong>ipconfig</strong></em>ï¼ˆå¯¹äº <em><strong>Windows</strong></em> ï¼‰å’Œ <em><strong>ifconfig</strong></em>ï¼ˆå¯¹äº <em><strong>Linux &#x2F; Unix</strong></em>ï¼‰æ˜¯ä¸»æœºä¸­æœ€å®ç”¨çš„ç¨‹åºï¼Œå°¤å…¶æ˜¯ç”¨äºè°ƒè¯•ç½‘ç»œé—®é¢˜æ—¶ã€‚è¿™é‡Œæˆ‘ä»¬åªè®¨è®º <em><strong>ipconfig</strong></em>ï¼Œå°½ç®¡ <em><strong>Linux &#x2F; Unix</strong></em> çš„ <em><strong>ifconfig</strong></em> ä¸å…¶éå¸¸ç›¸ä¼¼ã€‚ <em><strong>ipconfig</strong></em> å¯ç”¨äºæ˜¾ç¤ºæ‚¨å½“å‰çš„ <em><strong>TCP&#x2F;IP</strong></em> ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ‚¨çš„åœ°å€ï¼Œ<em><strong>DNS</strong></em> æœåŠ¡å™¨åœ°å€ï¼Œé€‚é…å™¨ç±»å‹ç­‰ã€‚</p><p><em><strong>ipconfig</strong></em> å¯¹äºç®¡ç†ä¸»æœºä¸­å­˜å‚¨çš„ <em><strong>DNS</strong></em> ä¿¡æ¯ä¹Ÿéå¸¸æœ‰ç”¨ã€‚åœ¨ç¬¬2.5èŠ‚ä¸­ï¼Œæˆ‘ä»¬äº†è§£åˆ°ä¸»æœºå¯ä»¥ç¼“å­˜æœ€è¿‘è·å¾—çš„ <em><strong>DNS</strong></em> è®°å½•ã€‚è¦æŸ¥çœ‹è¿™äº›ç¼“å­˜è®°å½•ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢ä¸¤æ¡å‘½ä»¤ï¼š</p><ol><li><p><code>ipconfig /displaydns</code><br>æ˜¾ç¤ºæ¯ä¸ªæ¡ç›®å‰©ä½™çš„ç”Ÿå­˜æ—¶é—´</p></li><li><p><code>ipconfig /flushdns</code><br>æ¸…é™¤æ‰€æœ‰ <em><strong>DNS</strong></em> ç¼“å­˜å¹¶ä» <em><strong>hosts</strong></em> é‡æ–°åŠ è½½ç¼“å­˜è®°å½•</p></li></ol><h2 id="ä½¿ç”¨Wiresharkè¿½è¸ªDNS"><a href="#ä½¿ç”¨Wiresharkè¿½è¸ªDNS" class="headerlink" title="ä½¿ç”¨Wiresharkè¿½è¸ªDNS"></a>ä½¿ç”¨Wiresharkè¿½è¸ªDNS</h2><p><em><strong>Q4</strong></em> : æ‰¾åˆ° <em><strong>DNS</strong></em> æŸ¥è¯¢å’Œå“åº”æ¶ˆæ¯ã€‚å®ƒä»¬æ˜¯å¦é€šè¿‡ <em><strong>UDP</strong></em> æˆ– <em><strong>TCP</strong></em> å‘é€ï¼Ÿ<br><em><strong>A</strong></em> : é€šè¿‡ <em><strong>UDP</strong></em> å‘é€<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221112144958.png"></p><hr><p><em><strong>Q5</strong></em> : <em><strong>DNS</strong></em> æŸ¥è¯¢æ¶ˆæ¯çš„ç›®æ ‡ç«¯å£æ˜¯ä»€ä¹ˆï¼Ÿ<em><strong>DNS</strong></em> å“åº”æ¶ˆæ¯çš„æºç«¯å£æ˜¯ä»€ä¹ˆï¼Ÿ<br><em><strong>A</strong></em> : ç›®æ ‡ç«¯å£å’Œæºç«¯å£éƒ½æ˜¯ <em><strong>53</strong></em><br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221112145503.png"></p><hr><p><em><strong>Q6</strong></em> : <em><strong>DNS</strong></em> æŸ¥è¯¢æ¶ˆæ¯å‘é€åˆ°å“ªä¸ª <em><strong>IP</strong></em> åœ°å€ï¼Ÿä½¿ç”¨ <em><strong>ipconfig</strong></em> æ¥ç¡®å®šæœ¬åœ° <em><strong>DNS</strong></em> æœåŠ¡å™¨çš„ <em><strong>IP</strong></em> åœ°å€ã€‚è¿™ä¸¤ä¸ª <em><strong>IP</strong></em> åœ°å€æ˜¯å¦ç›¸åŒï¼Ÿ<br><em><strong>A</strong></em> : æŸ¥è¯¢æ¶ˆæ¯å‘åˆ°äº† <code>192.168.31.1</code> è¿™ä¸ª <em><strong>IP</strong></em> åœ°å€ä¸Šã€‚<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221112150057.png"><br>ç”¨ <em><strong>ipconfig</strong></em> æŸ¥åˆ°çš„æœ¬åœ° <em><strong>DNS</strong></em> æœåŠ¡å™¨çš„ <em><strong>IP</strong></em> åœ°å€ä¸ºï¼š<code>192.168.31.1</code>ï¼Œæ˜¯åŒä¸€ä¸ªåœ°å€ã€‚<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221112150340.png"></p><hr><p><em><strong>Q7</strong></em> : æ£€æŸ¥ <em><strong>DNS</strong></em> æŸ¥è¯¢æ¶ˆæ¯ã€‚<em><strong>DNS</strong></em> æŸ¥è¯¢æ˜¯ä»€ä¹ˆâ€ <em><strong>Type</strong></em> â€œçš„ï¼ŸæŸ¥è¯¢æ¶ˆæ¯æ˜¯å¦åŒ…å«ä»»ä½•â€ <em><strong>answers</strong></em> â€œï¼Ÿ<br><em><strong>A</strong></em> : <em><strong>Type</strong></em> ä¸º <em><strong>A</strong></em>ï¼Œä¸åŒ…å«ä»»ä½• <em><strong>answers</strong></em> ä¿¡æ¯ã€‚<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221112150743.png"></p><hr><p><em><strong>Q8</strong></em> : æ£€æŸ¥ <em><strong>DNS</strong></em> å“åº”æ¶ˆæ¯ã€‚æä¾›äº†å¤šå°‘ä¸ªâ€ <em><strong>answers</strong></em> â€œï¼Ÿè¿™äº›ç­”æ¡ˆå…·ä½“åŒ…å«ä»€ä¹ˆï¼Ÿ<br><em><strong>A</strong></em> : æä¾›äº†ä¸‰ä¸ª <em><strong>answers</strong></em>ï¼Œåˆ†åˆ«æ˜¯ç”±å›½å¤– <em><strong>CDN</strong></em> å‚å•† <em><strong>Cloudflare</strong></em> æä¾›çš„è§„èŒƒ <em><strong>CNAME</strong></em> çš„ <em><strong>CDN</strong></em> åŠ é€Ÿï¼ˆ<em><strong>type&#x3D;CNAME</strong></em>ï¼‰åœ°å€ï¼Œä»¥åŠè§„èŒƒå <em><strong>CNAME</strong></em> çš„ä¸¤ä¸ª <em><strong>IPV4</strong></em> åœ°å€ï¼ˆ<em><strong>type&#x3D;A</strong></em>ï¼‰ã€‚<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221112155343.png"></p><hr><p><em><strong>Q9</strong></em> : è€ƒè™‘ä»æ‚¨ä¸»æœºå‘é€çš„åç»­ <em><strong>TCP SYN</strong></em> æ•°æ®åŒ…ã€‚<em><strong>SYN</strong></em> æ•°æ®åŒ…çš„ç›®çš„ <em><strong>IP</strong></em> åœ°å€æ˜¯å¦ä¸ <em><strong>DNS</strong></em> å“åº”æ¶ˆæ¯ä¸­æä¾›çš„ä»»ä½• <em><strong>IP</strong></em> åœ°å€ç›¸å¯¹åº”ï¼Ÿ<br><em><strong>A</strong></em> : æ˜¯å¯¹åº”çš„<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221112160514.png"></p><hr><p><em><strong>Q10</strong></em> : è¿™ä¸ªç½‘é¡µåŒ…å«ä¸€äº›å›¾ç‰‡ã€‚åœ¨è·å–æ¯ä¸ªå›¾ç‰‡å‰ï¼Œæ‚¨çš„ä¸»æœºæ˜¯å¦éƒ½å‘å‡ºäº†æ–°çš„DNSæŸ¥è¯¢ï¼Ÿç°åœ¨è®©æˆ‘ä»¬ç©ç© <em><strong>nslookup</strong></em>ã€‚</p><ul><li>å¯åŠ¨æ•°æ®åŒ…æ•è·</li><li>ä½¿ç”¨ <em><strong>nslookup</strong></em> æŸ¥è¯¢ <code>www.mit.edu</code></li><li>åœæ­¢æ•°æ®åŒ…æ•è·</li></ul><p><em><strong>A</strong></em> : ä»å›¾å¯ä»¥çœ‹å‡ºæˆ‘ä»¬å‘å‡ºäº†ä¸‰ä¸ª <em><strong>DNS</strong></em> æŸ¥è¯¢ï¼Œä½†åªæœ‰åä¸¤ä¸ªæ˜¯æ–°çš„ <em><strong>DNS</strong></em> æŸ¥è¯¢ï¼Œç¬¬ä¸€ä¸ªå› ä¸ºå·²ç»æœ‰ç¼“å­˜äº†æ‰€ä»¥ç›´æ¥ä½¿ç”¨çš„æ˜¯æœ¬åœ° <em><strong>DNS</strong></em> æœåŠ¡å™¨ä¸­çš„åœ°å€ã€‚<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221112161621.png"></p><hr><p><em><strong>Q11</strong></em> : <em><strong>DNS</strong></em> æŸ¥è¯¢æ¶ˆæ¯çš„ç›®æ ‡ç«¯å£æ˜¯ä»€ä¹ˆï¼Ÿ <em><strong>DNS</strong></em> å“åº”æ¶ˆæ¯çš„æºç«¯å£æ˜¯ä»€ä¹ˆï¼Ÿ<br><em><strong>A</strong></em> : ç›®æ ‡ç«¯å£å’Œæºç«¯å£è¿˜æ˜¯53ã€‚<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221112162120.png"></p><hr><p><em><strong>Q12</strong></em> : <em><strong>DNS</strong></em> æŸ¥è¯¢æ¶ˆæ¯çš„ç›®æ ‡ <em><strong>IP</strong></em> åœ°å€æ˜¯ä»€ä¹ˆï¼Ÿè¿™æ˜¯ä½ çš„é»˜è®¤æœ¬åœ° <em><strong>DNS</strong></em> æœåŠ¡å™¨çš„ <em><strong>IP</strong></em> åœ°å€å—ï¼Ÿ<br><em><strong>A</strong></em> : è·Ÿä¸Šé¢ä¸€æ ·ï¼Œéƒ½æ˜¯ <code>192.168.31.1</code></p><hr><p><em><strong>Q13</strong></em> : æ£€æŸ¥ <em><strong>DNS</strong></em> æŸ¥è¯¢æ¶ˆæ¯ã€‚<em><strong>DNS</strong></em> æŸ¥è¯¢æ˜¯ä»€ä¹ˆâ€<em><strong>Type</strong></em>â€œçš„ï¼ŸæŸ¥è¯¢æ¶ˆæ¯æ˜¯å¦åŒ…å«ä»»ä½•â€<em><strong>answers</strong></em>â€œï¼Ÿ<br><em><strong>A</strong></em> : <em><strong>TYPE&#x3D;A</strong></em>ï¼ˆè¯·æ±‚ <em><strong>IPV4</strong></em> åœ°å€æŸ¥è¯¢ï¼‰ï¼Œ<em><strong>TYPE&#x3D;AAAA</strong></em>(è¯·æ±‚ <em><strong>IPV6</strong></em> åœ°å€æŸ¥è¯¢)ï¼ŒæŸ¥è¯¢æ¶ˆæ¯ä¸åŒ…æ‹¬ä»»ä½•ç­”æ¡ˆã€‚<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221112162646.png"></p><hr><p><em><strong>Q14</strong></em> : æ£€æŸ¥ <em><strong>DNS</strong></em> å“åº”æ¶ˆæ¯ã€‚æä¾›äº†å¤šå°‘ä¸ªâ€<em><strong>answers</strong></em>â€œï¼Ÿè¿™äº›ç­”æ¡ˆåŒ…å«ä»€ä¹ˆï¼Ÿ<br><em><strong>A</strong></em> : åŒæ ·åŒ…æ‹¬è§„èŒƒä¸»æœºåœ°å€ï¼ˆ <em><strong>type&#x3D;CNAME</strong></em> ï¼‰ï¼Œè§„èŒƒä¸»æœºåœ°å€æŒ‡å‘ <em><strong>IPV4</strong></em> ï¼ˆ<em><strong>type&#x3D;A</strong></em>ï¼‰å’Œ <em><strong>IPV6</strong></em>ï¼ˆ<em><strong>type&#x3D;AAAA</strong></em>ï¼‰åœ°å€ã€‚<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221112162930.png"></p><hr><p><em><strong>Q15</strong></em> : æä¾›å±å¹•æˆªå›¾<br><em><strong>A</strong></em> : æˆªå›¾åœ¨æ¯ä¸€ä¸ªé¢˜ä¸­</p><hr><p>ç°åœ¨é‡å¤ä¸Šä¸€ä¸ªå®éªŒï¼Œä½†æ¢æˆä»¥ä¸‹å‘½ä»¤ï¼š<br><code>nslookup -type=NS mit.edu</code></p><p><em><strong>Q16</strong></em> : <em><strong>DNS</strong></em> æŸ¥è¯¢æ¶ˆæ¯çš„ç›®æ ‡ <em><strong>IP</strong></em> åœ°å€æ˜¯ä»€ä¹ˆï¼Ÿè¿™æ˜¯ä½ çš„é»˜è®¤æœ¬åœ° <em><strong>DNS</strong></em> æœåŠ¡å™¨çš„ <em><strong>IP</strong></em> åœ°å€å—ï¼Ÿ<br><em><strong>A</strong></em> : æ˜¯çš„</p><hr><p><em><strong>Q17</strong></em> : æ£€æŸ¥ <em><strong>DNS</strong></em> æŸ¥è¯¢æ¶ˆæ¯ã€‚<em><strong>DNS</strong></em> æŸ¥è¯¢æ˜¯ä»€ä¹ˆâ€<em><strong>Type</strong></em>â€œçš„ï¼ŸæŸ¥è¯¢æ¶ˆæ¯æ˜¯å¦åŒ…å«ä»»ä½•â€<em><strong>answers</strong></em>â€œï¼Ÿ<br><em><strong>A</strong></em> : æœ‰ä¸€ä¸ª <em><strong>TYPE&#x3D;PTR</strong></em>ï¼ˆé€šè¿‡ <em><strong>IP</strong></em> åå‘æŸ¥åŸŸåï¼‰å’Œä¸€ä¸ª <em><strong>TYPE&#x3D;NS</strong></em>ï¼ˆæŸ¥è¯¢æƒå¨ <em><strong>DNS</strong></em>ï¼‰è¯·æ±‚ï¼ŒæŸ¥è¯¢æ¶ˆæ¯å‡ä¸åŒ…å«ä»»ä½•ç»“æœ, <em><strong>PTR</strong></em> åº”è¯¥æ˜¯é€šè¿‡ <em><strong>IP</strong></em> æŸ¥è¯¢åˆ°æˆ‘æœ¬åœ°çš„ <em><strong>DNS</strong></em> çš„åŸŸåã€‚<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221112163653.png" alt="TYPE=PTR"></p><p><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221112163800.png" alt="TYPE=NS"></p><p><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221112163917.png" alt="é€šè¿‡ TYPE=PTR æŸ¥è¯¢åŸŸå"></p><hr><p><em><strong>Q18</strong></em> : æ£€æŸ¥ <em><strong>DNS</strong></em> å“åº”æ¶ˆæ¯ã€‚å“åº”æ¶ˆæ¯æä¾›çš„ <em><strong>MIT</strong></em> åŸŸåæœåŠ¡å™¨æ˜¯ä»€ä¹ˆï¼Ÿæ­¤å“åº”æ¶ˆæ¯è¿˜æä¾›äº† <em><strong>MIT</strong></em> åŸŸåæœåŠ¡å™¨çš„ <em><strong>IP</strong></em> åœ°å€å—ï¼Ÿ<br><em><strong>A</strong></em> : æä¾›äº† <em><strong>MIT</strong></em> çš„æƒå¨ <em><strong>DNS</strong></em> çš„åŸŸåï¼Œä½†æ²¡æœ‰æä¾› <em><strong>MIT</strong></em> çš„åŸŸåçš„ <em><strong>IP</strong></em> åœ°å€ã€‚ä½†ä¸€ä¸ªæœ‰è¶£çš„äº‹å®æ˜¯ <em><strong>nslookup</strong></em> æä¾›äº† <em><strong>IP</strong></em> åœ°å€ã€‚<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221112164323.png" alt="DNS åŒ…"></p><p><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221112164351.png" alt="nslookup"></p><hr><p><em><strong>Q19</strong></em> : æä¾›å±å¹•æˆªå›¾<br><em><strong>A</strong></em> : æˆªå›¾åœ¨æ¯ä¸€ä¸ªé¢˜ä¸­</p><hr><p>ç°åœ¨é‡å¤ä¸Šä¸€ä¸ªå®éªŒï¼Œä½†æ¢æˆä»¥ä¸‹å‘½ä»¤ï¼š<br><code>nslookup www.aiit.or.kr bitsy.mit.edu</code></p><p><em><strong>Q20</strong></em> : <em><strong>DNS</strong></em> æŸ¥è¯¢æ¶ˆæ¯å‘é€åˆ°çš„ <em><strong>IP</strong></em> åœ°å€æ˜¯ä»€ä¹ˆï¼Ÿè¿™æ˜¯æ‚¨çš„é»˜è®¤æœ¬åœ° <em><strong>DNS</strong></em> æœåŠ¡å™¨çš„ <em><strong>IP</strong></em> åœ°å€å—ï¼Ÿå¦‚æœä¸æ˜¯ï¼Œè¿™ä¸ª <em><strong>IP</strong></em> åœ°å€æ˜¯ä»€ä¹ˆï¼Ÿ<br><em><strong>A</strong></em> : ä¸æ˜¯ï¼Œè¯¥ <em><strong>IP</strong></em> åœ°å€æ˜¯ï¼š<code>18.0.72.3</code><br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221112165100.png"></p><hr><p><em><strong>Q21</strong></em> : æ£€æŸ¥ <em><strong>DNS</strong></em> æŸ¥è¯¢æ¶ˆæ¯ã€‚<em><strong>DNS</strong></em> æŸ¥è¯¢æ˜¯ä»€ä¹ˆâ€ <em><strong>Type</strong></em> â€œçš„ï¼ŸæŸ¥è¯¢æ¶ˆæ¯æ˜¯å¦åŒ…å«ä»»ä½•â€ <em><strong>answers</strong></em> â€œï¼Ÿ<br><em><strong>A</strong></em> : è·Ÿä¸Šä¸€ä¸ªå®éªŒä¸€è‡´</p><hr><p><em><strong>Q22</strong></em> : æ£€æŸ¥ <em><strong>DNS</strong></em> å“åº”æ¶ˆæ¯ã€‚æä¾›äº†å¤šå°‘ä¸ªâ€ <em><strong>answers</strong></em> â€œï¼Ÿè¿™äº›ç­”æ¡ˆåŒ…å«ä»€ä¹ˆï¼Ÿ<br><em><strong>A</strong></em> : ç”±äºæˆ‘è¿™è¾¹æŸ¥è¯¢çš„æ—¶å€™ <em><strong>DNS</strong></em> è¶…æ—¶ï¼Œæ•…æ²¡æœ‰ <em><strong>DNS</strong></em> å“åº”æ¶ˆæ¯ã€‚</p><hr><p><em><strong>Q23</strong></em> : æä¾›å±å¹•æˆªå›¾<br><em><strong>A</strong></em> : æˆªå›¾åœ¨æ¯ä¸€ä¸ªé¢˜ä¸­</p>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œè‡ªé¡¶å‘ä¸‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Wireshark </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Wireshark-HTTP</title>
      <link href="/archives/b551ba0b.html"/>
      <url>/archives/b551ba0b.html</url>
      
        <content type="html"><![CDATA[<p><em><strong>å®˜æ–¹è‹±æ–‡èµ„æºç½‘ç«™</strong></em> ï¼š<a href="https://media.pearsoncmg.com/ph/esm/ecs_kurose_compnetwork_8/cw/"><em><strong>Pearson Computer Networking: a Top-Down Approach, 8th Edition</strong></em></a></p><p><em><strong>ç›´æ¥ä¸‹è½½</strong></em>ï¼š<a href="https://www-net.cs.umass.edu/wireshark-labs/"><em><strong>Wireshark Labs</strong></em></a></p><p>ç”±äºè‹±æ–‡åŸç‰ˆçš„ <em><strong>PDF</strong></em> çš„ç¿»è¯‘ä»»åŠ¡æœ‰ç‚¹å¤§ï¼Œæ‰€ä»¥è¿™é‡Œåªå±•ç¤ºéœ€è¦æäº¤çš„å†…å®¹ï¼Œè‡³äºç¿»è¯‘å…ˆæ”¾è¿› <em><strong>TODO</strong></em> é‡Œå§å‘œå‘œ</p><hr><h2 id="Wireshark-å®éªŒ-HTTP-v7-0"><a href="#Wireshark-å®éªŒ-HTTP-v7-0" class="headerlink" title="Wireshark å®éªŒ:  HTTP v7.0"></a>Wireshark å®éªŒ:  HTTP v7.0</h2><p><strong>ã€Šè®¡ç®—æœºç½‘ç»œï¼šè‡ªé¡¶å‘ä¸‹æ–¹æ³•ï¼ˆç¬¬7ç‰ˆï¼‰ã€‹è¡¥å……ææ–™ï¼ŒJ.F. Kurose and K.W. Ross</strong><br>â€œä¸é—»ä¸è‹¥é—»ä¹‹ï¼Œé—»ä¹‹ä¸è‹¥è§ä¹‹ï¼Œè§ä¹‹ä¸è‹¥çŸ¥ä¹‹ï¼ŒçŸ¥ä¹‹ä¸è‹¥è¡Œä¹‹ã€‚â€ â€”â€”ä¸­å›½è°šè¯­ </p><p>Â© 2005-2012, J.F Kurose and K.W. Ross, All Rights Reserved</p><h2 id="åŸºæœ¬HTTP-GET-x2F-responseäº¤äº’"><a href="#åŸºæœ¬HTTP-GET-x2F-responseäº¤äº’" class="headerlink" title="åŸºæœ¬HTTP GET&#x2F;responseäº¤äº’"></a>åŸºæœ¬HTTP GET&#x2F;responseäº¤äº’</h2><p><em><strong>Q1</strong></em> : æ‚¨çš„æµè§ˆå™¨æ˜¯å¦è¿è¡Œ <em><strong>HTTP</strong></em> ç‰ˆæœ¬ <em><strong>1.0</strong></em> æˆ– <em><strong>1.1</strong></em> ï¼ŸæœåŠ¡å™¨è¿è¡Œä»€ä¹ˆç‰ˆæœ¬çš„ <em><strong>HTTP</strong></em> ï¼Ÿ<br><em><strong>A</strong></em> : æµè§ˆå™¨è¿è¡Œçš„æ˜¯ <em><strong>1.1</strong></em>ï¼ŒæœåŠ¡å™¨è¿è¡Œçš„ä¹Ÿæ˜¯ <em><strong>1.1</strong></em>ã€‚<br>ä» <em><strong>GET</strong></em> è¯·æ±‚æŠ¥æ–‡å¯ä»¥æŸ¥çœ‹æµè§ˆå™¨ç‰ˆæœ¬ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221105163402.png"><br>ä»å“åº”æŠ¥æ–‡å¯ä»¥æŸ¥çœ‹æµè§ˆå™¨ç‰ˆæœ¬ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221105163036.png"></p><hr><p><em><strong>Q2</strong></em> : æ‚¨çš„æµè§ˆå™¨ä¼šä»æ¥æœåŠ¡å™¨æ¥å—å“ªç§è¯­è¨€ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Ÿ<br><em><strong>A</strong></em> : èƒ½æ¥æ”¶åˆ°ç®€ä½“ä¸­æ–‡å’Œè‹±æ–‡ã€‚<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221105163256.png"></p><hr><p><em><strong>Q3</strong></em> : æ‚¨çš„è®¡ç®—æœºçš„ <em><strong>IP</strong></em> åœ°å€æ˜¯ä»€ä¹ˆï¼Ÿ <em><strong>gaia.cs.umass.edu</strong></em> æœåŠ¡å™¨åœ°å€å‘¢ï¼Ÿ<br><em><strong>A</strong></em> : ç”±ä¸Šå›¾å¯çŸ¥ï¼Œæˆ‘çš„è®¡ç®—æœºçš„ <em><strong>IP</strong></em> åœ°å€æ˜¯ï¼š<code>192.168.43.92</code>; æœåŠ¡å™¨çš„ <em><strong>IP</strong></em> åœ°å€æ˜¯ï¼š<code>128.119.245.12</code></p><hr><p><em><strong>Q4</strong></em> : æœåŠ¡å™¨è¿”å›åˆ°æµè§ˆå™¨çš„çŠ¶æ€ä»£ç æ˜¯ä»€ä¹ˆï¼Ÿ<br><em><strong>A</strong></em> : ç”±ä¸Šå›¾å¯çŸ¥ï¼ŒçŠ¶æ€ç æ˜¯ <code>304</code> ã€‚</p><hr><p><em><strong>Q5</strong></em> : æœåŠ¡å™¨ä¸ŠHTMLæ–‡ä»¶çš„æœ€è¿‘ä¸€æ¬¡ä¿®æ”¹æ˜¯ä»€ä¹ˆæ—¶å€™ï¼Ÿ<br><em><strong>A</strong></em> : ç”±äºè¿”å›çš„æ˜¯ <code>304</code> çŠ¶æ€ç ï¼Œæ•…æŸ¥çœ‹ä¸åˆ°ä¸Šä¸€æ¬¡ä¿®æ”¹çš„æ—¶é—´ã€‚</p><hr><p><em><strong>Q6</strong></em> : æœåŠ¡å™¨è¿”å›å¤šå°‘å­—èŠ‚çš„å†…å®¹åˆ°æ‚¨çš„æµè§ˆå™¨ï¼Ÿ<br><em><strong>A</strong></em> : 293 å­—èŠ‚<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221105164732.png"></p><hr><p><em><strong>Q7</strong></em> : é€šè¿‡æ£€æŸ¥æ•°æ®åŒ…å†…å®¹çª—å£ä¸­çš„åŸå§‹æ•°æ®ï¼Œä½ æ˜¯å¦çœ‹åˆ°æœ‰åè®®å¤´åœ¨æ•°æ®åŒ…åˆ—è¡¨çª—å£ä¸­æœªæ˜¾ç¤ºï¼Ÿ å¦‚æœæ˜¯ï¼Œè¯·ä¸¾ä¸€ä¸ªä¾‹å­ã€‚<br><em><strong>A</strong></em> : æ²¡æœ‰ï¼Œä»…æœ‰è¿™ä¸¤æ¡ <em><strong>HTTP</strong></em> æŠ¥æ–‡ã€‚</p><h2 id="HTTPæ¡ä»¶Get-x2F-responseäº¤äº’"><a href="#HTTPæ¡ä»¶Get-x2F-responseäº¤äº’" class="headerlink" title="HTTPæ¡ä»¶Get&#x2F;responseäº¤äº’"></a>HTTPæ¡ä»¶Get&#x2F;responseäº¤äº’</h2><p><em><strong>Q8</strong></em> : æ£€æŸ¥ç¬¬ä¸€ä¸ªä»æ‚¨æµè§ˆå™¨åˆ°æœåŠ¡å™¨çš„ <em><strong>HTTP GET</strong></em> è¯·æ±‚çš„å†…å®¹ã€‚æ‚¨åœ¨ <em><strong>HTTP GET</strong></em>ä¸­çœ‹åˆ°äº† <em><strong>â€œIF-MODIFIED-SINCEâ€</strong></em> è¡Œå—ï¼Ÿ<br><em><strong>A</strong></em> : å¦‚ä¸‹å›¾ï¼Œæ²¡æœ‰çœ‹åˆ°ã€‚<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221105170136.png"></p><hr><p><em><strong>Q9</strong></em> : æ£€æŸ¥æœåŠ¡å™¨å“åº”çš„å†…å®¹ã€‚æœåŠ¡å™¨æ˜¯å¦æ˜¾å¼è¿”å›æ–‡ä»¶çš„å†…å®¹ï¼Ÿ ä½ æ˜¯æ€ä¹ˆçŸ¥é“çš„ï¼Ÿ<br><em><strong>A</strong></em> : æœ‰ã€‚ç›´æ¥çœ‹å“åº”æŠ¥æ–‡çš„ <em><strong>entity body</strong></em> å³å¯ã€‚<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221105170801.png"></p><hr><p><em><strong>Q10</strong></em> : ç°åœ¨ï¼Œæ£€æŸ¥ç¬¬äºŒä¸ª <em><strong>HTTP GET</strong></em> è¯·æ±‚çš„å†…å®¹ã€‚ æ‚¨åœ¨ <em><strong>HTTP GET</strong></em> ä¸­çœ‹åˆ°äº† <em><strong>â€œIF-MODIFIED-SINCE:â€</strong></em> è¡Œå—ï¼Ÿ å¦‚æœæ˜¯ï¼Œ <em><strong>â€œIF-MODIFIED-SINCE:â€</strong></em> å¤´åé¢åŒ…å«å“ªäº›ä¿¡æ¯ï¼Ÿ<br><em><strong>A</strong></em> : çœ‹åˆ°äº†ã€‚åé¢çš„å€¼åˆšå¥½å°±æ˜¯ä¸Šæ¬¡å¾—åˆ°çš„æœåŠ¡å™¨æœ€åä¿®æ”¹è¿™ä¸ªæ–‡ä»¶çš„æ—¶é—´ã€‚<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221105171625.png"></p><hr><p><em><strong>Q11</strong></em> : é’ˆå¯¹ç¬¬äºŒä¸ª <em><strong>HTTP GET</strong></em> ï¼Œä»æœåŠ¡å™¨å“åº”çš„ <em><strong>HTTP</strong></em> çŠ¶æ€ç å’ŒçŸ­è¯­æ˜¯ä»€ä¹ˆï¼ŸæœåŠ¡å™¨æ˜¯å¦æ˜ç¡®åœ°è¿”å›æ–‡ä»¶çš„å†…å®¹ï¼Ÿè¯·è§£é‡Šã€‚<br><em><strong>A</strong></em> : çŠ¶æ€ç æ˜¯<code>304</code>ï¼ŒçŸ­è¯­æ˜¯ <code>Not Modified</code>ã€‚æœåŠ¡å™¨å¹¶ä¸ä¼šæ˜ç¡®åœ°è¿”å›æ–‡ä»¶çš„å†…å®¹ï¼Œå¦‚ä¸‹å›¾å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¹¶æ²¡æœ‰å…·ä½“çš„ <em><strong>entity body</strong></em> ã€‚<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221105172144.png"></p><p>å› ä¸ºæœåŠ¡å™¨è¿”å› <code>304</code> çŠ¶æ€ç è¯´æ˜æˆ‘ä»¬è¯·æ±‚çš„æ–‡ä»¶å¹¶æ²¡æœ‰è¢«ä¿®æ”¹ï¼Œæ‰€ä»¥æœåŠ¡å™¨ä¼šè®©æˆ‘ä»¬å»ç¼“å­˜ä¸­å–å¾—è¯¥æ–‡ä»¶ï¼Œå› æ­¤æœåŠ¡å™¨å¹¶ä¸ä¼šæ˜ç¡®åœ°è¿”å›æ–‡ä»¶çš„å†…å®¹ã€‚è‡³äºæœåŠ¡å™¨å¦‚ä½•åˆ¤æ–­ç¼“å­˜ä¸­çš„æ–‡ä»¶å’ŒæœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶æ˜¯å¦æœ‰å·®å¼‚ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬åœ¨ç¬¬äºŒæ¬¡ <em><strong>HTTP GET</strong></em> è¯·æ±‚ä¸­å«æœ‰ä¸Šæ¬¡å¾—åˆ°çš„æœåŠ¡å™¨æœ€åä¿®æ”¹è¿™ä¸ªæ–‡ä»¶çš„æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯ <em><strong>â€œIF-MODIFIED-SINCE:â€</strong></em> ã€‚æœåŠ¡å™¨é€šè¿‡æ¯”è¾ƒè¿™ä¸¤ä¸ªæ—¶é—´æ¥åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å·²ç»åŒæ­¥ï¼Œä»è€Œé¿å…äº†ä¸å¿…è¦çš„æ–‡ä»¶ä¼ è¾“ã€‚</p><h2 id="æ£€ç´¢é•¿æ–‡ä»¶"><a href="#æ£€ç´¢é•¿æ–‡ä»¶" class="headerlink" title="æ£€ç´¢é•¿æ–‡ä»¶"></a>æ£€ç´¢é•¿æ–‡ä»¶</h2><p><em><strong>Q12</strong></em> : æ‚¨çš„æµè§ˆå™¨å‘é€å¤šå°‘ <em><strong>HTTP GET</strong></em> è¯·æ±‚æ¶ˆæ¯ï¼Ÿå“ªä¸ªæ•°æ®åŒ…åŒ…å«äº†ç¾å›½æƒåˆ©æ³•æ¡ˆçš„æ¶ˆæ¯ï¼Ÿ<br><em><strong>A</strong></em> : æˆ‘çš„æµè§ˆå™¨å‘é€äº†ä¸€ä¸ª <em><strong>HTTP GET</strong></em> æŠ¥æ–‡ï¼Œå…¶ä¸­ 1919 å·æ•°æ®åŒ…åŒ…å«äº†ç¾å›½æƒåˆ©æ³•æ¡ˆçš„æ¶ˆæ¯ã€‚<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221105174648.png"></p><hr><p><em><strong>Q13</strong></em> : å“ªä¸ªæ•°æ®åŒ…åŒ…å«å“åº”HTTP GETè¯·æ±‚çš„çŠ¶æ€ç å’ŒçŸ­è¯­ï¼Ÿ<br><em><strong>A</strong></em> : ç”±ä¸Šå›¾å¯çŸ¥ï¼ŒåŒæ ·æ˜¯ç”± 1919 å·æ•°æ®åŒ…åŒ…å«äº†å“åº”çš„çŠ¶æ€ç ï¼š <code>200</code>ï¼ŒçŸ­è¯­ä¸ºï¼š<code>OK</code> ã€‚</p><hr><p><em><strong>Q14</strong></em> : å“åº”ä¸­çš„çŠ¶æ€ç å’ŒçŸ­è¯­æ˜¯ä»€ä¹ˆï¼Ÿ<br><em><strong>A</strong></em> : åŒä¸Šé¢˜ã€‚</p><hr><p><em><strong>Q15</strong></em> : éœ€è¦å¤šå°‘åŒ…å«æ•°æ®çš„ <em><strong>TCP</strong></em> æ®µæ¥æ‰§è¡Œå•ä¸ª <em><strong>HTTP</strong></em> å“åº”å’Œæƒåˆ©æ³•æ¡ˆæ–‡æœ¬ï¼Ÿ<br><em><strong>A</strong></em> : éœ€è¦4ä¸ªã€‚<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221105175513.png"></p><h2 id="å…·æœ‰åµŒå…¥å¯¹è±¡çš„HTMLæ–‡æ¡£"><a href="#å…·æœ‰åµŒå…¥å¯¹è±¡çš„HTMLæ–‡æ¡£" class="headerlink" title="å…·æœ‰åµŒå…¥å¯¹è±¡çš„HTMLæ–‡æ¡£"></a>å…·æœ‰åµŒå…¥å¯¹è±¡çš„HTMLæ–‡æ¡£</h2><p><em><strong>Q16</strong></em> : æ‚¨çš„æµè§ˆå™¨å‘é€äº†å‡ ä¸ª <em><strong>HTTP GET</strong></em> è¯·æ±‚æ¶ˆæ¯ï¼Ÿ è¿™äº› <em><strong>GET</strong></em> è¯·æ±‚å‘é€åˆ°å“ªä¸ªIPåœ°å€ï¼Ÿ<br><em><strong>A</strong></em> : å‘é€äº†ä¸‰ä¸ªï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªè¯·æ±‚çš„ <em><strong>IP</strong></em> åœ°å€ï¼š<code>128.119.245.12</code> å’Œ <code>178.79.137.164</code> ã€‚<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221105180145.png"></p><hr><p><em><strong>Q17</strong></em> : æµè§ˆå™¨ä»ä¸¤ä¸ªç½‘ç«™ä¸²è¡Œè¿˜æ˜¯å¹¶è¡Œä¸‹è½½äº†ä¸¤å¼ å›¾ç‰‡ï¼Ÿè¯·è¯´æ˜ã€‚<br><em><strong>A</strong></em> : è§‚å¯Ÿä¸Šå›¾åä¸¤ä¸ª <em><strong>HTTP GET</strong></em> è¯·æ±‚æ¶ˆæ¯çš„å‘å‡ºæ—¶é—´å¯ä»¥å‘ç°ï¼Œè¿™ä¸¤ä¸ªæŠ¥æ–‡çš„æ—¶é—´å¹¶æ²¡æœ‰é‡å ï¼Œè€Œæ˜¯æœ‰å…ˆåçš„ï¼Œå› æ­¤å¯ä»¥åˆ¤æ–­å¹¶éæ˜¯å¹¶è¡Œä¸‹è½½ã€‚</p><h2 id="HTTPè®¤è¯"><a href="#HTTPè®¤è¯" class="headerlink" title="HTTPè®¤è¯"></a>HTTPè®¤è¯</h2><p><em><strong>Q18</strong></em> : å¯¹äºæ‚¨çš„æµè§ˆå™¨çš„åˆå§‹ <em><strong>HTTP GET</strong></em> æ¶ˆæ¯ï¼ŒæœåŠ¡å™¨å“åº”ï¼ˆçŠ¶æ€ç å’ŒçŸ­è¯­ï¼‰æ˜¯ä»€ä¹ˆå“åº”ï¼Ÿ<br><em><strong>A</strong></em> : çŠ¶æ€ç ï¼š<code>401</code>ï¼›çŸ­è¯­ï¼š<code>Unauthorized</code> ï¼Œå³æœªæˆæƒï¼Œéœ€è¦ç™»å½•æ‰èƒ½è®¿é—®ã€‚<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221105181502.png"></p><hr><p><em><strong>Q19</strong></em> : å½“æ‚¨çš„æµè§ˆå™¨ç¬¬äºŒæ¬¡å‘é€ <em><strong>HTTP GET</strong></em> æ¶ˆæ¯æ—¶ï¼Œ<em><strong>HTTP GET</strong></em> æ¶ˆæ¯ä¸­åŒ…å«å“ªäº›æ–°å­—æ®µï¼Ÿ<br><em><strong>A</strong></em> : å¤šäº† <em><strong>Authorization</strong></em> å­—æ®µï¼Œå³æˆæƒå­—æ®µï¼Œå…¶ä¸­åŒ…å«äº†æˆ‘ä»¬çš„è´¦æˆ·å’Œå¯†ç ã€‚<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221105182257.png"></p>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œè‡ªé¡¶å‘ä¸‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Wireshark </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CMakeå­¦ä¹ ç¬”è®°</title>
      <link href="/archives/9f9ceb8.html"/>
      <url>/archives/9f9ceb8.html</url>
      
        <content type="html"><![CDATA[<p>ä½œä¸ºä¸€å <em><strong>C&#x2F;C++</strong></em> çš„å¼€å‘è€…ï¼Œå…¶å®åœ¨å¾ˆæ—©ä¹‹å‰å·²ç»çŸ¥é“ <em><strong>CMake</strong></em> çš„å­˜åœ¨äº†ã€‚æœ€è¿‘æ­£å¥½ç”±äºè¯¾ä¸šçš„è¦æ±‚ï¼Œè¦æ±‚ä½¿ç”¨ <em><strong>CMake</strong></em>ï¼Œæ•…å€Ÿæ­¤æ¥ç³»ç»Ÿåœ°å­¦ä¹ ä¸€ä¸‹ <em><strong>CMake</strong></em>ã€‚</p><p>æœ¬ç¯‡åšå®¢çš„å†…å®¹æ˜¯æˆ‘å­¦ä¹ å°å½­è€å¸ˆçš„è§†é¢‘æ—¶æ‰€åšçš„ç¬”è®°ï¼Œå¦‚æœ‰ä¾µæƒè¯·åŠæ—¶è”ç³»æˆ‘ã€‚</p><p>ä¸‹é¢æ˜¯å°å½­è€å¸ˆè§†é¢‘çš„é“¾æ¥ï¼š<a href="https://www.bilibili.com/video/BV16P4y1g7MH/?spm_id_from=333.337.search-card.all.click&vd_source=2652d832108fec04c7b16fcf850e5ca7">ã€å…¬å¼€è¯¾ã€‘ç°ä»£CMakeé«˜çº§æ•™ç¨‹ï¼ˆæŒç»­æ›´æ–°ä¸­ï¼‰</a></p><h2 id="åˆè¯†CMake"><a href="#åˆè¯†CMake" class="headerlink" title="åˆè¯†CMake"></a>åˆè¯†CMake</h2><ul><li><p>å®˜ç½‘ï¼š<a href="https://www.cmake.org/"><em><strong>www.cmake.org</strong></em></a></p></li><li><p>ç‰¹ç‚¹ï¼š</p><ol><li>å¼€æ”¾æºä»£ç ï¼Œä½¿ç”¨ç±» <em><strong>BSD</strong></em> è®¸å¯å‘å¸ƒã€‚<a href="http://cmake.org/HTML/Copyright.html"><em><strong>http://cmake.org/HTML/Copyright.html</strong></em></a></li><li>è·¨å¹³å°ï¼Œå¹¶å¯ç”Ÿæˆ <em><strong>native</strong></em> ç¼–è¯‘é…ç½®æ–‡ä»¶ï¼Œåœ¨ <em><strong>Linux&#x2F;Unix</strong></em> å¹³å°ï¼Œç”Ÿæˆ <em><strong>makefile</strong></em> ï¼Œåœ¨è‹¹æœå¹³å°ï¼Œå¯ä»¥ç”Ÿæˆ <em><strong>xcode</strong></em> ï¼Œåœ¨ <em><strong>Windows</strong></em> å¹³å°ï¼Œå¯ä»¥ç”Ÿæˆ <em><strong>MSVC</strong></em> çš„å·¥ç¨‹æ–‡ä»¶ã€‚</li><li>èƒ½å¤Ÿç®¡ç†å¤§å‹é¡¹ç›®ã€‚</li><li>ç®€åŒ–ç¼–è¯‘æ„å»ºè¿‡ç¨‹å’Œç¼–è¯‘è¿‡ç¨‹ã€‚</li><li>é«˜æ•ˆè™‘ï¼Œä¸»è¦æ˜¯å› ä¸º <em><strong>CMake</strong></em> åœ¨å·¥å…·é“¾ä¸­æ²¡æœ‰ <em><strong>libtool</strong></em>ã€‚</li><li>å¯æ‰©å±•ï¼Œå¯ä»¥ä¸º <em><strong>CMake</strong></em> ç¼–å†™ç‰¹å®šåŠŸèƒ½çš„æ¨¡å—ï¼Œæ‰©å…… <em><strong>CMake</strong></em> åŠŸèƒ½ã€‚</li></ol></li><li><p>ä¸è¶³ï¼š</p><ol><li><em><strong>CMake</strong></em> ç»å¯¹æ²¡æœ‰å¬èµ·æ¥æˆ–è€…æƒ³è±¡ä¸­é‚£ä¹ˆç®€å•ã€‚</li><li><em><strong>CMake</strong></em> ç¼–å†™çš„è¿‡ç¨‹å®é™…ä¸Šæ˜¯ç¼–ç¨‹çš„è¿‡ç¨‹ï¼Œæ¯ä¸ªç›®å½•æœ‰ä¸€ä¸ª <em><strong>CMakeLists.txt</strong></em>ï¼Œä½¿ç”¨çš„æ˜¯ <em><strong>CMake</strong></em> è¯­è¨€å’Œè¯­æ³•ã€‚</li><li><em><strong>CMake</strong></em> è·Ÿå·²æœ‰ä½“ç³»çš„é…åˆå¹¶ä¸æ˜¯ç‰¹åˆ«ç†æƒ³ï¼Œæ¯”å¦‚ <em><strong>pkgconfig</strong></em> ã€‚</li></ol></li></ul><h2 id="å®‰è£…CMake"><a href="#å®‰è£…CMake" class="headerlink" title="å®‰è£…CMake"></a>å®‰è£…CMake</h2><p>æˆ‘æœ¬äººä½¿ç”¨çš„ç¯å¢ƒæ˜¯ <em><strong>Ubuntu 20.04</strong></em> ï¼Œå¯¹äº <em><strong>Linux&#x2F;Unix</strong></em> å¹³å°çš„ç”¨æˆ·ä¸‹è½½çš„æ–¹æ³•åº”è¯¥éƒ½æ˜¯å¤§åŒå°å¼‚ã€‚</p><p>åœ¨æˆ‘çš„ç¯å¢ƒåªéœ€è¦ä¸€è¡Œå‘½ä»¤è¡Œå³å¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install cmake</span><br></pre></td></tr></table></figure><h2 id="CMakeçš„helloworld"><a href="#CMakeçš„helloworld" class="headerlink" title="CMakeçš„helloworld"></a>CMakeçš„helloworld</h2><p>é¦–å…ˆä½ éœ€è¦å»ºç«‹ä¸€ä¸ªç›®å½•ï¼Œè¯¥ç›®å½•ä¸‹æœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š<em><strong>main.cpp</strong></em> å’Œ <em><strong>CMakeLists.txt</strong></em>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CMake-practice</span><br><span class="line">â””â”€â”€ template</span><br><span class="line">    â”œâ”€â”€ CMakeLists.txt</span><br><span class="line">    â””â”€â”€ main.cpp</span><br></pre></td></tr></table></figure><p>ä¸ºäº†æ–¹ä¾¿ç®¡ç†ä½ çš„ç»ƒä¹ ä»£ç ï¼Œå»ºè®®ä½ å°†ç»ƒä¹ ä»£ç é›†ä¸­æ”¾ç½®åœ¨ä¸€èµ·ã€‚</p><p><em><strong>main.cpp</strong></em> çš„å†…å®¹ä¸ºï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello, world!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em><strong>CMakeLists.txt</strong></em> çš„å†…å®¹ä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 3.15)</span><br><span class="line">project(hellocmake)</span><br><span class="line"></span><br><span class="line">find_program(CCACHE_PROGRAM ccache)</span><br><span class="line">if (CCACHE_PROGRAM)</span><br><span class="line">    message(STATUS &quot;Found CCache: $&#123;CCACHE_PROGRAM&#125;&quot;)</span><br><span class="line">    set_property(GLOBAL PROPERTY RULE_LAUNCH_COMPILE $&#123;CCACHE_PROGRAM&#125;)</span><br><span class="line">    set_property(GLOBAL PROPERTY RULE_LAUNCH_LINK $&#123;CCACHE_PROGRAM&#125;)</span><br><span class="line">endif()</span><br><span class="line"></span><br><span class="line">add_executable(main main.cpp)</span><br><span class="line"></span><br><span class="line">add_custom_target(run COMMAND $&lt;TARGET_FILE:main&gt;)</span><br><span class="line">if (CMAKE_EDIT_COMMAND)</span><br><span class="line">    add_custom_target(configure COMMAND $&#123;CMAKE_EDIT_COMMAND&#125; -B $&#123;CMAKE_BINARY_DIR&#125;)</span><br><span class="line">endif()</span><br></pre></td></tr></table></figure><p>ä»¥æˆ‘çš„ç›®å½•ç»“æ„ä¸ºä¾‹ï¼Œåœ¨ <code>/template</code> ç›®å½•ä¸‹æ‰§è¡Œ <code>cmake -B build</code>ï¼Œä½ ä¼šçœ‹åˆ°è¿™æ ·çš„è¾“å‡ºï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221102204837.png"></p><p>ç„¶åé¡¹ç›®ä¸­ä¼šå¤šå‡ºä¸€ä¸ª <code>/template/build</code> ç›®å½•ï¼Œè¯¥ç›®å½•ä¸­å¤šå‡ºäº†è¿™å‡ ä¸ªæ–‡ä»¶ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221102205935.png"></p><p>æ¥ç€åœ¨ <code>/template</code> ç›®å½•ä¸‹æ‰§è¡Œ <code>cmake --build build</code>ï¼Œä½ ä¼šçœ‹åˆ°è¿™æ ·çš„è¾“å‡ºï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221102205628.png"></p><p>æ­¤æ—¶<code>/template/build</code> ç›®å½•ä¸‹ä¼šå¤šå‡ºä¸€ä¸ª <code>main</code> å¯æ‰§è¡Œæ–‡ä»¶ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221102205737.png"></p><p>æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥åœ¨<code>/template</code> ç›®å½•ä¸‹æ‰§è¡Œ <code>build/main</code> äº†ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221102210159.png"></p><h2 id="å‘½ä»¤è¡Œå°æŠ€å·§"><a href="#å‘½ä»¤è¡Œå°æŠ€å·§" class="headerlink" title="å‘½ä»¤è¡Œå°æŠ€å·§"></a>å‘½ä»¤è¡Œå°æŠ€å·§</h2><p>ä»è¿™é‡Œå¼€å§‹æˆ‘ä»¬å°†ä¸€æ­¥ä¸€æ­¥è®²è§£æˆ‘ä»¬åœ¨ <em><strong>CMake</strong></em> çš„ <em><strong>helloworld</strong></em> é‡Œæ‰€ä½œçš„å‘½ä»¤è¡Œæ“ä½œçš„å«ä¹‰ï¼Œä»¥åŠ <em><strong>CMakeLists.txt</strong></em> è¯¥å¦‚ä½•ç¼–å†™ã€‚</p><h3 id="B-å’Œ-build-æŒ‡ä»¤ï¼Œä¸åŒå¹³å°ï¼Œç»Ÿä¸€å‘½ä»¤"><a href="#B-å’Œ-build-æŒ‡ä»¤ï¼Œä¸åŒå¹³å°ï¼Œç»Ÿä¸€å‘½ä»¤" class="headerlink" title="-B å’Œ --build æŒ‡ä»¤ï¼Œä¸åŒå¹³å°ï¼Œç»Ÿä¸€å‘½ä»¤"></a><code>-B</code> å’Œ <code>--build</code> æŒ‡ä»¤ï¼Œä¸åŒå¹³å°ï¼Œç»Ÿä¸€å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cmake -B build          // åœ¨æºç ç›®å½•ç”¨ -B ç›´æ¥åˆ›å»º build ç›®å½•å¹¶ç”Ÿæˆ build/Makefile</span><br><span class="line"></span><br><span class="line">cmake --build build -j4 // è‡ªåŠ¨è°ƒç”¨æœ¬åœ°çš„æ„å»ºç³»ç»Ÿåœ¨ build é‡Œæ„å»ºï¼Œåœ¨ linux ä¸Šå°±æ˜¯ï¼šmake -C build -j4</span><br><span class="line"></span><br><span class="line">sudo cmake --build build --target install  // è°ƒç”¨æœ¬åœ°çš„æ„å»ºç³»ç»Ÿæ‰§è¡Œ install è¿™ä¸ªç›®æ ‡ï¼Œå³å®‰è£…</span><br></pre></td></tr></table></figure><ul><li><code>cmake -B build</code> å…å»äº†å…ˆæ„å»º <em><strong>build</strong></em> ç›®å½•å†åˆ‡æ¢è¿›å»å†æŒ‡å®šæºç ç›®å½•çš„éº»çƒ¦ã€‚</li><li><code>cmake --build build</code> ç»Ÿä¸€äº†ä¸åŒå¹³å°ï¼ˆ <em><strong>linux</strong></em> ä¸Šä¼šè°ƒç”¨ <em><strong>make</strong></em>ï¼Œ<em><strong>windows</strong></em> ä¸Šè°ƒç”¨ <em><strong>devenv.exe</strong></em>ï¼‰</li><li>ç»“è®ºï¼šå¦‚æœåœ¨å‘½ä»¤è¡Œæ“ä½œ <em><strong>cmake</strong></em>ï¼Œè¯·ä½¿ç”¨æ›´æ–¹ä¾¿çš„ <code>-B</code> å’Œ <code>--build</code> æŒ‡ä»¤ã€‚</li></ul><h3 id="D-é€‰é¡¹ï¼šæŒ‡å®šé…ç½®å˜é‡ï¼ˆåˆç§°ç¼“å­˜å˜é‡ï¼‰"><a href="#D-é€‰é¡¹ï¼šæŒ‡å®šé…ç½®å˜é‡ï¼ˆåˆç§°ç¼“å­˜å˜é‡ï¼‰" class="headerlink" title="-D é€‰é¡¹ï¼šæŒ‡å®šé…ç½®å˜é‡ï¼ˆåˆç§°ç¼“å­˜å˜é‡ï¼‰"></a><code>-D</code> é€‰é¡¹ï¼šæŒ‡å®šé…ç½®å˜é‡ï¼ˆåˆç§°ç¼“å­˜å˜é‡ï¼‰</h3><p>ç”±ä¸Šå¯çŸ¥ <em><strong>CMake</strong></em> é¡¹ç›®çš„å¯åˆ†ä¸ºä¸¤æ­¥èµ°ï¼š</p><ol><li>ç¬¬ä¸€æ­¥æ˜¯ <code>cmake -B build</code>ï¼Œç§°ä¸ºé…ç½®é˜¶æ®µï¼ˆ<em><strong>configure</strong></em>ï¼‰ï¼Œè¿™æ—¶åªæ˜¯æ£€æµ‹ç¯-å¢ƒå¹¶ç”Ÿæˆæ„å»ºè§„åˆ™ã€‚ä¼šåœ¨ <em><strong>build</strong></em> ç›®å½•ä¸‹ç”Ÿæˆæœ¬åœ°æ„å»ºç³»ç»Ÿèƒ½è¯†åˆ«çš„é¡¹ç›®æ–‡ä»¶ï¼ˆ<em><strong>Makefile</strong></em> æˆ– <em><strong>.sln</strong></em>ï¼‰</li><li>ç¬¬äºŒæ­¥æ˜¯ <code>cmake --build build</code>ï¼Œç§°ä¸ºæ„å»ºé˜¶æ®µï¼ˆ<em><strong>build</strong></em>ï¼‰ï¼Œè¿™æ—¶æ‰å®é™…è°ƒç”¨ç¼–è¯‘å™¨æ¥ç¼–è¯‘ä»£ç ã€‚</li></ol><ul><li>åœ¨é…ç½®é˜¶æ®µå¯ä»¥é€šè¿‡ <code>-D</code> è®¾ç½®ç¼“å­˜å˜é‡ã€‚ç¬¬äºŒæ¬¡é…ç½®æ—¶ï¼Œä¹‹å‰çš„ <code>-D</code> æ·»åŠ ä»ç„¶ä¼šè¢«ä¿ç•™ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cmake -B build -DCMAKE_BUILD_TYPE=Release // è®¾ç½®æ„å»ºæ¨¡å¼ä¸ºå‘å¸ƒæ¨¡å¼ï¼ˆå¼€å¯å…¨éƒ¨ä¼˜åŒ–ï¼‰</span><br><span class="line"></span><br><span class="line">cmake -B build  // ç¬¬äºŒæ¬¡é…ç½®æ—¶æ²¡æœ‰ -D å‚æ•°ï¼Œä½†æ˜¯ä¹‹å‰ -D è®¾ç½®çš„å˜é‡éƒ½ä¼šè¢«ä¿ç•™</span><br></pre></td></tr></table></figure><ul><li>æ­¤æ—¶ç¼“å­˜é‡Œä»æœ‰æˆ‘ä»¬ä¹‹å‰å®šä¹‰çš„ <code>CMAKE_BUILD_TYPE</code>ã€‚</li></ul><h3 id="G-é€‰é¡¹ï¼šæŒ‡å®šè¦ç”¨çš„ç”Ÿæˆå™¨"><a href="#G-é€‰é¡¹ï¼šæŒ‡å®šè¦ç”¨çš„ç”Ÿæˆå™¨" class="headerlink" title="-G é€‰é¡¹ï¼šæŒ‡å®šè¦ç”¨çš„ç”Ÿæˆå™¨"></a><code>-G</code> é€‰é¡¹ï¼šæŒ‡å®šè¦ç”¨çš„ç”Ÿæˆå™¨</h3><p><em><strong>linux</strong></em> ç³»ç»Ÿä¸Šçš„ <em><strong>CMake</strong></em> é»˜è®¤ç”¨ <em><strong>UNIX Makefiles</strong></em> ç”Ÿæˆå™¨ï¼›<em><strong>Windows</strong></em> ç³»ç»Ÿé»˜è®¤æ˜¯ <em><strong>Visual Studio 2019</strong></em> ç”Ÿæˆå™¨ï¼›<em><strong>MacOS</strong></em> ç³»ç»Ÿé»˜è®¤æ˜¯ <em><strong>Xcode</strong></em> ç”Ÿæˆå™¨ã€‚</p><p>å¯ä»¥ç”¨ <code>-G</code> å‚æ•°æ”¹ç”¨åˆ«çš„ç”Ÿæˆå™¨ï¼Œä¾‹å¦‚ <code>cmake -GNinja</code> ä¼šç”Ÿæˆ <em><strong>Ninja</strong></em> è¿™ä¸ªæ„å»ºç³»ç»Ÿçš„æ„å»ºè§„åˆ™ã€‚<em><strong>Ninja</strong></em> æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ï¼Œè·¨å¹³å°çš„æ„å»ºç³»ç»Ÿï¼Œä¸‰å¤§ä¸»æµå¹³å°ä¸Šéƒ½å¯ä»¥ç”¨ã€‚<em><strong>Ninja</strong></em> å¯ä»¥ä»åŒ…ç®¡ç†å™¨å®‰è£…ï¼Œæ²¡æœ‰åŒ…ç®¡ç†å™¨çš„ <em><strong>Windows</strong></em> å¯ä»¥ç”¨ <em><strong>Python</strong></em> çš„åŒ…ç®¡ç†å™¨å®‰è£…ï¼š<code>pip install ninja</code></p><p>äº‹å®ä¸Šï¼Œ <em><strong>MSBuild</strong></em> æ˜¯å•æ ¸å¿ƒçš„æ„å»ºç³»ç»Ÿï¼Œ <em><strong>Makefile</strong></em> è™½ç„¶å¤šæ ¸å¿ƒä½†å› ä¸ºå†å²å…¼å®¹åŸå› æ•ˆç‡ä¸€èˆ¬ã€‚è€Œ <em><strong>Ninja</strong></em> åˆ™æ˜¯ä½œä¸ºæ€§èƒ½ä¼˜åŒ–çš„æ„å»ºç³»ç»Ÿï¼Œä»–å’Œ <em><strong>CMake</strong></em> ç»“åˆéƒ½æ˜¯è¡Œä¸šæ ‡å‡†äº†ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬æ¼”ç¤ºä¸€ä¸‹ç”¨ <code>cmake -GNinja</code> ç”Ÿæˆ <em><strong>Ninja</strong></em>ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221106223904.png"></p><h2 id="æ·»åŠ æºæ–‡ä»¶"><a href="#æ·»åŠ æºæ–‡ä»¶" class="headerlink" title="æ·»åŠ æºæ–‡ä»¶"></a>æ·»åŠ æºæ–‡ä»¶</h2><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç®€å•çš„ <code>.cpp</code> æºæ–‡ä»¶ç”¨äºæµ‹è¯•ï¼Œå°±åƒæˆ‘ä»¬åœ¨ <em><strong>CMake</strong></em> çš„ <em><strong>helloworld</strong></em> é‡Œæ‰€ä½œçš„é‚£æ ·ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello, world!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨åŒçº§ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª <em><strong>CMakeLists.txt</strong></em>ï¼Œåœ¨ <em><strong>CMake</strong></em> ä¸­æ·»åŠ ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ä½œä¸ºæ„å»ºç›®æ ‡ã€‚</p><h3 id="åˆ›å»ºå¹¶æ·»åŠ æºæ–‡ä»¶"><a href="#åˆ›å»ºå¹¶æ·»åŠ æºæ–‡ä»¶" class="headerlink" title="åˆ›å»ºå¹¶æ·»åŠ æºæ–‡ä»¶"></a>åˆ›å»ºå¹¶æ·»åŠ æºæ–‡ä»¶</h3><ul><li>è‡³äºå‰ä¸¤è¡Œæˆ‘ä»¬å¯ä»¥æš‚ä¸”å¿½ç•¥ï¼Œåé¢ä¼šä»‹ç»åˆ°çš„ï¼Œæˆ‘ä»¬åªçœ‹ç¬¬ä¸‰æ¡è¯­å¥ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221106225042.png"></li><li>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>add_executable(main main.cpp)</code> è¿™æ¡è¯­å¥ï¼Œå…¶ä¸­ <code>main</code> å°±æ˜¯ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶çš„æ–‡ä»¶åï¼Œç›¸å½“äº <em><strong>gcc</strong></em> çš„ <em><strong>-o</strong></em> é€‰é¡¹ï¼Œè€Œåœ¨è¿™ä¹‹åè·Ÿç€çš„å°±æ˜¯æºæ–‡ä»¶åˆ—è¡¨ï¼Œä½ å¯ä»¥åœ¨è¿™åé¢è·Ÿå¤šä¸ªæºæ–‡ä»¶ã€‚ä¾‹å¦‚ <code>add_executable(main main.cpp xxx.cpp xxx.cpp)</code> ã€‚</li></ul><h3 id="å¦ä¸€ç§æ–¹å¼ï¼šå…ˆåˆ›å»ºç›®æ ‡ï¼Œç¨åæ·»åŠ æºæ–‡ä»¶"><a href="#å¦ä¸€ç§æ–¹å¼ï¼šå…ˆåˆ›å»ºç›®æ ‡ï¼Œç¨åæ·»åŠ æºæ–‡ä»¶" class="headerlink" title="å¦ä¸€ç§æ–¹å¼ï¼šå…ˆåˆ›å»ºç›®æ ‡ï¼Œç¨åæ·»åŠ æºæ–‡ä»¶"></a>å¦ä¸€ç§æ–¹å¼ï¼šå…ˆåˆ›å»ºç›®æ ‡ï¼Œç¨åæ·»åŠ æºæ–‡ä»¶</h3><ul><li><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221106231348.png"></li><li>å¦‚æœæœ‰å¤šä¸ªæºæ–‡ä»¶ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯åœ¨æºæ–‡ä»¶åˆ—è¡¨é‡Œé€ä¸ªæ·»åŠ å³å¯ï¼š<code>target_sources(main PRIVATE main.cpp xxx.cpp xxx.cpp)</code>ã€‚</li><li>è¿˜æœ‰ä¸€ä¸ªååˆ†æ˜¾çœ¼çš„å…³é”®å­— <em><strong>PRIVATE</strong></em>ã€‚è¿™ä¸ªå…³é”®å­—æŒ‡å‡ºäº†è¿™äº›å¯¹åº”çš„æºåº”è¯¥åœ¨ä½•å¤„è¢«ä½¿ç”¨ï¼Œ<em><strong>PRIVATE</strong></em> è¡¨ç¤ºè¿™äº›æºåªåº”è¯¥æ·»åŠ åˆ° <code>main</code> ä¸­ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„ã€‚</li><li>ä¸ä¹‹å¯¹åº”çš„è¿˜æœ‰ <em><strong>PUBLIC</strong></em> å…³é”®å­—ï¼Œ<em><strong>PUBLIC</strong></em> è¡¨ç¤ºè¿™äº›æºåº”è¯¥æ·»åŠ åˆ° <code>main</code> å’Œä»»ä½•é“¾æ¥åˆ° <code>main</code> çš„å¯¹è±¡ä¸­ï¼Œè¿™å¯ä¸æ˜¯æˆ‘ä»¬é€šå¸¸æƒ³è¦çš„ã€‚ä½†æœ‰ä¸€ç§ä¾‹å¤–ï¼Œé‚£å°±æ˜¯å¤´æ–‡ä»¶ä»¥åŠ <em><strong>header only</strong></em> çš„åº“ï¼Œæˆ‘ä»¬å¯èƒ½æ€»æ˜¯å¸Œæœ›æŠŠè¿™äº›å¤´æ–‡ä»¶ä¼ æ’­åˆ°ä¸ <code>main</code> é“¾æ¥çš„å¯¹è±¡ä¸­ã€‚</li><li>æˆ–è®¸ä½ å¯èƒ½è¿˜ä¼šé—® <em><strong>INTERFACE</strong></em> å…³é”®å­—å‘¢ï¼Œå› ä¸ºç›®å‰æˆ‘ä»¬æš‚æ—¶æ²¡æœ‰ç”¨ä¸Šè¿™ä¸ªå…³é”®å­—çš„åœºæ™¯ï¼Œç­‰æˆ‘ä»¬ä»¥åç¢°ä¸Šå†è¯´å§ã€‚</li></ul><h3 id="ä½¿ç”¨å˜é‡æ¥å­˜å‚¨"><a href="#ä½¿ç”¨å˜é‡æ¥å­˜å‚¨" class="headerlink" title="ä½¿ç”¨å˜é‡æ¥å­˜å‚¨"></a>ä½¿ç”¨å˜é‡æ¥å­˜å‚¨</h3><ul><li><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221106233634.png"></li><li>å…¶ä¸­ <code>set(source main.cpp)</code> å°±æ˜¯å®šä¹‰å˜é‡çš„è¯­å¥ï¼Œ<em><strong>source</strong></em> æ˜¯å˜é‡åï¼Œè€Œåœ¨è¿™ä¹‹åçš„åˆ—è¡¨å°±æ˜¯å˜é‡çš„å†…å®¹ã€‚æˆ‘ä»¬åœ¨è®¿é—®å˜é‡æ—¶ä½¿ç”¨ <code>$&#123;source&#125;</code> çš„è¯­æ³•ï¼Œè¿™æ · <em><strong>source</strong></em> å°±ä¼šæŠŠå†…å®¹å±•å¼€ï¼Œå…¶å®å°±æœ‰ç‚¹åƒå®æ›¿æ¢çš„æ„Ÿè§‰ã€‚</li></ul><h3 id="ä½¿ç”¨-GLOB-å®ç°æ‰¹é‡æ·»åŠ æºæ–‡ä»¶"><a href="#ä½¿ç”¨-GLOB-å®ç°æ‰¹é‡æ·»åŠ æºæ–‡ä»¶" class="headerlink" title="ä½¿ç”¨ GLOB å®ç°æ‰¹é‡æ·»åŠ æºæ–‡ä»¶"></a>ä½¿ç”¨ <code>GLOB</code> å®ç°æ‰¹é‡æ·»åŠ æºæ–‡ä»¶</h3><ul><li><p><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221113215121.png"></p></li><li><p>ä½¿ç”¨ <code>GLOB</code> ä¼šè‡ªåŠ¨æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹æŒ‡å®šæ‰©å±•åçš„æ–‡ä»¶ï¼Œä»è€Œå®ç°æ‰¹é‡æ·»åŠ æºæ–‡ä»¶çš„æ•ˆæœã€‚ä½†è¿™ç§æ–¹å¼æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œé‚£å°±æ˜¯æ„å»ºå®Œæˆä¹‹åå¦‚æœæŒ‡å®šæ‰©å±•åçš„æ–‡ä»¶æ·»åŠ æˆ–è€…åˆ é™¤äº†ï¼Œ<em><strong>cmake</strong></em> å¹¶ä¸ä¼šè‡ªåŠ¨æ›´æ–°ã€‚</p></li><li><p>å› æ­¤æˆ‘ä»¬æœ€å¥½æ˜¯å¯ç”¨ <code>CONFIGURE_DEPENDS</code> é€‰é¡¹ï¼Œå½“æ·»åŠ æ–°æ–‡ä»¶æ—¶ï¼Œè‡ªåŠ¨æ›´æ–°å˜é‡ã€‚<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221113220256.png"></p></li></ul><h3 id="ä½¿ç”¨-aux-source-directory-è‡ªåŠ¨æœé›†éœ€è¦çš„æ–‡ä»¶åç¼€å"><a href="#ä½¿ç”¨-aux-source-directory-è‡ªåŠ¨æœé›†éœ€è¦çš„æ–‡ä»¶åç¼€å" class="headerlink" title="ä½¿ç”¨ aux_source_directory è‡ªåŠ¨æœé›†éœ€è¦çš„æ–‡ä»¶åç¼€å"></a>ä½¿ç”¨ <code>aux_source_directory</code> è‡ªåŠ¨æœé›†éœ€è¦çš„æ–‡ä»¶åç¼€å</h3><ul><li><p>å‡ºäºç®¡ç†æºç çš„éœ€è¦ï¼Œæˆ‘ä»¬å¯èƒ½æŠŠä»£ç æ”¾åˆ°å½“å‰ç›®å½•ä¸‹çš„ä¸€ä¸ªå­æ–‡ä»¶å¤¹ä¸­ï¼Œå°±åƒè¿™æ ·ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CMake-practice</span><br><span class="line">â””â”€â”€ template</span><br><span class="line">    â”œâ”€â”€ CMakeLists.txt</span><br><span class="line">    â”œâ”€â”€ main.cpp</span><br><span class="line">    â””â”€â”€ mylib</span><br><span class="line">        â””â”€â”€ mylib.cpp</span><br></pre></td></tr></table></figure></li><li><p>å¦‚æœæˆ‘ä»¬è¿˜æ˜¯å•çº¯åœ°ä½¿ç”¨ç¬¬ <em><strong>4</strong></em> ç‚¹ä¸­æˆ‘ä»¬æ‰€ç”¨çš„å‘½ä»¤ï¼Œæ˜¯ä¸ä¼šå°† <em><strong>mylib</strong></em> æ–‡ä»¶å¤¹ä¸­çš„æ‰€éœ€æ–‡ä»¶åŠ å…¥è¿›æ¥çš„ï¼Œå› ä¸º <code>GLOB</code> åªä¼šæŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå¹¶ä¸ä¼šè¿›è¡Œé€’å½’æŸ¥æ‰¾ã€‚</p></li><li><p>å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠè·¯å¾„åå’Œåç¼€åçš„æ’åˆ—ç»„åˆå…¨éƒ¨å†™å‡ºæ¥ï¼Œä¾‹å¦‚ï¼š<code>file(GLOB source CONFIGURE_DEPENDS *.cpp *.h mylib/*.cpp mylib/*.h)</code></p></li><li><p>ä½†è¿™æ ·æœªå…å¤ªè¿‡éº»çƒ¦ï¼Œè¿™ä¸ªæ—¶å€™ <code>aux_source_directory</code> å°±ååˆ†æ–¹ä¾¿äº†ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221113222949.png"></p></li><li><p>æˆ‘ä»¬è¿™é‡ŒæŒ‡å®šäº†ä¸¤ä¸ªæœç´¢ç›®å½•ï¼Œä¸€ä¸ªæ˜¯å½“å‰ç›®å½•ï¼Œä¸€ä¸ªæ˜¯ <em><strong>mylib</strong></em> ç›®å½•ï¼Œ<code>aux_source_directory</code> ä¼šæ ¹æ®æˆ‘ä»¬æ‰€ä½¿ç”¨çš„è¯­è¨€è‡ªåŠ¨å»æœç´¢éœ€è¦çš„æ–‡ä»¶ã€‚</p></li><li><p>å½“ç„¶ <code>aux_source_directory</code> ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œå®ƒæœ¬èº«å¹¶ä¸å…·å¤‡æ£€æŸ¥æ›´æ–°çš„åŠŸèƒ½ã€‚</p></li></ul><h3 id="è¿›ä¸€æ­¥ï¼šGLOB-RECURSE-é€’å½’æŸ¥è¯¢å­æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶"><a href="#è¿›ä¸€æ­¥ï¼šGLOB-RECURSE-é€’å½’æŸ¥è¯¢å­æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶" class="headerlink" title="è¿›ä¸€æ­¥ï¼šGLOB_RECURSE , é€’å½’æŸ¥è¯¢å­æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶"></a>è¿›ä¸€æ­¥ï¼š<code>GLOB_RECURSE</code> , é€’å½’æŸ¥è¯¢å­æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶</h3><ul><li><p>æˆ‘ä»¬é¦–å…ˆéœ€è¦ä¿®æ”¹ä¸€ä¸‹é¡¹ç›®ç»“æ„ï¼Œå°†æºç å…¨éƒ¨æ”¾åˆ° <em><strong>src</strong></em> æ–‡ä»¶å¤¹ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CMake-practice</span><br><span class="line">â””â”€â”€ template</span><br><span class="line">    â”œâ”€â”€ build</span><br><span class="line">    â”œâ”€â”€ CMakeLists.txt</span><br><span class="line">    â””â”€â”€ src</span><br><span class="line">        â”œâ”€â”€ main.cpp</span><br><span class="line">        â””â”€â”€ mylib</span><br><span class="line">            â””â”€â”€ mylib.cpp</span><br></pre></td></tr></table></figure></li><li><p>ç„¶åä¿®æ”¹ <em><strong>CMakeLists.txt</strong></em> ä¸ºï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221113231341.png"></p></li><li><p>ä¹‹æ‰€ä»¥æŠŠæºç ç§»å…¥ <em><strong>src</strong></em> æ–‡ä»¶å¤¹ä¸‹ï¼Œæ˜¯å› ä¸ºå¦‚æœæºç å’Œ <em><strong>build</strong></em> æ–‡ä»¶å¤¹åœ¨åŒä¸€ç›®å½•ä¸‹ï¼Œä¼šæŠŠ <em><strong>build</strong></em> æ–‡ä»¶å¤¹ä¸‹çš„ä¸€äº›ä¸­é—´æ–‡ä»¶ä¹Ÿå¼•å…¥è¿›æ¥ï¼Œè¿™å°†å¯èƒ½å¯¼è‡´æ„æ–™å¤–çš„é”™è¯¯ã€‚</p></li><li><p>å› æ­¤æœ€ä½³å®è·µæ˜¯æŠŠæºç å’Œ <em><strong>build</strong></em> æ–‡ä»¶å¤¹éš”ç¦»å¼€æ¥ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¾—åˆ°äº†é€’å½’æœç´¢æ–‡ä»¶å’Œè‡ªåŠ¨æ›´æ–°ä¸¤å¤§å¥½å¤„ã€‚</p><h2 id="é¡¹ç›®é…ç½®å˜é‡"><a href="#é¡¹ç›®é…ç½®å˜é‡" class="headerlink" title="é¡¹ç›®é…ç½®å˜é‡"></a>é¡¹ç›®é…ç½®å˜é‡</h2></li></ul>]]></content>
      
      
      <categories>
          
          <category> CMake </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CMake </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Wireshark-Introduction</title>
      <link href="/archives/c3b21e39.html"/>
      <url>/archives/c3b21e39.html</url>
      
        <content type="html"><![CDATA[<p><em><strong>å®˜æ–¹è‹±æ–‡èµ„æºç½‘ç«™</strong></em> ï¼š<a href="https://media.pearsoncmg.com/ph/esm/ecs_kurose_compnetwork_8/cw/"><em><strong>Pearson Computer Networking: a Top-Down Approach, 8th Edition</strong></em></a></p><p><em><strong>ç›´æ¥ä¸‹è½½</strong></em>ï¼š<a href="https://www-net.cs.umass.edu/wireshark-labs/"><em><strong>Wireshark Labs</strong></em></a></p><p>ç”±äºè‹±æ–‡åŸç‰ˆçš„ <em><strong>PDF</strong></em> çš„ç¿»è¯‘ä»»åŠ¡æœ‰ç‚¹å¤§ï¼Œæ‰€ä»¥è¿™é‡Œåªå±•ç¤ºéœ€è¦æäº¤çš„å†…å®¹ï¼Œè‡³äºç¿»è¯‘å…ˆæ”¾è¿› <em><strong>TODO</strong></em> é‡Œå§å‘œå‘œ</p><hr><h2 id="Wireshark-å®éªŒ-å…¥é—¨-v7-0"><a href="#Wireshark-å®éªŒ-å…¥é—¨-v7-0" class="headerlink" title="Wireshark å®éªŒ:  å…¥é—¨ v7.0"></a>Wireshark å®éªŒ:  å…¥é—¨ v7.0</h2><p><strong>ã€Šè®¡ç®—æœºç½‘ç»œï¼šè‡ªé¡¶å‘ä¸‹æ–¹æ³•ï¼ˆç¬¬7ç‰ˆï¼‰ã€‹è¡¥å……ææ–™ï¼ŒJ.F. Kurose and K.W. Ross</strong><br>â€œä¸é—»ä¸è‹¥é—»ä¹‹ï¼Œé—»ä¹‹ä¸è‹¥è§ä¹‹ï¼Œè§ä¹‹ä¸è‹¥çŸ¥ä¹‹ï¼ŒçŸ¥ä¹‹ä¸è‹¥è¡Œä¹‹ã€‚â€ â€”â€”ä¸­å›½è°šè¯­ </p><p>Â© 2005-2012, J.F Kurose and K.W. Ross, All Rights Reserved</p><h2 id="è·å–Wireshark"><a href="#è·å–Wireshark" class="headerlink" title="è·å–Wireshark"></a>è·å–Wireshark</h2><p>ä¸ºäº†è¿è¡Œ <em><strong>Wireshark</strong></em> ï¼Œæ‚¨éœ€è¦ä¸€å°æ”¯æŒ <em><strong>Wireshark</strong></em> å’Œ <em><strong>libpcap</strong></em> æˆ– <em><strong>WinPCap</strong></em> åˆ†ç»„æ•è·åº“çš„è®¡ç®—æœºã€‚å½“ä½ å®‰è£… <em><strong>Wireshark</strong></em> æ—¶ï¼Œå¦‚æœä½ çš„æ“ä½œç³»ç»Ÿä¸­æœªå®‰è£… <em><strong>libpcap</strong></em> è½¯ä»¶ï¼Œå®ƒå°†ä¼šè‡ªåŠ¨å®‰è£…ã€‚</p><p>æœ‰å…³æ”¯æŒçš„æ“ä½œç³»ç»Ÿå’Œä¸‹è½½ç«™ç‚¹çš„åˆ—è¡¨ï¼Œè¯·è®¿é—®ï¼š<a href="http://www.wireshark.org/download.html"><em><strong>http://www.wireshark.org/download.html</strong></em></a></p><p><em><strong>Wireshark</strong></em> <em><strong>FAQ</strong></em> æœ‰ä¸€äº›æœ‰ç”¨çš„æç¤ºå’Œæœ‰è¶£çš„ä¿¡æ¯ï¼Œå°¤å…¶æ˜¯ä½ åœ¨å®‰è£…æˆ–è¿è¡Œ <em><strong>Wireshark</strong></em> æ—¶é‡åˆ°é—®é¢˜çš„æ—¶å€™ã€‚</p><h2 id="éœ€è¦æäº¤çš„å†…å®¹"><a href="#éœ€è¦æäº¤çš„å†…å®¹" class="headerlink" title="éœ€è¦æäº¤çš„å†…å®¹"></a>éœ€è¦æäº¤çš„å†…å®¹</h2><p>ç¬¬ä¸€ä¸ªå®éªŒçš„ç›®çš„ä¸»è¦æ˜¯å‘ä½ ä»‹ç» <em><strong>Wireshark</strong></em> ã€‚ä»¥ä¸‹é—®é¢˜å°†è¯æ˜ä½ å·²ç»èƒ½å¤Ÿä½¿ <em><strong>Wireshark</strong></em> å¯åŠ¨å¹¶è¿è¡Œï¼Œå¹¶ä¸”å·²ç»æ¢ç´¢äº†å…¶ä¸­ä¸€äº›åŠŸèƒ½ã€‚æ ¹æ®ä½ çš„ <em><strong>Wireshark</strong></em> å®éªŒå›ç­”ä»¥ä¸‹é—®é¢˜ï¼š</p><ol><li><p>åˆ—å‡ºå‡ºç°åœ¨æœªè¿‡æ»¤çš„åˆ†ç»„åˆ—è¡¨çª—å£çš„åè®®åˆ—ä¸­çš„3ç§ä¸åŒçš„åè®®ã€‚<br>éšä¾¿é€‰å…¶ä¸­å‡ ç§ï¼š<em><strong>TCP</strong></em>ã€<em><strong>OICP</strong></em>ã€<em><strong>TLSv1.2</strong></em></p></li><li><p>ä» <em><strong>HTTP GET</strong></em> æ¶ˆæ¯å‘é€åˆ° <em><strong>HTTP OK</strong></em> å›å¤éœ€è¦å¤šé•¿æ—¶é—´ï¼Ÿ<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/InkedQQ%E5%9B%BE%E7%89%8720221021223929.jpg"><br>å¦‚å›¾éœ€è¦ï¼š<em><strong>0.413765 - 0.145155 &#x3D; 0.268610 s</strong></em></p></li><li><p><code>gaia.cs.umass.edu</code> (ä¹Ÿç§°ä¸º <code>wwwnet.cs.umass.edu</code> )çš„ <em><strong>Internetåœ°å€</strong></em> æ˜¯ä»€ä¹ˆï¼Ÿä½ çš„è®¡ç®—æœºçš„ <em><strong>Internet</strong></em> åœ°å€æ˜¯ä»€ä¹ˆï¼Ÿ<br>å‚è€ƒä¸Šå›¾å¯çŸ¥ <code>gaia.cs.umass.edu</code> çš„ <em><strong>IP</strong></em> åœ°å€ä¸ºï¼š<code>128.119.245.12</code>ï¼Œæˆ‘è‡ªå·±çš„ <em><strong>IP</strong></em> åœ°å€ä¸ºäº†ä¿å¯†å°±ä¸æ”¾å‡ºåŠ›ã€‚</p></li><li><p>æ‰“å°é—®é¢˜2æåˆ°çš„ä¸¤ä¸ª <em><strong>HTTP</strong></em> æ¶ˆæ¯(<em><strong>GETå’ŒOK</strong></em>)ã€‚è¦è¿™æ ·åšï¼Œä» <em><strong>Wireshark</strong></em> çš„â€œæ–‡ä»¶â€èœå•ä¸­é€‰æ‹©â€œæ‰“å°â€ï¼Œç„¶åé€‰æ‹©â€œä»…é€‰ä¸­åˆ†ç»„â€å’Œâ€œæŒ‰å½“å‰æ˜¾ç¤ºâ€æŒ‰é’®ï¼Œç„¶åå•å‡»ç¡®å®šã€‚<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221021225150.png"></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œè‡ªé¡¶å‘ä¸‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Wireshark </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SocketLab2ï¼šUDPping</title>
      <link href="/archives/ce10b13b.html"/>
      <url>/archives/ce10b13b.html</url>
      
        <content type="html"><![CDATA[<p><em><strong>å®˜æ–¹è‹±æ–‡èµ„æºç½‘ç«™</strong></em> ï¼š<a href="https://media.pearsoncmg.com/ph/esm/ecs_kurose_compnetwork_8/cw/"><em><strong>Pearson Computer Networking: a Top-Down Approach, 8th Edition</strong></em></a></p><p><em><strong>ç›´æ¥ä¸‹è½½</strong></em>ï¼š<a href="https://media.pearsoncmg.com/ph/esm/ecs_kurose_compnetwork_8/cw/content/python-socket-programming-assignments.zip"><em><strong>Python 3 Socket Programming Assignments</strong></em></a></p><p><em><strong>ä»¥ä¸‹å†…å®¹ä¸ºç¬”è€…ç¿»è¯‘</strong></em> ï¼š</p><hr><p>åœ¨è¿™ä¸ªå®éªŒä¸­ï¼Œä½ å°†å­¦ä¹ åœ¨ <em><strong>Python</strong></em> ä½¿ç”¨ <em><strong>UDP</strong></em> å¥—æ¥å­—ç¼–ç¨‹çš„åŸºç¡€ã€‚ä½ å°†å­¦ä¹ åˆ°å¦‚ä½•ä½¿ç”¨ <em><strong>UDP</strong></em> å¥—æ¥å­—æ¥æ”¶å’Œå‘é€æ•°æ®æŠ¥ï¼Œä»¥åŠå¦‚ä½•è®¾ç½®ä¸€ä¸ªåˆç†çš„å¥—æ¥å­—è¶…æ—¶ã€‚é€šè¿‡è¿™ä¸ªå®éªŒï¼Œä½ å°†ä¼šç†Ÿæ‚‰ <em><strong>Ping</strong></em> åº”ç”¨ç¨‹åºåŠå…¶åœ¨è®¡ç®—ç»Ÿè®¡ä¿¡æ¯ï¼ˆå¦‚ä¸¢åŒ…ç‡ï¼‰ä¸­çš„ä½œç”¨ã€‚</p><p>ä½ é¦–å…ˆå°†ä¼šå­¦ä¹ ä½¿ç”¨ <em><strong>Python</strong></em> ç¼–å†™ä¸€ä¸ªç®€å•çš„äº’è”ç½‘ <em><strong>Ping</strong></em> æœåŠ¡å™¨ç¨‹åºï¼Œå¹¶å®ç°ç›¸å…³çš„å®¢æˆ·ç«¯ã€‚è¿™äº›ç¨‹åºæä¾›çš„åŠŸèƒ½ç±»ä¼¼äºç°ä»£æ“ä½œç³»ç»Ÿä¸­æä¾›çš„å¯ç”¨çš„æ ‡å‡†çš„ <em><strong>Ping</strong></em> ç¨‹åºçš„åŠŸèƒ½ã€‚ç„¶è€Œï¼Œè¿™äº›ç¨‹åºä½¿ç”¨ä¸€ä»½æ›´ç®€å•çš„ <em><strong>UDP</strong></em> åè®®ï¼Œè€Œä¸æ˜¯æ ‡å‡†äº’è”ç½‘ä¿¡æ¯æ§åˆ¶åè®®ï¼ˆ<em><strong>ICMP</strong></em>ï¼‰æ¥è¿›è¡Œé€šä¿¡ã€‚<em><strong>Ping</strong></em> åè®®å…è®¸ä¸€ä¸ªå®¢æˆ·ç«¯æœºå™¨å‘é€ä¸€ä¸ªæ•°æ®æŠ¥ç»™ä¸€ä¸ªè¿œç¨‹æœºå™¨ï¼Œå¹¶ä½¿è¿œç¨‹æœºå™¨è¿”å›æ•°æ®åˆ°å®¢æˆ·ç«¯æœºå™¨ï¼ˆç§°ä¸ºå›æ˜¾ï¼‰çš„æ“ä½œã€‚åœ¨å…¶ä»–ç”¨é€”ä¸Šï¼Œ<em><strong>Ping</strong></em> åè®®å…è®¸ä¸»æœºç¡®è®¤ä»–åˆ°å…¶ä»–æœºå™¨çš„å¾€è¿”æ—¶é—´ã€‚</p><p>ä¸‹é¢å·²ç»ä¸ºä½ ç»™å‡ºäº†å®Œæ•´çš„ <em><strong>Ping</strong></em> æœåŠ¡å™¨ä»£ç ã€‚ä½ çš„ä»»åŠ¡æ˜¯ç¼–å†™ <em><strong>Ping</strong></em> å®¢æˆ·ç«¯ä»£ç ã€‚</p><h2 id="æœåŠ¡å™¨ä»£ç "><a href="#æœåŠ¡å™¨ä»£ç " class="headerlink" title="æœåŠ¡å™¨ä»£ç "></a>æœåŠ¡å™¨ä»£ç </h2><p>ä»¥ä¸‹ä»£ç å®Œæ•´åœ°å®ç°äº†ä¸€ä¸ª <em><strong>Ping</strong></em> æœåŠ¡å™¨ã€‚ä½ éœ€è¦åœ¨è¿è¡Œä½ çš„å®¢æˆ·ç«¯ä»£ç ä¹‹å‰ç¼–è¯‘å¹¶è¿è¡Œè¿™ä»½æœåŠ¡å™¨ä»£ç ã€‚ä½ ä¸éœ€è¦ä¿®æ”¹è¿™ä»½ä»£ç ã€‚</p><p>åœ¨è¿™ä»½æœåŠ¡å™¨ä»£ç ä¸­ï¼Œ30%çš„å®¢æˆ·ç«¯çš„æ•°æ®åŒ…ä¼šè¢«æ¨¡æ‹Ÿä¸¢å¤±ã€‚ä½ åº”è¯¥ä»”ç»†å­¦ä¹ è¿™ä»½ä»£ç ï¼Œå®ƒå°†å¸®åŠ©ä½ æ€è€ƒå¦‚ä½•ç¼–å†™ <em><strong>Ping</strong></em> å®¢æˆ·ç«¯ç¨‹åºã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># UDPPingerServer.py </span></span><br><span class="line"><span class="comment"># We will need the following module to generate randomized lost packets import random </span></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> * </span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a UDP socket  </span></span><br><span class="line"><span class="comment"># Notice the use of SOCK_DGRAM for UDP packets </span></span><br><span class="line">serverSocket = socket(AF_INET, SOCK_DGRAM) </span><br><span class="line"><span class="comment"># Assign IP address and port number to socket </span></span><br><span class="line">serverSocket.bind((<span class="string">&#x27;&#x27;</span>, <span class="number">12000</span>)) </span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:     </span><br><span class="line"><span class="comment"># Generate random number in the range of 0 to 10 </span></span><br><span class="line">rand = random.randint(<span class="number">0</span>, <span class="number">10</span>)     </span><br><span class="line"><span class="comment"># Receive the client packet along with the address it is coming from  </span></span><br><span class="line">message, address = serverSocket.recvfrom(<span class="number">1024</span>) </span><br><span class="line"><span class="comment"># Capitalize the message from the client     </span></span><br><span class="line">message = message.upper() </span><br><span class="line"><span class="comment"># If rand is less is than 4, we consider the packet lost and do not respond     </span></span><br><span class="line"><span class="keyword">if</span> rand &lt; <span class="number">4</span>:         </span><br><span class="line"><span class="keyword">continue</span>     </span><br><span class="line"><span class="comment"># Otherwise, the server responds         </span></span><br><span class="line">serverSocket.sendto(message, address)</span><br></pre></td></tr></table></figure><p>æœåŠ¡å™¨ç¨‹åºåœ¨ä¸€ä¸ªæ­»å¾ªç¯ä¸­ç›‘å¬åˆ°æ¥çš„ <em><strong>UDP</strong></em> æ•°æ®åŒ…ã€‚å½“ä¸€ä¸ªæ•°æ®åŒ…åˆ°æ¥æ—¶ï¼Œå¦‚æœç”Ÿæˆä¸€ä¸ªéšæœºæ•°å¤§äºç­‰äº4ï¼Œåˆ™æœåŠ¡å™¨ç¨‹åºåªéœ€å°†æ•°æ®åŒ…ä¸­çš„æ•°æ®è½¬æ¢ä¸ºå¤§å†™å¹¶å°†å…¶è¿”å›ç»™å®¢æˆ·ç«¯å³å¯ã€‚</p><h2 id="ä¸¢åŒ…"><a href="#ä¸¢åŒ…" class="headerlink" title="ä¸¢åŒ…"></a>ä¸¢åŒ…</h2><p><em><strong>UDP</strong></em> å‘åº”ç”¨ç¨‹åºæä¾›ä¸€ä¸ªä¸å¯ä¿¡èµ–çš„ä¼ è¾“æœåŠ¡ã€‚ä¿¡æ¯å¯èƒ½ä¼šä¸¢å¤±äºç½‘ç»œä¹‹ä¸­ï¼Œæ¯”å¦‚å› ä¸ºè·¯ç”±å™¨ç¼“å­˜æº¢å‡ºã€ç¡¬ä»¶æ•…éšœæˆ–è€…å…¶ä»–çš„åŸå› ã€‚ä½†ç”±äºåœ¨å†…ç½‘ä¸­ä¸¢åŒ…æ˜¯å¾ˆç½•è§çš„ç”šè‡³ä¸å­˜åœ¨çš„ï¼Œæ‰€ä»¥æœ¬æ¬¡å®éªŒä¸­çš„æœåŠ¡å™¨ç¨‹åºæ·»åŠ äººä¸ºçš„ä¸¢åŒ…æ¥æ¨¡æ‹Ÿç½‘ç»œä¸¢åŒ…çš„å½±å“ã€‚æœåŠ¡å™¨ç¨‹åºç”Ÿæˆä¸€ä¸ªéšæœºæ•´æ•°å˜é‡æ¥ç¡®å®šä¼ å…¥çš„æ•°æ®åŒ…æ˜¯ä¸¢å¤±è¿˜æ˜¯ä¸ä¸¢å¤±ã€‚</p><h2 id="å®¢æˆ·ç«¯ä»£ç "><a href="#å®¢æˆ·ç«¯ä»£ç " class="headerlink" title="å®¢æˆ·ç«¯ä»£ç "></a>å®¢æˆ·ç«¯ä»£ç </h2><p>ä½ éœ€è¦å®ç°ä»¥ä¸‹çš„å®¢æˆ·ç«¯ç¨‹åºã€‚è¿™ä¸ªå®¢æˆ·ç«¯ç¨‹åºåº”è¯¥å‘é€10ä¸ª <em><strong>Ping</strong></em> ç»™æœåŠ¡å™¨ã€‚å› ä¸º <em><strong>UDP</strong></em> æ˜¯ä¸€ä¸ªä¸å¯ä¿¡èµ–çš„åè®®ï¼Œæ‰€ä»¥ä»ä¸€ä¸ªä»å®¢æˆ·ç«¯å‘é€åˆ°æœåŠ¡å™¨çš„æ•°æ®åŒ…å¯èƒ½ä¼šåœ¨ç½‘ç»œä¸­ä¸¢å¤±ï¼Œåä¹‹äº¦ç„¶ã€‚ç”±äºè¿™ä¸ªåŸå› ï¼Œå®¢æˆ·ç«¯ç¨‹åºä¸èƒ½æ— é™ç­‰å¾… <em><strong>Ping</strong></em> æ¶ˆæ¯çš„å“åº”ã€‚ä½ åº”è¯¥è®©å®¢æˆ·ç«¯ç¨‹åºç­‰å¾…æœåŠ¡å™¨å›ç­”çš„æ—¶é—´æœ€å¤šä¸ºä¸€ç§’ã€‚å¦‚æœä¸€ç§’å†…æ²¡æœ‰æ”¶åˆ°å“åº”ï¼Œä½ çš„å®¢æˆ·ç«¯ç¨‹åºåº”è¯¥å‡è®¾è¯¥æ•°æ®åŒ…åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å·²ç»ä¸¢å¤±ã€‚æ‚¨éœ€è¦æŸ¥é˜… <em><strong>Python</strong></em> æ–‡æ¡£ï¼Œå¦‚ä½•åœ¨ä¸€ä¸ªæ•°æ®åŒ…å¥—æ¥å­—ä¸Šè®¾ç½®è¶…æ—¶å€¼ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œä½ çš„å®¢æˆ·ç«¯ç¨‹åºåº”è¯¥ï¼š</p><ol><li>ä½¿ç”¨ <em><strong>UDP</strong></em> æ¥å‘é€ <em><strong>Ping</strong></em> ä¿¡æ¯ã€‚ï¼ˆæ³¨æ„ï¼šä½ ä¸éœ€è¦åƒ <em><strong>TCP</strong></em> ä¸€æ ·å…ˆå»ºç«‹è¿æ¥ï¼Œå› ä¸º <em><strong>UDP</strong></em> æ˜¯ä¸€ä¸ªæ— è¿æ¥åè®®ï¼‰</li><li>è¾“å‡ºæ¥è‡ªæœåŠ¡å™¨çš„å“åº”ã€‚</li><li>å¦‚æœæ”¶åˆ°æ¥è‡ªæœåŠ¡å™¨çš„å“åº”ï¼Œè®¡ç®—å¹¶æ‰“å°å‡ºå¾€è¿”æ—¶é—´ï¼ˆ<em><strong>RTT</strong></em>ï¼‰ï¼Œä»¥ç§’ä¸ºå•ä½ã€‚</li><li>å¦åˆ™ï¼Œæ‰“å° <em><strong>â€œè¯·æ±‚è¶…æ—¶â€</strong></em> ã€‚</li></ol><p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä½ åº”è¯¥åœ¨ä½ çš„æœºå™¨ä¸Šè¿è¡Œ <code>UDPPingerServer.py</code> ï¼Œå¹¶é€šè¿‡å‘ <code>localhost</code> (æˆ–è€… <code>127.0.0.1</code> ) å‘é€æ•°æ®åŒ…æµ‹è¯•ä½ çš„å®¢æˆ·ç«¯ç¨‹åºã€‚åœ¨è°ƒè¯•å®Œæˆä¹‹åï¼Œä½ åº”è¯¥èƒ½å¤Ÿçœ‹åˆ°ä½ çš„ <em><strong>Ping</strong></em> æœåŠ¡å™¨å’Œ <em><strong>Ping</strong></em> å®¢æˆ·ç«¯åœ¨ä¸åŒæœºå™¨ä¸Šé€šè¿‡ç½‘ç»œè¿›è¡Œé€šä¿¡ã€‚</p><h2 id="ä¿¡æ¯æ ¼å¼"><a href="#ä¿¡æ¯æ ¼å¼" class="headerlink" title="ä¿¡æ¯æ ¼å¼"></a>ä¿¡æ¯æ ¼å¼</h2><p>åœ¨è¿™ä¸ªå®éªŒä¸­ <em><strong>Ping</strong></em> æ¶ˆæ¯æ ¼å¼ä½¿ç”¨æœ€ç®€å•çš„æ–¹å¼ã€‚å®¢æˆ·ç«¯ä¿¡æ¯åªæœ‰ä¸€è¡Œï¼Œç”±ä»¥ä¸‹æ ¼å¼çš„ <em><strong>ASCII</strong></em> å­—ç¬¦ç»„æˆï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ping sequence_number time</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <em><strong>sequence_number</strong></em> ä»1å¼€å§‹ï¼Œä¸€ç›´åˆ°10ï¼Œä¸€å…±10æ¡æ¶ˆæ¯ï¼Œè€Œ <em><strong>time</strong></em> åˆ™æ˜¯å®¢æˆ·ç«¯å‘é€ä¿¡æ¯çš„æ—¶é—´ã€‚</p><h2 id="éœ€è¦ä¸Šäº¤çš„å†…å®¹"><a href="#éœ€è¦ä¸Šäº¤çš„å†…å®¹" class="headerlink" title="éœ€è¦ä¸Šäº¤çš„å†…å®¹"></a>éœ€è¦ä¸Šäº¤çš„å†…å®¹</h2><p>ä½ éœ€è¦ä¸Šäº¤å®Œæ•´çš„å®¢æˆ·ç«¯ä»£ç å’Œæˆªå›¾æ¥è¯æ˜ä½ çš„ <em><strong>Ping</strong></em> ç¨‹åºåƒè¦æ±‚çš„é‚£æ ·æ­£å¸¸å·¥ä½œã€‚</p><h2 id="å¯é€‰ç»ƒä¹ "><a href="#å¯é€‰ç»ƒä¹ " class="headerlink" title="å¯é€‰ç»ƒä¹ "></a>å¯é€‰ç»ƒä¹ </h2><ol><li>ç›®å‰ï¼Œç¨‹åºä¸ºæ¯ä¸ªæ•°æ®åŒ…å•ç‹¬åœ°è®¡ç®—å‡ºå¾€è¿”æ—¶é—´ï¼ˆ<em><strong>RTT</strong></em>ï¼‰å¹¶æ‰“å°å‡ºæ¥ã€‚è¯·æŒ‰ç…§æ ‡å‡†çš„ <em><strong>Ping</strong></em> ç¨‹åºçš„æ¨¡å¼ä¿®æ”¹ã€‚ä½ éœ€è¦åœ¨å®¢æˆ·ç«¯å‘é€å®Œæ‰€æœ‰ <em><strong>Ping</strong></em> æ¶ˆæ¯åæŠ¥å‘Šæœ€å¤§ï¼Œæœ€å°å’Œå¹³å‡çš„ <em><strong>RTT</strong></em>ã€‚å¦å¤–ï¼Œä½ è¿˜éœ€è¦è®¡ç®—å‡ºæ­¤æ¬¡çš„ä¸¢åŒ…ç‡ï¼ˆä½¿ç”¨ç™¾åˆ†æ¯”ï¼‰ã€‚</li><li>å¦ä¸€ä¸ªå’Œ <em><strong>UDPPing</strong></em> ç›¸ä¼¼çš„åº”ç”¨ç¨‹åºæ˜¯ <em><strong>UDPHeartbeat</strong></em> ã€‚<em><strong>UDPHeartbeat</strong></em> å¯ä»¥è¢«ç”¨æ¥æ£€æŸ¥ä¸€ä¸ªåº”ç”¨ç¨‹åºæ˜¯å¦å·²ç»å¯åŠ¨ä¸”æ­£åœ¨è¿è¡Œï¼Œå¹¶æŠ¥å‘Šå•å‘ä¸¢åŒ…ç‡ã€‚å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªåŒ…å«åºåˆ—å·å’Œæ—¶é—´æˆ³çš„ <em><strong>UDP</strong></em> æ•°æ®åŒ…åˆ°æ­£åœ¨ç›‘å¬å®¢æˆ·ç«¯å¿ƒè·³çš„æœåŠ¡å™¨ã€‚å½“æœåŠ¡å™¨æ”¶åˆ°æ•°æ®åŒ…åï¼Œè®¡ç®—æ—¶é—´å·®ï¼ŒæŠ¥å‘Šä¸¢åŒ…ç‡ã€‚å¦‚æœå¿ƒè·³æ•°æ®åŒ…åœ¨é™å®šæ—¶é—´å†…ä¸¢å¤±äº†ï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾å®¢æˆ·ç«¯ç¨‹åºå·²ç»åœæ­¢è¿è¡Œäº†ã€‚å®ç° <em><strong>UDPHeartbeat</strong></em> ï¼ˆåŒ…æ‹¬å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ï¼‰ã€‚ä½ éœ€è¦ä¿®æ”¹æä¾›ç»™ä½ çš„ <code>UDPPingerServer.py</code> å’Œä½ çš„ <em><strong>UDPPing</strong></em> å®¢æˆ·ç«¯ç¨‹åºã€‚</li></ol><h2 id="å¿…åšé¢˜"><a href="#å¿…åšé¢˜" class="headerlink" title="å¿…åšé¢˜"></a>å¿…åšé¢˜</h2><p>ä¸ºäº†æ ¼å¼å¥½çœ‹ä¸€ç‚¹ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©è®© <em><strong>sequence_number</strong></em> ä»0å¼€å§‹ï¼Œä»¥9ç»“æŸï¼Œä¸€å…±10æ¡ <em><strong>Ping</strong></em> æ¶ˆæ¯ã€‚</p><h3 id="å®ç°ä»£ç "><a href="#å®ç°ä»£ç " class="headerlink" title="å®ç°ä»£ç "></a>å®ç°ä»£ç </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">serverName = <span class="string">&#x27;Anya&#x27;</span></span><br><span class="line">serverPort = <span class="number">12000</span></span><br><span class="line">clientSocket = socket(AF_INET, SOCK_DGRAM)</span><br><span class="line">clientSocket.settimeout(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">10</span>):</span><br><span class="line">    sendTime = time.time()</span><br><span class="line">    message = <span class="string">&#x27;Ping &#x27;</span> + <span class="built_in">str</span>(i) + <span class="string">&#x27; &#x27;</span> + time.asctime()</span><br><span class="line">    clientSocket.sendto(message.encode(), (serverName, serverPort))</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        modifiedMessage, serverAddress = clientSocket.recvfrom(<span class="number">2048</span>)</span><br><span class="line">        rtt = time.time() - sendTime</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Sequence %d: %s    RTT = %.3fs&#x27;</span> % (i, modifiedMessage.decode(), rtt)) </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Sequence %d: Request timed out&#x27;</span> % (i))</span><br><span class="line"></span><br><span class="line">clientSocket.close()</span><br></pre></td></tr></table></figure><h3 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h3><p><em><strong>æœåŠ¡å™¨ç«¯ï¼š</strong></em><br>åœ¨ä¸€å°ä¸»æœºä¸Šè¿è¡Œ <code>UDPPingerServer.py</code>ï¼Œä½œä¸ºæ¥æ”¶ <em><strong>Ping</strong></em> ç¨‹åºçš„æœåŠ¡å™¨ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221020123157.png"></p><p><em><strong>å®¢æˆ·ç«¯ï¼š</strong></em><br>åœ¨å¦ä¸€å°ä¸»æœºä¸Šè¿è¡Œ <code>UDPPingerClient.py</code>ï¼Œä½œä¸º <em><strong>Ping</strong></em> ç¨‹åºçš„å®¢æˆ·ç«¯ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221020123533.png"></p>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œè‡ªé¡¶å‘ä¸‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SocketPA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SocketLab1ï¼šWebServe</title>
      <link href="/archives/d13c898c.html"/>
      <url>/archives/d13c898c.html</url>
      
        <content type="html"><![CDATA[<p><em><strong>å®˜æ–¹è‹±æ–‡èµ„æºç½‘ç«™</strong></em> ï¼š<a href="https://media.pearsoncmg.com/ph/esm/ecs_kurose_compnetwork_8/cw/"><em><strong>Pearson Computer Networking: a Top-Down Approach, 8th Edition</strong></em></a></p><p><em><strong>ç›´æ¥ä¸‹è½½</strong></em>ï¼š<a href="https://media.pearsoncmg.com/ph/esm/ecs_kurose_compnetwork_8/cw/content/python-socket-programming-assignments.zip"><em><strong>Python 3 Socket Programming Assignments</strong></em></a></p><p><em><strong>ä»¥ä¸‹å†…å®¹ä¸ºç¬”è€…ç¿»è¯‘</strong></em> ï¼š</p><hr><p>åœ¨è¿™ä¸ªå®éªŒä¸­ï¼Œä½ å°†å­¦ä¹ åœ¨ <em><strong>Python</strong></em> ä¸­ä½¿ç”¨ <em><strong>TCP</strong></em> è¿æ¥çš„å¥—æ¥å­—ç¼–ç¨‹çš„åŸºç¡€ï¼šå¦‚ä½•åˆ›å»ºä¸€ä¸ªå¥—æ¥å­—ï¼Œå°†å…¶ç»‘å®šåœ¨ç‰¹å®šçš„åœ°å€å’Œç«¯å£ä¸Šï¼Œä»¥åŠå‘é€å’Œæ¥æ”¶ä¸€ä¸ª <em><strong>HTTP</strong></em> æ•°æ®åŒ…ã€‚æ­¤å¤–ä½ è¿˜å°†å­¦ä¹ åˆ°ä¸€äº›å…³äº <em><strong>HTTP</strong></em> å¤´éƒ¨æ ¼å¼çš„åŸºç¡€çŸ¥è¯†ã€‚</p><p>ä½ å°†å¼€å‘ä¸€ä¸ªä¸€æ¬¡å¤„ç†ä¸€ä¸ª <em><strong>HTTP</strong></em> è¯·æ±‚çš„ <em><strong>Web</strong></em> æœåŠ¡å™¨ã€‚ä½ çš„ <em><strong>Web</strong></em> æœåŠ¡å™¨åº”è¯¥èƒ½å¤Ÿæ¥æ”¶å’Œè§£æ <em><strong>HTTP</strong></em> è¯·æ±‚ï¼Œç„¶åä»æœåŠ¡å™¨çš„æ–‡ä»¶ç³»ç»Ÿä¸­è·å–æ‰€è¯·æ±‚çš„æ–‡ä»¶ï¼Œåˆ›å»ºä¸€ä¸ªç”±æ‰€è¯·æ±‚æ–‡ä»¶ç»„æˆçš„ï¼Œé¦–éƒ¨è¡Œåœ¨å‰çš„ <em><strong>HTTP</strong></em> å“åº”æŠ¥æ–‡ï¼Œæœ€åå°†å“åº”ç›´æ¥å‘é€ç»™å®¢æˆ·ç«¯ã€‚å¦‚æœæ‰€è¯·æ±‚çš„æ–‡ä»¶ä¸å­˜åœ¨äºæœåŠ¡å™¨ä¸­ï¼Œåˆ™æœåŠ¡è¯·åº”è¯¥å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª <em><strong>â€œ404 Not Foundâ€</strong></em> çš„ <em><strong>HTTP</strong></em> æ¶ˆæ¯ã€‚</p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p>åœ¨ä¸‹é¢ä½ ä¼šæ‰¾åˆ° <em><strong>Web</strong></em> æœåŠ¡å™¨çš„æ¡†æ¶ä»£ç ã€‚ä½ éœ€è¦å®Œå–„è¿™ä¸ªæ¡†æ¶ä»£ç ã€‚é‚£äº›ä½ éœ€è¦å¡«å†™ä»£ç çš„åœ°æ–¹å·²ç»ä½¿ç”¨ <code>#Fill in start</code> å’Œ <code>#Fill in end</code> æ ‡è®°å‡ºæ¥äº†ã€‚æ¯ä¸ªåœ°æ–¹å¯èƒ½éœ€è¦å¡«å†™ä¸€è‡³å¤šè¡Œä»£ç ã€‚</p><h2 id="è¿è¡ŒæœåŠ¡å™¨"><a href="#è¿è¡ŒæœåŠ¡å™¨" class="headerlink" title="è¿è¡ŒæœåŠ¡å™¨"></a>è¿è¡ŒæœåŠ¡å™¨</h2><p>å°† <em><strong>HTML</strong></em> æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼š<code>HelloWorld.html</code> ï¼‰æ”¾åœ¨æœåŠ¡å™¨æ‰€åœ¨çš„ç›®å½•ã€‚è¿è¡ŒæœåŠ¡å™¨ç¨‹åºã€‚ç¡®è®¤è¿è¡ŒæœåŠ¡å™¨çš„ä¸»æœºçš„ <em><strong>IP</strong></em> åœ°å€ï¼ˆä¾‹å¦‚ï¼š <code>128.238.251.26</code> ï¼‰ã€‚ä»å¦å¤–ä¸€ä¸ªä¸»æœºæ‰“å¼€æµè§ˆå™¨å¹¶æä¾›ç›¸åº”çš„ <em><strong>URL</strong></em> é“¾æ¥ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š<code>http://128.238.251.26:6789/HelloWorld.html</code></p><p><em><strong>â€˜HelloWorld.htmlâ€™</strong></em> æ˜¯ä½ æ”¾ç½®åœ¨æœåŠ¡å™¨ç›®å½•çš„æ–‡ä»¶çš„åå­—ã€‚è¿˜è¦æ³¨æ„å†’å·åçš„ç«¯å£å·çš„ä½¿ç”¨ã€‚ä½ éœ€è¦å°†å…¶æ›¿æ¢æˆä½ åœ¨æœåŠ¡å™¨ä»£ç ä¸­æ‰€ä½¿ç”¨çš„ç«¯å£å·ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <em><strong>6789</strong></em> è¿™ä¸ªç«¯å£å·ã€‚æµè§ˆå™¨åº”è¯¥æ˜¾ç¤º <code>HelloWorld.html</code> çš„å†…å®¹ã€‚å¦‚æœä½ çœå»äº† <em><strong>:6789</strong></em>ï¼Œæµè§ˆå™¨ä¼šå‡å®šä½¿ç”¨é»˜è®¤ç«¯å£å·80ï¼Œåªæœ‰å½“ä½ çš„æœåŠ¡å™¨åœ¨ç›‘å¬80å·ç«¯å£æ—¶ï¼Œä½ æ‰èƒ½ä»æœåŠ¡å™¨å¾—åˆ°ç½‘é¡µã€‚</p><p>ç„¶åè¯•å›¾è·å–ä¸€ä¸ªå¹¶ä¸å­˜åœ¨äºæœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ã€‚ä½ ä¼šæ”¶åˆ°ä¸€ä¸ª <em><strong>â€œ404 Not Foundâ€</strong></em> çš„ä¿¡æ¯ã€‚</p><h2 id="éœ€è¦ä¸Šäº¤çš„å†…å®¹"><a href="#éœ€è¦ä¸Šäº¤çš„å†…å®¹" class="headerlink" title="éœ€è¦ä¸Šäº¤çš„å†…å®¹"></a>éœ€è¦ä¸Šäº¤çš„å†…å®¹</h2><p>ä½ éœ€è¦ä¸Šäº¤å®Œæ•´çš„æœåŠ¡å™¨ä»£ç å¹¶é™„å¸¦å®¢æˆ·ç«¯çš„æµè§ˆå™¨æˆªå›¾ï¼Œç”¨äºéªŒè¯ä½ ç¡®å®ä»æœåŠ¡å™¨æ¥æ”¶åˆ°äº† <em><strong>HTML</strong></em> æ–‡ä»¶çš„å†…å®¹ã€‚</p><h2 id="WebæœåŠ¡å™¨çš„Pythonä»£ç æ¡†æ¶"><a href="#WebæœåŠ¡å™¨çš„Pythonä»£ç æ¡†æ¶" class="headerlink" title="WebæœåŠ¡å™¨çš„Pythonä»£ç æ¡†æ¶"></a>WebæœåŠ¡å™¨çš„Pythonä»£ç æ¡†æ¶</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#import socket module</span></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line">serverSocket = socket(AF_INET, SOCK_STREAM) </span><br><span class="line"><span class="comment">#Prepare a sever socket </span></span><br><span class="line"><span class="comment">#Fill in start </span></span><br><span class="line"><span class="comment">#Fill in end </span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:     </span><br><span class="line">    <span class="comment">#Establish the connection    </span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;Ready to serve...&#x27;</span>     </span><br><span class="line">    connectionSocket, addr =   <span class="comment">#Fill in start  #Fill in end</span></span><br><span class="line">    <span class="keyword">try</span>:         </span><br><span class="line">        message =   <span class="comment">#Fill in start  #Fill in end</span></span><br><span class="line">        filename = message.split()[<span class="number">1</span>]                          </span><br><span class="line">        f = <span class="built_in">open</span>(filename[<span class="number">1</span>:])</span><br><span class="line">        outputdata = <span class="comment">#Fill in start  #Fill in end</span></span><br><span class="line">        <span class="comment">#Send one HTTP header line into socket         </span></span><br><span class="line">        <span class="comment">#Fill in start         </span></span><br><span class="line">        <span class="comment">#Fill in end    </span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#Send the content of the requested file to the client</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(outputdata)):</span><br><span class="line">            connectionSocket.send(outputdata[i])</span><br><span class="line">        connectionSocket.close()</span><br><span class="line">    <span class="keyword">except</span> IOError:</span><br><span class="line">        <span class="comment">#Send response message for file not found</span></span><br><span class="line">        <span class="comment">#Fill in start</span></span><br><span class="line">        <span class="comment">#Fill in end</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#Close client socket</span></span><br><span class="line">        <span class="comment">#Fill in start</span></span><br><span class="line">        <span class="comment">#Fill in end             </span></span><br><span class="line">    serverSocket.close()</span><br></pre></td></tr></table></figure><h2 id="å¯é€‰ç»ƒä¹ "><a href="#å¯é€‰ç»ƒä¹ " class="headerlink" title="å¯é€‰ç»ƒä¹ "></a>å¯é€‰ç»ƒä¹ </h2><ol><li><p>ç›®å‰ï¼Œè¿™ä¸ª <em><strong>Web</strong></em> æœåŠ¡å™¨åªæ”¯æŒä¸€æ¬¡å¤„ç†ä¸€ä¸ª <em><strong>HTTP</strong></em> è¯·æ±‚ã€‚è¯·å®ç°ä¸€ä¸ªèƒ½å¤ŸåŒæ—¶å¤„ç†å¤šä¸ªè¯·æ±‚çš„å¤šçº¿ç¨‹æœåŠ¡å™¨ã€‚ä½¿ç”¨çº¿ç¨‹ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªä¸»çº¿ç¨‹åœ¨å›ºå®šç«¯å£ç›‘å¬å®¢æˆ·ç«¯è¯·æ±‚ã€‚å½“æ”¶åˆ°ä¸€ä¸ªä»å®¢æˆ·ç«¯å‘æ¥çš„ <em><strong>TCP</strong></em> è¿æ¥è¯·æ±‚ï¼Œå®ƒå°†é€šè¿‡å¦ä¸€ä¸ªç«¯å£å»ºç«‹ <em><strong>TCP</strong></em> è¿æ¥ï¼Œå¹¶åœ¨å¦å¤–çš„å•ç‹¬çº¿ç¨‹ä¸ºå®¢æˆ·ç«¯è¯·æ±‚æä¾›æœåŠ¡ã€‚è¿™æ ·æ¯ä¸€å¯¹è¯·æ±‚&#x2F;å“åº”ç»„éƒ½ä¼šæœ‰ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹æä¾›ç‹¬ç«‹çš„ <em><strong>TCP</strong></em> è¿æ¥ã€‚</p></li><li><p>ä¸ä½¿ç”¨æµè§ˆå™¨ï¼Œè€Œæ˜¯ç¼–å†™ä½ è‡ªå·±çš„ <em><strong>HTTP</strong></em> å®¢æˆ·ç«¯æ¥æµ‹è¯•ä½ çš„æœåŠ¡å™¨ã€‚ä½ çš„å®¢æˆ·ç«¯å°†ä¼šé€šè¿‡ <em><strong>TCP</strong></em> æ¥è¿æ¥æœåŠ¡å™¨ï¼Œå‘é€ä¸€ä¸ª <em><strong>HTTP</strong></em> è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œå¹¶å°†æœåŠ¡å™¨å“åº”ä½œä¸ºè¾“å‡ºæ¥å±•ç¤ºã€‚ä½ å¯ä»¥å‡è®¾å‘é€çš„ <em><strong>HTTP</strong></em> è¯·æ±‚ä½¿ç”¨ <em><strong>GET</strong></em> æ–¹æ³•ã€‚å®¢æˆ·ç«¯åº”è¯¥ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°æ¥æŒ‡å®šæœåŠ¡å™¨ <em><strong>IP</strong></em> åœ°å€æˆ–ä¸»æœºåï¼Œå’ŒæœåŠ¡å™¨æ­£åœ¨ç›‘å¬çš„ç«¯å£å·ï¼Œè¿˜æœ‰è¢«è¯·æ±‚å¯¹è±¡è¢«è£…è½½åœ¨æœåŠ¡å™¨ä¸Šçš„è·¯å¾„ã€‚ä»¥ä¸‹æ˜¯è¿è¡Œå®¢æˆ·ç«¯çš„è¾“å…¥å‘½ä»¤æ ¼å¼:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">client.py server_host server_port filename</span><br></pre></td></tr></table></figure></li></ol><h2 id="å¿…åšé¢˜"><a href="#å¿…åšé¢˜" class="headerlink" title="å¿…åšé¢˜"></a>å¿…åšé¢˜</h2><p>ç”±äºæˆ‘æ²¡æœ‰ä¸¤å°ç”µè„‘ï¼Œæ‰€ä»¥æˆ‘é‡‡ç”¨çš„æ˜¯ç”¨è™šæ‹Ÿæœºä½œä¸ºæœåŠ¡å™¨ï¼Œç‰©ç†æœºä½œä¸ºå®¢æˆ·ç«¯çš„æ–¹æ³•è¿›è¡Œå®éªŒçš„ï¼Œäº²æµ‹å¯è¡Œã€‚</p><h3 id="å®ç°ä»£ç "><a href="#å®ç°ä»£ç " class="headerlink" title="å®ç°ä»£ç "></a>å®ç°ä»£ç </h3><p><code>WebServer.py</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#import socket module</span></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line">serverSocket = socket(AF_INET, SOCK_STREAM) </span><br><span class="line"><span class="comment">#Prepare a sever socket </span></span><br><span class="line"><span class="comment">#Fill in start </span></span><br><span class="line">serverSocket.bind((<span class="string">&#x27;&#x27;</span>, <span class="number">1300</span>)) <span class="comment"># Bind the TCP welcome socket to the default port</span></span><br><span class="line">serverSocket.listen(<span class="number">1</span>)</span><br><span class="line"><span class="comment">#Fill in end </span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;The serve is ready to receive.&#x27;</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:     </span><br><span class="line">    <span class="comment">#Establish the connection    </span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Ready to serve...&#x27;</span>)   </span><br><span class="line">    connectionSocket, addr = serverSocket.accept()</span><br><span class="line">    <span class="keyword">try</span>:         </span><br><span class="line">        message = connectionSocket.recv(<span class="number">1024</span>).decode()</span><br><span class="line">        filename = message.split()[<span class="number">1</span>]                          </span><br><span class="line">        f = <span class="built_in">open</span>(filename[<span class="number">1</span>:])</span><br><span class="line">        outputdata = f.read()</span><br><span class="line">        <span class="comment">#Send one HTTP header line into socket         </span></span><br><span class="line">        <span class="comment">#Fill in start     </span></span><br><span class="line">        header = <span class="string">&#x27; HTTP/1.1 200 OK\nConnection: close\nContent-Type: text/html\nContent-Length: %d\n\n&#x27;</span> % (<span class="built_in">len</span>(outputdata)) </span><br><span class="line">        connectionSocket.send(header.encode())   </span><br><span class="line">        <span class="comment">#Fill in end    </span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#Send the content of the requested file to the client</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(outputdata)):</span><br><span class="line">            connectionSocket.send(outputdata[i].encode())</span><br><span class="line">        connectionSocket.close()</span><br><span class="line">    <span class="keyword">except</span> IOError:</span><br><span class="line">        <span class="comment">#Send response message for file not found</span></span><br><span class="line">        <span class="comment">#Fill in start</span></span><br><span class="line">        header = <span class="string">&#x27; HTTP/1.1 404 Not Found&#x27;</span></span><br><span class="line">        connectionSocket.send(header.encode())   </span><br><span class="line">        <span class="comment">#Fill in end</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#Close client socket</span></span><br><span class="line">        <span class="comment">#Fill in start</span></span><br><span class="line">        connectionSocket.close()</span><br><span class="line">        <span class="comment">#Fill in end             </span></span><br><span class="line">serverSocket.close()</span><br></pre></td></tr></table></figure><p><code>HelloWorld.html</code>:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span>Hello world!<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h3><p><em><strong>æœåŠ¡å™¨ç«¯ï¼š</strong></em><br>åœ¨ä¸€å°ä¸»æœºçš„åŒä¸€ç›®å½•ä¸‹æ”¾ä¸Š <code>WebServer.py</code> å’Œ <code>HelloWorld.html</code> ä¸¤ä¸ªæ–‡ä»¶ï¼Œå¹¶è¿è¡Œ <code>WebServer.py</code> ä½œä¸ºæœåŠ¡å™¨ã€‚<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221016093057.png"></p><p><em><strong>å®¢æˆ·ç«¯ï¼š</strong></em><br>åœ¨å¦ä¸€å°ä¸»æœºçš„æµè§ˆå™¨ä¸Šè¾“å…¥ <code>http://XXX.XXX.XXX.XXX:1300/HelloWorld.html</code> (å…¶ä¸­ <em><strong>XXX.XXX.XXX.XXX</strong></em> æ˜¯ä½ æ‰€é€‰æ‹©çš„æœåŠ¡å™¨çš„ <em><strong>IP</strong></em> åœ°å€)<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221016093614.png"></p><p>å¦‚æœè¾“å…¥ <code>http://XXX.XXX.XXX.XXX:1300/Nothing.html</code>ï¼Œæ¥å°è¯•è·å–æœåŠ¡å™¨å¹¶ä¸å­˜åœ¨çš„æ–‡ä»¶ <code>Nothing.html</code>ï¼Œå°†ä¼šæ”¶åˆ°ä¸€ä¸ª <em><strong>HTTP ERROR 404</strong></em> ä¿¡æ¯ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221016093928.png"></p>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œè‡ªé¡¶å‘ä¸‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SocketPA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PA3å®éªŒç¬”è®°</title>
      <link href="/archives/7c883405.html"/>
      <url>/archives/7c883405.html</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>PAæ˜¯NJU ICSçš„è¯¾ç¨‹å®éªŒï¼Œä½œä¸ºä¸€ä¸ªéç§‘ç­çš„å­¦ç”Ÿï¼Œè¦å®Œæˆè¿™ä¸ªå®éªŒå±å®ä¸æ˜“ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘æ”¶è·åˆ°çš„çŸ¥è¯†å’Œç»éªŒæ— ç–‘æ˜¯æˆ‘æ±‚å­¦è·¯ä¸Šæ— æ¯”å®è´µçš„è´¢å¯Œã€‚ä¸ºäº†è®°å½•ä¸‹è¿™å®è´µçš„ç»å†ï¼Œæ•…å†™æ­¤åšå®¢è®°å½•ä¸‹æˆ‘çš„è‹¦æ¼ä¸æ„Ÿæ‚Ÿã€‚åœ¨è¿™ç¯‡åšå®¢é‡Œæˆ‘ä¼šç®€å•å™è¿°æˆ‘çš„æ€è·¯å’Œè¸©è¿‡çš„å‘ã€‚<strong><em>å¦å¤–ç‰¹æ­¤å£°æ˜ï¼Œå¦‚æœæ‚¨æœ¬èº«éœ€è¦ç‹¬è‡ªå®ŒæˆPAå®éªŒï¼Œä¸ºäº†å­¦æœ¯è¯šä¿¡ï¼Œè¯·è‡ªè¡Œå®Œæˆåå†å‚è€ƒæœ¬åšå®¢ï¼Œä»Šæ—¥å·çš„æ‡’ï¼Œåœ¨æœªæ¥ä¼šåŠ å€å¿è¿˜ï¼</em></strong></p><h1 id="æœ€ç®€å•çš„æ“ä½œç³»ç»Ÿ"><a href="#æœ€ç®€å•çš„æ“ä½œç³»ç»Ÿ" class="headerlink" title="æœ€ç®€å•çš„æ“ä½œç³»ç»Ÿ"></a>æœ€ç®€å•çš„æ“ä½œç³»ç»Ÿ</h1><p>åœ¨ <strong><em>PA</em></strong> ä¸­ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿå« <strong><em>Nanos-lite</em></strong> , å®ƒæ˜¯å—äº¬å¤§å­¦æ“ä½œç³»ç»Ÿ <strong><em>Nanos</em></strong> çš„è£å‰ªç‰ˆã€‚æ˜¯ä¸€ä¸ªä¸º <strong><em>PA</em></strong> é‡èº«è®¢é€ çš„æ“ä½œç³»ç»Ÿã€‚  </p><p><strong><em>Nanos-lite</em></strong> æ˜¯è¿è¡Œåœ¨ <strong><em>AM</em></strong> ä¹‹ä¸Š, <strong><em>AM</em></strong> çš„ <strong><em>API</em></strong> åœ¨ <strong><em>Nanos-lite</em></strong> ä¸­éƒ½æ˜¯å¯ç”¨çš„ã€‚è™½ç„¶æ“ä½œç³»ç»Ÿå¯¹æˆ‘ä»¬æ¥è¯´æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ¦‚å¿µ, ä½†åœ¨ <strong><em>AM</em></strong> çœ‹æ¥, å®ƒåªæ˜¯ä¸€ä¸ªè°ƒç”¨ <strong><em>AM API</em></strong> çš„ <strong><em>æ™®é€šCç¨‹åº</em></strong> è€Œå·², å’Œè¶…çº§ç›ä¸½æ²¡ä»€ä¹ˆåŒºåˆ«ã€‚</p><p>ç›®å‰æˆ‘ä»¬çš„æ“ä½œç³»ç»Ÿçš„åŠŸèƒ½è¿˜ååˆ†ç®€é™‹ï¼Œä½†æˆ‘ä»¬å¯ä»¥å…ˆè¿è¡Œä¸€ä¸‹å®ƒæ¥çœ‹çœ‹ <strong><em>logo</em></strong>ï¼š</p><p>åœ¨ <strong><em>nanos-lite/</em></strong> ç›®å½•ä¸‹æ‰§è¡Œ<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make ARCH=<span class="variable">$ISA</span>-nemu run</span><br></pre></td></tr></table></figure><br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/5$Z3_0QW5`BEANL7UD@SJ(V.png" alt=""></p><p>å¦‚æœä½ æ²¡èƒ½é¡ºåˆ©å‡ºç° <strong><em>Nanos-lite</em></strong> çš„ <strong><em>logo</em></strong>ï¼Œå¤§æ¦‚æ˜¯è¿˜æœ‰ä¸€äº›æŒ‡ä»¤ä½ æ²¡æœ‰å®ç°ã€‚ç›¸ä¿¡éƒ½åˆ°è¿™ä¸ªé˜¶æ®µäº†ï¼Œå®ç°æŒ‡ä»¤å¯¹ä½ æ¥è¯´åº”è¯¥ä¸æˆé—®é¢˜ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªä¸é‚£ä¹ˆå®¹æ˜“å¯Ÿè§‰åˆ°çš„å‘ï¼Œå°±æ˜¯è¾“å‡º <strong><em>logo</em></strong> æ—¶å®é™…ä¼šè°ƒç”¨æˆ‘ä»¬ <strong><em>klib</em></strong> ä¸­çš„ <strong><em>printf</em></strong>ã€‚å¦‚æœä½ ç»™ <strong><em>printf</em></strong> è®¾ç½®çš„å†…ç½® <strong><em>buf</em></strong> ä¸å¤Ÿå¤§ï¼Œå¾ˆå¯èƒ½ä¼šå‡ºç°ç¼“å†²åŒºæº¢å‡ºçš„æƒ…å†µï¼Œä»è€Œå‡ºç°è·Ÿ <strong><em>ref</em></strong> å®Œå…¨ä¸åŒçš„è¡Œä¸ºã€‚</p><h1 id="ç©¿è¶Šæ—¶ç©ºçš„æ—…ç¨‹"><a href="#ç©¿è¶Šæ—¶ç©ºçš„æ—…ç¨‹" class="headerlink" title="ç©¿è¶Šæ—¶ç©ºçš„æ—…ç¨‹"></a>ç©¿è¶Šæ—¶ç©ºçš„æ—…ç¨‹</h1><p><strong><em>riscv32</em></strong> æä¾› <strong><em>ecall</em></strong> æŒ‡ä»¤ä½œä¸ºè‡ªé™·æŒ‡ä»¤, å¹¶æä¾›ä¸€ä¸ª <strong><em>mtvec</em></strong> å¯„å­˜å™¨æ¥å­˜æ”¾å¼‚å¸¸å…¥å£åœ°å€ã€‚ä¸ºäº†ä¿å­˜ç¨‹åºå½“å‰çš„çŠ¶æ€, <strong><em>riscv32</em></strong> æä¾›äº†ä¸€äº›ç‰¹æ®Šçš„ç³»ç»Ÿå¯„å­˜å™¨, å« <strong><em>æ§åˆ¶çŠ¶æ€å¯„å­˜å™¨(CSRå¯„å­˜å™¨)</em></strong> ã€‚åœ¨ <strong><em>PA</em></strong> ä¸­, æˆ‘ä»¬åªä½¿ç”¨å¦‚ä¸‹3ä¸ª <strong><em>CSR</em></strong> å¯„å­˜å™¨:</p><ul><li><strong><em>mepc</em></strong> å¯„å­˜å™¨ - å­˜æ”¾è§¦å‘å¼‚å¸¸çš„PC</li><li><strong><em>mstatus</em></strong> å¯„å­˜å™¨ - å­˜æ”¾å¤„ç†å™¨çš„çŠ¶æ€</li><li><strong><em>mcause</em></strong> å¯„å­˜å™¨ - å­˜æ”¾è§¦å‘å¼‚å¸¸çš„åŸå› </li></ul><p><strong><em>riscv32</em></strong> è§¦å‘å¼‚å¸¸åç¡¬ä»¶çš„å“åº”è¿‡ç¨‹å¦‚ä¸‹:</p><ol><li>å°†å½“å‰ <strong><em>PC</em></strong> å€¼ä¿å­˜åˆ° <strong><em>mepc</em></strong> å¯„å­˜å™¨</li><li>åœ¨ <strong><em>mcause</em></strong> å¯„å­˜å™¨ä¸­è®¾ç½®å¼‚å¸¸å·</li><li>ä» <strong><em>mtvec</em></strong> å¯„å­˜å™¨ä¸­å–å‡ºå¼‚å¸¸å…¥å£åœ°å€</li><li>è·³è½¬åˆ°å¼‚å¸¸å…¥å£åœ°å€</li></ol><p>ç­‰åˆ°å¼‚å¸¸å¤„ç†ç»“æŸä¹‹å, å°±æ ¹æ®ä¹‹å‰ä¿å­˜çš„ä¿¡æ¯æ¢å¤ç¨‹åºçš„çŠ¶æ€, å¹¶ä»å¼‚å¸¸å¤„ç†è¿‡ç¨‹ä¸­è¿”å›åˆ°ç¨‹åºè§¦å‘å¼‚å¸¸ä¹‹å‰çš„çŠ¶æ€. å…·ä½“åœ°ï¼š</p><ul><li><strong><em>riscv32</em></strong> é€šè¿‡ <strong><em>mret</em></strong> æŒ‡ä»¤ä»å¼‚å¸¸å¤„ç†è¿‡ç¨‹ä¸­è¿”å›, å®ƒå°†æ ¹æ® <strong><em>mepc</em></strong> å¯„å­˜å™¨æ¢å¤ <strong><em>PC</em></strong>ã€‚</li></ul><h1 id="å°†ä¸Šä¸‹æ–‡ç®¡ç†æŠ½è±¡æˆCTE"><a href="#å°†ä¸Šä¸‹æ–‡ç®¡ç†æŠ½è±¡æˆCTE" class="headerlink" title="å°†ä¸Šä¸‹æ–‡ç®¡ç†æŠ½è±¡æˆCTE"></a>å°†ä¸Šä¸‹æ–‡ç®¡ç†æŠ½è±¡æˆCTE</h1><p>æˆ‘ä»¬å¯ä»¥å°†ä¸Šä¸‹æ–‡ç®¡ç†çš„åŠŸèƒ½åˆ’å…¥åˆ° <strong><em>AM</em></strong> çš„ä¸€ç±»æ–°çš„ <strong><em>API</em></strong> ä¸­, åå­—å« <strong><em>CTE(ConText Extension)</em></strong> ã€‚</p><h2 id="è§¦å‘è‡ªé™·æ“ä½œ"><a href="#è§¦å‘è‡ªé™·æ“ä½œ" class="headerlink" title="è§¦å‘è‡ªé™·æ“ä½œ"></a>è§¦å‘è‡ªé™·æ“ä½œ</h2><p>ä¸ºäº†æµ‹è¯•å¼‚å¸¸å…¥å£åœ°å€æ˜¯å¦å·²ç»è®¾ç½®æ­£ç¡®, æˆ‘ä»¬è¿˜éœ€è¦çœŸæ­£è§¦å‘ä¸€æ¬¡è‡ªé™·æ“ä½œã€‚å®šä¹‰äº†å® <strong><em>HAS_CTE</em></strong> å, <strong><em>Nanos-lite</em></strong> ä¼šåœ¨ <strong><em>panic()</em></strong> å‰è°ƒç”¨ <strong><em>yield()</em></strong> æ¥è§¦å‘è‡ªé™·æ“ä½œã€‚</p><p>ä¸ºäº†æ”¯æ’‘è¿™æ¬¡è‡ªé™·æ“ä½œ, ä½ éœ€è¦åœ¨ <strong><em>NEMU</em></strong> ä¸­å®ç° <strong><em>isa_raise_intr()</em></strong> å‡½æ•° <strong><em>(åœ¨nemu/src/isa/$ISA/system/intr.cä¸­å®šä¹‰)</em></strong> æ¥æ¨¡æ‹Ÿä¸Šæ–‡æåˆ°çš„å¼‚å¸¸å“åº”æœºåˆ¶ã€‚</p><p>å…·ä½“åœ°ï¼Œå¦‚ä½•åˆ¤æ–­æˆ‘ä»¬è¿›å…¥äº†æ­£ç¡®çš„å¼‚å¸¸å…¥å£åœ°å€ã€‚è®©æˆ‘ä»¬å…·ä½“åœ°çœ‹çœ‹ <strong><em>cte_init</em></strong> æ˜¯å¦‚ä½•è®¾ç½®å¼‚å¸¸å…¥å£åœ°å€çš„ã€‚<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">asm</span> <span class="title function_">volatile</span><span class="params">(<span class="string">&quot;csrw mtvec, %0&quot;</span> : : <span class="string">&quot;r&quot;</span>(__am_asm_trap))</span>;</span><br></pre></td></tr></table></figure><br>è¿™é‡Œæ¶‰åŠäº†ä¸€ç‚¹å†…è”æ±‡ç¼–çš„çŸ¥è¯†ï¼Œç®€å•æ¥è¯´å°±æ˜¯æŠŠ <strong><em>__am_asm_trap</em></strong> çš„å‡½æ•°åœ°å€èµ‹ç»™ <strong><em>%0</em></strong>ï¼Œç„¶åå†æ‰§è¡Œè¿™æ¡æ±‡ç¼–è¯­å¥ã€‚è¿™ä¸ªæ—¶å€™ <strong><em>mtvec</em></strong> å°±æ­£ç¡®åœ°è¢«è®¾ç½®ä¸Šäº†å¼‚å¸¸å¤„ç†å‡½æ•°åœ°å…¥å£åœ°å€ï¼Œè‡³æ­¤ <strong><em>OS</em></strong>  å®Œæˆäº†æ³¨å†Œå¼‚å¸¸å…¥å£åœ°å€çš„è¡Œä¸ºã€‚</p><p>å› æ­¤æˆ‘ä»¬åªéœ€è¦è§‚å¯Ÿç¨‹åºæ˜¯å¦è¿›å…¥åˆ°äº† <strong><em>__am_asm_trap</em></strong> å†…éƒ¨å³å¯ã€‚</p><h2 id="ä¿å­˜ä¸Šä¸‹æ–‡"><a href="#ä¿å­˜ä¸Šä¸‹æ–‡" class="headerlink" title="ä¿å­˜ä¸Šä¸‹æ–‡"></a>ä¿å­˜ä¸Šä¸‹æ–‡</h2><p>è¿™éƒ¨åˆ†çš„ä»»åŠ¡éœ€è¦æˆ‘ä»¬æ ¹æ® <strong><em>trap.S</em></strong> çš„æ±‡ç¼–å†…å®¹é‡æ–°ç»„ç»‡ <strong><em>Contextç»“æ„ä½“</em></strong>ã€‚ç®€å•æ¥è¯´å°±æ˜¯ç†è§£ <strong><em>riscv32</em></strong> åœ¨æ±‡ç¼–å±‚é¢ä¸Šç»“æ„ä½“æ˜¯å¦‚ä½•å­˜æ”¾åœ¨æ ˆä¸­çš„ã€‚</p><p><strong><em>Contextç»“æ„ä½“</em></strong>ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Context</span> &#123;</span></span><br><span class="line">  <span class="comment">// <span class="doctag">TODO:</span> fix the order of these members to match trap.S</span></span><br><span class="line">  <span class="type">uintptr_t</span> gpr[<span class="number">32</span>], mcause, mstatus, mepc;</span><br><span class="line">  <span class="type">void</span> *pdir;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>æ±‡ç¼–ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">#define concat_temp(x, y) x ## y</span><br><span class="line">#define concat(x, y) concat_temp(x, y)</span><br><span class="line">#define MAP(c, f) c(f)</span><br><span class="line"></span><br><span class="line">#if __riscv_xlen == 32</span><br><span class="line">#define LOAD  lw</span><br><span class="line">#define STORE sw</span><br><span class="line">#define XLEN  4</span><br><span class="line">#else</span><br><span class="line">#define LOAD  ld</span><br><span class="line">#define STORE sd</span><br><span class="line">#define XLEN  8</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">#define REGS(f) \</span><br><span class="line">      f( 1)       f( 3) f( 4) f( 5) f( 6) f( 7) f( 8) f( 9) \</span><br><span class="line">f(10) f(11) f(12) f(13) f(14) f(15) f(16) f(17) f(18) f(19) \</span><br><span class="line">f(20) f(21) f(22) f(23) f(24) f(25) f(26) f(27) f(28) f(29) \</span><br><span class="line">f(30) f(31)</span><br><span class="line"></span><br><span class="line">#define PUSH(n) STORE concat(x, n), (n * XLEN)(sp);</span><br><span class="line">#define POP(n)  LOAD  concat(x, n), (n * XLEN)(sp);</span><br><span class="line"></span><br><span class="line">#define CONTEXT_SIZE  ((32 + 3 + 1) * XLEN)</span><br><span class="line">#define OFFSET_SP     ( 2 * XLEN)</span><br><span class="line">#define OFFSET_CAUSE  (32 * XLEN)</span><br><span class="line">#define OFFSET_STATUS (33 * XLEN)</span><br><span class="line">#define OFFSET_EPC    (34 * XLEN)</span><br><span class="line"></span><br><span class="line">.align 3</span><br><span class="line">.globl __am_asm_trap</span><br><span class="line">__am_asm_trap:</span><br><span class="line">  addi sp, sp, -CONTEXT_SIZE</span><br><span class="line"></span><br><span class="line">  MAP(REGS, PUSH)</span><br><span class="line"></span><br><span class="line">  csrr t0, mcause</span><br><span class="line">  csrr t1, mstatus</span><br><span class="line">  csrr t2, mepc</span><br><span class="line"></span><br><span class="line">  STORE t0, OFFSET_CAUSE(sp)</span><br><span class="line">  STORE t1, OFFSET_STATUS(sp)</span><br><span class="line">  STORE t2, OFFSET_EPC(sp)</span><br></pre></td></tr></table></figure></p><p>ç®€å•å¯¹æ¯”ä¸€ä¸‹å°±å¯ä»¥å‘ç°åœ¨ <strong><em>trap.S</em></strong> é‡Œæ˜¯å…ˆå¡32ä¸ªé€šç”¨å¯„å­˜å™¨ï¼Œå†å¡ <strong><em>mcause</em></strong>ï¼Œç„¶åå¡ <strong><em>mstatus</em></strong>ï¼Œæœ€åå¡ <strong><em>mepc</em></strong> çš„ã€‚</p><p>æˆ‘ä»¬åªéœ€è¦ä¿è¯ç»“æ„ä½“ä¸­æ˜¯æŒ‰è¿™ä¸ªé¡ºåºæ’æ”¾å˜é‡çš„å³å¯ã€‚</p><h2 id="äº‹ä»¶åˆ†å‘"><a href="#äº‹ä»¶åˆ†å‘" class="headerlink" title="äº‹ä»¶åˆ†å‘"></a>äº‹ä»¶åˆ†å‘</h2><p>è¿™ä¸ªå…¶å®å¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦åº·åº·æ–‡æ¡£å°±å¯ä»¥äº†ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">man 2 syscall</span><br></pre></td></tr></table></figure><br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/L}B~K[TY5~MI~BZH(_08D`M.png" alt=""></p><p>ä»æ–‡æ¡£ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ° <strong><em>RISCV</em></strong> çš„ <strong><em>abi</em></strong> è§„çº¦ï¼Œ<strong><em>a7</em></strong> å¯„å­˜å™¨å°±æ˜¯ç”¨æ¥å­˜æ”¾å¼‚å¸¸å·çš„ã€‚çŸ¥é“äº†è¿™ç‚¹äº‹ä»¶åˆ†å‘å°±æ²¡ä»€ä¹ˆå›°éš¾çš„äº†ã€‚</p><h2 id="æ¢å¤ä¸Šä¸‹æ–‡"><a href="#æ¢å¤ä¸Šä¸‹æ–‡" class="headerlink" title="æ¢å¤ä¸Šä¸‹æ–‡"></a>æ¢å¤ä¸Šä¸‹æ–‡</h2><p>ä»£ç å°†ä¼šä¸€è·¯ä» <strong><em>__am_irq_handle()</em></strong> è¿”å›åˆ° <strong><em>trap.S</em></strong> çš„  <strong><em>__am_asm_trap()</em></strong> ä¸­, æ¥ä¸‹æ¥çš„äº‹æƒ…å°±æ˜¯æ¢å¤ç¨‹åºçš„ä¸Šä¸‹æ–‡ã€‚</p><p>å¯¹äº <strong><em>mips32</em></strong> çš„ <strong><em>syscall</em></strong> å’Œ <strong><em>riscv32</em></strong> çš„ <strong><em>ecall</em></strong> , ä¿å­˜çš„æ˜¯è‡ªé™·æŒ‡ä»¤çš„ <strong><em>PC</em></strong> , å› æ­¤éœ€è¦åœ¨é€‚å½“çš„åœ°æ–¹å¯¹ä¿å­˜çš„ <strong><em>PC</em></strong> åŠ ä¸Š4, ä½¿å¾—å°†æ¥è¿”å›åˆ°è‡ªé™·æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚</p><div class="note primary modern"><p><strong><em>ä»åŠ  4 æ“ä½œçœ‹ CISC å’Œ RISC</em></strong><br>æˆ‘ä»¬å¿…é¡»è¦è€ƒè™‘ï¼Œå†³å®šè¦ä¸è¦åŠ 4çš„æ“ä½œåˆ°åº•æ˜¯äº¤ç»™ç¡¬ä»¶æ¥åšè¿˜æ˜¯è½¯ä»¶æ¥åšå‘¢ï¼Ÿ <strong><em>CISC</em></strong> å’Œ <strong><em>RISC</em></strong> çš„åšæ³•æ­£å¥½ç›¸å, <strong><em>CISC</em></strong> éƒ½äº¤ç»™ç¡¬ä»¶æ¥åš, è€Œ <strong><em>RISC</em></strong> åˆ™äº¤ç»™è½¯ä»¶æ¥åšã€‚</p></div><p>å¯ä¸è¦å°çœ‹äº†è¿™é‡Œçš„åŒºåˆ«ï¼Œå¦‚æœä½ æ²¡æœ‰ä»”ç»†é˜…è¯»è¿™é‡Œçš„è¯ï¼Œé‚£ä¹ˆä½ çš„ <strong><em>difftest</em></strong> å¤šåŠæ˜¯è¿‡ä¸å»çš„ã€‚ä¸ªä¸­ç¼˜ç”±è¿˜è¯·ä½ å¥½å¥½æ€è€ƒä¸€ä¸‹ã€‚</p><h2 id="å¼‚å¸¸å¤„ç†çš„è¸ªè¿¹-etrace"><a href="#å¼‚å¸¸å¤„ç†çš„è¸ªè¿¹-etrace" class="headerlink" title="å¼‚å¸¸å¤„ç†çš„è¸ªè¿¹ - etrace"></a>å¼‚å¸¸å¤„ç†çš„è¸ªè¿¹ - etrace</h2><p>è¿™ä¸ªè·Ÿæˆ‘ä»¬å‰é¢å®ç°çš„ <strong><em>trace</em></strong> æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œä¸æ˜¯ä»€ä¹ˆéš¾é¢˜ã€‚</p><h1 id="ç”¨æˆ·ç¨‹åºå’Œç³»ç»Ÿè°ƒç”¨"><a href="#ç”¨æˆ·ç¨‹åºå’Œç³»ç»Ÿè°ƒç”¨" class="headerlink" title="ç”¨æˆ·ç¨‹åºå’Œç³»ç»Ÿè°ƒç”¨"></a>ç”¨æˆ·ç¨‹åºå’Œç³»ç»Ÿè°ƒç”¨</h1><p>ç°åœ¨æˆ‘ä»¬æ¥è§£å†³å®ç°æ‰¹å¤„ç†ç³»ç»Ÿçš„ç¬¬äºŒä¸ªé—®é¢˜: å¦‚ä½•åŠ è½½ç”¨æˆ·ç¨‹åºã€‚</p><h2 id="åŠ è½½ç¬¬ä¸€ä¸ªç”¨æˆ·ç¨‹åº"><a href="#åŠ è½½ç¬¬ä¸€ä¸ªç”¨æˆ·ç¨‹åº" class="headerlink" title="åŠ è½½ç¬¬ä¸€ä¸ªç”¨æˆ·ç¨‹åº"></a>åŠ è½½ç¬¬ä¸€ä¸ªç”¨æˆ·ç¨‹åº</h2><p>åœ¨æ“ä½œç³»ç»Ÿä¸­, åŠ è½½ç”¨æˆ·ç¨‹åºæ˜¯ç”± <strong><em>loader(åŠ è½½å™¨)</em></strong> æ¨¡å—è´Ÿè´£çš„ã€‚åŠ è½½çš„è¿‡ç¨‹å°±æ˜¯æŠŠå¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„ä»£ç å’Œæ•°æ®æ”¾ç½®åœ¨æ­£ç¡®çš„å†…å­˜ä½ç½®, ç„¶åè·³è½¬åˆ°ç¨‹åºå…¥å£, ç¨‹åºå°±å¼€å§‹æ‰§è¡Œäº†ã€‚ç®€å•æ¥è¯´ï¼Œå®ç° <strong><em>loader</em></strong> çš„æœ€å¤§å›°éš¾å°±åœ¨äºå¦‚ä½•è§£æ <strong><em>ELF</em></strong> æ–‡ä»¶ã€‚å¼„æ‡‚äº†è¿™ç‚¹ï¼Œå®ç° <strong><em>loader</em></strong> å°±æ²¡ä»€ä¹ˆå›°éš¾äº†ã€‚</p><p>å½“ç„¶ï¼Œè¦åŠ è½½ç”¨æˆ·ç¨‹åºï¼Œé¦–å…ˆå¾—è§£å†³ç”¨æˆ·ç¨‹åºä»å“ªé‡Œæ¥çš„é—®é¢˜ã€‚ç”¨æˆ·ç¨‹åºè¿è¡Œåœ¨æ“ä½œç³»ç»Ÿä¹‹ä¸Š, ç”±äºè¿è¡Œæ—¶ç¯å¢ƒçš„å·®å¼‚, æˆ‘ä»¬ä¸èƒ½æŠŠç¼–è¯‘åˆ° <strong><em>AM</em></strong> ä¸Šçš„ç¨‹åºæ”¾åˆ°æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä¸èƒ½æŠŠ <strong><em>AMï¼ˆé©±åŠ¨å±‚ï¼‰</em></strong> çš„æ¥å£ç›´æ¥æš´éœ²ç»™ç”¨æˆ·ï¼Œå¦åˆ™å°±å¤ªå±é™©äº†ã€‚ä¸ºæ­¤, æˆ‘ä»¬å‡†å¤‡äº†ä¸€ä¸ªæ–°çš„å­é¡¹ç›®<br><strong><em>Navy-apps</em></strong> , ä¸“é—¨ç”¨äºç¼–è¯‘å‡ºæ“ä½œç³»ç»Ÿçš„ç”¨æˆ·ç¨‹åºã€‚</p><p>ç”¨æˆ·ç¨‹åºçš„å…¥å£ä½äº <code>navy-apps/libs/libos/src/crt0/start/$ISA.S</code> ä¸­çš„ <strong><em>_start()</em></strong> å‡½æ•°, è¿™é‡Œçš„ <strong><em>crt</em></strong> æ˜¯ <strong><em>C RunTime</em></strong> çš„ç¼©å†™, 0çš„å«ä¹‰è¡¨ç¤ºæœ€å¼€å§‹. <strong><em>_start()</em></strong> å‡½æ•°ä¼šè°ƒç”¨ <code>navy-apps/libs/libos/src/crt0/crt0.c</code> ä¸­çš„ <strong><em>call_main()</em></strong> å‡½æ•°, ç„¶åè°ƒç”¨ç”¨æˆ·ç¨‹åºçš„ <strong><em>main()</em></strong> å‡½æ•°, ä» <strong><em>main()</em></strong> å‡½æ•°è¿”å›åä¼šè°ƒç”¨ <strong><em>exit()</em></strong> ç»“æŸè¿è¡Œã€‚</p><p>è¿™å…¶å®è·ŸçœŸå®çš„ <strong><em>linux</em></strong> æ‰§è¡Œ <strong><em>c</em></strong> ç¨‹åºçš„è¿‡ç¨‹éå¸¸çš„ç›¸ä¼¼ï¼Œä¹Ÿå¤§è‡´æè¿°äº†æ­£å¸¸çš„ <strong><em>c</em></strong> ç¨‹åºçš„å…¥å£å‡½æ•°å…¶å®å¹¶é <strong><em>main()</em></strong> å‡½æ•°ã€‚</p><p>è®©æˆ‘ä»¬å…ˆæ¥æ¢³ç†ä¸€ä¸‹å®ç° <strong><em>loader</em></strong> éœ€è¦è§£å†³çš„é—®é¢˜ï¼š</p><ol><li>å¯æ‰§è¡Œæ–‡ä»¶åœ¨å“ªé‡Œ?</li><li>ä»£ç å’Œæ•°æ®åœ¨å¯æ‰§è¡Œæ–‡ä»¶çš„å“ªä¸ªä½ç½®?</li><li>ä»£ç å’Œæ•°æ®æœ‰å¤šå°‘?</li><li>â€œæ­£ç¡®çš„å†…å­˜ä½ç½®â€åœ¨å“ªé‡Œ?</li></ol><p>ç¬¬ä¸€ä¸ªé—®é¢˜å·²ç»å¯ä»¥è§£å†³äº†ï¼Œé‡ç‚¹åœ¨ç¬¬äºŒç¬¬ä¸‰ä¸ªé—®é¢˜ä¸Šã€‚æˆ‘ä»¬å¿…é¡»è¦å¼„æ˜ç™½å¯æ‰§è¡Œæ–‡ä»¶çš„ç»“æ„ï¼Œæ‰èƒ½æ­£ç¡®çš„åŠ è½½ç”¨æˆ·ç¨‹åºã€‚ç”±äºæˆ‘ä»¬æ˜¯åœ¨ <strong><em>linux</em></strong> ä¸Šåšçš„å®éªŒï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦äº†è§£çš„å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼å°±æ˜¯ <strong><em>ELF</em></strong> ã€‚</p><p>ä»€ä¹ˆæ˜¯ <strong><em>ELF</em></strong> ï¼Ÿç®€å•æ¥è¯´ <strong><em>ELF</em></strong> å°±æ˜¯æè¿°ç¨‹åºçŠ¶æ€æœºåˆå§‹çŠ¶æ€çš„ä¸€ä¸ªæ•°æ®ç»“æ„ã€‚</p><p>è®©æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å…¸å‹çš„ <strong><em>ELF</em></strong> å¯æ‰§è¡Œæ–‡ä»¶çš„ç»“æ„æ˜¯ä»€ä¹ˆæ ·çš„ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/OCAY`93CYPB]SP`O40TQAQW.png" alt=""><br>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° <strong><em>ELF</em></strong> å¯æ‰§è¡Œæ–‡ä»¶ä¸»è¦å°±æ˜¯ç”±ä¸¤éƒ¨åˆ†ï¼Œ<strong><em>section</em></strong> å’Œ <strong><em>segment</em></strong> ç»„æˆã€‚å…¶ä¸­ä¸€äº› <strong><em>section</em></strong> è¢«ç§°ä¸º <strong><em>table</em></strong> ï¼Œ<strong><em>table</em></strong> å¯ä»¥è¢«ç”¨æ¥ç´¢å¼• <strong><em>segment</em></strong> çš„ï¼Œå¹¶å­˜å‚¨ä¸€äº›é¢å¤–çš„ä¿¡æ¯ã€‚</p><p><strong><em>ELFä¸­</em></strong> é‡‡ç”¨ <strong><em>program header table</em></strong> æ¥ç®¡ç† <strong><em>segment</em></strong> , <strong><em>program header table</em></strong> çš„ä¸€ä¸ªè¡¨é¡¹æè¿°äº†ä¸€ä¸ª <strong><em>segment</em></strong> çš„æ‰€æœ‰å±æ€§, åŒ…æ‹¬ç±»å‹, è™šæ‹Ÿåœ°å€, æ ‡å¿—, å¯¹é½æ–¹å¼, ä»¥åŠæ–‡ä»¶å†…åç§»é‡å’Œ <strong><em>segment</em></strong> å¤§å°ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ¤æ–­ <strong><em>segment</em></strong> çš„ <strong><em>Type</em></strong> å±æ€§æ˜¯å¦ä¸º <strong><em>PT_LOAD</em></strong> æ¥åˆ¤æ–­ä¸€ä¸ª <strong><em>segment</em></strong> æ˜¯å¦éœ€è¦åŠ è½½ã€‚</p><p>å½“ç„¶è¿™äº›æ¦‚å¿µå…·ä½“æ˜¯å¦‚ä½•ä½“ç°åœ¨ä»£ç ä¸Šçš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ–¹ä¾¿çš„åº“ <strong><em><elf.h></em></strong> æ¥å±•ç¤ºï¼š</p><p><strong><em><elf.h></em></strong> æä¾›äº†ä¸€ä¸ªå«åš <strong><em>Elf64_Ehdr</em></strong> çš„ç»“æ„ä½“ï¼Œå…¶å®å°±å¯¹åº”äº†ä¸Šå›¾ä¸­çš„ <strong><em>ELFå¤´</em></strong> ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">char</span>e_ident[EI_NIDENT];<span class="comment">/* Magic number and other info */</span></span><br><span class="line">  Elf64_Halfe_type;  <span class="comment">/* Object file type */</span></span><br><span class="line">  Elf64_Halfe_machine;<span class="comment">/* Architecture */</span></span><br><span class="line">  Elf64_Worde_version;<span class="comment">/* Object file version */</span></span><br><span class="line">  Elf64_Addre_entry;  <span class="comment">/* Entry point virtual address */</span></span><br><span class="line">  Elf64_Offe_phoff;  <span class="comment">/* Program header table file offset */</span></span><br><span class="line">  Elf64_Offe_shoff;  <span class="comment">/* Section header table file offset */</span></span><br><span class="line">  Elf64_Worde_flags;  <span class="comment">/* Processor-specific flags */</span></span><br><span class="line">  Elf64_Halfe_ehsize;  <span class="comment">/* ELF header size in bytes */</span></span><br><span class="line">  Elf64_Halfe_phentsize;<span class="comment">/* Program header table entry size */</span></span><br><span class="line">  Elf64_Halfe_phnum;  <span class="comment">/* Program header table entry count */</span></span><br><span class="line">  Elf64_Halfe_shentsize;<span class="comment">/* Section header table entry size */</span></span><br><span class="line">  Elf64_Halfe_shnum;  <span class="comment">/* Section header table entry count */</span></span><br><span class="line">  Elf64_Halfe_shstrndx;<span class="comment">/* Section header string table index */</span></span><br><span class="line">&#125; Elf64_Ehdr;</span><br></pre></td></tr></table></figure></p><p>å…¶ä¸­ <strong><em>e_phnum</em></strong> è¿™ä¸ªå­—æ®µæŒ‡å‡ºäº†è¿™ä¸ª <strong><em>ELFå¯æ‰§è¡Œæ–‡ä»¶</em></strong> å«æœ‰å¤šå°‘ä¸ª <strong><em>program header table</em></strong>ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <strong><em>e_phoff</em></strong> æ¥å®šä½åˆ° <strong><em>program header table</em></strong> åœ¨ <strong><em>ELFå¯æ‰§è¡Œæ–‡ä»¶</em></strong> ä¸­çš„ä½ç½®ï¼Œå¹¶è¿ç»­è¯»å‡º <strong><em>e_phnum</em></strong> ä¸ª <strong><em>program header table</em></strong>ã€‚</p><p><strong><em>Elf64_Phdr</em></strong> å°±å¯¹åº”äº†ä¸Šå›¾ä¸­çš„æ®µå¤´éƒ¨è¡¨ï¼Œä¹Ÿå°±æ˜¯ <strong><em>program header table</em></strong>ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  Elf64_Wordp_type;<span class="comment">/* Segment type */</span></span><br><span class="line">  Elf64_Wordp_flags;<span class="comment">/* Segment flags */</span></span><br><span class="line">  Elf64_Offp_offset;<span class="comment">/* Segment file offset */</span></span><br><span class="line">  Elf64_Addrp_vaddr;<span class="comment">/* Segment virtual address */</span></span><br><span class="line">  Elf64_Addrp_paddr;<span class="comment">/* Segment physical address */</span></span><br><span class="line">  Elf64_Xwordp_filesz;<span class="comment">/* Segment size in file */</span></span><br><span class="line">  Elf64_Xwordp_memsz;<span class="comment">/* Segment size in memory */</span></span><br><span class="line">  Elf64_Xwordp_align;<span class="comment">/* Segment alignment */</span></span><br><span class="line">&#125; Elf64_Phdr;</span><br></pre></td></tr></table></figure><br>æˆ‘ä»¬é€šè¿‡éå† <strong><em>ELFå¯æ‰§è¡Œæ–‡ä»¶</em></strong> ä¸­çš„ <strong><em>program header tables</em></strong>ï¼Œç­›é€‰å‡º <strong><em>p_type</em></strong> å±æ€§ä¸º <strong><em>PT_LOAD</em></strong> çš„ <strong><em>segment</em></strong> è£…è½½åˆ°æŒ‡å®šçš„å†…å­˜ä¸­ï¼Œæˆ‘ä»¬çš„ç”¨æˆ·ç¨‹åºåŸºæœ¬å°±å®Œæˆäº† <strong><em>load</em></strong>ã€‚</p><div class="note primary modern"><p>ï¼ˆè¿™é‡Œæˆ‘ä»¬ä»¥64ä½ä¸ºä¾‹ï¼Œ32ä½ä¹Ÿæœ‰å¯¹åº”çš„ç»“æ„ä½“ï¼‰</p></div><p>å½“ç„¶è¿˜æœ‰ä¸€äº›å°ç»†èŠ‚ï¼Œæ¯”å¦‚è¯´ï¼š</p><ul><li>ä¸ºä»€ä¹ˆ <strong><em>p_memsz</em></strong> é€šå¸¸æ¯” <strong><em>p_filesz</em></strong> å¤§ï¼Ÿ</li><li>ä¸ºä»€ä¹ˆè¦å°†<code>[VirtAddr + FileSiz, VirtAddr + MemSiz)</code>å¯¹åº”çš„ç‰©ç†åŒºé—´æ¸…é›¶ï¼Ÿï¼ˆ<strong><em>tips</em></strong>ï¼š <strong><em>.bssæ®µ</em></strong> çš„ä½œç”¨ï¼‰</li><li>å¦‚æœæ²¡æœ‰æ¸…é›¶ï¼Œå…¨å±€å˜é‡/é™æ€å˜é‡çš„åˆå§‹å€¼ä¼šæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</li></ul><p>å¦‚æœä½ å¸Œæœ›æŸ¥é˜…æ›´å¤šä¸ <strong><em>ELFæ–‡ä»¶</em></strong> ç›¸å…³çš„ä¿¡æ¯, è¯·å‚è€ƒ:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">man 5 elf</span><br></pre></td></tr></table></figure></p><p>æˆ‘ä»¬çŸ¥é“ <strong><em>ELFæ–‡ä»¶</em></strong> çš„å¼€å¤´æœ‰ä¸€ä¸ªé­”æ•°ï¼Œä¸ºäº†é˜²æ­¢ <strong><em>loader</em></strong> åŠ è½½äº†ä¸€ä¸ªé <strong><em>ELF</em></strong> æ ¼å¼çš„æ–‡ä»¶, æˆ‘ä»¬å¯ä»¥åœ¨ <strong><em>loader</em></strong> ä¸­å¯¹é­”æ•°è¿›è¡Œæ£€æŸ¥ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">assert(*(<span class="type">uint32_t</span> *)elf-&gt;e_ident == <span class="number">0xBadC0de</span>);</span><br></pre></td></tr></table></figure><br>è¯·è‡ªè¡Œå¡«å†™æ­£ç¡®çš„é­”æ•°ã€‚</p><p>åˆ«çœ‹è¿™ä¸ª <strong><em>assert</em></strong> çœ‹èµ·æ¥è ¢è ¢çš„ï¼Œç­‰å“ªå¤©ä¸çŸ¥é“ä»€ä¹ˆç¥å¥‡çš„åŸå› æ²¡æœ‰æ­£ç¡®è¯»å–æ—¶ï¼Œä½ ä¼šæ„Ÿè°¢è‡ªå·±çš„ <strong><em>â€œå¤šæ­¤ä¸€ä¸¾â€</em></strong> ã€‚</p><h2 id="ç³»ç»Ÿè°ƒç”¨"><a href="#ç³»ç»Ÿè°ƒç”¨" class="headerlink" title="ç³»ç»Ÿè°ƒç”¨"></a>ç³»ç»Ÿè°ƒç”¨</h2><p>åœ¨ <strong><em>GNU/Linux</em></strong> ä¸­, ç”¨æˆ·ç¨‹åºé€šè¿‡è‡ªé™·æŒ‡ä»¤æ¥è§¦å‘ç³»ç»Ÿè°ƒç”¨, <strong><em>Nanos-lite</em></strong> ä¹Ÿæ²¿ç”¨è¿™ä¸ªçº¦å®š. <strong><em>CTE</em></strong> ä¸­çš„ <strong><em>yield()</em></strong> ä¹Ÿæ˜¯é€šè¿‡è‡ªé™·æŒ‡ä»¤æ¥å®ç°ã€‚æ—¢ç„¶æˆ‘ä»¬é€šè¿‡è‡ªé™·æŒ‡ä»¤æ¥è§¦å‘ç³»ç»Ÿè°ƒç”¨, é‚£ä¹ˆå¯¹ç”¨æˆ·ç¨‹åºæ¥è¯´, ç”¨æ¥å‘æ“ä½œç³»ç»Ÿæè¿°éœ€æ±‚çš„æœ€æ–¹ä¾¿æ‰‹æ®µå°±æ˜¯ä½¿ç”¨é€šç”¨å¯„å­˜å™¨äº†ï¼Œç³»ç»Ÿè°ƒç”¨å¤„ç†å‡½æ•°åªéœ€è¦ä»ä¸Šä¸‹æ–‡ä¸­è·å–å¿…è¦çš„ä¿¡æ¯, å°±èƒ½çŸ¥é“ç”¨æˆ·ç¨‹åºå‘å‡ºçš„æœåŠ¡è¯·æ±‚æ˜¯ä»€ä¹ˆäº†ã€‚</p><p><strong><em>Navy</em></strong> å·²ç»ä¸ºç”¨æˆ·ç¨‹åºå‡†å¤‡å¥½äº†ç³»ç»Ÿè°ƒç”¨çš„æ¥å£äº†ã€‚<br><code>navy-apps/libs/libos/src/syscall.c</code>ä¸­å®šä¹‰çš„<code>_syscall_()</code>å‡½æ•°å·²ç»è•´å«ç€ä¸Šè¿°è¿‡ç¨‹ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">intptr_t</span> _syscall_(<span class="type">intptr_t</span> type, <span class="type">intptr_t</span> a0, <span class="type">intptr_t</span> a1, <span class="type">intptr_t</span> a2) &#123;</span><br><span class="line">  <span class="keyword">register</span> <span class="type">intptr_t</span> _gpr1 <span class="title function_">asm</span> <span class="params">(GPR1)</span> = type;</span><br><span class="line">  <span class="keyword">register</span> <span class="type">intptr_t</span> _gpr2 <span class="title function_">asm</span> <span class="params">(GPR2)</span> = a0;</span><br><span class="line">  <span class="keyword">register</span> <span class="type">intptr_t</span> _gpr3 <span class="title function_">asm</span> <span class="params">(GPR3)</span> = a1;</span><br><span class="line">  <span class="keyword">register</span> <span class="type">intptr_t</span> _gpr4 <span class="title function_">asm</span> <span class="params">(GPR4)</span> = a2;</span><br><span class="line">  <span class="keyword">register</span> <span class="type">intptr_t</span> ret <span class="title function_">asm</span> <span class="params">(GPRx)</span>;</span><br><span class="line">  <span class="keyword">asm</span> <span class="title function_">volatile</span> <span class="params">(SYSCALL : <span class="string">&quot;=r&quot;</span> (ret) : <span class="string">&quot;r&quot;</span>(_gpr1), <span class="string">&quot;r&quot;</span>(_gpr2), <span class="string">&quot;r&quot;</span>(_gpr3), <span class="string">&quot;r&quot;</span>(_gpr4))</span>;</span><br><span class="line">  <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ç†è§£ä¸Šè¿°å‡½æ•°ä½ éœ€è¦çš„æ–‡æ¡£ï¼š<a href="http://www.ibiblio.org/gferg/ldp/GCC-Inline-Assembly-HOWTO.html"><strong><em>GCC-Inline-Assembly-HOWTO</em></strong></a></p><p><strong><em>CTE</em></strong> ä¼šå°†è¿™ä¸ªè‡ªé™·æ“ä½œæ‰“åŒ…æˆä¸€ä¸ªç³»ç»Ÿè°ƒç”¨äº‹ä»¶ <strong><em>EVENT_SYSCALL</em></strong> , å¹¶äº¤ç”± <strong><em>Nanos-lite</em></strong> ç»§ç»­å¤„ç†ã€‚</p><p>æ·»åŠ ä¸€æ¡ç³»ç»Ÿè°ƒç”¨ç±»ä¼¼äºæ·»åŠ ä¸€æ¡æŒ‡ä»¤ï¼Œå…¶å®æ²¡ä»€ä¹ˆéš¾åº¦ã€‚<strong><em>Nanos-lite</em></strong> æ”¶åˆ°ç³»ç»Ÿè°ƒç”¨äº‹ä»¶ä¹‹å, å°±ä¼šè°ƒå‡ºç³»ç»Ÿè°ƒç”¨å¤„ç†å‡½æ•° <strong><em>do_syscall()</em></strong> è¿›è¡Œå¤„ç†ã€‚æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ ¹æ®ç³»ç»Ÿè°ƒç”¨å·åœ¨ <strong><em>do_syscall()</em></strong> æ·»åŠ ç›¸åº”çš„é€»è¾‘åŠŸèƒ½å³å¯ã€‚</p><p>å¦‚æœå®ç°æ­£ç¡®ï¼Œä½ å°†çœ‹åˆ°ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQå›¾ç‰‡20220929234734.png" alt=""></p><h2 id="æ“ä½œç³»ç»Ÿä¹‹ä¸Šçš„TRM"><a href="#æ“ä½œç³»ç»Ÿä¹‹ä¸Šçš„TRM" class="headerlink" title="æ“ä½œç³»ç»Ÿä¹‹ä¸Šçš„TRM"></a>æ“ä½œç³»ç»Ÿä¹‹ä¸Šçš„TRM</h2><p><strong><em>TRM</em></strong> å‘æˆ‘ä»¬å±•ç¤ºäº†, ä¸ºäº†æ»¡è¶³ç¨‹åºçš„åŸºæœ¬è®¡ç®—èƒ½åŠ›, éœ€è¦æœ‰å“ªäº›æ¡ä»¶:</p><ul><li>æœºå™¨æä¾›åŸºæœ¬çš„è¿ç®—æŒ‡ä»¤</li><li>èƒ½è¾“å‡ºå­—ç¬¦</li><li>æœ‰å †åŒºå¯ä»¥åŠ¨æ€ç”³è¯·å†…å­˜</li><li>å¯ä»¥ç»“æŸè¿è¡Œ<br>æŒ‡ä»¤çš„è¿ç®—æˆ‘ä»¬å·²ç»åœ¨ <strong><em>PA2</em></strong> å®ç°äº†ï¼Œç¨‹åºçš„ç»“æŸè¿è¡Œæˆ‘ä»¬å·²ç»é€šè¿‡ <strong><em>SYS_exit</em></strong> ç³»ç»Ÿè°ƒç”¨å®ç°äº†ã€‚ä¸ºäº†å‘ç”¨æˆ·ç¨‹åºæä¾›è¾“å‡ºå­—ç¬¦å’Œå†…å­˜åŠ¨æ€ç”³è¯·çš„åŠŸèƒ½, æˆ‘ä»¬éœ€è¦å®ç°æ›´å¤šçš„ç³»ç»Ÿè°ƒç”¨ã€‚</li></ul><h3 id="æ ‡å‡†è¾“å‡º"><a href="#æ ‡å‡†è¾“å‡º" class="headerlink" title="æ ‡å‡†è¾“å‡º"></a>æ ‡å‡†è¾“å‡º</h3><p>åœ¨ <strong><em>GNU/Linux</em></strong> ä¸­, è¾“å‡ºæ˜¯é€šè¿‡ <strong><em>SYS_write</em></strong> ç³»ç»Ÿè°ƒç”¨æ¥å®ç°çš„ã€‚äº‹å®ä¸Š, æˆ‘ä»¬å¹³æ—¶ä½¿ç”¨çš„ <strong><em>printf()</em></strong> , <strong><em>cout</em></strong> è¿™äº›åº“å‡½æ•°å’Œåº“ç±», å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ ¼å¼åŒ–ä¹‹å, æœ€ç»ˆä¹Ÿæ˜¯é€šè¿‡ç³»ç»Ÿè°ƒç”¨è¿›è¡Œè¾“å‡ºã€‚è¿™äº›éƒ½æ˜¯â€ç³»ç»Ÿè°ƒç”¨å°è£…æˆåº“å‡½æ•°â€çš„ä¾‹å­ã€‚</p><p>å› æ­¤æˆ‘ä»¬åªéœ€è¦å®ç° <strong><em>SYS_write</em></strong> ç³»ç»Ÿè°ƒç”¨å°±åŸºæœ¬æ‰«é™¤äº† <strong><em>printf()</em></strong> çš„æœ€å¤§éšœç¢äº†ï¼Œè‡³äº <strong><em>printf()</em></strong> å…·ä½“æ˜¯å¦‚ä½•å®ç°çš„ï¼Œ<strong><em>Navy</em></strong> ä¸­çš„<strong><em>Newlibåº“</em></strong> å·²ç»ä¸ºæˆ‘ä»¬å‡†å¤‡å¥½äº†ã€‚</p><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ“ä½œç³»ç»Ÿçš„åº”ç”¨ç¨‹åºè°ƒç”¨çš„ <strong><em>printf()</em></strong> å¹¶ä¸æ˜¯æˆ‘ä»¬ç¼–å†™çš„ <strong><em>klib</em></strong> ã€‚<strong><em>klib</em></strong> æ‰€å¤„çš„æŠ½è±¡å±‚ä½äº <strong><em>am</em></strong>ï¼Œä¹Ÿå°±æ˜¯é©±åŠ¨å±‚ï¼Œè€Œæ“ä½œç³»ç»Ÿåœ¨ <strong><em>am</em></strong> ä¹‹ä¸Šå†æ·»åŠ äº†ä¸€å±‚æŠ½è±¡ã€‚å› ä¸ºæ“ä½œç³»ç»Ÿå¹¶ä¸æ‰“ç®—æŠŠ <strong><em>am</em></strong> æš´éœ²ç»™æˆ‘ä»¬çš„ç”¨æˆ·ï¼Œæ‰€ä»¥æ“ä½œç³»ç»Ÿçš„åº”ç”¨ç¨‹åºæ˜¯æ— æ³•ç›´æ¥è°ƒç”¨ <strong><em>am</em></strong> å±‚çš„ <strong><em>API</em></strong> çš„ã€‚</p><p>å…¶å®æŒ‰ç†è¯´ï¼Œåœ¨è¿™ä¸€æ­¥æˆ‘ä»¬å°±èƒ½é€šè¿‡ <code>hello</code> æµ‹è¯•ç¨‹åºäº†ã€‚ä½†å¦‚æœä½ æ­£ç¡®å®ç°äº† <strong><em>SYS_write</em></strong> è°ƒç”¨åä¼šå‘ç°å±å¹•ä¸æ–­åœ°åœ¨è¾“å‡ºç¬¬ä¸€ä¸ªå­—ç¬¦<code>H</code>ï¼Œè¿™å¾ˆéš¾è¯´æ˜¯é€šè¿‡äº†ã€‚å½“ä½ å»é˜…è¯» <strong><em>Newlibåº“</em></strong> ä¸­ <strong><em>printf()</em></strong> çš„æºç ä¼šå‘ç°ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰å®ç°å †åŒºåˆ†é…å¯¼è‡´çš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚å¾ˆéš¾è¯´è¿™æ˜¯å®éªŒå®‰æ’çš„ç–å¿½ï¼Œè¿˜æ˜¯æ•…æ„çš„å‘¢ï¼Ÿ(ç¬‘)</p><h3 id="å †åŒºç®¡ç†"><a href="#å †åŒºç®¡ç†" class="headerlink" title="å †åŒºç®¡ç†"></a>å †åŒºç®¡ç†</h3><p>å †åŒºçš„ä½¿ç”¨æƒ…å†µæ˜¯ç”± <strong><em>libc</em></strong> æ¥è¿›è¡Œç®¡ç†çš„, ä½†å †åŒºçš„å¤§å°å´éœ€è¦é€šè¿‡ç³»ç»Ÿè°ƒç”¨å‘æ“ä½œç³»ç»Ÿæå‡ºæ›´æ”¹ã€‚è¿™æ˜¯å› ä¸º, å †åŒºçš„æœ¬è´¨æ˜¯ä¸€ç‰‡å†…å­˜åŒºåŸŸ, å½“éœ€è¦è°ƒæ•´å †åŒºå¤§å°çš„æ—¶å€™, å®é™…ä¸Šæ˜¯åœ¨è°ƒæ•´ç”¨æˆ·ç¨‹åºå¯ç”¨çš„å†…å­˜åŒºåŸŸã€‚å¦‚æœä¸€ä¸ªæ¶æ„ç¨‹åºä¸ç»è¿‡æ“ä½œç³»ç»Ÿå°±å¯ä»¥éšæ„æ›´æ”¹å…¶ä»–ç¨‹åºçš„å†…å­˜åŒºåŸŸï¼Œé‚£å°±å¯ä»¥ç›´æ¥å¼€é¦™æ§Ÿäº†ï¼ˆbushiï¼‰ã€‚</p><p>æˆ‘ä»¬çŸ¥é“å¯æ‰§è¡Œæ–‡ä»¶é‡Œé¢æœ‰ä»£ç æ®µå’Œæ•°æ®æ®µ, é“¾æ¥çš„æ—¶å€™ <strong><em>ld</em></strong> ä¼šé»˜è®¤æ·»åŠ ä¸€ä¸ªåä¸º <strong><em>_end</em></strong> çš„ç¬¦å·, æ¥æŒ‡ç¤ºç¨‹åºçš„æ•°æ®æ®µç»“æŸçš„ä½ç½®ã€‚ç”¨æˆ·ç¨‹åºå¼€å§‹è¿è¡Œçš„æ—¶å€™, <strong><em>program break</em></strong> ä¼šä½äº <strong><em>_end</em></strong> æ‰€æŒ‡ç¤ºçš„ä½ç½®, æ„å‘³ç€æ­¤æ—¶å †åŒºçš„å¤§å°ä¸º0ã€‚</p><p>å…¶å®è¿™éƒ¨åˆ†çš„é€»è¾‘æ²¡æœ‰ä»€ä¹ˆå›°éš¾ï¼Œæ ¸å¿ƒæ€æƒ³å°±æ˜¯ç»´æŠ¤ <strong><em>program break</em></strong> çš„å€¼å³å¯ã€‚ä½†æ˜¯ <strong><em>program break</em></strong> çš„åˆå€¼ <strong><em>_end</em></strong> æˆ‘ä»¬è¯¥å¦‚ä½•è·å–å‘¢ï¼Ÿè¿™å°±æ˜¯å”¯ä¸€çš„éš¾ç‚¹äº†ã€‚ä½†æ˜¯è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆå…¶å®ä¹Ÿéå¸¸ç®€å•ï¼Œå‰é¢å·²ç»è¯´äº† <strong><em>ld</em></strong> çš„æ—¶å€™æˆ‘ä»¬ä¼šæ·»åŠ  <strong><em>_end</em></strong> çš„ç¬¦å·ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦ <code>extern char _end</code> å³å¯ï¼Œåœ¨é“¾æ¥é˜¶æ®µä¼šè‡ªåŠ¨å–å¾—è¯¥ç¬¦å·çš„å®šä¹‰ã€‚</p><p>å½“ç„¶äº†ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ <code>man 3 end</code> æ¥æŸ¥è¯¢å¦‚ä½•ä½¿ç”¨ <code>_end</code> ç¬¦å·ã€‚ä½ ä¼šå‘ç°è·Ÿæˆ‘è¯´çš„å…¶å®æ˜¯ä¸€æ ·çš„ã€‚</p><p>å¦‚æœä½ æ­£ç¡®å®ç°äº†ä¸Šè¿°ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œé‚£ä¹ˆæ­¤æ—¶ä½ åº”è¯¥èƒ½é€šè¿‡ <code>hello</code> æµ‹è¯•ç¨‹åºäº†ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQå›¾ç‰‡20221002000222.png" alt=""></p><h1 id="æ–‡ä»¶ç³»ç»Ÿ"><a href="#æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿ"></a>æ–‡ä»¶ç³»ç»Ÿ</h1><h2 id="ç®€æ˜“æ–‡ä»¶ç³»ç»Ÿ"><a href="#ç®€æ˜“æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="ç®€æ˜“æ–‡ä»¶ç³»ç»Ÿ"></a>ç®€æ˜“æ–‡ä»¶ç³»ç»Ÿ</h2><p>æ–‡ä»¶çš„æœ¬è´¨å°±æ˜¯å­—èŠ‚åºåˆ—, å¦å¤–è¿˜ç”±ä¸€äº›é¢å¤–çš„å±æ€§æ„æˆã€‚åœ¨è¿™é‡Œ, æˆ‘ä»¬å…ˆè®¨è®ºæ™®é€šæ„ä¹‰ä¸Šçš„æ–‡ä»¶ã€‚é‚£äº›é¢å¤–çš„å±æ€§å°±ç»´æŠ¤äº†æ–‡ä»¶åˆ° <code>ramdisk</code> å­˜å‚¨ä½ç½®çš„æ˜ å°„,ä¸ºäº†ç®¡ç†è¿™äº›æ˜ å°„, åŒæ—¶å‘ä¸Šå±‚æä¾›æ–‡ä»¶æ“ä½œçš„æ¥å£, æˆ‘ä»¬éœ€è¦åœ¨ <code>Nanos-lite</code> ä¸­å®ç°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿã€‚</p><p>æˆ‘ä»¬å¯¹æ–‡ä»¶ç³»ç»Ÿçš„éœ€æ±‚å¹¶ä¸æ˜¯é‚£ä¹ˆå¤æ‚, å› æ­¤æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªç®€æ˜“æ–‡ä»¶ç³»ç»Ÿ <code>sfs(Simple File System)</code>ï¼š</p><ul><li>æ¯ä¸ªæ–‡ä»¶çš„å¤§å°æ˜¯å›ºå®šçš„</li><li>å†™æ–‡ä»¶æ—¶ä¸å…è®¸è¶…è¿‡åŸæœ‰æ–‡ä»¶çš„å¤§å°</li><li>æ–‡ä»¶çš„æ•°é‡æ˜¯å›ºå®šçš„, ä¸èƒ½åˆ›å»ºæ–°æ–‡ä»¶</li><li>æ²¡æœ‰ç›®å½•</li></ul><p>æˆ‘ä»¬çº¦å®šæ–‡ä»¶ä»ramdiskçš„æœ€å¼€å§‹ä¸€ä¸ªæŒ¨ç€ä¸€ä¸ªåœ°å­˜æ”¾ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0</span><br><span class="line">+-------------+---------+----------+-----------+--</span><br><span class="line">|    file0    |  file1  |  ......  |   filen   |</span><br><span class="line">+-------------+---------+----------+-----------+--</span><br><span class="line"> \           / \       /            \         /</span><br><span class="line">  +  size0  +   +size1+              + sizen +</span><br></pre></td></tr></table></figure></p><p>ä¸ºäº†è®°å½•ramdiskä¸­å„ä¸ªæ–‡ä»¶çš„åå­—å’Œå¤§å°, æˆ‘ä»¬è¿˜éœ€è¦ä¸€å¼ â€æ–‡ä»¶è®°å½•è¡¨â€ã€‚</p><p>â€œæ–‡ä»¶è®°å½•è¡¨â€å…¶å®æ˜¯ä¸€ä¸ªæ•°ç»„, æ•°ç»„çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªç»“æ„ä½“:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">  <span class="type">char</span> *name;         <span class="comment">// æ–‡ä»¶å</span></span><br><span class="line">  <span class="type">size_t</span> size;        <span class="comment">// æ–‡ä»¶å¤§å°</span></span><br><span class="line">  <span class="type">size_t</span> disk_offset;  <span class="comment">// æ–‡ä»¶åœ¨ramdiskä¸­çš„åç§»</span></span><br><span class="line">&#125; Finfo;</span><br></pre></td></tr></table></figure></p><p>ç”±äº <code>sfs</code> åœ¨è®¾å®šä¸Šæ˜¯æ²¡æœ‰ç›®å½•çš„ï¼Œæ‰€ä»¥ç›®å½•åˆ†éš”ç¬¦ä¹Ÿè¢«å½“ä½œäº†æ–‡ä»¶åçš„ä¸€éƒ¨åˆ†ï¼Œä¾‹å¦‚ <code>/bin/hello</code> æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ–‡ä»¶åã€‚åœ¨æ–‡ä»¶æ•°é‡ä¸å¤šçš„æƒ…å†µä¸‹ï¼Œè¿™ç§å®ç°æ—¢ <strong><em>trivial</em></strong> åˆ <strong><em>effective</em></strong> ã€‚</p><p>ä¸‹é¢ä¸»è¦è®²è§£ä¸€ä¸‹æ–‡ä»¶æ“ä½œå‡½æ•°å®ç°éœ€è¦æ³¨æ„çš„å‘äº†ã€‚ <strong><em>open()</em></strong> å’Œ <strong><em>close()</em></strong> æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œé‡ç‚¹æ˜¯ <strong><em>read()</em></strong> å’Œ <strong><em>write()</em></strong> ã€‚</p><p>åœ¨å®ç° <strong><em>read()</em></strong> å‡½æ•°åŠŸèƒ½ä¹‹å‰æˆ‘ä»¬å¾ˆæœ‰å¿…è¦ <code>man 2 read</code> ä¸€ä¸‹ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQå›¾ç‰‡20221006230048.png" alt=""><br>è¿™æ„å‘³ç€æˆ‘ä»¬è¦æ³¨æ„æ–‡ä»¶æè¿°ç¬¦å½“å‰çš„ <strong><em>offset</em></strong> ï¼Œå¦‚æœç”¨æˆ·è¦æ±‚è¯»å–çš„é•¿åº¦è¶…å‡ºäº†æ–‡ä»¶çš„å¤§å°ï¼Œæˆ‘ä»¬è¦åŠæ—¶åšå¥½æ§åˆ¶ï¼Œå¦åˆ™å°±å¯èƒ½è¯»åˆ°å¥‡æ€ªçš„åœ°æ–¹ï¼Œä»è€Œäº§ç”Ÿè«åå…¶å¦™çš„ <strong><em>bug</em></strong> (æ³ªç›®)ã€‚</p><p>åŒç†å¯¹ <strong><em>write()</em></strong> ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œé‡ç‚¹æ˜¯ <strong><em>è¯»æ‰‹å†Œï¼è¯»æ‰‹å†Œï¼è¯»æ‰‹å†Œï¼</em></strong> é‡è¦çš„äº‹æƒ…è¯´ä¸‰éã€‚</p><p>è¿™éƒ¨åˆ†æˆåŠŸå®Œæˆåï¼Œä½ åº”è¯¥èƒ½çœ‹åˆ° <code>PASS!!!</code> çš„ä¿¡æ¯ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQå›¾ç‰‡20221006231125.png" alt=""></p><h2 id="ä¸€åˆ‡çš†æ–‡ä»¶"><a href="#ä¸€åˆ‡çš†æ–‡ä»¶" class="headerlink" title="ä¸€åˆ‡çš†æ–‡ä»¶"></a>ä¸€åˆ‡çš†æ–‡ä»¶</h2><p>æ‰€è°“ä¸€åˆ‡çš†æ–‡ä»¶ï¼Œå®é™…ä¸Šå°±æ˜¯æŠŠå„ç§äº”èŠ±å…«é—¨çš„å­—èŠ‚æµéƒ½çœ‹æˆæ–‡ä»¶ã€‚æ¯”å¦‚è¯´ <strong><em>è®¾å¤‡</em></strong> å’Œ <strong><em>socket</em></strong> æœ¬èº«å°±å¯ä»¥çœ‹æˆæ˜¯ä¸€ç§å­—èŠ‚æµï¼Œé‚£ä¹ˆè‡ªç„¶è€Œç„¶åœ°æˆ‘ä»¬å¯ä»¥æŠŠä»–ä»¬æŠ½è±¡æˆæ–‡ä»¶ã€‚è¿™ä¹ˆåšçš„å¥½å¤„æ˜¯æˆ‘ä»¬å¯ä»¥æä¾›ç»Ÿä¸€çš„æ¥å£ï¼Œå»æ“çºµè®¡ç®—æœºä¸Šçš„ä¸€åˆ‡äº‹ç‰©ï¼Œè€Œä¸å¿…å› ä¸ºå°†æ¥åŠ å…¥äº†æ–°çš„è®¾å¤‡è€Œå¢åŠ ä¸€ä¸ªæ–°çš„ç³»ç»Ÿè°ƒç”¨ã€‚</p><p><strong><em>Unix</em></strong> å°±æ˜¯è¿™æ ·åšçš„, å› æ­¤æœ‰ <code>&quot;ä¸€åˆ‡çš†æ–‡ä»¶&quot;(Everything is a file)</code> çš„è¯´æ³•ã€‚ä¸ºäº†å‘ç”¨æˆ·ç¨‹åºæä¾›ç»Ÿä¸€çš„æŠ½è±¡, <strong><em>Nanos-lite</em></strong> ä¹Ÿå°è¯•å°† <strong><em>IOE</em></strong> æŠ½è±¡æˆæ–‡ä»¶ã€‚</p><h3 id="è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ"><a href="#è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ"></a>è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ</h3><p>ä¸ºäº†å®ç°ä¸€åˆ‡çš†æ–‡ä»¶çš„æ€æƒ³ï¼Œæˆ‘ä»¬ä¸ä»…éœ€è¦å¯¹æ™®é€šæ–‡ä»¶è¿›è¡Œè¯»å†™, è¿˜éœ€è¦æ”¯æŒå„ç§â€ç‰¹æ®Šæ–‡ä»¶â€çš„æ“ä½œã€‚</p><p>è¿™ç»„æ‰©å±•è¯­ä¹‰ä¹‹åçš„ <strong><em>API</em></strong> æœ‰ä¸€ä¸ªé…·ç‚«çš„åå­—, å« <code>VFS(è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ)</code> ã€‚</p><p>åœ¨ <strong><em>Nanos-lite</em></strong> ä¸­, å®ç° <strong><em>VFS</em></strong> çš„å…³é”®å°±æ˜¯ <strong><em>Finfoç»“æ„ä½“</em></strong> ä¸­çš„ä¸¤ä¸ªè¯»å†™å‡½æ•°æŒ‡é’ˆ:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">  <span class="type">char</span> *name;         <span class="comment">// æ–‡ä»¶å</span></span><br><span class="line">  <span class="type">size_t</span> size;        <span class="comment">// æ–‡ä»¶å¤§å°</span></span><br><span class="line">  <span class="type">size_t</span> disk_offset;  <span class="comment">// æ–‡ä»¶åœ¨ramdiskä¸­çš„åç§»</span></span><br><span class="line">  ReadFn read;        <span class="comment">// è¯»å‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line">  WriteFn write;      <span class="comment">// å†™å‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line">&#125; Finfo;</span><br></pre></td></tr></table></figure><br>åªæœ‰ç‰¹æ®Šæ–‡ä»¶ä¼šè¢«è®¾ç½®è¿™ä¸¤ä¸ªè¯»å†™å‡½æ•°æŒ‡é’ˆï¼Œå› æ­¤åè¿‡æ¥è¯´å¦‚æœè¿™ä¸¤ä¸ªè¯»å†™å‡½æ•°æŒ‡é’ˆä¸º <code>NULL</code> ï¼Œåˆ™è¯´æ˜è¯¥æ–‡ä»¶æ˜¯æ™®é€šæ–‡ä»¶ã€‚è¿™æ · <strong><em>VFS</em></strong> çš„æŠ½è±¡å°±å®Œæˆäº†ã€‚</p><h3 id="æ“ä½œç³»ç»Ÿä¹‹ä¸Šçš„IOE"><a href="#æ“ä½œç³»ç»Ÿä¹‹ä¸Šçš„IOE" class="headerlink" title="æ“ä½œç³»ç»Ÿä¹‹ä¸Šçš„IOE"></a>æ“ä½œç³»ç»Ÿä¹‹ä¸Šçš„IOE</h3><p>æœ‰äº† <strong><em>VFS</em></strong> , è¦æŠŠ <strong><em>IOE</em></strong> æŠ½è±¡æˆæ–‡ä»¶å°±éå¸¸ç®€å•äº†ã€‚</p><p>ä¸²å£è¾“å‡ºæ²¡ä»€ä¹ˆå¥½è®²çš„ï¼Œè¿™é‡Œå…ˆè®²ä¸€ä¸‹æ—¶é’Ÿè¿™ä¸ªè¾“å…¥è®¾å¤‡ã€‚ç”±äºæ—¶é’Ÿæ¯”è¾ƒç‰¹æ®Šï¼Œå¤§éƒ¨åˆ†çš„ <strong><em>OS</em></strong> å¹¶æ²¡æœ‰æŠŠå®ƒæŠ½è±¡æˆæ–‡ä»¶ï¼Œè€Œæ˜¯æä¾›äº†ä¸€ä¸ªç‰¹æ®Šçš„ç³»ç»Ÿè°ƒç”¨ã€‚æˆ‘ä»¬åœ¨ <strong><em>Nanos-lite</em></strong> é‡Œä¹Ÿæ˜¯è¿™ä¹ˆåšçš„ã€‚</p><p>å…¶å®æˆ‘ä»¬ä¹‹å‰åœ¨ <strong><em>am</em></strong> å±‚å·²ç»åšäº†å‡†å¤‡å·¥ä½œäº†ï¼Œ<strong><em>Nanos-lite</em></strong> ä½œä¸ºä¸€ä¸ª <strong><em>am</em></strong> åº”ç”¨ç¨‹åºï¼Œèƒ½å¤Ÿç›´æ¥è°ƒç”¨ <strong><em>am</em></strong> çš„ <strong><em>api</em></strong>ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨å®ç°ä¸­ä½¿ç”¨ <code>io_read(AM_TIMER_UPTIME)</code> å°±èƒ½è·å–åˆ°ç³»ç»Ÿçš„æ—¶é—´äº†ã€‚</p><p>æ—¶é’Ÿç³»ç»Ÿè°ƒç”¨å®ç°æˆåŠŸåå¯ä»¥çœ‹åˆ°ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQå›¾ç‰‡20221008000127.png" alt=""></p><p>å…³äºæ—¶é’Ÿè¿˜æœ‰å¦å¤–ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹æ˜¯æˆ‘ä»¬åç»­éœ€è¦å®ç°çš„ <strong><em>NDL</em></strong> å‡½æ•°ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»¥æ¯«ç§’ä¸ºå•ä½è¿”å›ç³»ç»Ÿæ—¶é—´</span></span><br><span class="line"><span class="type">uint32_t</span> <span class="title function_">NDL_GetTicks</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure><br>è¿™é‡Œæ˜¯ä»¥æ¯«ç§’ä¸ºå•ä½è¿”å›çš„ï¼Œå’Œæˆ‘ä»¬ä¹‹å‰é»˜è®¤çš„ä½¿ç”¨å•ä½æ˜¯ä¸åŒçš„ï¼Œè¦æ³¨æ„è½¬æ¢ã€‚</p><p>ä¸‹ä¸€ä¸ªè¾“å…¥è®¾å¤‡æ˜¯é”®ç›˜ã€‚æŒ‰é”®çš„ä¿¡æ¯å¯¹äºç³»ç»Ÿæ¥è¯´å¯ä»¥æŠ½è±¡ä¸ºä¸€ä¸ªäº‹ä»¶ï¼Œè€Œäº‹ä»¶å¾ˆé€‚åˆç”¨æ–‡æœ¬æ¥æè¿°ã€‚ç”±äºæ–‡æœ¬æœ¬èº«å°±æ˜¯ä¸€ç§å­—èŠ‚æµï¼Œæ‰€ä»¥äº‹ä»¶æŠ½è±¡æˆæ–‡ä»¶ååˆ†ç®€å•ï¼Œè€Œä¸”å¯è¯»æ€§å¾ˆå¥½ã€‚å› æ­¤æˆ‘ä»¬æŠŠä¸Šè¿°äº‹ä»¶æŠ½è±¡æˆä¸€ä¸ªç‰¹æ®Šæ–‡ä»¶ <code>/dev/events</code> åŠ å…¥åˆ° <code>file_table[]</code> ä¸­ï¼Œè¯¥ç‰¹æ®Šæ–‡ä»¶éœ€è¦æ”¯æŒè¯»æ“ä½œã€‚å’Œæ—¶é’Ÿç±»ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ© <strong><em>IOE</em></strong> çš„ <strong><em>api</em></strong> æ¥è·å–æŒ‰é”®ä¿¡æ¯ï¼Œæ‰“åŒ…æˆäº‹ä»¶å†ä¾›ç”¨æˆ·è¯»å–ã€‚</p><p>å®ç°æ•ˆæœå¦‚ä¸‹ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQå›¾ç‰‡20221008001531.png" alt=""><br>åœ¨è¿›è¡Œé”®ç›˜æµ‹è¯•çš„æ—¶å€™æ³¨æ„è¦åœ¨å¼¹å‡ºçš„çª—å£ä¸­è¾“å…¥æŒ‰é”®æ‰æ˜¯æœ‰æ•ˆçš„ï¼Œå¦åˆ™ä½ å¾ˆæœ‰å¯èƒ½æ€€ç–‘æ˜¯è‡ªå·±æ²¡æœ‰æ­£ç¡®å®ç°æŒ‰é”®åŠŸèƒ½ :-(</p><p>è®²ä¹‰ä¸­è¿˜æå‡ºäº†ä¸€ä¸ªéå¸¸å€¼å¾—æ€è€ƒçš„é—®é¢˜ï¼Œå½“æˆ‘ä»¬å¯¹è¿™äº›å³æ—¶æ€§è¦æ±‚éå¸¸é«˜çš„ç‰¹æ®Šæ–‡ä»¶æ“ä½œçš„æ—¶å€™ï¼Œæˆ‘ä»¬åº”è¯¥æ˜¯é€‰ç”¨ <strong><em>fopen()</em></strong> è¿˜æ˜¯ <strong><em>open()</em></strong> å‘¢ï¼Ÿè¿™ä¸¤è€…çš„åŒºåˆ«æ˜¯å•¥å‘¢ï¼Ÿå…¶å®ä»–ä»¬ä¹‹é—´çš„å·®åˆ«å°±æ˜¯ <strong><em>fopen()</em></strong> å†…ç½®äº†ä¸€ä¸ªç¼“å†²åŒºï¼Œè¿™ä¸ªç¼“å†²åŒºä¼šå¯¹æˆ‘ä»¬çš„è¯»å–é€ æˆä»€ä¹ˆå½±å“å‘¢ï¼Ÿä½ ç¨å¾®æƒ³ä¸€ä¸‹åº”è¯¥å°±èƒ½æ˜ç™½äº†ã€‚</p><p>æœ€åæ˜¯ <strong><em>VGA</em></strong> , ç¨‹åºä¸ºäº†æ›´æ–°å±å¹•, åªéœ€è¦å°†åƒç´ ä¿¡æ¯å†™å…¥VGAçš„æ˜¾å­˜å³å¯ã€‚è€Œæˆ‘ä»¬è¦åšçš„ï¼Œå°±æ˜¯æŠŠæ˜¾å­˜æŠ½è±¡æˆæ–‡ä»¶ã€‚</p><p>æ˜¾å­˜æœ¬èº«ä¹Ÿæ˜¯ä¸€æ®µå­˜å‚¨ç©ºé—´, å®ƒä»¥è¡Œä¼˜å…ˆçš„æ–¹å¼å­˜å‚¨äº†å°†è¦åœ¨å±å¹•ä¸Šæ˜¾ç¤ºçš„åƒç´ ã€‚è¿™ä¸€ç‚¹å®åœ¨æ˜¯å¤ªé‡è¦äº†ï¼Œè™½ç„¶å‰é¢å®ç° <strong><em>VGA</em></strong> æ—¶å·²ç»å¼ºè°ƒè¿‡äº†ï¼Œä½†è¿™é‡Œè¿˜æ˜¯ä¸å¾—ä¸å†æä¸€éã€‚</p><p>è¿™é‡Œè¿˜å¼•å…¥äº†ä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼Œ<strong><em>â€œç”»å¸ƒâ€</em></strong> ã€‚æˆ‘ä»¬å¿…é¡»è®¤è¯†åˆ°ï¼Œç”»å¸ƒå’Œå±å¹•æ˜¯ä¸¤ä¸ªä¸œè¥¿ã€‚æˆ‘ä»¬ç»˜åˆ¶ç”»é¢åªèƒ½åœ¨æˆ‘ä»¬çš„ç”»å¸ƒèŒƒå›´å†…ç»˜åˆ¶ã€‚<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‰“å¼€ä¸€å¼ (*w) X (*h)çš„ç”»å¸ƒ</span></span><br><span class="line"><span class="comment">// å¦‚æœ*wå’Œ*hå‡ä¸º0, åˆ™å°†ç³»ç»Ÿå…¨å±å¹•ä½œä¸ºç”»å¸ƒ, å¹¶å°†*wå’Œ*håˆ†åˆ«è®¾ä¸ºç³»ç»Ÿå±å¹•çš„å¤§å°</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">NDL_OpenCanvas</span><span class="params">(<span class="type">int</span> *w, <span class="type">int</span> *h)</span>;</span><br></pre></td></tr></table></figure><br>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ª <strong><em>api</em></strong> æ¥æ‰“å¼€ä¸€å¼ ç”»å¸ƒï¼Œæ³¨æ„è¿™é‡Œæœ‰ç‰¹æ®Šçš„é»˜è®¤çŠ¶å†µï¼Œè¦ç‰¹æ®Šå¤„ç†ä¸€ä¸‹ã€‚</p><p>å®éªŒä¸­è¿˜è¦æ±‚æˆ‘ä»¬å®ç°å±…ä¸­çš„ <strong><em>logo</em></strong> ï¼Œè¿™ä¸ªå…¶å®åªéœ€è¦ç®€å•çš„è®¡ç®—ä¸€ä¸‹èµ·å§‹åæ ‡çš„ <strong><em>offset</em></strong> å°±è¡Œäº†ï¼Œä¹Ÿå°±æ˜¯ <strong><em>pixels</em></strong> çš„å·¦ä¸Šè§’é‚£ä¸ªç‚¹åˆ°åº•æ˜¯ä»€ä¹ˆå°±è¡Œã€‚</p><p>å®ç°æˆåŠŸåï¼Œä½ å°†çœ‹åˆ°å±…ä¸­çš„ <strong><em>logo</em></strong>ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQå›¾ç‰‡20221009000546.png" alt=""></p><h1 id="ç²¾å½©çº·å‘ˆçš„åº”ç”¨ç¨‹åº"><a href="#ç²¾å½©çº·å‘ˆçš„åº”ç”¨ç¨‹åº" class="headerlink" title="ç²¾å½©çº·å‘ˆçš„åº”ç”¨ç¨‹åº"></a>ç²¾å½©çº·å‘ˆçš„åº”ç”¨ç¨‹åº</h1><p>TODO</p>]]></content>
      
      
      <categories>
          
          <category> PA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PA </tag>
            
            <tag> OS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PA2å®éªŒç¬”è®°</title>
      <link href="/archives/81c5e64f.html"/>
      <url>/archives/81c5e64f.html</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>PAæ˜¯NJU ICSçš„è¯¾ç¨‹å®éªŒï¼Œä½œä¸ºä¸€ä¸ªéç§‘ç­çš„å­¦ç”Ÿï¼Œè¦å®Œæˆè¿™ä¸ªå®éªŒå±å®ä¸æ˜“ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘æ”¶è·åˆ°çš„çŸ¥è¯†å’Œç»éªŒæ— ç–‘æ˜¯æˆ‘æ±‚å­¦è·¯ä¸Šæ— æ¯”å®è´µçš„è´¢å¯Œã€‚ä¸ºäº†è®°å½•ä¸‹è¿™å®è´µçš„ç»å†ï¼Œæ•…å†™æ­¤åšå®¢è®°å½•ä¸‹æˆ‘çš„è‹¦æ¼ä¸æ„Ÿæ‚Ÿã€‚åœ¨è¿™ç¯‡åšå®¢é‡Œæˆ‘ä¼šç®€å•å™è¿°æˆ‘çš„æ€è·¯å’Œè¸©è¿‡çš„å‘ã€‚<strong><em>å¦å¤–ç‰¹æ­¤å£°æ˜ï¼Œå¦‚æœæ‚¨æœ¬èº«éœ€è¦ç‹¬è‡ªå®ŒæˆPAå®éªŒï¼Œä¸ºäº†å­¦æœ¯è¯šä¿¡ï¼Œè¯·è‡ªè¡Œå®Œæˆåå†å‚è€ƒæœ¬åšå®¢ï¼Œä»Šæ—¥å·çš„æ‡’ï¼Œåœ¨æœªæ¥ä¼šåŠ å€å¿è¿˜ï¼</em></strong></p><h1 id="ä¸åœè®¡ç®—çš„æœºå™¨"><a href="#ä¸åœè®¡ç®—çš„æœºå™¨" class="headerlink" title="ä¸åœè®¡ç®—çš„æœºå™¨"></a>ä¸åœè®¡ç®—çš„æœºå™¨</h1><p>åœ¨PA1ä¸­, æˆ‘ä»¬å·²ç»è§è¯†åˆ°æœ€ç®€å•çš„è®¡ç®—æœºTRMçš„å·¥ä½œæ–¹å¼:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">  ä»PCæŒ‡ç¤ºçš„å­˜å‚¨å™¨ä½ç½®å–å‡ºæŒ‡ä»¤;</span><br><span class="line">  æ‰§è¡ŒæŒ‡ä»¤;</span><br><span class="line">  æ›´æ–°PC;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å¯¹äºå¤§éƒ¨åˆ†æŒ‡ä»¤æ¥è¯´, æ‰§è¡Œå®ƒä»¬éƒ½å¯ä»¥æŠ½è±¡æˆ <strong><em>å–æŒ‡-è¯‘ç -æ‰§è¡Œ</em></strong> çš„æŒ‡ä»¤å‘¨æœŸã€‚å¯¹äºTRMæ¥è¯´ï¼Œåªè¦å†…å­˜æ— é™ï¼Œè¿™ä¸ªå¾ªç¯å°±å¯ä»¥ä¸€ç›´è¿›è¡Œä¸‹å»ï¼Œæ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„ä¸åœè®¡ç®—çš„æœºå™¨ã€‚</p><h1 id="RTFSC-å‹å¥½åœ°é˜…è¯»æºç "><a href="#RTFSC-å‹å¥½åœ°é˜…è¯»æºç " class="headerlink" title="RTFSC(å‹å¥½åœ°é˜…è¯»æºç )"></a>RTFSC(å‹å¥½åœ°é˜…è¯»æºç )</h1><p>æˆ‘ä»¬åœ¨PA1ä¸­æåˆ°:</p><blockquote><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° <strong><em>cpu_exec()</em></strong> æ¨¡æ‹Ÿäº†CPUçš„å·¥ä½œæ–¹å¼: ä¸æ–­æ‰§è¡ŒæŒ‡ä»¤.  <strong><em>fetch_decode_exec_updatepc()</em></strong> å‡½æ•°  <strong><em>(åœ¨nemu/src/cpu/cpu-exec.cä¸­å®šä¹‰)</em></strong> è®©CPUæ‰§è¡Œå½“å‰PCæŒ‡å‘çš„ä¸€æ¡æŒ‡ä»¤, ç„¶åæ›´æ–°PC.</p></blockquote><p>å› æ­¤æˆ‘ä»¬åªéœ€è¦å¼„æ‡‚ <strong><em>fetch_decode_exec_updatepc()</em></strong> çš„å·¥ä½œåŸç†ï¼Œå°±å¯ä»¥å¾ˆå¥½åœ°å®Œæˆ <strong><em>å–æŒ‡-è¯‘ç -æ‰§è¡Œ</em></strong> çš„å·¥ä½œäº†ã€‚<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">fetch_decode_exec_updatepc</span><span class="params">(Decode *s)</span> &#123;</span><br><span class="line">  fetch_decode(s, cpu.pc); <span class="comment">// å–å‡ºæŒ‡ä»¤å¹¶ä¸”è¯‘ç </span></span><br><span class="line">  s-&gt;EHelper(s);           <span class="comment">// æ‰§è¡Œ</span></span><br><span class="line">  cpu.pc = s-&gt;dnpc;        <span class="comment">// æ›´æ–°PC</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="å–æŒ‡-instruction-fetch-IF"><a href="#å–æŒ‡-instruction-fetch-IF" class="headerlink" title="å–æŒ‡(instruction fetch, IF)"></a>å–æŒ‡(instruction fetch, IF)</h2><p>å¦‚æœä½ è·³è½¬åˆ° <strong><em>fetch_decode(s, cpu.pc)</em></strong> çš„å®šä¹‰é‡ŒæŸ¥çœ‹ï¼Œå°±ä¼šå‘ç°è¿™ä¸ªå‡½æ•°çš„å·¥ä½œå°±æ˜¯æŠŠå½“å‰çš„ <strong><em>PC</em></strong> ä¿å­˜åˆ° <strong><em>s</em></strong> çš„æˆå‘˜ <strong><em>pc</em></strong> å’Œ <strong><em>snpc</em></strong> ä¸­, å…¶ä¸­ <strong><em>s-&gt;pc</em></strong> å°±æ˜¯å½“å‰æŒ‡ä»¤çš„ <strong><em>PC</em></strong>, è€Œ <strong><em>s-&gt;snpc</em></strong> åˆ™æ˜¯ä¸‹ä¸€æ¡æŒ‡ä»¤çš„ <strong><em>PC</em></strong>, è¿™é‡Œçš„ <strong><em>snpc</em></strong> æ˜¯ <strong><em>â€œstatic next PCâ€</em></strong> çš„æ„æ€ã€‚</p><p>è€Œè¿™ä¸ªå‡½æ•°ä¸­çš„é‡å¤´æˆå…¶å®æ˜¯ <strong><em>isa_fetch_decode()</em></strong> è¿™ä¸ªå‡½æ•°è°ƒç”¨ã€‚<strong><em>isa_fetch_decode()</em></strong> åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯ä»å†…å­˜ä¸­å–æŒ‡ä»¤ï¼Œè¿™é¡¹å·¥ä½œå…·ä½“ç”± <strong><em>instr_fetch()</em></strong> å‡½æ•°æ¥å®Œæˆã€‚<strong><em>instr_fetch()</em></strong> ä¼šæ ¹æ®ä½ ä¼ å…¥çš„ <strong><em>pc</em></strong> å’ŒæœŸæœ›çš„å­—èŠ‚é•¿åº¦ï¼Œç»è¿‡ä¸€å±‚è½¬å‘æœ€ç»ˆè°ƒç”¨ <strong><em>paddr_read()</em></strong> å‡½æ•°æ¥è®¿é—®ç‰©ç†å†…å­˜ä¸­çš„å†…å®¹ã€‚å› æ­¤å–å€¼æ“ä½œå°±æ˜¯ä¸€ä¸ªç®€å•çš„å†…å­˜è®¿é—®è€Œå·²ã€‚å¹¶ä¸” <strong><em>instr_fetch()</em></strong> å°†è¿”å›ä¸€ä¸ª <strong><em>uint32_t</em></strong> ç±»å‹çš„æ•°æ®ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™ <strong><em>s</em></strong> æŒ‡å‘çš„ <strong><em>Decode</em></strong> ç»“æ„ä½“ï¼Œè¿™æ · <strong><em>Decode </em>s*</strong> æŒ‡å‘çš„ç»“æ„ä½“å°±æŒæœ‰äº†è¯¥æ¡æŒ‡ä»¤çš„å…¨éƒ¨ä¿¡æ¯äº†ï¼Œæ¥ä¸‹æ¥çš„å·¥ä½œå°±æ˜¯è§£æå‡ºè¯¥æŒ‡ä»¤çš„ä¿¡æ¯ã€‚</p><p>è°ƒç”¨ <strong><em>instr_fetch()</em></strong> çš„æ—¶å€™ä¼ å…¥äº† <strong><em>s-&gt;snpc</em></strong> çš„åœ°å€, å› æ­¤ <strong><em>instr_fetch()</em></strong> æœ€åè¿˜ä¼šæ ¹æ® <strong><em>len</em></strong> æ¥æ›´æ–° <strong><em>s-&gt;snpc</em></strong> , ä»è€Œè®© <strong><em>s-&gt;snpc</em></strong> æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚</p><p><strong><em>æ€»ç»“ä¸‹æ¥ï¼Œå–æŒ‡å·¥ä½œå®Œæˆäº†ä¸¤ä»¶äº‹æƒ…ï¼š</em></strong></p><ul><li><strong><em>s</em></strong> æŒ‡å‘çš„ <strong><em>Decode</em></strong> ç»“æ„ä½“è·å¾—å½“å‰ <strong><em>pc</em></strong> æ‰€æŒ‡å‘çš„æŒ‡ä»¤</li><li>æ›´æ–° <strong><em>s-&gt;snpc</em></strong>ï¼Œ è®© <strong><em>s-&gt;snpc</em></strong> æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚</li></ul><p><strong><em>å¦å¤–å¾ˆæœ‰å¿…è¦çš„ä¸€ä»¶äº‹æ˜¯æ¸…æ¥š </em></strong>Decode<strong><em> ç»“æ„ä½“çš„å†…å®¹ï¼Œå…·ä½“åœ°ï¼š</em></strong><br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Decode</span> &#123;</span></span><br><span class="line">  <span class="type">vaddr_t</span> pc;   <span class="comment">// å½“å‰æŒ‡ä»¤å†…å­˜çš„ä½ç½®</span></span><br><span class="line">  <span class="type">vaddr_t</span> snpc; <span class="comment">// static next pc</span></span><br><span class="line">  <span class="type">vaddr_t</span> dnpc; <span class="comment">// dynamic next pc</span></span><br><span class="line">  <span class="type">void</span> (*EHelper)(<span class="keyword">struct</span> Decode *); <span class="comment">// æ‰§è¡ŒæŒ‡ä»¤çš„å‡½æ•° </span></span><br><span class="line">  Operand dest, src1, src2;         <span class="comment">// ç›®æ ‡å’Œæº1 æº2</span></span><br><span class="line">  ISADecodeInfo isa;                <span class="comment">// å®é™…äºŒè¿›åˆ¶æŒ‡ä»¤</span></span><br><span class="line">  IFDEF(CONFIG_ITRACE, <span class="type">char</span> logbuf[<span class="number">128</span>]);  <span class="comment">// æ­¤é¡¹å¯æš‚æ—¶å¿½ç•¥</span></span><br><span class="line">&#125; Decode;</span><br></pre></td></tr></table></figure></p><h2 id="è¯‘ç -instruction-decode-ID"><a href="#è¯‘ç -instruction-decode-ID" class="headerlink" title="è¯‘ç (instruction decode, ID)"></a>è¯‘ç (instruction decode, ID)</h2><p>è¯‘ç çš„ç›®çš„æ˜¯å¾—åˆ°æŒ‡ä»¤çš„æ“ä½œå’Œæ“ä½œå¯¹è±¡, è¿™ä¸»è¦æ˜¯é€šè¿‡æŸ¥çœ‹æŒ‡ä»¤çš„ <strong><em>opcodeï¼ˆæ“ä½œç ï¼‰</em></strong> æ¥å†³å®šçš„ã€‚å½“ç„¶ä¸åŒçš„ <strong><em>ISA</em></strong> çš„ <strong><em>opcode</em></strong> çš„ä½ç½®å’Œç»„ç»‡æ–¹å¼ä¸åŒï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ç›¸åº”çš„æ‰‹å†Œæ¥è·å–è¿™äº›ä¿¡æ¯ã€‚è€Œæˆ‘æ‰€é€‰æ‹©çš„ <strong><em>ISA</em></strong> æ˜¯ <strong><em>RISCV-32</em></strong> , è¿™æ˜¯ä¸€æ¬¾å¹´è½»å¼€æºå¹¶ä¸”æå¯Œæ½œåŠ›çš„ <strong><em>ISA</em></strong>, ä»–çš„æ‰€æœ‰æŒ‡ä»¤éƒ½æ˜¯32ä½å®šé•¿çš„ï¼Œè¿™å¯¹äºæˆ‘ä»¬çš„è¯‘ç æ¥è¯´å°†ä¼šæä¾›å¾ˆå¤§çš„å¸®åŠ©ã€‚</p><p>NEMUä½¿ç”¨ä¸€ç§æŠ½è±¡å±‚æ¬¡æ›´é«˜çš„è¯‘ç æ–¹å¼: <strong><em>æ¨¡å¼åŒ¹é…</em></strong>, å¯ä»¥é€šè¿‡ä¸€ä¸ªæ¨¡å¼å­—ç¬¦ä¸²æ¥æŒ‡å®šæŒ‡ä»¤ä¸­çš„ <strong><em>opcode</em></strong>ã€‚ä»¥æˆ‘æ‰€é€‰çš„ <strong><em>RISCV-32</em></strong> ä¸¾ä¾‹å­ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">def_INSTR_IDTAB(<span class="string">&quot;??????? ????? ????? ??? ????? 01101 11&quot;</span>, U     , lui);</span><br></pre></td></tr></table></figure><br>æ¨¡å¼å­—ç¬¦ä¸²ä¸­åªå…è®¸å‡ºç°4ç§å­—ç¬¦:</p><ul><li>0è¡¨ç¤ºç›¸åº”çš„ä½åªèƒ½åŒ¹é…0</li><li>1è¡¨ç¤ºç›¸åº”çš„ä½åªèƒ½åŒ¹é…1</li><li>?è¡¨ç¤ºç›¸åº”çš„ä½å¯ä»¥åŒ¹é…0æˆ–1</li><li>(ç©ºæ ¼)æ˜¯åˆ†éš”ç¬¦, åªç”¨äºæå‡æ¨¡å¼å­—ç¬¦ä¸²çš„å¯è¯»æ€§, ä¸å‚ä¸åŒ¹é…</li></ul><p>å…¶ä¸­ <strong><em>def_INSTR_IDTAB</em></strong> æ˜¯ä¸€ä¸ªå®ï¼Œå¯¹å…¶è¿›è¡Œå±•å¼€åå¯ä»¥å¾—åˆ°ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">  <span class="type">uint32_t</span> key, mask, shift;</span><br><span class="line">  pattern_decode(<span class="string">&quot;??????? ????? ????? ??? ????? 01101 11&quot;</span>, <span class="number">37</span>, &amp;key, &amp;mask, &amp;shift);</span><br><span class="line">  <span class="keyword">if</span> (((s-&gt;isa.instr.val &gt;&gt; shift) &amp; mask) == key) &#123;</span><br><span class="line">    decode_U(s, <span class="number">0</span>);       <span class="comment">// è¯‘ç è¾…åŠ©å‡½æ•°ï¼Œå…¶ä¸­ç¬¬äºŒä¸ªå‚æ•°widthæ˜¯ä¸“é—¨ä¸ºx86è¿™ç§ä¸å®šé•¿æŒ‡ä»¤å‡†å¤‡çš„ï¼Œ</span></span><br><span class="line">                          <span class="comment">// è€Œæˆ‘é€‰æ‹©çš„RISCV-32å…¶å®å¹¶ä¸éœ€è¦ç¬¬äºŒä¸ªå‚æ•°ï¼Œæ‰€ä»¥ç›´æ¥é»˜è®¤éƒ½æ˜¯ä¸º0</span></span><br><span class="line">    <span class="keyword">return</span> table_lui(s);</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">while</span> (<span class="number">0</span>);</span><br></pre></td></tr></table></figure><br>å¯¹äº <strong><em>pattern_decode</em></strong> å…·ä½“å¦‚ä½•å·¥ä½œä½ å¯ä»¥è·³è½¬åˆ°ä»–çš„å®šä¹‰å»äº†è§£ï¼Œä½†åœ¨è¿™é‡Œå…¶å®ä¸æ˜¯é‡ç‚¹ï¼Œé‡ç‚¹æ˜¯ç»è¿‡ä¸€ç³»åˆ—è½¬æ¢åæˆ‘ä»¬çš„ä¸€æ®µ32ä½çš„å®šé•¿æŒ‡ä»¤å¯ä»¥ç²¾ç¡®åŒ¹é…åˆ° <strong><em>RISCV-32</em></strong> çš„çš„å…­ç§åŸºæœ¬æŒ‡ä»¤æ ¼å¼ï¼š <strong><em>Rã€Iã€Sã€Bã€Uã€Jã€‚</em></strong> </p><p>æ­¤æ—¶æŒ‡ä»¤æ»¡è¶³ä¸Šè¿°å®å±•å¼€çš„ifè¯­å¥, è¡¨ç¤ºåŒ¹é…åˆ° <strong><em>luiæŒ‡ä»¤</em></strong> çš„ç¼–ç , å› æ­¤å°†ä¼šè¿›è¡Œè¿›ä¸€æ­¥çš„è¯‘ç æ“ä½œã€‚</p><p>åˆšæ‰æˆ‘ä»¬åªçŸ¥é“äº†æŒ‡ä»¤çš„å…·ä½“æ“ä½œ(æ¯”å¦‚ <strong><em>luiæŒ‡ä»¤</em></strong> æ˜¯è¯»å…¥ä¸€ä¸ªç«‹å³æ•°åˆ°å¯„å­˜å™¨çš„é«˜ä½), ä½†æˆ‘ä»¬è¿˜æ˜¯ä¸çŸ¥é“æ“ä½œå¯¹è±¡(æ¯”å¦‚ç«‹å³æ•°æ˜¯å¤šå°‘, è¯»å…¥åˆ°å“ªä¸ªå¯„å­˜å™¨)ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜, ä»£ç éœ€è¦è¿›è¡Œè¿›ä¸€æ­¥çš„è¯‘ç å·¥ä½œ, è¿™æ˜¯é€šè¿‡è°ƒç”¨ç›¸åº”çš„ <strong><em>è¯‘ç è¾…åŠ©å‡½æ•°(decode helper function)</em></strong> æ¥å®Œæˆçš„ã€‚</p><p>è¯‘ç è¾…åŠ©å‡½æ•°ç»Ÿä¸€é€šè¿‡å® <strong><em>def_DHelper(åœ¨nemu/include/cpu/decode.hä¸­å®šä¹‰)</em></strong> æ¥å®šä¹‰ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> def_DHelper(name) void concat(decode_, name) (Decode *s)</span></span><br></pre></td></tr></table></figure><br>è¯·æ³¨æ„ï¼Œè¿™å…¶å®åªæ˜¯ä¸ºäº†æ–¹ä¾¿ç”Ÿæˆå¤šä¸ªå‡½æ•°ç­¾åï¼Œå…¶å®æ˜¯æ²¡æœ‰å‡½æ•°ä½“çš„ï¼Œå› ä¸ºæ¯ç§æŒ‡ä»¤çš„çš„æ“ä½œå¯¹è±¡æœ‰å¯èƒ½æ˜¯ç«‹å³æ•°ä¹Ÿå¯èƒ½æ˜¯å¯„å­˜å™¨ï¼Œå…³äºå¦‚ä½•å®šä¹‰å‡½æ•°ä½“æ˜¯è¦æ ¹æ®æ¯ç§æŒ‡ä»¤çš„ç±»å‹æ¥å®šåˆ¶çš„ã€‚</p><p>æ¯ä¸ª <strong><em>è¯‘ç è¾…åŠ©å‡½æ•°</em></strong> è´Ÿè´£è¿›è¡Œä¸€ç§ç±»å‹çš„æ“ä½œæ•°è¯‘ç , æŠŠæŒ‡ä»¤ä¸­çš„æ“ä½œæ•°ä¿¡æ¯åˆ†åˆ«è®°å½•åœ¨è¯‘ç ä¿¡æ¯ <strong><em>s</em></strong> çš„ <strong><em>destæˆå‘˜</em></strong> , <strong><em>src1æˆå‘˜</em></strong> å’Œ <strong><em>src2æˆå‘˜</em></strong> ä¸­, å®ƒä»¬åˆ†åˆ«ä»£è¡¨ç›®çš„æ“ä½œæ•°å’Œä¸¤ä¸ªæºæ“ä½œæ•°ã€‚</p><p>æˆ‘ä»¬ä¼šå‘ç°, ç±»ä¼¼å¯„å­˜å™¨å’Œç«‹å³æ•°è¿™äº›æ“ä½œæ•°, å…¶å®æ˜¯éå¸¸å¸¸è§çš„æ“ä½œæ•°ç±»å‹. ä¸ºäº†è¿›ä¸€æ­¥å®ç° <strong><em>æ“ä½œæ•°è¯‘ç </em></strong> å’Œ <strong><em>æŒ‡ä»¤è¯‘ç </em></strong> çš„è§£è€¦, æ¡†æ¶ä»£ç å¯¹è¿™äº›æ“ä½œæ•°çš„è¯‘ç è¿›è¡Œäº†æŠ½è±¡å°è£…, æŒ‡ä»¤è¯‘ç è¿‡ç¨‹ç”±è‹¥å¹² <strong><em>è¯‘ç æ“ä½œæ•°è¾…åŠ©å‡½æ•°(decode operand helper function)</em></strong> ç»„æˆ. è¯‘ç æ“ä½œæ•°è¾…åŠ©å‡½æ•°ç»Ÿä¸€é€šè¿‡å® <strong><em>def_DopHelper</em></strong> æ¥å®šä¹‰ã€‚<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> def_DopHelper(name) \</span></span><br><span class="line"><span class="meta">  void concat(decode_op_, name) (Decode *s, Operand *op, word_t val, bool flag)</span></span><br></pre></td></tr></table></figure><br><strong><em>DopHelper</em></strong> å¸¦æœ‰ä¸€ä¸ªflagå‚æ•°, ä¸åŒçš„ <strong><em>DopHelper</em></strong> å¯ä»¥ç”¨å®ƒæ¥è¿›è¡Œä¸åŒçš„å¤„ç†. ä¾‹å¦‚å¯„å­˜å™¨çš„ <strong><em>DopHelper</em></strong> å¯ä»¥é€šè¿‡flagæ¥æŒ‡ç¤ºæ˜¯å¦å†™å…¥:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="title function_">def_DopHelper</span><span class="params">(r)</span> &#123;</span><br><span class="line">  <span class="type">bool</span> is_write = flag;</span><br><span class="line">  <span class="type">static</span> <span class="type">word_t</span> zero_null = <span class="number">0</span>;</span><br><span class="line">  op-&gt;preg = (is_write &amp;&amp; val == <span class="number">0</span>) ? &amp;zero_null : &amp;gpr(val);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>åœ¨ <strong><em>mips</em></strong> å’Œ <strong><em>riscv</em></strong> ä¸­, 0å·å¯„å­˜å™¨çš„å€¼æ’ä¸º0, å› æ­¤å¾€0å·å¯„å­˜å™¨çš„å†™å…¥æ“ä½œéƒ½ä¼šè¢«ç¡¬ä»¶å¿½ç•¥. ä¸ºäº†å®ç°è¿™ä¸ªåŠŸèƒ½, ä¸Šè¿°ä»£ç ä¼šåœ¨è¯‘ç çš„æ—¶å€™æ£€æŸ¥æŒ‡ä»¤æ˜¯å¦å°è¯•å¾€0å·å¯„å­˜å™¨è¿›è¡Œå†™å…¥, è‹¥æ˜¯, åˆ™æŠŠå†™å…¥çš„ç›®çš„ä¿®æ”¹æˆä¸€ä¸ª <strong><em>â€œé»‘æ´å˜é‡â€</em></strong> , è¿™ä¸ªå˜é‡ä¸ä¼šè¢«å…¶å®ƒä»£ç è¯»å–, ä»è€Œå®ç°â€å¾€0å·å¯„å­˜å™¨çš„å†™å…¥æ“ä½œéƒ½ä¼šè¢«ç¡¬ä»¶å¿½ç•¥â€çš„æ•ˆæœã€‚</p><p>æœ‰äº†è¿™äº› <strong><em>è¯‘ç æ“ä½œæ•°è¾…åŠ©å‡½æ•°ï¼ˆdef_DopHelperï¼‰</em></strong> , æˆ‘ä»¬å°±å¯ä»¥ç”¨å®ƒä»¬æ¥ç¼–å†™ <strong><em>è¯‘ç è¾…åŠ©å‡½æ•°ï¼ˆdef_DHelperï¼‰</em></strong> äº†, ä¾‹å¦‚ <strong><em>riscv</em></strong> ä¸­ <strong><em>I-å‹æŒ‡ä»¤</em></strong> çš„è¯‘ç è¿‡ç¨‹å¯ä»¥é€šè¿‡å¦‚ä¸‹ä»£ç å®ç°:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="title function_">def_DHelper</span><span class="params">(I)</span> &#123;</span><br><span class="line">  decode_op_r(s, id_src1, s-&gt;isa.instr.i.rs1, <span class="literal">false</span>);       <span class="comment">// def_DopHelper(r)</span></span><br><span class="line">  decode_op_i(s, id_src2, s-&gt;isa.instr.i.simm11_0, <span class="literal">false</span>);  <span class="comment">// def_DopHelper(i)</span></span><br><span class="line">  decode_op_r(s, id_dest, s-&gt;isa.instr.i.rd, <span class="literal">true</span>);         <span class="comment">// def_DopHelper(r)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å›åˆ° <strong><em>def_INSTR_IDTAB</em></strong> çš„å®å±•å¼€ç»“æœ, å¯¹äº <strong><em>luiæŒ‡ä»¤</em></strong>, åœ¨ <strong><em>è¯‘ç è¾…åŠ©å‡½æ•°decode_U()</em></strong> æ‰§è¡Œç»“æŸå, ä»£ç å°†ä¼šæ‰§è¡Œ <strong><em>table_lui()</em></strong> ã€‚<strong><em>table_lui()</em></strong> çš„å®šä¹‰æ–¹å¼æ¯”è¾ƒç‰¹æ®Š, æˆ‘ä»¬åœ¨è¿™é‡Œå…ˆç»™å‡ºéƒ¨åˆ†å®å±•å¼€åçš„å®šä¹‰:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def_THelper(lui) &#123;</span><br><span class="line">  <span class="keyword">return</span> EXEC_ID_lui;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>å® <strong><em>def_THelper(åœ¨nemu/include/cpu/decode.hä¸­å®šä¹‰)</em></strong> ç”¨äºç»Ÿä¸€å®šä¹‰ <strong><em>â€œè¡¨æ ¼è¾…åŠ©å‡½æ•°â€(table helper function)</em></strong> ã€‚ <strong><em>table_lui()</em></strong> åšçš„äº‹æƒ…å¾ˆç®€å•, å®ƒç›´æ¥è¿”å›ä¸€ä¸ªæ ‡è¯†luiæŒ‡ä»¤çš„å”¯ä¸€ID. è¿™ä¸ªIDä¼šä½œä¸ºè¯‘ç ç»“æœçš„è¿”å›å€¼, åœ¨ <strong><em>fetch_decode()</em></strong> ä¸­ç´¢å¼• <strong><em>g_exec_tableæ•°ç»„</em></strong> ã€‚</p><p><strong><em>g_exec_tableæ•°ç»„</em></strong> å…¶å®å°±æ˜¯ä¸€ä¸ªå­˜æ”¾æŒ‡ä»¤æ‰§è¡Œå‡½æ•°æŒ‡é’ˆçš„æ•°ç»„ï¼Œé€šè¿‡æ­£ç¡®çš„IDèƒ½æ˜ å°„åˆ°æ­£ç¡®çš„æŒ‡ä»¤æ‰§è¡Œå‡½æ•°ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™ <strong><em>s</em></strong> æŒ‡å‘çš„ <strong><em>Decode</em></strong> ç»“æ„ä½“ã€‚</p><p><strong><em>äº‹å®ä¸Š, NEMUæŠŠè¯‘ç æ—¶çš„å¦‚ä¸‹æƒ…å†µéƒ½çœ‹ä½œæ˜¯æŸ¥è¡¨è¿‡ç¨‹ï¼š</em></strong></p><ul><li>åœ¨ <strong><em>isa_fetch_decode()</em></strong> ä¸­æŸ¥ <strong><em>ä¸»è¡¨(main decode table)</em></strong> ï¼Œå…¶å®å°±æ˜¯ <strong><em>int idx = table_main(s);</em></strong> è¿™å¥ä»£ç </li><li>åœ¨è¯‘ç è¿‡ç¨‹ä¸­åˆ†åˆ«åŒ¹é…æŒ‡ä»¤ä¸­çš„æ¯ä¸€ä¸ªåŸŸ</li><li>è¯‘ç å‡ºæœ€ç»ˆçš„æŒ‡ä»¤æ—¶è®¤ä¸ºæ˜¯ä¸€ç§ç‰¹æ®Šçš„æŸ¥è¡¨æ“ä½œ, ç›´æ¥è¿”å›æ ‡è¯†è¯¥æŒ‡ä»¤çš„å”¯ä¸€ID</li><li>å¦‚æœæ‰€æœ‰æ¨¡å¼åŒ¹é…è§„åˆ™éƒ½æ— æ³•æˆåŠŸåŒ¹é…, ä»£ç å°†ä¼šè¿”å›ä¸€ä¸ªæ ‡è¯†éæ³•æŒ‡ä»¤çš„ID<br><strong><em>è¸©å‘ç‚¹ä»¥åŠæ„Ÿæ‚Ÿï¼ï¼ï¼ï¼ï¼š</em></strong></li><li>å¿½è§†äº†æŒ‡ä»¤ä¸­ <strong><em>funct3</em></strong> ä»¥åŠ <strong><em>funct7</em></strong> çš„é‡è¦æ€§ï¼Œç”±äº <strong><em>RISCV-32</em></strong> æŒ‡ä»¤çš„é«˜åº¦ç»Ÿä¸€æ€§ï¼Œå¦‚æœä½ æ²¡æœ‰æŠŠæ‰‹å†Œä¸­çš„æ‰€æœ‰æœ‰æ•ˆä¿¡æ¯åœ¨æ¨¡å¼åŒ¹é…çš„æ—¶å€™å®Œå…¨åŒ¹é…ä¸Šï¼Œå°±æœ‰å¯èƒ½ä¼šå‡ºç° <strong><em>æŒ‡é¹¿ä¸ºé©¬</em></strong> çš„å‘çˆ¹æƒ…å†µã€‚ä¾‹å¦‚ <strong><em>ori</em></strong> å’Œ <strong><em>andi</em></strong> è¿™ä¸¤ä¸ªæŒ‡ä»¤ï¼Œä»–ä»¬çš„ <strong><em>opcode</em></strong> å®Œå…¨ä¸€æ ·ï¼Œå”¯ä¸€çš„å·®åˆ«æ˜¯å‰è€…çš„ <strong><em>funct3</em></strong> ä¸º <strong><em>110</em></strong>ï¼Œè€Œåè€…çš„ä¸º <strong><em>111</em></strong>ï¼Œä»…ä¸€ä½ä¹‹å·®ï¼Œå°±æœ‰å¯èƒ½æ˜¯å®Œå…¨ä¸åŒçš„è¯­ä¹‰ï¼Œè¯·åŠ¡å¿…ç‰¹åˆ«å°å¿ƒï¼</li><li>è¾…åŠ©å‡½æ•°å¤ªå¤šï¼Œå®è½¬å‘çœ‹çš„å¤´æ™•ï¼Œå‘†ååŠå¤©éƒ½æ— æ³•ç†è§£æ˜¯å¦‚ä½•å®Œæˆä¸€æ¡æŒ‡ä»¤çš„è¯‘ç çš„ã€‚åŸè®²ä¹‰ä¸­å…³äºå„ç§è¾…åŠ©å‡½æ•°çš„å®å‘½åå®åœ¨å¤ªè¿‡ç›¸åƒä¸”æ²¡æœ‰çªå‡ºæ˜¾ç¤ºï¼Œæ‰€ä»¥åœ¨æˆ‘çš„ç¬”è®°ä¸­æˆ‘ç€é‡çªå‡ºäº†è¾…åŠ©å‡½æ•°çš„åå­—ï¼Œæ–¹ä¾¿å„ä½æŸ¥é˜…ã€‚å…³äºå®è½¬å‘çœ‹çš„å¤´æ™•çš„é—®é¢˜ï¼Œæœ€å¥½çš„è§£å†³åŠæ³•æ˜¯ç”»ä¸€å¼ è¿çº¿å›¾ï¼Œæ¯•ç«Ÿäººè„‘æ— æ³•æ¨¡æ‹Ÿå¤ªå¤æ‚çš„çŠ¶æ€æœºï¼ŒæŠŠè½¬å‘çš„è¿‡ç¨‹ç”»ä¸‹æ¥å°†æ›´æœ‰åŠ©äºä½ ç†è§£è¿™æ•´ä¸ªè¿‡ç¨‹ã€‚</li><li>è¿™é‡Œæˆ‘ç”»äº†ä¸€å¼  <strong><em>luiæŒ‡ä»¤</em></strong> çš„è¯‘ç æµç¨‹å›¾ï¼Œä¾›å¤§å®¶å‚è€ƒï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/è¯‘ç è¿‡ç¨‹å›¾.png" alt=""></li><li>ç»è¿‡è¿™äº›è½¬å‘æˆ‘ä»¬å¾—åˆ°äº†ä»€ä¹ˆï¼Ÿç­”æ¡ˆæ˜¯æˆ‘ä»¬å¾—åˆ°äº†è¯¥æŒ‡ä»¤æ‰€éœ€è¦çš„ <strong><em>ç›®çš„æ“ä½œæ•°å’Œä¸¤ä¸ªæºæ“ä½œæ•°(éƒ¨åˆ†æ˜¯åªæœ‰ä¸€ä¸ªæºæ“ä½œæ•°)</em></strong>ï¼Œå¹¶å°†ä¿¡æ¯å­˜å‚¨åœ¨äº† <strong><em>s</em></strong> æ‰€æŒ‡å‘çš„ <strong><em>Decode</em></strong> ç»“æ„ä½“ä¸­ï¼Œä»¥åŠè¿”å›äº† <strong><em>æŒ‡ä»¤çš„å”¯ä¸€ID</em></strong>ï¼Œ<strong><em>æŒ‡ä»¤çš„å”¯ä¸€ID</em></strong> å°†ä¸ºæˆ‘ä»¬ç´¢å¼• <strong><em>g_exec_tableæ•°ç»„</em></strong> å¹¶å¾—åˆ°è¯¥æŒ‡ä»¤å”¯ä¸€å¯¹åº”çš„æŒ‡ä»¤æ‰§è¡Œå‡½æ•°ï¼Œåœ¨è¿™ä¸ºæˆ‘ä»¬åç»­æ‰§è¡ŒæŒ‡ä»¤çš„æ“ä½œæä¾›äº†å¿…è¦çš„åŸææ–™ã€‚</li></ul><h2 id="æ‰§è¡Œ-execute-EX"><a href="#æ‰§è¡Œ-execute-EX" class="headerlink" title="æ‰§è¡Œ(execute, EX)"></a>æ‰§è¡Œ(execute, EX)</h2><p>è¯‘ç è¿‡ç¨‹ç»“æŸä¹‹å, æ¥ä¸‹æ¥ä¼šè¿”å›åˆ° <strong><em>fetch_decode()</em></strong> ä¸­, å¹¶é€šè¿‡è¿”å›çš„IDæ¥ä» <strong><em>g_exec_tableæ•°ç»„</em></strong> ä¸­é€‰æ‹©ç›¸åº”çš„ <strong><em>æ‰§è¡Œè¾…åŠ©å‡½æ•°(execution helper function)</em></strong> , ç„¶åè®°å½•åˆ° <strong><em>s-&gt;EHelper</em></strong> ä¸­ã€‚</p><p><strong><em>æ‰§è¡Œè¾…åŠ©å‡½æ•°</em></strong> ç»Ÿä¸€é€šè¿‡å® <strong><em>def_EHelper</em></strong> (åœ¨nemu/include/cpu/exec.hä¸­å®šä¹‰)æ¥å®šä¹‰:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> def_EHelper(name) static inline void concat(exec_, name) (Decode *s)</span></span><br></pre></td></tr></table></figure><br>å®ƒä»¬çš„åå­—æ˜¯æŒ‡ä»¤æ“ä½œæœ¬èº«. <strong><em>æ‰§è¡Œè¾…åŠ©å‡½æ•°</em></strong> é€šè¿‡ <strong><em>RTLæŒ‡ä»¤</em></strong> æ¥æè¿°æŒ‡ä»¤çœŸæ­£çš„æ‰§è¡ŒåŠŸèƒ½ (<strong><em>RTLæŒ‡ä»¤</em></strong> å°†åœ¨ä¸‹æ–‡ä»‹ç») ã€‚</p><p>æ¯ä¸ª <strong><em>æ‰§è¡Œè¾…åŠ©å‡½æ•°</em></strong> éƒ½éœ€è¦æœ‰ä¸€ä¸ªæ ‡è¯†è¯¥æŒ‡ä»¤çš„ <strong><em>ID</em></strong> ä»¥åŠä¸€ä¸ª <strong><em>è¡¨æ ¼è¾…åŠ©å‡½æ•°</em></strong> ä¸ä¹‹ç›¸å¯¹åº”, è¿™ä¸€ç‚¹æ˜¯é€šè¿‡ä¸€ç³»åˆ—å®å®šä¹‰æ¥å®ç°çš„ã€‚</p><p>è¡¨ç¤ºæŒ‡ä»¤åˆ—è¡¨çš„å® <strong><em>INSTR_LIST</em></strong> , å®ƒå®šä¹‰äº†NEMUæ”¯æŒçš„æ‰€æœ‰æŒ‡ä»¤ã€‚å…·ä½“çš„å®å±•å¼€è¡Œä¸ºï¼Œäº²è‡ªè¡Œ <strong><em>RTSFC</em></strong> ã€‚</p><h2 id="æ›´æ–°PC"><a href="#æ›´æ–°PC" class="headerlink" title="æ›´æ–°PC"></a>æ›´æ–°PC</h2><p>æ›´æ–°PCçš„æ“ä½œéå¸¸ç®€å•, åªéœ€è¦æŠŠ <strong><em>s-&gt;dnpc</em></strong> èµ‹å€¼ç»™ <strong><em>cpu.pc</em></strong> å³å¯ã€‚æˆ‘ä»¬ä¹‹å‰æåˆ°äº† <strong><em>snpc</em></strong> å’Œ <strong><em>dnpc</em></strong> , ç°åœ¨æ¥è¯´æ˜ä¸€ä¸‹å®ƒä»¬çš„åŒºåˆ«ã€‚<br><div class="note primary modern"><p><strong><em>é™æ€æŒ‡ä»¤å’ŒåŠ¨æ€æŒ‡ä»¤</em></strong><br>åœ¨ç¨‹åºåˆ†æé¢†åŸŸä¸­, é™æ€æŒ‡ä»¤æ˜¯æŒ‡ç¨‹åºä»£ç ä¸­çš„æŒ‡ä»¤, åŠ¨æ€æŒ‡ä»¤æ˜¯æŒ‡ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­çš„æŒ‡ä»¤ã€‚ä¾‹å¦‚å¯¹äºä»¥ä¸‹æŒ‡ä»¤åºåˆ—ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">100: jmp 102</span><br><span class="line">101: add</span><br><span class="line">102: xor</span><br></pre></td></tr></table></figure><br>jmpæŒ‡ä»¤çš„ä¸‹ä¸€æ¡é™æ€æŒ‡ä»¤æ˜¯addæŒ‡ä»¤, è€Œä¸‹ä¸€æ¡åŠ¨æ€æŒ‡ä»¤åˆ™æ˜¯xoræŒ‡ä»¤ã€‚</p></div></p><p>æœ‰äº†é™æ€æŒ‡ä»¤å’ŒåŠ¨æ€æŒ‡ä»¤è¿™ä¸¤ä¸ªæ¦‚å¿µä¹‹å, æˆ‘ä»¬å°±å¯ä»¥è¯´æ˜ <strong><em>snpc</em></strong> å’Œ <strong><em>dnpc</em></strong> çš„åŒºåˆ«äº†: <strong><em>snpc</em></strong> æ˜¯æŒ‡ä»£ç ä¸­çš„ä¸‹ä¸€æ¡æŒ‡ä»¤, è€Œ <strong><em>dnpc</em></strong> æ˜¯æŒ‡ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚<br>æ˜¾ç„¶, æˆ‘ä»¬åº”è¯¥ä½¿ç”¨ <strong><em>s-&gt;dnpc</em></strong> æ¥æ›´æ–° <strong><em>PC</em></strong> , å¹¶ä¸”åœ¨æ‰§è¡Œè¾…åŠ©å‡½æ•°ä¸­æ­£ç¡®ç»´æŠ¤ <strong><em>s-&gt;dnpc</em></strong> ã€‚</p><h1 id="ç”¨RTLè¡¨ç¤ºæŒ‡ä»¤è¡Œä¸º"><a href="#ç”¨RTLè¡¨ç¤ºæŒ‡ä»¤è¡Œä¸º" class="headerlink" title="ç”¨RTLè¡¨ç¤ºæŒ‡ä»¤è¡Œä¸º"></a>ç”¨RTLè¡¨ç¤ºæŒ‡ä»¤è¡Œä¸º</h1><p>åœ¨ <strong><em>NEMU</em></strong> ä¸­, æˆ‘ä»¬ä½¿ç”¨ <strong><em>RTL(å¯„å­˜å™¨ä¼ è¾“è¯­è¨€)</em></strong> æ¥æè¿°æˆ‘ä»¬æŒ‡ä»¤çš„å…·ä½“è¡Œä¸ºã€‚å…¶å®ä½ å¯ä»¥æŠŠ <strong><em>RTL</em></strong> çœ‹ä½œå¾®æŒ‡ä»¤ï¼Œæ¯ä¸€æ¡å…·ä½“æŒ‡ä»¤çš„è¡Œä¸ºéƒ½æ˜¯ç”±å¾®æŒ‡ä»¤æ‹¼å‡‘è€Œæˆçš„ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬å¯¹ <strong><em>NEMU</em></strong> ä¸­ä½¿ç”¨çš„ <strong><em>RTL</em></strong> è¿›è¡Œä¸€äº›è¯´æ˜, é¦–å…ˆæ˜¯ <strong><em>RTLå¯„å­˜å™¨</em></strong> çš„å®šä¹‰. åœ¨NEMUä¸­, <strong><em>RTLå¯„å­˜å™¨</em></strong> ç»Ÿä¸€ä½¿ç”¨ <strong><em>rtlreg_t</em></strong> æ¥å®šä¹‰ã€‚è€Œ <strong><em>rtlreg_t</em></strong> å…¶å®åªæ˜¯ä¸€ä¸ª <strong><em>word_t</em></strong> ç±»å‹ã€‚</p><p>åœ¨ <strong><em>NEMU</em></strong> ä¸­, <strong><em>RTLå¯„å­˜å™¨</em></strong> åªæœ‰ä»¥ä¸‹è¿™äº›ï¼š</p><ul><li>ä¸åŒ <strong><em>ISA</em></strong> çš„é€šç”¨å¯„å­˜å™¨(åœ¨nemu/src/isa/$ISA/include/isa-def.hä¸­å®šä¹‰)</li><li>ä¸´æ—¶å¯„å­˜å™¨ <strong><em>s0, s1, s2å’Œ t0</em></strong> (åœ¨nemu/include/rtl/rtl.hä¸­å®šä¹‰)</li><li>é›¶å¯„å­˜å™¨ <strong><em>rz</em></strong> (åœ¨nemu/include/rtl/rtl.hä¸­å®šä¹‰), å®ƒçš„å€¼æ€»æ˜¯0</li></ul><p>æœ‰äº† <strong><em>RTLå¯„å­˜å™¨</em></strong> , æˆ‘ä»¬å°±å¯ä»¥å®šä¹‰ <strong><em>RTLæŒ‡ä»¤</em></strong> å¯¹å®ƒä»¬è¿›è¡Œçš„æ“ä½œäº†. åœ¨ <strong><em>NEMU</em></strong> ä¸­, <strong><em>RTLæŒ‡ä»¤</em></strong> æœ‰ä¸¤ç§ã€‚</p><ul><li>ä¸€ç§æ˜¯ <strong><em>RTLåŸºæœ¬æŒ‡ä»¤</em></strong> (åœ¨nemu/src/engine/interpreter/rtl-basic.hä¸­å®šä¹‰), å®ƒä»¬çš„ç‰¹ç‚¹æ˜¯ä¸éœ€è¦ä½¿ç”¨ä¸´æ—¶å¯„å­˜å™¨, å¯ä»¥çœ‹åšæ˜¯CPUæ‰§è¡Œè¿‡ç¨‹ä¸­æœ€åŸºæœ¬çš„æ“ä½œ. ä¸åŒçš„ <strong><em>ISA</em></strong> éƒ½å¯ä»¥ä½¿ç”¨ <strong><em>RTLåŸºæœ¬æŒ‡ä»¤</em></strong>, å› æ­¤å®ƒä»¬å±äº <strong><em>ISAæ— å…³</em></strong> çš„ä»£ç ã€‚</li><li>ç¬¬äºŒç§æ˜¯ <strong><em>RTLä¼ªæŒ‡ä»¤</em></strong>, å®ƒä»¬æ˜¯é€šè¿‡ <strong><em>RTLåŸºæœ¬æŒ‡ä»¤</em></strong> æˆ–è€…å·²ç»å®ç°çš„ <strong><em>RTLä¼ªæŒ‡ä»¤</em></strong> æ¥å®ç°çš„ã€‚</li></ul><p>å…¶ä¸­å¤§éƒ¨åˆ† <strong><em>RTLä¼ªæŒ‡ä»¤</em></strong> è¿˜æ²¡æœ‰å®ç°, å¿…è¦çš„æ—¶å€™ä½ éœ€è¦å®ç°å®ƒä»¬ã€‚</p><h1 id="å®ç°æ–°æŒ‡ä»¤"><a href="#å®ç°æ–°æŒ‡ä»¤" class="headerlink" title="å®ç°æ–°æŒ‡ä»¤"></a>å®ç°æ–°æŒ‡ä»¤</h1><p>å¯¹è¯‘ç , æ‰§è¡Œå’Œæ“ä½œæ•°å®½åº¦çš„è§£è€¦å®ç°ä»¥åŠ <strong><em>RTL</em></strong> çš„å¼•å…¥, å¯¹åœ¨ <strong><em>NEMU</em></strong> ä¸­å®ç°å®¢æˆ·æŒ‡ä»¤æä¾›äº†å¾ˆå¤§çš„ä¾¿åˆ©, ä¸ºäº†å®ç°ä¸€æ¡æ–°æŒ‡ä»¤, ä½ åªéœ€è¦ï¼š</p><ul><li>æ·»åŠ æ­£ç¡®çš„æ¨¡å¼åŒ¹é…è§„åˆ™ <strong><em>ï¼ˆnemu/src/isa/$ISA/instr/decode.cï¼‰</em></strong></li><li>ç”¨ <strong><em>RTL</em></strong> å®ç°æ­£ç¡®çš„ <strong><em>æ‰§è¡Œè¾…åŠ©å‡½æ•°</em></strong></li><li>æŠŠæŒ‡ä»¤æ·»åŠ åˆ° <strong><em>ï¼ˆnemu/src/isa/$ISA/include/isa-all-instr.h  INSTR_LISTï¼‰</em></strong> ä¸­</li><li>å¿…è¦æ—¶åœ¨ä¸­æ·»åŠ ç›¸åº”çš„å¤´æ–‡ä»¶ <strong><em>ï¼ˆnemu/src/isa/$ISA/include/isa-exec.hï¼‰</em></strong></li></ul><h2 id="å…³äºæŒ‡ä»¤çš„å®ç°"><a href="#å…³äºæŒ‡ä»¤çš„å®ç°" class="headerlink" title="å…³äºæŒ‡ä»¤çš„å®ç°"></a>å…³äºæŒ‡ä»¤çš„å®ç°</h2><p>ä¸‡äº‹å¼€å¤´éš¾ï¼Œå¦‚æœè¿™æ˜¯ä½ ç¬¬ä¸€æ¬¡å®ç° <strong><em>RISCV-32</em></strong> æŒ‡ä»¤ï¼Œæƒ³å¿…ä¼šæœ‰è®¸å¤šå›°æƒ‘ã€‚æ¯”å¦‚è¿™æ¡æŒ‡ä»¤çš„å…·ä½“è¡Œä¸ºï¼Œè¿™æ¡æŒ‡ä»¤å±äºä»€ä¹ˆç±»å‹ï¼Œå“ªäº›æ˜¯ä¼ªæŒ‡ä»¤ï¼Œå“ªäº›æ˜¯åŸºç¡€æŒ‡ä»¤ç­‰ç­‰è¿™äº›é—®é¢˜ï¼Œä¼šåƒæ´ªæ°´ä¸€æ ·å‘ä½ æ€’æ¶›è¢­æ¥ï¼Œè€Œç¼“è§£ææƒ§çš„æœ€ä½³æ–¹æ³•å°±æ˜¯é˜…è¯»æ‰‹å†Œã€‚å½“ä½ é˜…è¯»æ‰‹å†Œä¹‹åï¼Œä½ æ‰èƒ½å¼„æ‡‚ä¸€åˆ‡ï¼Œä½ æ‰èƒ½å–å›æŒæ¡ä¸€åˆ‡çš„é‚£ç§æ„Ÿè§‰ï¼Œä½ ä¼šå†ä¸€æ¬¡åšä¿¡ï¼Œ<strong><em>è®¡ç®—æœºçš„ä¸–ç•Œé‡Œæ²¡æœ‰é­”æ³•</em></strong> ã€‚æŒæ¡æ„Ÿå’Œç¡®å®šæ€§ï¼Œè¿™æ˜¯ç¼–ç¨‹å¸¦ç»™æˆ‘æœ€ç¾å¦™çš„æ„Ÿè§‰ã€‚</p><p>æˆ‘è¿™é‡Œå°±è®²è§£ä¸€æ¡æœ€ç®€å•çš„ <strong><em>liæŒ‡ä»¤</em></strong> çš„å®ç°ã€‚é¦–å…ˆçœ‹ <strong><em>RV32I</em></strong> åŸºç¡€æŒ‡ä»¤é›†ä¸­æœ‰æ²¡æœ‰ <strong><em>liæŒ‡ä»¤</em></strong>ï¼š</p><p><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQå›¾ç‰‡20220821230158.png" alt=""><br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQå›¾ç‰‡20220821230349.png" alt=""></p><p>æˆ‘ä»¬ä»”ç»†æŸ¥é˜…äº†æŒ‡ä»¤é›†è¡¨åï¼Œå‘ç°å¹¶æ²¡æœ‰æ‰€è°“çš„ <strong><em>liæŒ‡ä»¤</em></strong>ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰å¯èƒ½æ˜¯åœ¨åˆ«çš„åŸºç¡€æŒ‡ä»¤é›†ä¸­å‘¢ï¼Ÿæœ‰è¿™ä¸ªå¯èƒ½ï¼Œå½“ä½ é—®å‡ºè¿™ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œä½ å·²ç»æŒ‰è€ä¸ä½è‡ªå·±æŸ¥é˜…æ‰‹å†Œäº†å§ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å¼€å§‹ï¼Œè¯·å»ä»”ç»†æŸ¥é˜…åæ‰¾åˆ°ä½ æƒ³è¦çš„ç­”æ¡ˆã€‚</p><p>åœ¨è¿™é‡Œæˆ‘ä»¬ç»™å‡ºç­”æ¡ˆï¼Œ<strong><em>liæŒ‡ä»¤</em></strong> æ˜¯ä¸€ä¸ªä¼ªæŒ‡ä»¤ï¼Œå®ƒåªæ˜¯åŸºç¡€æŒ‡ä»¤çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µè€Œå·²ã€‚</p><p><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQå›¾ç‰‡20220821231009.png" alt=""></p><p>å®ƒçš„è¡Œä¸ºä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯è¯»å–ä¸€ä¸ªç«‹å³æ•°åˆ°ç›®çš„å¯„å­˜å™¨è€Œå·²ã€‚å¹¶ä¸”å®˜æ–¹ä¹Ÿæ²¡æœ‰ç»™å‡º <strong><em>liæŒ‡ä»¤</em></strong> çš„æ˜ç¡®å®ç°æ–¹å¼ï¼Œä¸åƒå…¶ä»–ä¼ªæŒ‡ä»¤ä¸€æ ·ï¼Œå¯ä»¥çœ‹åˆ°ä¸€èˆ¬æ˜¯æœ‰å¯¹åº”çš„åŸºç¡€æŒ‡ä»¤çš„ç‰¹æ®Šæƒ…å†µçš„ã€‚è¿™ä¸»è¦æ˜¯å› ä¸º <strong><em>liæŒ‡ä»¤</em></strong> çš„å®ç°å¤ªè¿‡çµæ´»ï¼Œå®˜æ–¹å°±ä¸æ‰“ç®—å…¨éƒ¨åˆ—ä¸¾å‡ºæ¥äº†ã€‚</p><p>è€Œæˆ‘çš„å®ç°ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯åˆ©ç”¨ <strong><em>addiæŒ‡ä»¤</em></strong> æ¥å®ç° <strong><em>liæŒ‡ä»¤</em></strong>ã€‚å…³äº <strong><em>addiæŒ‡ä»¤</em></strong> çš„å…·ä½“è¡Œä¸ºï¼Œå°±äº¤ç»™ä½ è‡ªå·±å»é˜…è¯»æ‰‹å†Œäº†ï¼Œåœ¨è¿™é‡Œæˆ‘åªæé†’ä¸€ç‚¹ï¼Œå…³äº <strong><em>addiæŒ‡ä»¤</em></strong> çš„æºæ“ä½œæ•°ä¸­çš„ <strong><em>immç«‹å³æ•°</em></strong> ï¼Œéœ€è¦è¿›è¡Œä»€ä¹ˆç‰¹æ®Šå¤„ç†å—ï¼Ÿå¦‚æœä½ å¿½ç•¥äº†è¿™ç‚¹ï¼Œæˆ‘å¯ä»¥è‚¯å®š <strong><em>bug</em></strong> å¾ˆå¿«å°±ä¼šæ‰¾ä¸Šé—¨æ¥ã€‚</p><h1 id="ç¨‹åº-è¿è¡Œæ—¶ç¯å¢ƒä¸AM"><a href="#ç¨‹åº-è¿è¡Œæ—¶ç¯å¢ƒä¸AM" class="headerlink" title="ç¨‹åº, è¿è¡Œæ—¶ç¯å¢ƒä¸AM"></a>ç¨‹åº, è¿è¡Œæ—¶ç¯å¢ƒä¸AM</h1><p>ä¸€æ–¹é¢, åº”ç”¨ç¨‹åºçš„è¿è¡Œéƒ½éœ€è¦è¿è¡Œæ—¶ç¯å¢ƒçš„æ”¯æŒ; å¦ä¸€æ–¹é¢, åªè¿›è¡Œçº¯ç²¹è®¡ç®—ä»»åŠ¡çš„ç¨‹åºåœ¨ <strong><em>TRM</em></strong> ä¸Šå°±å¯ä»¥è¿è¡Œ, æ›´å¤æ‚çš„åº”ç”¨ç¨‹åºå¯¹è¿è¡Œæ—¶ç¯å¢ƒå¿…å®šè¿˜æœ‰å…¶å®ƒçš„éœ€æ±‚: ä¾‹å¦‚ä½ ä¹‹å‰ç©çš„è¶…çº§ç›ä¸½éœ€è¦å’Œç”¨æˆ·è¿›è¡Œäº¤äº’, è‡³å°‘éœ€è¦è¿è¡Œæ—¶ç¯å¢ƒæä¾›è¾“å…¥è¾“å‡ºçš„æ”¯æŒ. è¦è¿è¡Œä¸€ä¸ªç°ä»£æ“ä½œç³»ç»Ÿ, è¿˜è¦åœ¨æ­¤åŸºç¡€ä¸ŠåŠ å…¥æ›´é«˜çº§çš„åŠŸèƒ½ã€‚</p><p>å¦‚æœæˆ‘ä»¬æŠŠè¿™äº›éœ€æ±‚éƒ½æ”¶é›†èµ·æ¥, å°†å®ƒä»¬æŠ½è±¡æˆç»Ÿä¸€çš„APIæä¾›ç»™ç¨‹åº, è¿™æ ·æˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ªå¯ä»¥æ”¯æ’‘å„ç§ç¨‹åºè¿è¡Œåœ¨å„ç§æ¶æ„ä¸Šçš„åº“äº†! å…·ä½“åœ°, æ¯ä¸ªæ¶æ„éƒ½æŒ‰ç…§å®ƒä»¬çš„ç‰¹æ€§å®ç°è¿™ç»„API; åº”ç”¨ç¨‹åºåªéœ€è¦ç›´æ¥è°ƒç”¨è¿™ç»„APIå³å¯, æ— éœ€å…³å¿ƒè‡ªå·±å°†æ¥è¿è¡Œåœ¨å“ªä¸ªæ¶æ„ä¸Šã€‚ç”±äºè¿™ç»„ç»Ÿä¸€æŠ½è±¡çš„APIä»£è¡¨äº†ç¨‹åºè¿è¡Œå¯¹è®¡ç®—æœºçš„éœ€æ±‚, æ‰€ä»¥æˆ‘ä»¬æŠŠè¿™ç»„APIç§°ä¸ºæŠ½è±¡è®¡ç®—æœºã€‚</p><p><strong><em>AM(Abstract machine)</em></strong> é¡¹ç›®å°±æ˜¯è¿™æ ·è¯ç”Ÿçš„ã€‚ä½œä¸ºä¸€ä¸ªå‘ç¨‹åºæä¾›è¿è¡Œæ—¶ç¯å¢ƒçš„åº“, <strong><em>AM</em></strong> æ ¹æ®ç¨‹åºçš„éœ€æ±‚æŠŠåº“åˆ’åˆ†æˆä»¥ä¸‹æ¨¡å—ï¼š<br><div class="note primary modern"><p>AM = TRM + IOE + CTE + VME + MPE</p></div></p><ul><li><strong><em>TRM(Turing Machine)</em></strong> - å›¾çµæœº, æœ€ç®€å•çš„è¿è¡Œæ—¶ç¯å¢ƒ, ä¸ºç¨‹åºæä¾›åŸºæœ¬çš„è®¡ç®—èƒ½åŠ›</li><li><strong><em>IOE(I/O Extension)</em></strong> - è¾“å…¥è¾“å‡ºæ‰©å±•, ä¸ºç¨‹åºæä¾›è¾“å‡ºè¾“å…¥çš„èƒ½åŠ›</li><li><strong><em>CTE(Context Extension)</em></strong> - ä¸Šä¸‹æ–‡æ‰©å±•, ä¸ºç¨‹åºæä¾›ä¸Šä¸‹æ–‡ç®¡ç†çš„èƒ½åŠ›</li><li><strong><em>VME(Virtual Memory Extension)</em></strong> - è™šå­˜æ‰©å±•, ä¸ºç¨‹åºæä¾›è™šå­˜ç®¡ç†çš„èƒ½åŠ›</li><li><strong><em>MPE(Multi-Processor Extension)</em></strong> - å¤šå¤„ç†å™¨æ‰©å±•, ä¸ºç¨‹åºæä¾›å¤šå¤„ç†å™¨é€šä¿¡çš„èƒ½åŠ› (MPEè¶…å‡ºäº†ICSè¯¾ç¨‹çš„èŒƒå›´, åœ¨PAä¸­ä¸ä¼šæ¶‰åŠ)</li></ul><div class="note blue modern"><p>(åœ¨NEMUä¸­)å®ç°ç¡¬ä»¶åŠŸèƒ½ -&gt; (åœ¨AMä¸­)æä¾›è¿è¡Œæ—¶ç¯å¢ƒ -&gt; (åœ¨APPå±‚)è¿è¡Œç¨‹åº<br>(åœ¨NEMUä¸­)å®ç°æ›´å¼ºå¤§çš„ç¡¬ä»¶åŠŸèƒ½ -&gt; (åœ¨AMä¸­)æä¾›æ›´ä¸°å¯Œçš„è¿è¡Œæ—¶ç¯å¢ƒ -&gt; (åœ¨APPå±‚)è¿è¡Œæ›´å¤æ‚çš„ç¨‹åº</p></div><h2 id="è¿è¡Œæ›´å¤šç¨‹åº"><a href="#è¿è¡Œæ›´å¤šç¨‹åº" class="headerlink" title="è¿è¡Œæ›´å¤šç¨‹åº"></a>è¿è¡Œæ›´å¤šç¨‹åº</h2><p>åœ¨è¿™ä¸€éƒ¨åˆ†å…¶å®å°±æ˜¯è¦ä¸æ–­ä¸æ–­åœ°å®ç°æ›´å¤šçš„æŒ‡ä»¤ï¼Œæ¥ä½¿æˆ‘ä»¬çš„ç¡¬ä»¶çš„èƒ½åŠ›æ›´åŠ å¼ºå¤§ã€‚å¦‚æœä½ ä¹‹å‰å·²ç»ç‹¬ç«‹å®ç°è¿‡æŒ‡ä»¤äº†ï¼Œé‚£ä¹ˆè¿™é‡Œå¯¹ä½ å…¶å®å·²ç»ä¸å­˜åœ¨ç†è§£ä¸Šçš„å›°éš¾äº†ï¼Œè€Œæ›´å¤šçš„æ˜¯å·¥ç¨‹ä¸Šçš„é—®é¢˜äº†ã€‚</p><p>è¿™é‡Œè´´ä¸€ä¸‹æˆ‘çš„ <strong><em>cpu-tests</em></strong> å…¨é€šè¿‡çš„æˆªå›¾ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQå›¾ç‰‡20220821233848.png" alt=""></p><p>åœ¨è¿™é‡Œæˆ‘å†æŠ›å‡ºå‡ ä¸ªé—®é¢˜ï¼Œéƒ½æ˜¯æˆ‘è®¤ä¸ºçš„éå¸¸å€¼å¾—æ€è€ƒçš„ï¼š</p><ol><li><strong><em>cpu-tests</em></strong> å…¨é€šè¿‡ä»£è¡¨æŒ‡ä»¤å·²ç»æ²¡æœ‰ <strong><em>bug</em></strong> äº†å—ï¼Ÿ</li><li>æˆ‘ä¸æƒ³åœ¨æµ‹è¯•çš„æ—¶å€™ä¸€ä¸‹å°±ç»“æŸäº†ï¼Œå®Œå…¨æ²¡æœ‰ä½¿ç”¨ <strong><em>sdb</em></strong> çš„æœºä¼šï¼Œè¯·é—®æœ‰ä»€ä¹ˆé€‰é¡¹å¯ä»¥å…³é—­æ‰¹å¤„ç†æ¨¡å¼å—ï¼Ÿ<br>ï¼ˆæç¤ºï¼šå…³é”®åœ¨äºå¼„æ¸…æ¥š <strong><em>makefile</em></strong> å¦‚ä½•å‘ <strong><em>NEMU</em></strong> ä¼ å‚ï¼‰</li></ol><h2 id="é‡æ–°è®¤è¯†è®¡ç®—æœº-è®¡ç®—æœºæ˜¯ä¸ªæŠ½è±¡å±‚"><a href="#é‡æ–°è®¤è¯†è®¡ç®—æœº-è®¡ç®—æœºæ˜¯ä¸ªæŠ½è±¡å±‚" class="headerlink" title="é‡æ–°è®¤è¯†è®¡ç®—æœº: è®¡ç®—æœºæ˜¯ä¸ªæŠ½è±¡å±‚"></a>é‡æ–°è®¤è¯†è®¡ç®—æœº: è®¡ç®—æœºæ˜¯ä¸ªæŠ½è±¡å±‚</h2><p>å¤§å®¶åœ¨åšå®éªŒçš„æ—¶å€™ä¹Ÿå¯ä»¥å¤šå¤šæ€è€ƒ: æˆ‘ç°åœ¨å†™çš„ä»£ç ç©¶ç«Ÿä½äºå“ªä¸€ä¸ªæŠ½è±¡å±‚? ä»£ç çš„å…·ä½“è¡Œä¸ºç©¶ç«Ÿæ˜¯ä»€ä¹ˆ?</p><p>å…ˆæ¥è®¨è®ºåœ¨ <strong><em>TRM</em></strong> ä¸Šè¿è¡Œçš„ç¨‹åº, æˆ‘ä»¬å¯¹è¿™äº›ç¨‹åºçš„éœ€æ±‚è¿›è¡Œåˆ†ç±», æ¥çœ‹çœ‹æˆ‘ä»¬çš„è®¡ç®—æœºç³»ç»Ÿæ˜¯å¦‚ä½•æ”¯æ’‘è¿™äº›éœ€æ±‚çš„ï¼š<br>| TRM | è®¡ç®— | å†…å­˜ç”³è¯· | ç»“æŸè¿è¡Œ | æ‰“å°ä¿¡æ¯ |<br>| â€”- | â€”- | â€”- | â€”- | â€”- |<br>|è¿è¡Œç¯å¢ƒ|-|malloc()/free()|-|printf()|<br>|AM API|-|heap|halt()|putch()|<br>|ISAæ¥å£|æŒ‡ä»¤|ç‰©ç†å†…å­˜åœ°å€ç©ºé—´|nemu_trapæŒ‡ä»¤|I/Oæ–¹å¼|<br>|ç¡¬ä»¶æ¨¡å—|å¤„ç†å™¨|ç‰©ç†å†…å­˜|Monitor|Monitor|<br>|ç”µè·¯å®ç°|cpu_exec()|pmem[]|nemu_state    s|serial_io_handler()|</p><p><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/pa-concept.png" alt=""></p><h1 id="åŸºç¡€è®¾æ–½-2"><a href="#åŸºç¡€è®¾æ–½-2" class="headerlink" title="åŸºç¡€è®¾æ–½(2)"></a>åŸºç¡€è®¾æ–½(2)</h1><p>è¿™ä¸€éƒ¨åˆ†ä¸»è¦æ˜¯ç”¨æ¥å®Œå–„å„ç§åŸºç¡€è®¾æ–½çš„ï¼Œç›¸ä¿¡æˆ‘ï¼Œä½ å€¼å¾—ä¸ºäº†è¿™äº›åŸºç¡€è®¾æ–½ä»˜å‡ºç²¾åŠ›ï¼Œè¿™å°†ä¼šä¸ºä½ åé¢è¯Šæ–­ <strong><em>bug</em></strong> çœä¸‹æ— æ•°å®è´µçš„æ—¶é—´ã€‚</p><p>å› ä¸º <strong><em>ftrace</em></strong> åˆ°åé¢å®ç° <strong><em>loader</em></strong> çš„æ—¶å€™è¿˜ä¼šæœ‰æ¶‰åŠï¼Œå°±æš‚ä¸”å…ˆæç½®ä¸‹æ¥åé¢å†ä¸€èµ·è®²ã€‚</p><p>è¿™é‡Œæˆ‘å°±ä¸»è¦è®²æˆ‘æœ€çœ‹é‡çš„è®¾æ–½ä¹‹ä¸€ï¼š<strong><em>difftest</em></strong></p><h2 id="Differential-Testing"><a href="#Differential-Testing" class="headerlink" title="Differential Testing"></a>Differential Testing</h2><p>åœ¨å‰é¢çš„éƒ¨åˆ†ä¸­æˆ‘ä»¬å·²ç»å®ç°äº†å¾ˆå¤šæŒ‡ä»¤äº†ï¼Œå¹¶ä¸”å·²ç»é¡ºåˆ©åœ°é€šè¿‡äº† <strong><em>cpu-tests</em></strong>ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å°±èƒ½å®Œå…¨æ”¾å¿ƒäº†å—ï¼Ÿæˆ‘ä»¬çš„æŒ‡ä»¤çœŸçš„å·²ç»å®Œå…¨åˆä¹æ‰‹å†Œçš„è¦æ±‚äº†å—ï¼Ÿæˆ‘çœ‹æœªå¿…ã€‚<strong><em>bug</em></strong> çš„ç§å­æˆ–è®¸å·²ç»åŸ‹ä¸‹ï¼Œåªæ˜¯åœ¨ç›®å‰è¿˜æ²¡æœ‰å‘èŠ½è€Œå·²ã€‚éšç€æˆ‘ä»¬æµ‹è¯•çš„ç¨‹åºè¶Šæ¥è¶Šå¤æ‚ï¼Œæ±‡ç¼–ä»£ç çš„è¡Œæ•°ä¹Ÿä¼šæš´å¢ï¼Œå¦‚æœæˆ‘ä»¬çš„æŒ‡ä»¤å®ç°å‡ºç°é”™è¯¯ï¼Œå…¶æ¶æœæˆ–è®¸å°†ç»è¿‡ä¸€æ®µå¾ˆé•¿çš„è°ƒç”¨é“¾åæ‰å±•éœ²åœ¨æˆ‘ä»¬é¢å‰ã€‚è¿™å¯¹æˆ‘ä»¬æ¥æ‰¾ <strong><em>bug</em></strong> çš„éš¾åº¦æ¥è¯´å¯ä»¥è¯´æ˜¯å™©æ¢¦çº§åˆ«çš„ã€‚</p><p>å¦‚æœæœ‰ä¸€ç§æ–¹æ³•èƒ½å¤Ÿè¡¨è¾¾æŒ‡ä»¤çš„æ­£ç¡®è¡Œä¸º, æˆ‘ä»¬å°±å¯ä»¥åŸºäºè¿™ç§æ–¹æ³•æ¥è¿›è¡Œç±»ä¼¼ <strong><em>assert()</em></strong> çš„æ£€æŸ¥äº†ã€‚å¬èµ·æ¥å¾ˆç†Ÿæ‚‰å¯¹ä¸å¯¹ï¼Œè¿™å…¶å®å°±æ˜¯æˆ‘ä»¬é«˜ä¸­å°±å­¦è¿‡çš„å¯¹ç…§å®éªŒçš„æ€æƒ³æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥è®©åœ¨ <strong><em>NEMU</em></strong> ä¸­æ‰§è¡Œçš„æ¯æ¡æŒ‡ä»¤ä¹Ÿåœ¨çœŸæœºä¸­æ‰§è¡Œä¸€æ¬¡, ç„¶åå¯¹æ¯” <strong><em>NEMU</em></strong> å’ŒçœŸæœºçš„çŠ¶æ€, å¦‚æœ <strong><em>NEMU</em></strong> å’ŒçœŸæœºçš„çŠ¶æ€ä¸ä¸€è‡´, æˆ‘ä»¬å°±æ•æ‰åˆ° <strong><em>error</em></strong> äº†!</p><p>è¿™å®é™…ä¸Šæ˜¯ä¸€ç§éå¸¸å¥æ•ˆçš„æµ‹è¯•æ–¹æ³•, åœ¨è½¯ä»¶æµ‹è¯•é¢†åŸŸç§°ä¸º <strong><em>differential testing</em></strong> (åç»­ç®€ç§° <strong><em>difftest</em></strong> )ã€‚é€šå¸¸æ¥è¯´, è¿›è¡Œ <strong><em>difftest</em></strong> éœ€è¦æä¾›ä¸€ä¸ªå’Œ <strong><em>DUT(Design Under Test, æµ‹è¯•å¯¹è±¡)</em></strong> åŠŸèƒ½ç›¸åŒä½†å®ç°æ–¹å¼ä¸åŒçš„ <strong><em>REF(Reference, å‚è€ƒå®ç°)</em></strong> , ç„¶åè®©å®ƒä»¬æ¥å—ç›¸åŒçš„æœ‰å®šä¹‰çš„è¾“å…¥, è§‚æµ‹å®ƒä»¬çš„è¡Œä¸ºæ˜¯å¦ç›¸åŒã€‚</p><p>è€Œå…³äº <strong><em>REF</em></strong> ï¼Œæˆ‘é€‰æ‹©çš„æ˜¯ <strong><em>Spike</em></strong>ã€‚<strong><em>Spike</em></strong> æ˜¯ <strong><em>RISC-V</em></strong> ç¤¾åŒºçš„ä¸€æ¬¾å…¨ç³»ç»Ÿæ¨¡æ‹Ÿå™¨, å®ƒçš„å·¥ä½œåŸç†ä¸ <strong><em>NEMU</em></strong> éå¸¸ç±»ä¼¼ã€‚æˆ‘ä»¬å¯ä»¥ä¿¡èµ–å®ƒçš„å®ç°æ˜¯æ­£ç¡®çš„ã€‚</p><p>å®ç° <strong><em>difftest</em></strong> ä¹Ÿéå¸¸ç®€å•ï¼Œæ¡†æ¶ä»£ç å·²ç»å¸®æˆ‘ä»¬å®Œæˆäº†å¤§éƒ¨åˆ†å·¥ä½œã€‚æˆ‘åªéœ€è¦é˜…è¯»æºç ï¼Œä¿è¯å¯„å­˜å™¨æŒ‰ç…§æŸç§é¡ºåºæ’åˆ—ï¼Œç„¶ååœ¨ <strong><em>isa_difftest_checkregs()</em></strong> ä¸­æ·»åŠ éå¸¸å°‘é‡çš„çš„ä»£ç å°±å¯ä»¥å¾—åˆ°ä¸€æ¬¾æ— æ¯”å¼ºå¤§çš„å·¥å…·ã€‚å¤©åº•ä¸‹å¤§æ¦‚æ²¡æœ‰æ¯”è¿™æ›´èµšçš„äº‹æƒ…äº†ã€‚</p><div class="note primary modern"><p>ä½ å¯ä»¥ <strong><em>RTFSC</em></strong> æˆ–è€…ç›´æ¥å»è¯» <strong><em>Spike</em></strong> çš„æ‰‹å†Œï¼Œä½ å¾ˆå®¹æ˜“å°±èƒ½å‘ç°æˆ‘ä»¬çš„ <strong><em>pa</em></strong> æ¡†æ¶æœ¬èº«å°±å·²ç»æŒ‰ç…§ç‰¹å®šé¡ºåºæ’å¥½äº†å¯„å­˜å™¨ï¼ˆå¦‚æœä½ ä¹‹å‰æ²¡æœ‰æ›´æ”¹è¿‡å¯„å­˜å™¨é¡ºåºçš„è¯ï¼‰ã€‚</p></div><div class="note primary modern"><p>åœ¨ <strong><em>isa_difftest_checkregs()</em></strong> ä¸­æˆ‘ä»¬åªéœ€è¦æŠŠ <strong><em>REF</em></strong> å’Œ <strong><em>DUT</em></strong> çš„å¯„å­˜å™¨å’Œ <strong><em>pc</em></strong> å€¼æ¯”è¾ƒä¸€ä¸‹å°±è¡Œäº†ï¼Œå¦‚æœæœ‰ä¸åŒç›´æ¥è¿”å› <strong><em>false</em></strong>ã€‚</p></div><p>åœ¨å¾—åˆ°äº† <strong><em>difftest</em></strong> è¿™ä¸ªå¼ºå¤§çš„å·¥å…·åï¼Œèµ¶ç´§å†å»æµ‹ä¸€ä¸‹ä½ çš„ <strong><em>cpu-tests</em></strong> å§ã€‚å¦‚æœä½ çš„ç¨‹åºè¢« <strong><em>difftest</em></strong> æ‹’ç»äº†ï¼Œé‚£ä¹ˆä½ åº”è¯¥åº†å¹¸æ‰å¯¹ã€‚æˆ‘ä»¬åœ¨ <strong><em>bug</em></strong> è¿˜æœªæˆæ°”å€™ä¹‹å‰å°±æŠŠå®ƒæ‰¼æ€æ‰äº†ï¼ŒçœŸæ˜¯ä¸å¹¸ä¸­çš„ä¸‡å¹¸å•Šã€‚</p><h1 id="è¾“å…¥è¾“å‡º"><a href="#è¾“å…¥è¾“å‡º" class="headerlink" title="è¾“å…¥è¾“å‡º"></a>è¾“å…¥è¾“å‡º</h1><p>è¿™éƒ¨åˆ†å¯è°“æ˜¯æˆ‘åš <strong><em>PA</em></strong> åˆ°ç°åœ¨æœ€ä¸ºéœ‡æ’¼çš„éƒ¨åˆ†ï¼Œåœ¨è¿™é‡Œé¢æˆ‘ä»¬å¾ˆå¿«å°±èƒ½é¢†ç•¥åˆ°è½¯ä»¶å±‚ï¼ˆ<strong><em>AM</em></strong>ï¼‰å’Œç¡¬ä»¶ï¼ˆ<strong><em>NEMU</em></strong>ï¼‰æ˜¯å¦‚ä½•ç´§å¯†é…åˆçš„ï¼Œå¹¶ä¸”ä¸å¾—ä¸æ„Ÿå¹æŠ½è±¡æ˜¯å¤šä¹ˆä¼Ÿå¤§ä¸”ç¾ä¸½çš„æ€æƒ³ã€‚</p><h2 id="ä¸²å£"><a href="#ä¸²å£" class="headerlink" title="ä¸²å£"></a>ä¸²å£</h2><p>ä¸²å£æ˜¯æœ€ç®€å•çš„è¾“å‡ºè®¾å¤‡. <strong><em>nemu/src/device/serial.c</em></strong> æ¨¡æ‹Ÿäº†ä¸²å£çš„åŠŸèƒ½. å…¶å¤§éƒ¨åˆ†åŠŸèƒ½ä¹Ÿè¢«ç®€åŒ–, åªä¿ç•™äº†æ•°æ®å¯„å­˜å™¨. ä¸²å£åˆå§‹åŒ–æ—¶ä¼šåˆ†åˆ«æ³¨å†Œ <strong><em>0x3F8</em></strong> å¤„é•¿åº¦ä¸º <strong><em>8ä¸ªå­—èŠ‚</em></strong> çš„ç«¯å£, ä»¥åŠ <strong><em>0xa00003F8</em></strong> å¤„é•¿åº¦ä¸º <strong><em>8å­—èŠ‚</em></strong> çš„ <strong><em>MMIO</em></strong> ç©ºé—´, å®ƒä»¬éƒ½ä¼šæ˜ å°„åˆ°ä¸²å£çš„æ•°æ®å¯„å­˜å™¨ã€‚</p><p><strong><em>abstract-machine/am/src/platform/nemu/trm.c</em></strong> ä¸­çš„ <strong><em>putch()</em></strong> ä¼šå°†å­—ç¬¦è¾“å‡ºåˆ°ä¸²å£ã€‚</p><p>å› æ­¤å®ç° <strong><em>printf()</em></strong> å…¶å®å¾ˆç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨æˆ‘ä»¬ä¹‹å‰å®ç°è¿‡çš„ <strong><em>vsprintf()</em></strong> æ¥å®ç°è§£è€¦ï¼Œç„¶åæŠŠ <strong><em>buf</em></strong> é‡Œçš„å­—èŠ‚ç”¨ <strong><em>putch</em></strong> è¾“å‡ºå³å¯ã€‚</p><h2 id="æ—¶é’Ÿï¼ˆç²¾åæ‰€åœ¨ï¼‰"><a href="#æ—¶é’Ÿï¼ˆç²¾åæ‰€åœ¨ï¼‰" class="headerlink" title="æ—¶é’Ÿï¼ˆç²¾åæ‰€åœ¨ï¼‰"></a>æ—¶é’Ÿï¼ˆç²¾åæ‰€åœ¨ï¼‰</h2><p>è¿™ä¸€éƒ¨åˆ†çš„å®éªŒä»£ç è®¾è®¡çš„éå¸¸å·§å¦™ï¼Œè¿™é‡Œæˆ‘å°±ä¸å†ä»‹ç»å‰æƒ…ï¼Œç›´æ¥è¿›å…¥æ­£é¢˜ã€‚</p><h3 id="æ—¶é’Ÿçš„æ›´æ–°é€»è¾‘æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#æ—¶é’Ÿçš„æ›´æ–°é€»è¾‘æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="æ—¶é’Ÿçš„æ›´æ–°é€»è¾‘æ˜¯ä»€ä¹ˆï¼Ÿ"></a>æ—¶é’Ÿçš„æ›´æ–°é€»è¾‘æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>å¦‚æœä½ ä»”ç»†åœ° <strong><em>RTFSC</em></strong> äº†ä¹‹åå°±ä¼šçŸ¥é“ï¼Œæ—¶é’Ÿæ›´æ–°çš„é€»è¾‘å…¶å®æ˜¯ç”±ä¸€ä¸ªå›è°ƒå‡½æ•°æ¥æ§åˆ¶çš„ã€‚è€Œé’ˆå¯¹æ—¶é’Ÿæ¥è¯´ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°å…·ä½“çš„å°±æ˜¯ <strong><em>rtc_io_handler()</em></strong> ã€‚å½“ä¸”ä»…å½“æˆ‘ä»¬è¯»å– <strong><em>RTC_ADDR</em></strong> è¿™ä¸ªåœ°å€çš„é«˜ä½çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ‰ä¼šè§¦å‘æ—¶é’Ÿçš„æ›´æ–°é€»è¾‘ã€‚å¦‚æœä½ æ²¡çœ‹æ‡‚æˆ‘åœ¨è¯´ä»€ä¹ˆï¼Œå»ºè®®å›å»å†ä»”ç»†ç ”ç©¶ä¸€ä¸‹æºç ï¼Œå› ä¸ºè¿™å¯¹äºæˆ‘ä»¬è¯»å–åˆ°æ­£ç¡®çš„æ—¶é—´éå¸¸é‡è¦ã€‚ä¸ç„¶å½“åé¢åš    <strong><em>benchmarks</em></strong> çš„æ—¶å€™ï¼Œä½ å¾ˆå¯èƒ½æ— æ³•å¾—åˆ°é¢„æœŸçš„ç»“æœã€‚<strong><em>PA</em></strong> ä»£ç ä¹‹æ‰€ä»¥è¿™æ ·è®¾ç½®ï¼Œå°±æ˜¯å¼ºè¿«æˆ‘ä»¬å»é˜…è¯»æºç ï¼Œå¦‚æœä½ æ²¡æœ‰å¼„æ¸…æ¥šæ›´æ–°é€»è¾‘è€Œèƒ¡ä¹±è¯»å–ä¸€é€šï¼Œä¼šæœ‰å¾ˆå¤§æ¦‚ç‡è¢«å‘åˆ°ä¸è¡Œã€‚</p><h3 id="inl-çš„é­”åŠ›æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ"><a href="#inl-çš„é­”åŠ›æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ" class="headerlink" title="inl() çš„é­”åŠ›æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ"></a>inl() çš„é­”åŠ›æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// inl() çš„å®šä¹‰</span></span><br><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">uint32_t</span> <span class="title function_">inl</span><span class="params">(<span class="type">uintptr_t</span> addr)</span> &#123; <span class="keyword">return</span> *(<span class="keyword">volatile</span> <span class="type">uint32_t</span> *)addr; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¯»å–æ—¶é’Ÿè¿™ä¸ªè®¾å¤‡æ¥è·å–æ—¶é—´</span></span><br><span class="line">inl(RTC_ADDR);</span><br></pre></td></tr></table></figure><p>éš¾é“ä½ å°±æ²¡æœ‰ç–‘æƒ‘è¿‡å—ï¼Ÿå½“æˆ‘ä»¬å†™ä¸‹è¿™è¡Œä»£ç çš„æ—¶å€™ï¼Œæˆ‘ä»¬åˆ°åº•æ˜¯å¦‚ä½•è°ƒç”¨åˆ°æ—¶é’Ÿçš„å›è°ƒå‡½æ•°çš„å‘¢ï¼Ÿæ˜æ˜æˆ‘è¿½è¸ªåˆ° <strong><em>inl()</em></strong> çš„å®šä¹‰ï¼Œä»–ä¸è¿‡åªæ˜¯ä¸€ä¸ªç®€å•çš„è§£å¼•ç”¨çš„åŒ…è£…ç½¢äº†ï¼Œæ ¹æœ¬å°±æ²¡æœ‰è°ƒç”¨ <strong><em>rtc_io_handler()</em></strong> çš„ç—•è¿¹ï¼Œä½•å…¶æ€ªå“‰ã€‚åœ¨æ­æ™“ç­”æ¡ˆä¹‹å‰ï¼Œè¯·è®©æˆ‘ä»¬å…ˆèµç¾æŠ½è±¡ï¼Œæ­£æ˜¯æŠ½è±¡æŠŠè¿™ä¸€åˆ‡éƒ½ä¸²è”äº†èµ·æ¥ã€‚</p><p>è®©æˆ‘ä»¬å…ˆå›æƒ³ä¸€ä¸‹å¯¹äº <strong><em>è½¯ä»¶ï¼ˆAMï¼‰</em></strong> æ¥è¯´ä¸€æ¡è§£å¼•ç”¨è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹ã€‚ä¸€æ¡è§£å¼•ç”¨çš„ <strong><em>Cä»£ç </em></strong> è¢«ç¿»è¯‘æˆæ±‡ç¼–åå…¶å®å°±æ˜¯ä¸€æ¡ <strong><em>load</em></strong> æŒ‡ä»¤ï¼Œ<strong><em>load</em></strong> æ±‡ç¼–æŒ‡ä»¤æœ‰å…¶å¯¹åº”çš„æœºå™¨ç ï¼Œæœºå™¨ç ä¼šè¢«è£…è½½è¿› <strong><em>ç¡¬ä»¶ï¼ˆNEMUï¼‰</em></strong> ä¸­ï¼Œè¿›è¡Œè¯‘ç å’Œæ‰§è¡Œã€‚ã€‚ã€‚ ç­‰ç­‰ï¼è¿™ä¸æ˜¯å‰ä¸ä¹…æˆ‘ä»¬ä¸€ç›´åœ¨åšçš„äº‹å—ï¼Ÿæ˜¯çš„ï¼Œå°±æ˜¯ä½ æƒ³çš„é‚£æ ·ã€‚é‚£ä¹ˆ <strong><em>load</em></strong> æŒ‡ä»¤ä¼šè°ƒç”¨ä»€ä¹ˆå‘¢ï¼Ÿä½ åº”è¯¥å»æ‰¾æŒ‡ä»¤æ‰§è¡Œå‡½æ•°äº†ã€‚åˆ°æœ€åçš„æœ€åï¼Œæˆ‘ä»¬ä¼šè¿½è¸ªåˆ°ä¸€ä¸ªå« <strong><em>paddr_read()</em></strong> çš„å‡½æ•°ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªç¥å¥‡çš„è°ƒç”¨ <strong><em>mmio_read()</em></strong> ã€‚ä¸€åˆ‡çš„ç­”æ¡ˆéƒ½åœ¨é‡Œé¢äº†ã€‚</p><p>ä½ æœ€ç»ˆä¼šå‘ç°ï¼Œé€šè¿‡ä¸€ä¸ªç®€å•çš„ <strong><em>inl()</em></strong> å‡½æ•°ï¼Œæ˜¯çœŸçš„èƒ½è°ƒç”¨åˆ° <strong><em>rtc_io_handler()</em></strong> çš„ï¼è¿™ç®€ç›´æ˜¯å¤ªé…·äº†ï¼è€Œå®ç°è¿™ä¸€åˆ‡çš„åŸç†å¹¶ä¸å¤æ‚ï¼Œå…¶å®å°±æ˜¯ <strong><em>MMIO</em></strong>ï¼Œå°†è®¾å¤‡æ˜ å°„åˆ°å†…å­˜ä¸Šï¼Œæˆ‘ä»¬å¯¹è®¾å¤‡çš„è®¿å­˜ä¹Ÿå°±è¢«æŠ½è±¡æˆäº†å¯¹å†…å­˜çš„è®¿å­˜ï¼Œå°±è·Ÿæˆ‘ä»¬è®¿é—®å…¶ä»–æ™®é€šå†…å­˜çœ‹èµ·æ¥ä¸€æ ·ï¼Œè®©ç”¨æˆ·å®Œå…¨æ„Ÿè§‰ä¸åˆ°å·®å¼‚ã€‚</p><p>è®©æˆ‘ä»¬å†å›è¿‡å¤´æ¥çœ‹ä¸€éæˆ‘ä»¬æ˜¯å¦‚ä½•è¯»å–æ—¶é’Ÿè¿™ä¸ªè®¾å¤‡çš„ï¼š<strong><em>inl(RTC_ADDR) ;</em></strong> </p><p><strong><em>å¤šä¹ˆç®€æ´è€Œæœ‰åŠ›å•Šï¼</em></strong></p><h3 id="çœ‹çœ‹NEMUè·‘å¤šå¿«"><a href="#çœ‹çœ‹NEMUè·‘å¤šå¿«" class="headerlink" title="çœ‹çœ‹NEMUè·‘å¤šå¿«"></a>çœ‹çœ‹NEMUè·‘å¤šå¿«</h3><p>æœ‰äº†æ—¶é’Ÿä¹‹å, æˆ‘ä»¬å°±å¯ä»¥æµ‹è¯•ä¸€ä¸ªç¨‹åºè·‘å¤šå¿«, ä»è€Œæµ‹è¯•è®¡ç®—æœºçš„æ€§èƒ½ã€‚è¿™é‡Œæˆ‘ç»Ÿä¸€åªå±•ç¤ºåœ¨ <strong><em>refæµ‹è¯•é›†</em></strong> ä¸‹æ‰€è·å¾—çš„åˆ†æ•°ã€‚</p><ul><li><strong><em>dhrystone ï¼š</em></strong><br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/G259JJ05]}DB{UMA5O5IRSS.png" alt=""></li><li><strong><em>coremark ï¼š</em></strong><br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/core.png" alt=""></li><li><strong><em>microbench ï¼š</em></strong><br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/microbench.png" alt=""></li></ul><h2 id="é”®ç›˜"><a href="#é”®ç›˜" class="headerlink" title="é”®ç›˜"></a>é”®ç›˜</h2><p>å¦‚æœä½ çœŸæ­£å¼„æ‡‚äº†æ—¶é’Ÿï¼Œè¿™ä¸ªå¯¹ä½ æ¥è¯´åº”è¯¥ä¸æ˜¯é—®é¢˜ã€‚å¦‚æœä½ æŸæ‰‹æ— ç­–ï¼Œé‚£ä¹ˆä½ ä¹Ÿä¸åº”è¯¥ç»§ç»­å¾€ä¸‹åšäº†ï¼Œå¥½å¥½å›å»æŠŠæ—¶é’Ÿå¼„æ‡‚å§ã€‚</p><h2 id="VGA"><a href="#VGA" class="headerlink" title="VGA"></a>VGA</h2><p><strong><em>VGA</em></strong> çš„ç¬¬ä¸€éƒ¨åˆ†è·Ÿæ—¶é’Ÿå…¶å®æ˜¯å¦‚å‡ºä¸€è¾™çš„ã€‚é‡ç‚¹æ˜¯æ‰¾åˆ°é‚£ä¸¤ä¸ªéšè—èµ·æ¥çš„å¯„å­˜å™¨åˆ°åº•åœ¨å“ªé‡Œï¼Œè‡³äºæ˜¯åœ¨å“ªé‡Œæ‰¾ï¼Œåæ­£æˆ‘æ˜¯çŸ¥é“è‚¯å®šæ˜¯å» <strong><em>ç¡¬ä»¶ï¼ˆNEMUï¼‰</em></strong> é‡Œæ‰¾ï¼Œè€Œä¸æ˜¯åœ¨ <strong><em>è½¯ä»¶ï¼ˆAMï¼‰</em></strong> é‡ŒæŠ“çï¼Œç­‰ç€ä»–ä»¬è‡ªå·±å‡ºç°ã€‚è¿™é‡Œå†æç¤ºä¸€ä¸ªå…³é”®è¯ <strong><em>vgactl_port_base</em></strong>ï¼Œå‰©ä¸‹çš„å°±é ä½ è‡ªå·±äº†ã€‚</p><p><strong><em>VGA</em></strong> çš„ç¬¬äºŒéƒ¨åˆ†æ‰æ˜¯é‡é‡çº§ã€‚å…³äºå›¾å½¢ç»˜åˆ¶è¿™å—çš„é€»è¾‘éå¸¸ä¹‹é‡è¦ï¼Œä¸€å®šè¦å½»åº•æŒæ¡ã€‚ä¸ç„¶åˆ°åé¢çš„ <strong><em>PA3</em></strong> å°†æ— æ¯”ç—›è‹¦ã€‚è®²ä¹‰å·²ç»å‘Šè¯‰æˆ‘ä»¬äº†ï¼Œåœ¨ç¬¬ä¸€éƒ¨åˆ†çœ‹åˆ°çš„é’ç»¿è‰²æ¡çº¹ç”»é¢å…¶å®å¹¶ä¸æ˜¯æ­£ç¡®çš„ <strong><em>display test</em></strong> æœŸæœ›çš„è¾“å‡ºç”»é¢ã€‚</p><p>åŸå› æ˜¯ <strong><em>AM_GPU_FBDRAW</em></strong> æ²¡èƒ½æ­£ç¡®å®ç°ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è¿˜æ²¡æœ‰æ­£ç¡®æŠŠ <strong><em>å¸§ç¼“å†²å¯„å­˜å™¨</em></strong> ä¸­çš„æ•°æ®æ›´æ–°åˆ° <strong><em>æ˜¾å­˜</em></strong> ä¸­ã€‚å…·ä½“æ˜¯åœ¨å“ªé‡Œæ›´æ–°ï¼Œåªè¦ä½ è®¤çœŸåœ°è¯»äº† <strong><em>gpu.c</em></strong> ä¸­çš„å‡½æ•°çš„åå­—ï¼Œåº”è¯¥å°±éå¸¸æ˜¾ç„¶äº†ã€‚ä¿—è¯è¯´å¥½çš„å–åå°±æ˜¯æœ€ä½³çš„æ³¨é‡Šï¼Œè¿™å¥è¯å¯ä¸æ˜¯å˜´ä¸Šè¯´è¯´çš„ã€‚</p><p>åˆ«å¿˜äº†è®²ä¹‰ä¸­æé†’æˆ‘è¦å¥½å¥½çœ‹çœ‹ <strong><em>display test</em></strong> çš„æºç ï¼Œåˆ«å·æ‡’ï¼Œè¿™å¯¹æˆ‘ä»¬ç†è§£è½¯ä»¶æ˜¯å¦‚ä½•æ›´æ–°ç”»é¢çš„é€»è¾‘æ˜¯æœ‰å¾ˆå¤§å¸®åŠ©çš„ã€‚å¦‚æœä½ è¯»äº†æºç ä¹‹åå°±ä¼šå‘ç°ï¼Œå…¶å® <strong><em>display test</em></strong> çš„æ›´æ–°é€»è¾‘å¹¶éä¸€æ¬¡å…¨éƒ¨å†™å…¥çš„ï¼Œè€Œæ˜¯å°†æ•´ä¸ª <strong><em>400 </em> 300*</strong> çš„å±å¹•åˆ†æˆäº†å¾ˆå¤šä¸ªå°çŸ©å½¢å—ï¼Œæ¯æ¬¡å†™å…¥ä¸€ä¸ªå°çŸ©å½¢å—åˆ°æ˜¾å­˜ä¸­è¿›è¡Œæ›´æ–°çš„ã€‚</p><p>è¯·æ³¨æ„è¿™é‡Œçš„ <strong><em>400 </em> 300*</strong> ï¼Œè¿™é‡Œæ˜¯ä»¥åƒç´ ä¸ºå•ä½çš„å±å¹•é•¿å®½ï¼Œæˆ‘ä¹‹å‰å°±æ˜¯ç†è§£é”™äº†è¿™é‡Œï¼Œæ‰æ²¡èƒ½æ˜ç™½ <strong><em>display test</em></strong> ä¸­ <strong><em>W / N</em></strong> çš„å«ä¹‰ã€‚ä»€ä¹ˆæ˜¯åƒç´ ï¼Œè¿™é‡Œä½ å¯ä»¥ç†è§£ä¸ºä¸€ä¸ª32ä½å¤§å°çš„æè¿°é¢œè‰²çš„å­—èŠ‚å—ï¼Œè¿™ä¸ªå­—èŠ‚å—çš„å¤§å°ä¸º <strong><em>4ä¸ªå­—èŠ‚</em></strong> ï¼Œä»¥ <strong><em>00RRGGBB</em></strong> è¿™æ ·çš„å½¢å¼æ¥æè¿°é¢œè‰²ã€‚æ‰€ä»¥è¯´ <strong><em>400 </em> 300*</strong> çš„å±å¹•å¤§å°åœ¨å†…å­˜ä¸­æ‰€å çš„å¤§å°å°±ä¸º <strong><em>400 </em> 300 <em> 4</em></strong> ä¸ªå­—èŠ‚ã€‚åé¢æˆ‘åœ¨ç»˜åˆ¶çš„æ—¶å€™ï¼Œé»˜è®¤çš„å•ä½éƒ½æ˜¯åƒç´ ï¼Œè€Œä¸æ˜¯å­—èŠ‚ã€‚</p><p>é˜…è¯» <strong><em>display test</em></strong> å°±èƒ½çŸ¥é“ï¼Œå½“ä¸€ä¸ªçŸ©å½¢å—çš„æ•°æ®å‡†å¤‡å¥½åï¼Œç”¨æˆ·ç¨‹åºå°±ä¼šè°ƒç”¨ <strong><em>AM</em></strong> æä¾›çš„ <strong><em>io_write()</em></strong> æ¥å£ï¼Œåªè¦ä½ ä¸€è·¯è¿½è¸ªï¼Œæœ€åå°±ä¼šæ¥åˆ°æ­£ç¡®æ›´æ–°æ˜¾å­˜çš„åœ°æ–¹ã€‚ç°åœ¨æˆ‘ä»¬çš„ <strong><em>å¸§ç¼“å†²å¯„å­˜å™¨</em></strong> ä¸­å·²ç»æœ‰äº†ç”¨æˆ·ç¨‹åºä¼ è¿‡æ¥çš„çŸ©å½¢å—çš„é¢œè‰²ä¿¡æ¯äº†ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯æŠŠè¿™ä¸ªçŸ©å½¢å—ç»˜åˆ¶åˆ°å±å¹•ä¸Šæ­£ç¡®çš„åæ ‡ä¸Šã€‚å…¶å®ä½ å·²ç»æ³¨æ„åˆ°äº†ï¼Œ<strong><em>ctl</em></strong> ä¸­çš„ <strong><em>pixels</em></strong> æ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œè€Œæˆ‘ä»¬è¦æ ¹æ®ç”¨æˆ·ç¨‹åºä¼ è¿‡æ¥çš„ <strong><em>w</em></strong> å’Œ <strong><em>h</em></strong> å°†å®ƒè¿˜åŸæˆäºŒç»´æ•°ç»„ï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½æ­£ç¡®åœ°å®Œæˆç»˜ç”»ã€‚</p><p>è¿™ä¸€éƒ¨åˆ†å…‰è¯´è¿˜æ˜¯æœ‰ç‚¹å¤ªæŠ½è±¡äº†ï¼Œæˆ‘è¿™é‡Œç”»äº†ä¸€å¼ å›¾ï¼Œå¸Œæœ›èƒ½å¸®åŠ©å¤§å®¶æ›´å¥½ç†è§£ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/`4[{SHB}GGYOJZ774}9AILH.png" alt=""></p><p>å¯¹ç€å›¾è¯´å°±çˆ½å¤šäº†ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨ç”¨ä¸€ç»´æ•°ç»„ <strong><em>pixels</em></strong> ç»˜åˆ¶çš„æ—¶å€™ä¸åªè¦è€ƒè™‘çŸ©å½¢å—æœ¬èº«çš„è¡Œä¼˜å…ˆé—®é¢˜ï¼Œè¿˜è¦è€ƒè™‘å±å¹•æœ¬èº«çš„è¡Œä¼˜å…ˆé—®é¢˜ï¼Œè¿˜è¦è€ƒè™‘ <strong><em>ï¼ˆxï¼Œyï¼‰</em></strong> èµ·å§‹åæ ‡çš„åˆå§‹ <strong><em>offset</em></strong> é—®é¢˜ã€‚è®¡ç®—æœºç»˜å›¾ï¼Œå¾ˆå¥‡å¦™å§ï¼ˆç¬‘ï¼‰ã€‚å¦‚æœä½ å¼€å§‹æ²¡è€ƒè™‘æ¸…æ¥šè¿™å…¶ä¸­çš„é€»è¾‘å…³ç³»ï¼Œæ²¡æœ‰å…³ç³»ï¼Œå¤šæƒ³æƒ³è¿™å¼ å›¾ï¼Œç›¸ä¿¡ä½ è‡ªå·±ä¸€å®šèƒ½è°ƒå¯¹çš„ã€‚</p><p>å¶å¯¹äº†ï¼Œè¯´äº†åŠå¤©ï¼Œè¿˜æ²¡è¯´åˆ°åº•æ€ä¹ˆæŠŠ <strong><em>å¸§ç¼“å†²å¯„å­˜å™¨</em></strong> ä¸­çš„æ•°æ®æ›´æ–°åˆ° <strong><em>æ˜¾å­˜</em></strong> ä¸­ã€‚è®²ä¹‰ç¬¬ä¸€éƒ¨åˆ†ç»™å‡ºçš„æµ‹è¯•ä»£ç å·²ç»ç»™å‡ºäº†è§£ç­”ï¼š<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">uint32_t</span> *fb = (<span class="type">uint32_t</span> *)(<span class="type">uintptr_t</span>)FB_ADDR;</span><br></pre></td></tr></table></figure><br>è¿™æ˜¯ä»€ä¹ˆæ„æ€æï¼Ÿæˆ‘ç›¸ä¿¡è¿™è‚¯å®šéš¾ä¸å€’ä½ äº†ã€‚</p><p>è¿™é‡Œå†æä¸€å˜´æˆ‘é‡åˆ°çš„ä¸€ä¸ªå°å‘ï¼Œ<strong><em>gpu.c</em></strong> ä¸­çš„æ¯ä¸ªå‡½æ•°éƒ½æœ‰å…¶å­˜åœ¨çš„æ„ä¹‰ï¼Œè¯·ç¡®ä¿è‡ªå·±å¼„æ˜ç™½äº†æ¯ä¸ªå‡½æ•°çš„ä½¿å‘½æ˜¯ä»€ä¹ˆï¼Œä»¥åŠä»–ä»¬æ˜¯å¦è¢«è®¾ç½®åœ¨äº†æ­£ç¡®çš„çŠ¶æ€ã€‚</p><h3 id="å±•ç¤ºVGA"><a href="#å±•ç¤ºVGA" class="headerlink" title="å±•ç¤ºVGA"></a>å±•ç¤ºVGA</h3><p><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/vga.png" alt=""></p><h3 id="åœ¨NEMUä¸Šè¿è¡ŒMario"><a href="#åœ¨NEMUä¸Šè¿è¡ŒMario" class="headerlink" title="åœ¨NEMUä¸Šè¿è¡ŒMario"></a>åœ¨NEMUä¸Šè¿è¡ŒMario</h3><p><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/`}OH5(7OFZ0XMI8BW9G_ZTB.png" alt=""></p><h1 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h1><p><a href="https://nju-projectn.github.io/ics-pa-gitbook/ics2021/index.html"><strong><em>https://nju-projectn.github.io/ics-pa-gitbook/ics2021/index.html</em></strong></a></p>]]></content>
      
      
      <categories>
          
          <category> PA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cå’ŒC++ä¸­çš„inline</title>
      <link href="/archives/6aa13749.html"/>
      <url>/archives/6aa13749.html</url>
      
        <content type="html"><![CDATA[<p>inlineæ˜¯Cå’ŒC++ä¸­éƒ½æœ‰çš„å…³é”®å­—ï¼Œè™½ç„¶åå­—ä¸€æ ·ï¼Œä½†åœ¨ä¸€äº›ç»†èŠ‚ä¸Šè¿˜æ˜¯æœ‰äº›è®¸ä¸åŒçš„ã€‚è™½ç„¶ç½‘ç»œä¸Šå…³äºinlineçš„è®¨è®ºå¯è°“æ˜¯ç»œç»ä¸ç»ï¼Œä½†å…¶ä¸­æŸäº›é”™è¯¯è®¤çŸ¥å¯è°“æ˜¯æ·±å…¥äººå¿ƒï¼ˆbushiï¼‰ã€‚å› æ­¤ï¼Œæœ¬æ–‡å°è¯•å¯¹å…¶ä¸­çš„ä¸»è¦è§‚ç‚¹è¿›è¡Œè¯´æ˜å’ŒéªŒè¯ã€‚</p><h2 id="0x1-Cå’ŒC-ä¸­çš„inlineä¸€æ ·å—"><a href="#0x1-Cå’ŒC-ä¸­çš„inlineä¸€æ ·å—" class="headerlink" title="0x1. Cå’ŒC++ä¸­çš„inlineä¸€æ ·å—?"></a>0x1. Cå’ŒC++ä¸­çš„inlineä¸€æ ·å—?</h2><h3 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h3><p>ç­”æ¡ˆæ˜¯ä¸å®Œå…¨ä¸€æ ·ã€‚</p><p>Cè¯­è¨€ä¸­inlineå‡½æ•°ä¸€èˆ¬éƒ½æ˜¯å®šä¹‰åœ¨å¤´æ–‡ä»¶ä¸­ï¼Œä½†è¯·æ³¨æ„ï¼Œæ­¤å®šä¹‰åªæ˜¯æä¾›äº†ä¸€ä¸ªå†…è”ç‰ˆæœ¬ï¼Œå› æ­¤ï¼Œè¯¥å®šä¹‰ä¹Ÿè¢«ç§°ä¸º <em><strong>å†…è”å®šä¹‰</strong></em> ã€‚Cç¼–è¯‘å™¨å¹¶ä¸ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬æä¾›éå†…è”ç‰ˆæœ¬ï¼Œéœ€è¦æˆ‘ä»¬åœ¨æŸä¸€ä¸ª.cæ–‡ä»¶ä¸­æä¾›å¸¸è§„çš„é <strong>inline</strong> é <strong>static</strong> å‡½æ•°ï¼Œæˆ–æ˜¯å£°æ˜ä¸º <strong>extern inline</strong> çš„å‡½æ•°ï¼Œåˆ™æ­¤å®šä¹‰ä¹Ÿè¢«ç§°ä½œ <em><strong>å¤–éƒ¨å®šä¹‰</strong></em> ã€‚å¦‚æœä¸æä¾›ï¼Œåˆ™ä¼šåœ¨é“¾æ¥é˜¶æ®µå‘ç”ŸæŠ¥é”™ï¼Œå› ä¸º <em><strong>å†…è”å®šä¹‰</strong></em> ä¸ä¼šè¢«æ”¾å…¥ç¬¦å·è¡¨ä¸­ï¼Œåœ¨é“¾æ¥æ—¶æ— æ³•æ‰¾åˆ°å·²ç»ç¼–è¯‘å¥½çš„testå‡½æ•°ï¼Œæ‰€ä»¥å‘ç”Ÿäº†é“¾æ¥é”™è¯¯ã€‚</p><p>æ­¤è¡Œä¸ºå·²ç»åœ¨C99æ ‡å‡†è§„å®šäº†ï¼š</p><blockquote><p>å¼•ç”¨è‡ª<a href="https://zh.cppreference.com/w/c/language/inline"><em><strong>cppreference.com</strong></em></a><br><em><strong>â€”â€”ä¸ºé¿å…æœªå®šä¹‰è¡Œä¸ºï¼Œè‹¥åœ¨è¡¨è¾¾å¼ä¸­ä½¿ç”¨æ‹¥æœ‰å¤–éƒ¨é“¾æ¥çš„å‡½æ•°åï¼Œåˆ™ç¨‹åºä¸­å¿…é¡»å­˜åœ¨ä¸€ä¸ªå¤–éƒ¨å®šä¹‰ï¼Œè§ä¸€ä¸ªå®šä¹‰è§„åˆ™ã€‚</strong></em> </p></blockquote><h3 id="ä¾‹å­-1"><a href="#ä¾‹å­-1" class="headerlink" title="ä¾‹å­ 1"></a>ä¾‹å­ 1</h3><p>è¿™é‡Œæˆ‘ä»¬ç»™å‡ºä¾‹å­ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ <strong>Debian</strong> ä¸‹çš„ <strong>gcc 10.2.1</strong>ï¼Œä¼˜åŒ–ç­‰çº§é™å®šåœ¨ <strong>O0</strong>ã€‚</p><p>test.h:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _TEST_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _TEST_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="type">void</span> <span class="title function_">test</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;test!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>main.c:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;test.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> *argv[], <span class="type">const</span> <span class="type">char</span> *envp[])</span> </span><br><span class="line">&#123;</span><br><span class="line">    test();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç¼–è¯‘ï¼Œå¾—åˆ°äº†ä¸€ä¸ªé“¾æ¥é”™è¯¯ï¼Œæç¤º <strong>â€˜testâ€™</strong> ç¬¦å·æ²¡æœ‰æ‰¾åˆ°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">anya@debian:~/OSwork/test-code$ gcc --version</span><br><span class="line">gcc (Debian 10.2.1-6) 10.2.1 20210110</span><br><span class="line">Copyright (C) 2020 Free Software Foundation, Inc.</span><br><span class="line">This is free software; see the source for copying conditions.  There is NO</span><br><span class="line">warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span><br><span class="line"></span><br><span class="line">anya@debian:~/OSwork/test-code$ gcc main.c -o main &amp;&amp; ./main</span><br><span class="line">/usr/bin/ld: /tmp/cc3k3H5m.o: in function `main&#x27;:</span><br><span class="line">main.c:(.text+0x19): undefined reference to `test&#x27;</span><br><span class="line">collect2: error: ld returned 1 exit status</span><br></pre></td></tr></table></figure><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ä¹Ÿå¾ˆç®€å•ï¼Œåœ¨ main.c ä¸­åŠ ä¸Šå¤–éƒ¨å®šä¹‰å³å¯ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;test.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">inline</span> <span class="type">void</span> <span class="title function_">test</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> *argv[], <span class="type">const</span> <span class="type">char</span> *envp[])</span> </span><br><span class="line">&#123;</span><br><span class="line">    test();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘æ‰§è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">anya@debian:~/OSwork/test-code$ gcc main.c -o main &amp;&amp; ./main</span><br><span class="line">test!</span><br></pre></td></tr></table></figure><h3 id="ä¾‹å­-2"><a href="#ä¾‹å­-2" class="headerlink" title="ä¾‹å­ 2"></a>ä¾‹å­ 2</h3><p><em><strong>è€Œå¯¹äºC++æ¥è¯´ï¼ŒåŒä¸€ä»½åŒ…å« inline å‡½æ•°çš„ä»£ç ï¼Œå³ä½¿ä¸åŠ å¤–éƒ¨å®šä¹‰ï¼Œåªéœ€è¦æŠŠåç¼€ä».cæ”¹æˆ.cppï¼Œå°±å¯ä»¥è§£å†³é“¾æ¥é—®é¢˜ã€‚</strong></em> </p><p>è¿™é‡Œæˆ‘ä»¬åªæ˜¯ç®€å•åœ°ä¿®æ”¹äº†æ–‡ä»¶åç¼€åï¼Œä½¿ç”¨åŒæ ·çš„ç¼–è¯‘å™¨å’Œä¼˜åŒ–ç­‰çº§ã€‚</p><p>test.h:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _TEST_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _TEST_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;test!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>main.cpp:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;test.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> *argv[], <span class="type">const</span> <span class="type">char</span> *envp[])</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">test</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘æ‰§è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">anya@debian:~/OSwork/test-code$ g++ main.cpp -o main &amp;&amp; ./main</span><br><span class="line">test!</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œï¼Œå…¶å®æˆ‘ä»¬å°±å·²ç»å®Œæˆäº†è¯æ˜ï¼ŒC++å’ŒCä¸­çš„inlineç¡®å®æ˜¯ä¸ä¸€æ ·çš„ï¼Œ<em><strong>è®¨è®º   inline å…³é”®å­—æ—¶ï¼Œåº”è¯¥åŒºåˆ†Cè¯­è¨€å’ŒC++åˆ†åˆ«è®¨è®ºã€‚</strong></em></p><p>è‡³äºä¸ºä»€ä¹ˆæ”¹æˆ.cppåå°±æ¶ˆé™¤äº†é“¾æ¥é”™è¯¯ï¼Œå¦‚æœè¦å±•å¼€æ¥è¯´åˆæ˜¯ä¸€ç•ªé•¿ç¯‡å¤§è®ºã€‚</p><p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯inlineå®šä¹‰ä¼šåœ¨æ‰€æœ‰ç”¨åˆ°è¯¥å‡½æ•°ä½†æ²¡æœ‰å†…è”çš„.cppä¸­éšå¼å®ä¾‹åŒ–éå†…è”ç‰ˆæœ¬ã€‚</p><p>å¦‚æœä½ æƒ³è¦ååˆ†ç¡®åˆ‡çš„ç†è®ºä¾æ®ï¼Œå¯ä»¥å‚è€ƒæ ‡å‡†çš„è§£é‡Šï¼š</p><blockquote><p>å¼•ç”¨è‡ª<a href="https://zh.cppreference.com/w/cpp/language/inline"><em><strong>cppreference.com</strong></em></a><br><em><strong>â€”â€”å‡½æ•°ä¸å˜é‡ (C++17 èµ·)çš„ inline è¯´æ˜ç¬¦</strong></em></p></blockquote><h2 id="0x2-inlineåœ¨ç°ä»£ç¼–è¯‘å™¨é‡Œç›¸å½“äºå¼±ç¬¦å·æŒ‡ç¤ºç¬¦å—"><a href="#0x2-inlineåœ¨ç°ä»£ç¼–è¯‘å™¨é‡Œç›¸å½“äºå¼±ç¬¦å·æŒ‡ç¤ºç¬¦å—" class="headerlink" title="0x2. inlineåœ¨ç°ä»£ç¼–è¯‘å™¨é‡Œç›¸å½“äºå¼±ç¬¦å·æŒ‡ç¤ºç¬¦å—?"></a>0x2. inlineåœ¨ç°ä»£ç¼–è¯‘å™¨é‡Œç›¸å½“äºå¼±ç¬¦å·æŒ‡ç¤ºç¬¦å—?</h2><h3 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h3><p>åœ¨ç¼–è¯‘æ—¶ï¼Œç¼–è¯‘å™¨å‘æ±‡ç¼–å™¨è¾“å‡ºæ¯ä¸ªå…¨å±€ç¬¦å·ï¼Œæˆ–è€…æ˜¯ <em><strong>å¼ºï¼ˆstrongï¼‰</strong></em>æˆ–è€…æ˜¯ <em><strong>å¼±ï¼ˆweakï¼‰</strong></em>ï¼Œè€Œæ±‡ç¼–å™¨æŠŠè¿™ä¸ªä¿¡æ¯éšå«åœ°ç¼–ç åœ¨å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶çš„ç¬¦å·è¡¨é‡Œã€‚<br>æ ¹æ®å¼ºå¼±ç¬¦å·çš„å®šä¹‰ï¼ŒLinuxé“¾æ¥å™¨ä½¿ç”¨ä¸‹é¢çš„è§„åˆ™æ¥å¤„ç†å¤šé‡å®šä¹‰çš„ç¬¦å·åã€‚</p><ul><li>è§„åˆ™1ï¼šä¸å…è®¸æœ‰å¤šä¸ªåŒåçš„å¼ºç¬¦å·ã€‚</li><li>è§„åˆ™2ï¼šå¦‚æœæœ‰ä¸€ä¸ªå¼ºç¬¦å·å’Œå¤šä¸ªå¼±ç¬¦å·åŒåï¼Œé‚£ä¹ˆé€‰æ‹©å¼ºç¬¦å·ã€‚</li><li>è§„åˆ™3ï¼šå¦‚æœæœ‰å¤šä¸ªå¼±ç¬¦å·åŒåï¼Œé‚£ä¹ˆä»è¿™äº›å¼±ç¬¦å·ä¸­ä»»æ„é€‰æ‹©ä¸€ä¸ªã€‚</li></ul><h3 id="æ­£æ–‡-1"><a href="#æ­£æ–‡-1" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h3><p>å½“å¤šä¸ªç¿»è¯‘å•å…ƒï¼ˆ.cppï¼‰éƒ½å‡ºç°äº†åŒåå†…è”å‡½æ•°ï¼ˆè¿™é‡Œä¸ºäº†ç®€å•ï¼Œæ’é™¤äº†é‡è½½å’Œæ¨¡æ¿çš„æƒ…å†µï¼‰çš„å®šä¹‰æ—¶ï¼Œæˆ‘ä»¬çš„é“¾æ¥å™¨ä¼šå¦‚ä½•é€‰æ‹©å‘¢ï¼Ÿinlineä¼šè®©è¿™äº›åŒåå‡½æ•°æˆä¸ºå¼±ç¬¦å·å—ï¼Ÿ<em><strong>ç­”æ¡ˆæ˜¯ä¸åŒç¼–è¯‘å™¨çš„è¡Œä¸ºä¸ä¸€æ ·ï¼ŒLinux gccä¸‹ç¡®å®æ˜¯å¼±ç¬¦å·ï¼Œè€Œ Windows msvcå´æ˜¯å¼ºç¬¦å·</strong></em>ã€‚æ‰€ä»¥inlineæ˜¯å¼±ç¬¦å·æŒ‡ç¤ºç¬¦æ˜¯ä¸å®Œå…¨æ­£ç¡®çš„ã€‚</p><h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><p>é¦–å…ˆè€ƒè™‘Linux gccä¸‹çš„æƒ…å†µï¼š</p><p>test.h:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _TEST_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _TEST_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;test!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>main.cpp:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;test.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> *argv[], <span class="type">const</span> <span class="type">char</span> *envp[])</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">test</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å’Œç¬¦å·è¡¨ç»“æœå¦‚ä¸‹ï¼Œ<em><strong>W</strong></em>è¡¨ç¤ºå…¨å±€å¼±ç¬¦å·ï¼Œè¯´æ˜inlineä¿®é¥°èµ·åˆ°äº†å¼±ç¬¦å·æŒ‡ç¤ºç¬¦çš„ä½œç”¨ï¼š</p><p><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/nm.png"></p><p>åŒæ ·çš„ä»£ç æˆ‘ä»¬ä¸åŠ æ›´æ”¹ï¼Œåœ¨ Windows ä¸‹æˆ‘ä»¬ä½¿ç”¨ vs2019 è‡ªå¸¦çš„ msvc ç¼–è¯‘å™¨ï¼ŒåŒæ ·æ˜¯ç¼–è¯‘åæŸ¥çœ‹ç¬¦å·ï¼Œå‘ç° test å†…è”å‡½æ•°å¯¹åº”çš„ç¬¦å·å¹¶ä¸æ˜¯å¼±ç¬¦å· <em><strong>W</strong></em> ï¼Œè€Œæ˜¯å…¨å±€ç¬¦å· <em><strong>T</strong></em>ï¼š</p><p><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/msvc-nm.png"></p><h2 id="0x3-ç°ä»£ç¼–è¯‘å™¨é‡Œå¯¹-inline-å…³é”®å­—çš„å†…è”å»ºè®®æ˜¯å¦é‡‡ç”¨"><a href="#0x3-ç°ä»£ç¼–è¯‘å™¨é‡Œå¯¹-inline-å…³é”®å­—çš„å†…è”å»ºè®®æ˜¯å¦é‡‡ç”¨" class="headerlink" title="0x3. ç°ä»£ç¼–è¯‘å™¨é‡Œå¯¹ inline å…³é”®å­—çš„å†…è”å»ºè®®æ˜¯å¦é‡‡ç”¨"></a>0x3. ç°ä»£ç¼–è¯‘å™¨é‡Œå¯¹ inline å…³é”®å­—çš„å†…è”å»ºè®®æ˜¯å¦é‡‡ç”¨</h2><p>inline å…³é”®è¯çš„æœ¬æ„æ˜¯ä½œä¸ºç»™ä¼˜åŒ–å™¨çš„æŒ‡ç¤ºå™¨ï¼Œä»¥æŒ‡ç¤ºä¼˜å…ˆé‡‡ç”¨å‡½æ•°çš„å†…è”æ›¿æ¢è€Œéè¿›è¡Œå‡½æ•°è°ƒç”¨ï¼Œå³å¹¶ä¸æ‰§è¡Œå°†æ§åˆ¶è½¬ç§»åˆ°å‡½æ•°ä½“å†…çš„å‡½æ•°è°ƒç”¨ CPU æŒ‡ä»¤ï¼Œè€Œæ˜¯ä»£ä¹‹ä»¥æ‰§è¡Œå‡½æ•°ä½“çš„ä¸€ä»½å‰¯æœ¬è€Œæ— éœ€ç”Ÿæˆè°ƒç”¨ã€‚è¿™ä¼šé¿å…å‡½æ•°è°ƒç”¨çš„å¼€é”€ï¼ˆä¼ é€’å®å‚åŠè¿”å›ç»“æœï¼‰ï¼Œä½†å®ƒå¯èƒ½å¯¼è‡´æ›´å¤§çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå› ä¸ºå‡½æ•°ä½“å¿…é¡»è¢«å¤åˆ¶å¤šæ¬¡ã€‚</p><p>ä½†åœ¨ C++17 ä»¥åï¼Œinline å¯¹äºå‡½æ•°çš„å«ä¹‰å·²ç»å˜ä¸ºâ€œå®¹è®¸å¤šæ¬¡å®šä¹‰â€è€Œä¸æ˜¯â€œä¼˜å…ˆå†…è”â€ã€‚é‚£ä¹ˆç°ä»£ CPP ç¼–è¯‘å™¨å¯¹äºä¸€ä¸ª inline å‡½æ•°æ˜¯å¦é‡‡å–å†…è”ï¼Œå…¶å®å°±æ¯”è¾ƒçœ‹å¿ƒæƒ…äº†ï¼Œå› ä¸ºæ ‡å‡†ä¸­ä¹Ÿæ²¡æœ‰å¼ºåˆ¶ inline å‡½æ•°ä¸€å®šè¦äº§ç”Ÿå†…è”ã€‚ä½†å¯¹äºç¼–è¯‘å™¨å…·ä½“çš„è¡Œä¸ºå¦‚ä½•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªæ–¹ä¾¿çš„ç½‘ç«™æ¥ç›´æ¥æŸ¥çœ‹ï¼š<a href="https://gcc.godbolt.org/"><em><strong>https://gcc.godbolt.org/</strong></em></a></p><h3 id="ä¾‹å­-1-1"><a href="#ä¾‹å­-1-1" class="headerlink" title="ä¾‹å­ 1"></a>ä¾‹å­ 1</h3><p>å¯¹äºä¸€ä¸ªååˆ† trivial çš„ <code>inline int add(int a, int b);</code> å‡½æ•°ï¼Œç†è®ºä¸Šä»–æ˜¯å…·å¤‡å†…è”çš„æ¡ä»¶çš„ã€‚æˆ‘åœ¨ä¸‰å¤§ä¸»æµçš„ C++ ç¼–è¯‘å™¨ä¸Šéƒ½è¿›è¡Œäº†æµ‹è¯•ï¼Œä¼˜åŒ–å‚æ•°éƒ½é€‰æ‹©çš„æ˜¯ -O0ï¼Œå…¶ç»“æœå¦‚ä¸‹ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221027195123.png"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ -O0 çš„ä¼˜åŒ–ä¸‹ï¼Œä¸‰å¤§ç¼–è¯‘å™¨éƒ½æ²¡æœ‰é€‰æ‹©è¿›è¡Œå†…è”ä¼˜åŒ–ã€‚å½“ä¼˜åŒ–ç­‰çº§æ›´é«˜æ—¶ï¼Œå³ä½¿ä¸ç”¨ inline å…³é”®è¯ <code>inline int add(int a, int b);</code> å‡½æ•°ä¹Ÿä¼šè¢«ä¼˜åŒ–æ‰ï¼š<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/QQ%E5%9B%BE%E7%89%8720221027195524.png"></p><p>å› æ­¤ï¼Œå¯¹äº C++ æ¥è¯´ï¼Œæˆ‘ä»¬ä¸å»ºè®®å¯¹äº inline å…³é”®è¯çš„ â€œä¼˜å…ˆå†…è”â€ ä½œç”¨æŠ±æœ‰å¤ªå¤§æœŸå¾…ï¼Œè€Œæ˜¯åº”è¯¥å°†è®¤çŸ¥è½¬å‘è‡ª C++17 å inline å…³é”®è¯è¢«èµ‹äºˆçš„ â€œå®¹è®¸å¤šæ¬¡å®šä¹‰â€ å«ä¹‰ã€‚</p><h2 id="0x4-å°ç»“"><a href="#0x4-å°ç»“" class="headerlink" title="0x4 å°ç»“"></a>0x4 å°ç»“</h2><p>æœ¬æ–‡é€šè¿‡å¼•ç”¨<a href="https://zh.cppreference.com/w/cpp/language/inline"><em><strong>cppreference.com</strong></em></a>ä¸­å…³äºæ ‡å‡†çš„é˜è¿°ï¼Œå¹¶ç»“åˆå®é™…çš„ä»£ç ï¼Œåœ¨ä¸åŒå¹³å°å’Œç¼–è¯‘å™¨ä¸Šè¿›è¡ŒéªŒè¯ï¼Œå¾—åˆ°ä¸€äº›ç»“è®ºï¼š</p><ol><li>C çš„ inline å’Œ C++ çš„ inline ä¸ä¸€æ ·ï¼Œå°½ç®¡ C çš„ inline æ˜¯å€Ÿé‰´çš„ C++</li><li>å¤šä¸ªç¿»è¯‘å•å…ƒä¸­çš„åŒåé static çš„ inline å‡½æ•°ï¼Œå¯èƒ½è¢«å½“åšå…¨å±€å¼±ç¬¦å·ï¼Œä¹Ÿå¯èƒ½æ˜¯å…¨å±€å¼ºç¬¦å·</li><li>ç°ä»£ C++ ç¼–è¯‘å™¨å¯¹äºä¸€ä¸ª inline å‡½æ•°æ˜¯å¦å±•å¼€ï¼Œä»æ ‡å‡†åˆ°å®ç°ä¸Šéƒ½æ˜¯æ²¡æœ‰ä¿è¯çš„ï¼Œå³ä½¿æ˜¯ä¸€ä¸ªååˆ† trivial çš„å‡½æ•°</li></ol>]]></content>
      
      
      <categories>
          
          <category> C/C++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cå’ŒC++ä¸­çš„inline </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gitå¸¸ç”¨å‘½ä»¤</title>
      <link href="/archives/caff8000.html"/>
      <url>/archives/caff8000.html</url>
      
        <content type="html"><![CDATA[<h2 id="åˆå§‹åŒ–æœ¬åœ°ä»“åº“"><a href="#åˆå§‹åŒ–æœ¬åœ°ä»“åº“" class="headerlink" title="åˆå§‹åŒ–æœ¬åœ°ä»“åº“"></a>åˆå§‹åŒ–æœ¬åœ°ä»“åº“</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; git init</span><br></pre></td></tr></table></figure><h2 id="ç¡®è®¤å·¥ä½œæ ‘å’Œç´¢å¼•çš„çŠ¶æ€"><a href="#ç¡®è®¤å·¥ä½œæ ‘å’Œç´¢å¼•çš„çŠ¶æ€" class="headerlink" title="ç¡®è®¤å·¥ä½œæ ‘å’Œç´¢å¼•çš„çŠ¶æ€"></a>ç¡®è®¤å·¥ä½œæ ‘å’Œç´¢å¼•çš„çŠ¶æ€</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; git status</span><br></pre></td></tr></table></figure><h2 id="å°†æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒº"><a href="#å°†æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒº" class="headerlink" title="å°†æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒº"></a>å°†æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒº</h2><p>åœ¨ [file] æŒ‡å®šåŠ å…¥æš‚å­˜åŒºçš„æ–‡ä»¶, ç”¨ç©ºæ ¼åˆ†éš”å¤šä¸ªæ–‡ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; git add [file]..</span><br><span class="line"><span class="comment">## e.g.</span></span><br><span class="line">&gt;&gt; git add README.md</span><br><span class="line">&gt;&gt; git add README.md main.cpp</span><br></pre></td></tr></table></figure><h2 id="å°†æ‰€æœ‰æ–°æ–‡ä»¶ã€æ›´æ”¹è¿‡çš„æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒº"><a href="#å°†æ‰€æœ‰æ–°æ–‡ä»¶ã€æ›´æ”¹è¿‡çš„æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒº" class="headerlink" title="å°†æ‰€æœ‰æ–°æ–‡ä»¶ã€æ›´æ”¹è¿‡çš„æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒº"></a>å°†æ‰€æœ‰æ–°æ–‡ä»¶ã€æ›´æ”¹è¿‡çš„æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒº</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; git add .</span><br></pre></td></tr></table></figure><h2 id="æäº¤æ›´æ”¹-å°†æš‚å­˜åŒºå†…å®¹æ·»åŠ åˆ°æœ¬åœ°ä»“åº“ä¸­"><a href="#æäº¤æ›´æ”¹-å°†æš‚å­˜åŒºå†…å®¹æ·»åŠ åˆ°æœ¬åœ°ä»“åº“ä¸­" class="headerlink" title="æäº¤æ›´æ”¹, å°†æš‚å­˜åŒºå†…å®¹æ·»åŠ åˆ°æœ¬åœ°ä»“åº“ä¸­"></a>æäº¤æ›´æ”¹, å°†æš‚å­˜åŒºå†…å®¹æ·»åŠ åˆ°æœ¬åœ°ä»“åº“ä¸­</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; git commit -m <span class="string">&quot;first commit&quot;</span></span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹æ›´æ”¹æ—¥å¿—"><a href="#æŸ¥çœ‹æ›´æ”¹æ—¥å¿—" class="headerlink" title="æŸ¥çœ‹æ›´æ”¹æ—¥å¿—"></a>æŸ¥çœ‹æ›´æ”¹æ—¥å¿—</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; git <span class="built_in">log</span></span><br></pre></td></tr></table></figure><h2 id="æ·»åŠ ä¸€ä¸ªè¿œç¨‹å­˜å‚¨åº“"><a href="#æ·»åŠ ä¸€ä¸ªè¿œç¨‹å­˜å‚¨åº“" class="headerlink" title="æ·»åŠ ä¸€ä¸ªè¿œç¨‹å­˜å‚¨åº“"></a>æ·»åŠ ä¸€ä¸ªè¿œç¨‹å­˜å‚¨åº“</h2><p>è¯·ä½¿ç”¨remoteæŒ‡ä»¤æ·»åŠ è¿œç¨‹æ•°æ®åº“ã€‚åœ¨ [name] å¤„è¾“å…¥è¿œç¨‹æ•°æ®åº“åç§°ï¼Œåœ¨ [url] å¤„æŒ‡å®šè¿œç¨‹æ•°æ®åº“çš„URLã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; git remote add [name] [url]</span><br><span class="line"><span class="comment">## e.g.</span></span><br><span class="line">&gt;&gt; git remote add origin https://[space_id].backlogtool.com/git/[project_key]/tutorial.git</span><br></pre></td></tr></table></figure><blockquote><p><em><strong>tips:</strong></em> æ‰§è¡Œæ¨é€æˆ–è€…æ‹‰å–çš„æ—¶å€™ï¼Œå¦‚æœçœç•¥äº†è¿œç¨‹æ•°æ®åº“çš„åç§°ï¼Œåˆ™é»˜è®¤ä½¿ç”¨åä¸ºâ€originâ€œçš„è¿œç¨‹æ•°æ®åº“ã€‚å› æ­¤ä¸€èˆ¬éƒ½ä¼šæŠŠè¿œç¨‹æ•°æ®åº“å‘½åä¸ºoriginã€‚</p></blockquote><h2 id="å°†åˆ†æ”¯æ¨é€åˆ°ä½ çš„è¿œç¨‹å­˜å‚¨åº“"><a href="#å°†åˆ†æ”¯æ¨é€åˆ°ä½ çš„è¿œç¨‹å­˜å‚¨åº“" class="headerlink" title="å°†åˆ†æ”¯æ¨é€åˆ°ä½ çš„è¿œç¨‹å­˜å‚¨åº“"></a>å°†åˆ†æ”¯æ¨é€åˆ°ä½ çš„è¿œç¨‹å­˜å‚¨åº“</h2><p>[remote-name&#x3D;origin] å¤„è¾“å…¥ç›®æ ‡åœ°å€ï¼Œ[branch-name] å¤„æŒ‡å®šæ¨é€çš„åˆ†æ”¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; git push [remote-name=origin] [branch-name]</span><br><span class="line"><span class="comment">## e.g.</span></span><br><span class="line">&gt;&gt; git push -u origin master</span><br></pre></td></tr></table></figure><blockquote><p><em><strong>tips:</strong></em> è¿è¡Œä»¥ä¸‹å‘½ä»¤ä¾¿å¯å‘è¿œç¨‹æ•°æ®åº“â€˜originâ€™è¿›è¡Œæ¨é€ã€‚å½“æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œå¦‚æœæ‚¨æŒ‡å®šäº†-ué€‰é¡¹ï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡æ¨é€æ—¶å°±å¯ä»¥çœç•¥åˆ†æ”¯åç§°äº†ã€‚ä½†æ˜¯ï¼Œé¦–æ¬¡è¿è¡ŒæŒ‡ä»¤å‘ç©ºçš„è¿œç¨‹æ•°æ®åº“æ¨é€æ—¶ï¼Œå¿…é¡»æŒ‡å®šè¿œç¨‹æ•°æ®åº“åç§°å’Œåˆ†æ”¯åç§°ã€‚</p></blockquote><h2 id="æ‹·è´Gitä»“åº“åˆ°æœ¬åœ°"><a href="#æ‹·è´Gitä»“åº“åˆ°æœ¬åœ°" class="headerlink" title="æ‹·è´Gitä»“åº“åˆ°æœ¬åœ°"></a>æ‹·è´Gitä»“åº“åˆ°æœ¬åœ°</h2><p>åœ¨ [repository] æŒ‡å®šè¿œç¨‹æ•°æ®åº“çš„URLï¼Œåœ¨ [directory] æŒ‡å®šæ–°ç›®å½•çš„åç§°ã€‚[directory] å¯çœç•¥ä¸å†™ï¼Œåˆ™é»˜è®¤ clone åˆ°å½“å‰ç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; git <span class="built_in">clone</span> [repository] [directory]</span><br><span class="line"><span class="comment">## e.g.</span></span><br><span class="line">&gt;&gt; git <span class="built_in">clone</span> https://github.com/Anyacoding/AnyaSTL.git myblog</span><br></pre></td></tr></table></figure><h2 id="ä»è¿œç¨‹å­˜å‚¨åº“ä¸­æ‹‰å–æ›´æ”¹"><a href="#ä»è¿œç¨‹å­˜å‚¨åº“ä¸­æ‹‰å–æ›´æ”¹" class="headerlink" title="ä»è¿œç¨‹å­˜å‚¨åº“ä¸­æ‹‰å–æ›´æ”¹"></a>ä»è¿œç¨‹å­˜å‚¨åº“ä¸­æ‹‰å–æ›´æ”¹</h2><p>ä½¿ç”¨pullæŒ‡ä»¤è¿›è¡Œæ‹‰å–æ“ä½œã€‚çœç•¥æ•°æ®åº“åç§°çš„è¯ï¼Œä¼šåœ¨åä¸ºoriginçš„æ•°æ®åº“è¿›è¡Œpullã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; git pull [repository] [branch-name]</span><br><span class="line"><span class="comment">## e.g.</span></span><br><span class="line">&gt;&gt; git pull origin master</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Gitå¸¸ç”¨å‘½ä»¤ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å½’å¹¶æ’åº</title>
      <link href="/archives/bb0c7ac5.html"/>
      <url>/archives/bb0c7ac5.html</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æƒ³èµ·å¾ˆä¹…ä¹‹å‰æ›¾åœ¨Leetcodeåˆ·åˆ°è¿‡ä¸€é“å¾ˆç»å…¸çš„å½’å¹¶æ’åºçš„é¢˜ç›®ï¼Œè™½ç„¶é¢˜ç›®ä¸éš¾ï¼Œä½†å®ç°èµ·æ¥å¹¶æ²¡æœ‰æƒ³è±¡ä¸­é‚£ä¹ˆå®¹æ˜“ã€‚ä¸ºäº†æ–¹ä¾¿æ—¥åæŸ¥é˜…ï¼Œåœ¨è¿™é‡Œç‰¹åœ°è®°å½•ä¸€ä¸‹</p><h2 id="ç®—æ³•ä»‹ç»"><a href="#ç®—æ³•ä»‹ç»" class="headerlink" title="ç®—æ³•ä»‹ç»"></a>ç®—æ³•ä»‹ç»</h2><h3 id="åŸºæœ¬æ€æƒ³"><a href="#åŸºæœ¬æ€æƒ³" class="headerlink" title="åŸºæœ¬æ€æƒ³"></a>åŸºæœ¬æ€æƒ³</h3><p>å½’å¹¶æ’åºï¼ˆMerge sortï¼‰æ˜¯å»ºç«‹åœ¨å½’å¹¶æ“ä½œä¸Šçš„ä¸€ç§æœ‰æ•ˆçš„æ’åºç®—æ³•ã€‚è¯¥ç®—æ³•æ˜¯é‡‡ç”¨åˆ†æ²»æ³•ï¼ˆDivide and Conquerï¼‰çš„ä¸€ä¸ªéå¸¸å…¸å‹çš„åº”ç”¨ã€‚</p><p>ä½œä¸ºä¸€ç§å…¸å‹çš„åˆ†è€Œæ²»ä¹‹æ€æƒ³çš„ç®—æ³•åº”ç”¨ï¼Œå½’å¹¶æ’åºçš„å®ç°ç”±ä¸¤ç§æ–¹æ³•ï¼š</p><ul><li>è‡ªä¸Šè€Œä¸‹çš„é€’å½’ï¼ˆæ‰€æœ‰é€’å½’çš„æ–¹æ³•éƒ½å¯ä»¥ç”¨è¿­ä»£é‡å†™ï¼Œæ‰€ä»¥å°±æœ‰äº†ç¬¬ 2 ç§æ–¹æ³•ï¼‰ï¼›</li><li>è‡ªä¸‹è€Œä¸Šçš„è¿­ä»£ï¼›</li></ul><p>ä¸ºäº†ä»£ç çš„ç®€æ´ï¼Œæˆ‘è¿™é‡Œé‡‡ç”¨çš„æ˜¯é€’å½’çš„å†™æ³•ã€‚</p><h3 id="å›¾è§£"><a href="#å›¾è§£" class="headerlink" title="å›¾è§£"></a>å›¾è§£</h3><blockquote><p><em><strong>é¦–å…ˆæ„Ÿè°¢<a href="https://www.cnblogs.com/chengxiao/p/6194356.html">å›¾è§£æ’åºç®—æ³•(å››)ä¹‹å½’å¹¶æ’åº</a>è¿™ç¯‡æ–‡ç« çš„ä½œè€…ï¼Œå¯¹äºå½’å¹¶æ’åºçš„æµç¨‹ä»–å®Œæˆäº†å‡ å¹…å¾ˆç²¾ç¾ç®€æ´çš„æµç¨‹å›¾ï¼Œåœ¨è¿™é‡Œåˆ†äº«ç»™å¤§å®¶</strong></em></p></blockquote><p><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/202207042134907.png"></p><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">merge_sort</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> l, <span class="type">int</span> r, vector&lt;<span class="type">int</span>&gt;&amp; temp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l + <span class="number">1</span> &gt;= r) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// divide</span></span><br><span class="line">    <span class="type">int</span> m = l + (r - l) / <span class="number">2</span>;</span><br><span class="line">    <span class="built_in">merge_sort</span>(nums, l, m, temp);</span><br><span class="line">    <span class="built_in">merge_sort</span>(nums, m, r, temp);</span><br><span class="line">    <span class="comment">// conquer</span></span><br><span class="line">    <span class="type">int</span> p = l, q = m, i = l;</span><br><span class="line">    <span class="keyword">while</span> (p &lt; m || q &lt; r) &#123;</span><br><span class="line">        <span class="keyword">if</span> (q &gt;= r || (p &lt; m &amp;&amp; nums[p] &lt;= nums[q])) &#123;</span><br><span class="line">            temp[i++] = nums[p++];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            temp[i++] = nums[q++];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = l; i &lt; r; ++i) &#123;</span><br><span class="line">        nums[i] = temp[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å®æˆ˜æŒ‡è·¯"><a href="#å®æˆ˜æŒ‡è·¯" class="headerlink" title="å®æˆ˜æŒ‡è·¯"></a>å®æˆ˜æŒ‡è·¯</h2><blockquote><p><a href="https://leetcode-cn.com/problems/sort-list/"><em><strong>Leetcode 148. Sort List (Medium)</strong></em></a></p></blockquote><p>â€œ<em><strong>å­¦ä¼šä¸€ç§ç®—æ³•çš„æœ€å¥½æ–¹æ³•å°±æ˜¯å»ä½¿ç”¨å®ƒã€‚</strong></em>â€œ<br><em><strong>Get your hand dirtyï¼</strong></em></p><p>è¿™é‡Œç»™å‡ºæˆ‘çš„å®ç°ä»£ç ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode() : val(0), next(nullptr) &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(nullptr) &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x, ListNode *next) : val(x), next(next) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> ListNode* List;</span><br><span class="line">    <span class="function">ListNode* <span class="title">sortList</span><span class="params">(ListNode* head)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">mergesort</span>(head);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function">List <span class="title">mergesort</span><span class="params">(List head)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//å¦‚æœç¬¬ä¸€æˆ–ç¬¬äºŒä¸ªç»“ç‚¹æ˜¯ç©ºç»“ç‚¹ï¼Œåˆ™ä¸ç”¨å½’å¹¶ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">NULL</span> || head-&gt;next == <span class="literal">NULL</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> head;</span><br><span class="line">        &#125;</span><br><span class="line">        List fast, slow, fasttp, l, r;<span class="comment">//è®¾å®šå¿«æ…¢æŒ‡é’ˆæ¥æ‰¾ä¸­é—´ç»“ç‚¹ï¼›</span></span><br><span class="line">        fast = slow = head;</span><br><span class="line">        fasttp = head-&gt;next-&gt;next;</span><br><span class="line">        <span class="keyword">while</span> (fasttp != <span class="literal">NULL</span> &amp;&amp; fasttp-&gt;next != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            slow = slow-&gt;next;</span><br><span class="line">            fasttp = fasttp-&gt;next-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ­¤æ—¶slow-&gt;nextå³ä¸ºä¸­é—´ç»“ç‚¹</span></span><br><span class="line">        <span class="comment">//å¯¹å³è¾¹è¿›è¡Œå½’å¹¶</span></span><br><span class="line">        r = <span class="built_in">mergesort</span>(slow-&gt;next);</span><br><span class="line">        <span class="comment">//ä¸€ä¸ªé“¾è¡¨ç»“æŸçš„æ ‡å¿—æ˜¯nullptrï¼Œæ‰€ä»¥è¿™é‡Œè¿›è¡Œcutæ“ä½œï¼Œå¦åˆ™ä¼šå‡ºç°ä¸€ä¸ªå¾ªç¯çš„æ­»</span></span><br><span class="line">        slow-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">        l = <span class="built_in">mergesort</span>(head);</span><br><span class="line">        <span class="comment">//æœ€åå°†å·¦å³ä¸¤æ®µè¿›è¡Œä¸€ä¸ªåˆå¹¶</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">merge</span>(l, r);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">List <span class="title">merge</span><span class="params">(List l, List r)</span> </span>&#123;</span><br><span class="line">        List temphead = <span class="keyword">new</span> ListNode;</span><br><span class="line">        List p = temphead;</span><br><span class="line">        <span class="keyword">while</span> (l &amp;&amp; r) &#123;</span><br><span class="line">            <span class="keyword">if</span>(l-&gt;val &lt;= r-&gt;val) &#123;</span><br><span class="line">                p-&gt;next = l;</span><br><span class="line">                l = l-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                p-&gt;next = r;</span><br><span class="line">                r = r-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">            p = p-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å½“å·¦è¾¹æœ‰å‰©ä½™æ—¶</span></span><br><span class="line">        <span class="keyword">if</span> (l != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            p-&gt;next = l;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å½“å³è¾¹æœ‰å‰©ä½™æ—¶</span></span><br><span class="line">        <span class="keyword">if</span> (r != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            p-&gt;next = r;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> temphead-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å½’å¹¶æ’åº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C/C++å†…å­˜å¯¹é½é—®é¢˜</title>
      <link href="/archives/af823184.html"/>
      <url>/archives/af823184.html</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä»Šå¤©çƒ­å¿ƒ(huaidan)ç¾¤å‹åœ¨ç¾¤é‡Œå‡ºäº†è¿™æ ·ä¸€ä¸ªé—®é¢˜: <mark class="hl-label pink">è¯·æ¨æµ‹å‡ºä¸‹åˆ—ä»£ç çš„è¾“å‡ºï¼Œåœ¨32ä½ç³»ç»Ÿä¸‹.</mark> </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">myclass</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">float</span> a = <span class="number">1.0f</span>;</span><br><span class="line">    <span class="type">char</span> c = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">    <span class="type">int</span> arr[<span class="number">3</span>];</span><br><span class="line">    <span class="type">int</span> *p;</span><br><span class="line">    <span class="built_in">myclass</span>(): arr&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;, <span class="built_in">p</span>(<span class="keyword">new</span> <span class="type">int</span>[<span class="number">2</span>]) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">myclass</span>() &#123;</span><br><span class="line">        <span class="keyword">delete</span> [] p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    myclass obj; </span><br><span class="line">    cout &lt;&lt; <span class="built_in">sizeof</span>(obj.arr) &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(obj.p) &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(obj);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘çš„ç­”æ¡ˆæ˜¯12 4 25ï¼Œå˜¿å˜¿ï¼Œæˆ‘è¿˜ä¿¡å¿ƒæ»¡æ»¡çš„æã€‚å› ä¸ºæˆ‘å·²ç»æ³¨æ„åˆ°äº†è¦æŠŠè™šå‡½æ•°è¡¨éšå«çš„é‚£æ ¹æŒ‡é’ˆç®—è¿›å»ã€‚ç„¶è€Œæˆ‘è¿˜æ˜¯è¢«å‘äº†ã€‚</p><mark class="hl-label pink">æ­£ç¡®ç­”æ¡ˆå¦‚ä¸‹:</mark> <p><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/202207042134912.png"><br>å‰ä¸¤ä¸ªæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œä¸»è¦æ˜¯ç¬¬ä¸‰ä¸ªè¾“å‡ºã€‚28æ˜¯è¿™ä¹ˆæ¥çš„ï¼š<em><strong>28 &#x3D; vptr4 + f4 + c4 + arr12 + p4</strong></em></p><p>å¦‚æœä½ æ²¡æœ‰æ¥ä¸‹æ¥å°†è¦ä»‹ç»çš„çŸ¥è¯†ï¼Œä¼°è®¡ä½ ä¹Ÿä¼šç–‘æƒ‘ï¼Œä¸ºä»€ä¹ˆcharçš„å¤§å°ä¸æ˜¯1å­—èŠ‚è€Œæ˜¯4å­—èŠ‚å‘¢ï¼Ÿå¦‚æœcharåœ¨è¿™é‡Œçš„å¤§å°ä¸º1å­—èŠ‚ï¼Œç»“æœå°†æ˜¯æˆ‘æ‰€é¢„æµ‹çš„25ã€‚</p><p>ç„¶è€Œäº‹å®å´æ˜¯ï¼Œä¸€ä¸ªç»“æ„ä½“æˆ–ç±»å®šä¹‰å®Œåï¼Œå…¶åœ¨å†…å­˜ä¸­çš„å­˜å‚¨å¹¶ä¸ç­‰äºå…¶æ‰€åŒ…å«çš„å…ƒç´ çš„å®½åº¦ä¹‹å’Œã€‚<br>è¿™å°±æ˜¯<em><strong>å†…å­˜å¯¹é½é—®é¢˜</strong></em></p><p>é¦–å…ˆæ„Ÿè°¢<a href="https://blog.csdn.net/liukun321/article/details/6974282">ç»“æ„ä½“åœ¨å†…å­˜ä¸­çš„å¯¹é½è§„åˆ™ - å’•å”§å’•å”§shubo.lkçš„ä¸“æ  - åšå®¢é¢‘é“ - CSDN.NET</a>è¿™ç¯‡æ–‡ç« çš„ä½œè€…ï¼Œæ­£æ˜¯é€šè¿‡ä»–çš„åšå®¢ï¼Œæˆ‘æ‰çœŸæ­£å¼„æ‡‚äº†å†…å­˜å¯¹é½é—®é¢˜</p><h2 id="åŸåˆ™ä¸€"><a href="#åŸåˆ™ä¸€" class="headerlink" title="åŸåˆ™ä¸€"></a>åŸåˆ™ä¸€</h2><p><em><strong>ç»“æ„ä½“ä¸­å…ƒç´ æ˜¯æŒ‰ç…§å®šä¹‰é¡ºåºä¸€ä¸ªä¸€ä¸ªæ”¾åˆ°å†…å­˜ä¸­å»çš„ï¼Œä½†å¹¶ä¸æ˜¯ç´§å¯†æ’åˆ—çš„ã€‚ä»ç»“æ„ä½“å­˜å‚¨çš„é¦–åœ°å€å¼€å§‹ï¼Œæ¯ä¸€ä¸ªå…ƒç´ æ”¾ç½®åˆ°å†…å­˜ä¸­æ—¶ï¼Œå®ƒéƒ½ä¼šè®¤ä¸ºå†…å­˜æ˜¯ä»¥å®ƒè‡ªå·±çš„å¤§å°æ¥åˆ’åˆ†çš„ï¼Œå› æ­¤å…ƒç´ æ”¾ç½®çš„ä½ç½®ä¸€å®šä¼šåœ¨è‡ªå·±å®½åº¦çš„æ•´æ•°å€ä¸Šå¼€å§‹ï¼ˆä»¥ç»“æ„ä½“å˜é‡é¦–åœ°å€ä¸º0è®¡ç®—ï¼‰ã€‚</strong></em></p><p>æ¯”å¦‚æˆ‘ä»¬ä¸Šé¢ä¸¾çš„ä¾‹å­ï¼Œé¦–å…ˆç³»ç»Ÿä¼šå°†è™šå‡½æ•°è¡¨æŒ‡é’ˆæ”¾å…¥ç¬¬0-3ä¸ªå­—èŠ‚(è¿™é‡ŒæŒ‡çš„æ—¶ç›¸å¯¹åœ°å€ï¼Œå³å†…å­˜å¼€è¾Ÿçš„é¦–åœ°å€)ï¼Œè¿™é‡Œæ˜¯å¦å¤–ä¸€ä¸ªçŸ¥è¯†äº†ï¼Œ<em><strong>è‹¥ä¸€ä¸ªç±»ä¸­æœ‰è™šå‡½æ•°ï¼Œé‚£ä¹ˆä»–çš„è™šå‡½æ•°è¡¨æŒ‡é’ˆå°†æ”¾åœ¨ç±»çš„å¼€å¤´</strong></em>ï¼›ç„¶ååœ¨å­˜æ”¾floatå‹å˜é‡æ—¶ï¼Œä¼šä»¥4ä¸ªå­—èŠ‚ä¸ºå•ä½è¿›è¡Œå­˜å‚¨ï¼Œä¹Ÿå°±æ˜¯åœ¨ç¬¬4-7ä¸ªå­—èŠ‚ï¼›ç„¶åæ˜¯æ”¾å…¥charå‹å˜é‡ï¼Œæ¯ä¸ªcharä»¥1ä¸ªå­—èŠ‚ä¸ºå•ä½è¿›è¡Œå­˜å‚¨ï¼Œä¹Ÿå°±æ˜¯æ”¾åœ¨ç¬¬8ä¸ªå­—èŠ‚ï¼›ç„¶åæ˜¯æ”¾å…¥intå‹æ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„æœ‰3ä¸ªå…ƒç´ ï¼Œä¹Ÿå°±æ˜¯å°†è¦æ”¾å…¥3ä¸ªintï¼Œæ¯ä¸ªintä»¥4ä¸ªå­—èŠ‚ä¸ºå•ä½è¿›è¡Œå­˜å‚¨ï¼Œç”±äºå‰ä¸‰ä¸ªå››å­—èŠ‚æ¨¡å—å·²ç»æœ‰æ•°æ®ï¼Œæ‰€ä»¥è¿™ä¸ªæ•°ç»„ä¼šè¢«å­˜æ”¾åœ¨ç¬¬12-23ä¸ªå­—èŠ‚ï¼›æœ€åæ˜¯æŒ‡é’ˆpï¼Œåœ¨32ä½ç³»ç»Ÿä¸‹æŒ‡é’ˆçš„å®½åº¦ä¸º4ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥ä»–ä¼šè¢«æ”¾åœ¨ç¬¬24-27ä¸ªå­—èŠ‚ã€‚</p><mark class="hl-label pink">æ•´ä½“å­˜å‚¨ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤º:</mark> <p><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/202207042134914.png"><br>åˆ°è¿™é‡Œè¿˜æ²¡å®Œï¼Œè®©æˆ‘ä»¬è¯•ç€æŠŠfloatæ”¹æˆdoubleè¯•è¯•ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">myclass</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">double</span> a = <span class="number">1.0f</span>;</span><br><span class="line">    <span class="type">char</span> c = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">    <span class="type">int</span> arr[<span class="number">3</span>];</span><br><span class="line">    <span class="type">int</span> *p;</span><br><span class="line">    <span class="built_in">myclass</span>(): arr&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;, <span class="built_in">p</span>(<span class="keyword">new</span> <span class="type">int</span>[<span class="number">2</span>]) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">myclass</span>() &#123;</span><br><span class="line">        <span class="keyword">delete</span> [] p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    myclass obj; </span><br><span class="line">    cout &lt;&lt; <span class="built_in">sizeof</span>(obj.arr) &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(obj.p) &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(obj);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰äº†ä¸Šé¢ä»‹ç»çš„åŸåˆ™ä¸€ï¼Œæˆ‘ä»¬ä¸éš¾ç®—å‡ºobjçš„å¤§å°ä¸º <em><strong>36 &#x3D; 8 + 8 + 4 + 12 + 4</strong></em>ï¼Œå’Œä¸Šé¢è®¡ç®—è¿‡ç¨‹ä¸­å”¯ä¸€çš„åŒºåˆ«æ˜¯æˆ‘ä»¬çš„è™šå‡½æ•°è¡¨æŒ‡é’ˆç”±äºdoubleçš„å¯¹é½é—®é¢˜ï¼Œè¢«çœ‹ä½œäº†ä¸€ä¸ª8å­—èŠ‚å¤§å°çš„å•å…ƒã€‚</p><p>ç„¶è€Œäº‹å®å´ä¸æ˜¯è¿™æ ·ã€‚<br><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/202207042134913.png"><br>è€Œè¿™å°±å¼•å‡ºäº†æˆ‘ä»¬çš„ç¬¬äºŒåŸåˆ™ã€‚</p><h2 id="åŸåˆ™äºŒ"><a href="#åŸåˆ™äºŒ" class="headerlink" title="åŸåˆ™äºŒ"></a>åŸåˆ™äºŒ</h2><p><em><strong>åœ¨ç»è¿‡ç¬¬ä¸€åŸåˆ™åˆ†æåï¼Œæ£€æŸ¥è®¡ç®—å‡ºçš„å­˜å‚¨å•å…ƒæ˜¯å¦ä¸ºæ‰€æœ‰å…ƒç´ ä¸­æœ€å®½çš„å…ƒç´ çš„é•¿åº¦çš„æ•´æ•°å€ï¼Œæ˜¯ï¼Œåˆ™ç»“æŸï¼›è‹¥ä¸æ˜¯ï¼Œåˆ™è¡¥é½ä¸ºå®ƒçš„æ•´æ•°å€ã€‚</strong></em></p><p>åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ†æå®Œåçš„å­˜å‚¨é•¿åº¦ä¸º36å­—èŠ‚ï¼Œä¸æ˜¯æœ€å®½å…ƒç´ doubleé•¿åº¦çš„æ•´æ•°å€ï¼Œå› æ­¤å°†36è¡¥é½åˆ°8çš„æ•´æ•°å€ï¼Œä¹Ÿå°±æ˜¯40ã€‚è¿™æ ·å°±æ²¡é—®é¢˜äº†ã€‚</p><mark class="hl-label pink">å…¶å­˜å‚¨ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤º:</mark> <p><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/202207042134915.png"><br>æŒæ¡äº†è¿™ä¸¤ä¸ªåŸåˆ™ï¼Œå°±è¶³ä»¥åˆ†ææ‰€æœ‰æ•°æ®å­˜å‚¨çš„å¯¹é½é—®é¢˜äº†ã€‚å¿«å»æ‰¾å‡ ä¸ªä¾‹å­è¯•è¯•å§ï¼</p><hr><p>è¿™é‡Œè¿›è¡Œä¸€ä¸ªè¡¥å……ï¼šç”±äºstaticæˆå‘˜å¹¶ä¸å±äºç±»çš„å®ä¾‹å¯¹è±¡ï¼Œæ‰€ä»¥åœ¨è®¡ç®—çš„æ—¶å€™è¯·æ³¨æ„ä¸è¦æŠŠstaticæˆå‘˜è€ƒè™‘è¿›æ¥æ~</p>]]></content>
      
      
      <categories>
          
          <category> C/C++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C/C++å†…å­˜å¯¹é½é—®é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºCè¯­è¨€scanfå‡½æ•°åƒäººäº‹ä»¶</title>
      <link href="/archives/66d72fbf.html"/>
      <url>/archives/66d72fbf.html</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¤§ä¸€çš„æ—¶å€™åˆšåˆšæ¥è§¦cè¯­è¨€ï¼Œä½¿ç”¨scanfå‡½æ•°æ€»æ˜¯ä¼šè«åå‡ºç°å„ç§å¥‡æ€ªçš„è¾“å…¥é—®é¢˜ï¼Œæƒ³æƒ³è¿˜çœŸæ˜¯è¸©äº†å¾ˆå¤šå‘æå‘œå‘œã€‚ä¾‹å¦‚è¾“å…¥æ•°æ®æ—¶ï¼Œä¼šå‘ç°è‹¥%dåé¢åŠ äº†ç©ºæ ¼ä¹‹åæŒ‰ä¸‹å›è½¦é”®æ§åˆ¶å°æ²¡æœ‰å“åº”ï¼Œè¿™å…¶å®å°±æ˜¯åƒç©ºç™½è¡Œä¸ºã€‚</p><p>ç»™å˜é‡èµ‹å€¼å®é™…ä¸Šéœ€è¦ä»ç¼“å†²åŒºæå–åˆé€‚çš„æ•°æ®åˆ°å˜é‡ä¸­ï¼Œè€Œç¼“å†²åŒºçš„æ•°æ®å…¶å®æ˜¯ç”±æˆ‘ä»¬çš„é”®ç›˜æ¥è¾“å…¥çš„ã€‚</p><mark class="hl-label pink">ä¸¾ä¸ªä¾‹å­:</mark> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> x = <span class="number">0</span>, y = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;x, &amp;y);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;x = %d\ny = %d&quot;</span>, x, y);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºä¸Šé¢è¿™æ®µä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰ä¸¤ç§è¾“å…¥æ–¹æ³•ã€‚ä¸€ç§æ˜¯è¾“å…¥xçš„å€¼ï¼Œç„¶åç©ºæ ¼ï¼Œç„¶åè¾“å…¥yçš„å€¼</p><p><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/KMI5DOV4BC08U4XH.png"></p><p>å¦ä¸€ç§æ˜¯è¾“å…¥xçš„å€¼ï¼Œå›è½¦ï¼Œç„¶åè¾“å…¥yçš„å€¼</p><p><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/T_6PKH61Z9A@FP7SYO5RO.png"></p><p>ä¸éš¾å‘ç°ï¼Œå…¶å®ä¸¤ç§è¾“å…¥æ–¹å¼çš„å›è½¦å’Œç©ºæ ¼éƒ½æ²¡æœ‰è¢«è¾“å…¥åˆ°yä¸­ï¼Œè¿™æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„ã€‚è¿™æ˜¯å› ä¸º%dçš„åŒ¹é…æœºåˆ¶ï¼Œä¼šä¸æ–­ä¸¢å¼ƒç©ºç™½ç¬¦(<mark class="hl-label pink">åŒ…æ‹¬å›è½¦ï¼Œç©ºç™½ç­‰</mark> )ï¼Œç›´åˆ°å‡ºç°æ•°å­—å­—ç¬¦ï¼Œç„¶åscanfå¼€å§‹è§£ææ•°å­—å­—ç¬¦ä¸²ï¼Œå†å°†è§£æå¥½çš„æ•°å€¼å­˜å…¥åˆ°yä¸­ã€‚è‡³æ­¤ä¸€ä¸ª%dçš„åŒ¹é…å·¥ä½œå®Œæˆï¼Œå½“ç„¶ï¼Œæœ€åç»“æŸè¾“å…¥çš„æ—¶å€™æˆ‘ä»¬è¿˜æŒ‰äº†ä¸€ä¸ªå›è½¦ï¼Œè¿™ä¸ªå›è½¦ä»ç„¶ç•™åœ¨ç¼“å†²åŒºä¸­æ²¡è¢«å¤„ç†ã€‚</p><p>é€šè¿‡ä¸Šè¿°çš„å®éªŒæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œ%dä¼šè‡ªåŠ¨æŠŠç¼“å†²åŒºä¸­æ•°å­—å­—ç¬¦ä¸²ä¹‹å‰çš„ç©ºç™½ç¬¦å…¨éƒ¨æ‰”æ‰ï¼Œä¹Ÿå°±æ˜¯æ°ç©ºç™½è¡Œä¸ºã€‚</p><h2 id="å…³äº-dæ— å“åº”é—®é¢˜"><a href="#å…³äº-dæ— å“åº”é—®é¢˜" class="headerlink" title="å…³äº%dæ— å“åº”é—®é¢˜"></a>å…³äº%dæ— å“åº”é—®é¢˜</h2><p>ç”±äºä½œä¸ºä¸€åcè¯­è¨€å¼±é¸¡ï¼Œå¯¹äºæ ¼å¼åŒ–çš„è¦æ±‚å¾€å¾€éå¸¸éšæ„ï¼Œæˆ‘åœ¨ä½¿ç”¨%dæ—¶å¸¸å¸¸æœ€åé¢é”™è¯¯åœ°å¤šåŠ äº†ä¸€ä¸ªç©ºæ ¼ï¼Œä»è€Œå¯¼è‡´äº†è¾“å…¥æ— æ³•æ­£å¸¸ç»“æŸã€‚ä¹Ÿå°±ä¼šå‘ç”Ÿç»å…¸å‰§æƒ…ï¼Œâ€œ<mark class="hl-label pink">æ˜æ˜æˆ‘ä»¬çš„ä»£ç ä¸€æ¨¡ä¸€æ ·ï¼Œä¸ºä»€ä¹ˆæˆ‘çš„å°±è¿è¡Œä¸äº†å‘œå‘œã€‚</mark> â€ æˆ‘ä»¬éœ€è¦çŸ¥é“ï¼Œå½“%dçš„åŒ¹é…å·¥ä½œå®Œæˆåï¼Œ%dåé¢çš„ç©ºæ ¼å¼€å§‹å·¥ä½œï¼Œç©ºæ ¼æ„å‘³ç€ä¸¢æ‰æ‰€æœ‰ç©ºç™½ç¬¦ï¼Œå› æ­¤æ— è®ºæˆ‘ä»¬è¾“å…¥å¤šå°‘ä¸ªç©ºæ ¼å’Œå›è½¦ï¼Œscanféƒ½ä¸ä¼šæ­£å¸¸ç»“æŸã€‚è¦ä½¿scanfå‡½æ•°ç»“æŸï¼Œæˆ‘ä»¬éœ€è¦è¾“å…¥ä¸€ä¸ªéç©ºç™½å­—ç¬¦ï¼Œæ¥ä½¿å¾—ç©ºæ ¼åƒç©ºç™½ç¬¦çš„å·¥ä½œç»“æŸã€‚</p><p>ç»†å¿ƒçš„åŒå­¦åº”è¯¥å‘ç°äº†ï¼Œå…¶å®æˆ‘ä»¬æœ€åè¾“å…¥çš„é‚£ä¸ªéç©ºç™½ç¬¦ä»»ç„¶ç•™åœ¨ç¼“å†²åŒºä¸­ï¼Œæ²¡æœ‰è¢«å¤„ç†ï¼Œåœ¨ä¸‹æ¬¡è¾“å…¥æ—¶å°±ä¼šè¢«äº‹ä¸æ„¿è¿åœ°è¯»å–ï¼Œæˆ‘ä»¬æ¥çœ‹è¿™ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> x = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d &quot;</span>, &amp;x);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;x = %d\n&quot;</span>, x);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/628H_N7IKDHWOT8T.png"></p><p>ä¸å»ºè®®åœ¨%dåé¢åŠ å…¥ç©ºæ ¼æ</p><h2 id="åƒç©ºç™½çš„å…¶ä»–çƒ¹é¥ªæ–¹å¼"><a href="#åƒç©ºç™½çš„å…¶ä»–çƒ¹é¥ªæ–¹å¼" class="headerlink" title="åƒç©ºç™½çš„å…¶ä»–çƒ¹é¥ªæ–¹å¼"></a>åƒç©ºç™½çš„å…¶ä»–çƒ¹é¥ªæ–¹å¼</h2><p>ç”±äº%dæœ¬èº«å°±ä¼šåƒæ‰æ•´å½¢æ•°å‰é¢çš„æ‰€æœ‰ç©ºç™½ç¬¦ï¼Œæ‰€ä»¥åœ¨%då‰é¢åŠ ä¸åŠ ç©ºæ ¼éƒ½æ— æ‰€è°“æã€‚ä½†æ˜¯å¯¹äºå­—ç¬¦%cæ¥è¯´æƒ…å†µå°±å®Œå…¨ä¸åŒäº†ï¼Œç”±äºç©ºç™½ç¬¦æœ¬èº«ä¹Ÿæ˜¯ä¸€ç§å­—ç¬¦ï¼Œæ‰€ä»¥%cä¼šé”™è¯¯åœ°æŠŠå¤šä½™åœ°ç©ºæ ¼ä»¥åŠå›è½¦ç­‰ä¸œä¸œè¯»å…¥æã€‚</p><p>æˆ‘ä»¬çœ‹ä¸‹é¢çš„ä¸€ç»„ä¾‹å­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> x = <span class="number">0</span>;</span><br><span class="line">  <span class="type">char</span> y = <span class="string">&#x27;&#x27;;</span></span><br><span class="line"><span class="string">  scanf(&quot;%d&quot;, &amp;x);</span></span><br><span class="line"><span class="string">  scanf(&quot;%c&quot;, &amp;y);</span></span><br><span class="line"><span class="string">  printf(&quot;x = %d\ny = %c&quot;, x, y);</span></span><br><span class="line"><span class="string">  return 0;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/8NML31TBKRS@ILNK1M2X.png"></p><p>å¯ä»¥æ˜æ˜¾çœ‹åˆ°ï¼Œç•™åœ¨ç¼“å†²åŒºä¸­çš„ç©ºæ ¼è¢«yè¯»å–äº†ã€‚ä½ å¯ä»¥å»è¯•è¯•ï¼Œè¾“å…¥xçš„å€¼ï¼Œå›è½¦ï¼Œå†è¾“å…¥yçš„å€¼ï¼Œç¼“å†²åŒºä¸­çš„å›è½¦åŒæ ·ä¼šè¢«yè¯»å–ã€‚</p><p>ä¸ºäº†è¾¾åˆ°æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœï¼Œæˆ‘ä»¬å¯ä»¥åœ¨%cå‰é¢åŠ ä¸€ä¸ªç©ºæ ¼ï¼Œæ¥æŠŠç¼“å†²åŒºä¸­å¤šä½™çš„ç©ºç™½ç¬¦åƒæ‰ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> x = <span class="number">0</span>;</span><br><span class="line">  <span class="type">char</span> y = <span class="string">&#x27;&#x27;;</span></span><br><span class="line"><span class="string">  scanf(&quot;%d&quot;, &amp;x);</span></span><br><span class="line"><span class="string">  scanf(&quot; %c&quot;, &amp;y);</span></span><br><span class="line"><span class="string">  printf(&quot;x = %d\ny = %c&quot;, x, y);</span></span><br><span class="line"><span class="string">  return 0;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/PDF0ELCJ7H08KQTBO7A.png"></p><p>æˆ‘ä»¬å¾—åˆ°äº†æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœã€‚</p><p>å› æ­¤ï¼Œå½“æˆ‘ä»¬çš„è¾“å…¥ä¸­ä¸æƒ³é”™è¯¯åœ°è¯»å–ç©ºç™½å­—ç¬¦æ—¶ï¼Œå»ºè®®ä½ åœ¨%cå‰é¢åŠ ä¸Šä¸€ä¸ªç©ºæ ¼ã€‚</p><p>å¯¹äº%sçš„å¤„ç†æ–¹å¼ï¼Œå’Œ%céå¸¸ç›¸ä¼¼ã€‚%sé‡åˆ°ç©ºç™½ç¬¦å°±ä¼šè®¤ä¸ºè¿™ä¸ªå­—ç¬¦ä¸²è¾“å…¥å®Œæ¯•äº†ï¼Œä¸”è¿™ä¸ªç©ºç™½ç¬¦åŠå…¶ä¹‹åçš„è¾“å…¥ä»ç„¶ä¼šç•™åœ¨ç¼“å†²åŒºä¸­ã€‚</p><p>ä¸Šä¾‹å­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> str[<span class="number">20</span>];</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;è¯·è¾“å…¥ä¸€ä¸²å­—ç¬¦ï¼š&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, str);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;è¿™ä¸ªå­—ç¬¦ä¸²ä¸º:%s\n&quot;</span>, str);</span><br><span class="line">  gets(str);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;è¿™ä¸ªå­—ç¬¦ä¸²ä¸º:%s\n&quot;</span>, str);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://anya-1308928365.cos.ap-nanjing.myqcloud.com/blog/WIYCBKZND7_P1HRX.png"><br>è¿™é‡Œæˆ‘ç”¨getså‡½æ•°æŠŠç•™åœ¨ç¼“å†²åŒºä¸­çš„å†…å®¹å…¨éƒ½å–äº†å‡ºæ¥ï¼Œç»“æœå¾ˆæ˜¾ç„¶äº†</p><p>å¯¹äºscanfåƒç©ºç™½è¿™ä¸€æŠ€å·§ï¼Œå…¶å®æ›´å¤šçš„æ˜¯ä¸€ç§æŠ€æœ¯ç»†èŠ‚ï¼Œæ¯”èµ·æ­»è®°ç¡¬èƒŒä»–çš„ç”¨æ³•ï¼Œæ›´é‡è¦çš„æ˜¯æˆ‘ä»¬åº”è¯¥ç†è§£è¿™èƒŒåçš„åŸç†ï¼Œè¿™æ ·æ–¹èƒ½ä»¥ä¸å˜åº”ä¸‡å˜</p>]]></content>
      
      
      <categories>
          
          <category> C </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cè¯­è¨€ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
